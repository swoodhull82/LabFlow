"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[511],{46102:(e,t,s)=>{s.d(t,{Bc:()=>l,ZI:()=>c,k$:()=>d,m_:()=>o});var r=s(95155),a=s(12115),n=s(89613),i=s(59434);let l=n.Kq,o=n.bL,d=n.l9,c=a.forwardRef((e,t)=>{let{className:s,sideOffset:a=4,...l}=e;return(0,r.jsx)(n.UC,{ref:t,sideOffset:a,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});c.displayName=n.UC.displayName},62523:(e,t,s)=>{s.d(t,{p:()=>i});var r=s(95155),a=s(12115),n=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},89511:(e,t,s)=>{s.d(t,{A:()=>ec});var r=s(95155),a=s(19164),n=s(44861),i=s(80644),l=s(76959),o=s(74641),d=s(78039),c=s(24386),u=s(73168),m=s(70831),p=s(92759),x=s(56313),f=s(37140),h=s(52873),g=s(12115),v=s(59434),j=s(59576),b=s(77694),y=s(87481),D=s(50172),N=s(31949),w=s(34301),k=s(80848),T=s(799),A=s(965),M=s(73158),P=s(11429),I=s(77223),S=s(40295),C=s(51920),E=s(24371),_=s(59119),V=s(30285),L=s(46102),O=s(17649);let R=O.bL;O.l9;let z=O.ZL,X=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.hJ,{className:(0,v.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t})});X.displayName=O.hJ.displayName;let J=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsxs)(z,{children:[(0,r.jsx)(X,{}),(0,r.jsx)(O.UC,{ref:t,className:(0,v.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]})});J.displayName=O.UC.displayName;let Y=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};Y.displayName="AlertDialogHeader";let F=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,v.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};F.displayName="AlertDialogFooter";let q=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.hE,{ref:t,className:(0,v.cn)("text-lg font-semibold",s),...a})});q.displayName=O.hE.displayName;let G=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.VY,{ref:t,className:(0,v.cn)("text-sm text-muted-foreground",s),...a})});G.displayName=O.VY.displayName;let $=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.rc,{ref:t,className:(0,v.cn)((0,V.r)(),s),...a})});$.displayName=O.rc.displayName;let B=g.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(O.ZD,{ref:t,className:(0,v.cn)((0,V.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...a})});B.displayName=O.ZD.displayName;var W=s(14636),U=s(85511),Z=s(47262),H=s(62523),K=s(85057),Q=s(62177),ee=s(90221),et=s(55594),es=s(6874),er=s.n(es),ea=s(35695),en=s(74466);let ei=(e,t,s)=>{if("VALIDATION_PROJECT"===s&&t)return"bg-purple-500 hover:bg-purple-600";if("VALIDATION_STEP"===s)return"bg-teal-500 hover:bg-teal-600";if(!e)return"bg-primary hover:bg-primary/90";switch(e.toLowerCase()){case"done":return"bg-green-500 hover:bg-green-600";case"in progress":return"bg-blue-500 hover:bg-blue-600";case"overdue":return"bg-red-500 hover:bg-red-600";case"blocked":return"bg-orange-500 hover:bg-orange-600";case"to do":return"bg-gray-400 hover:bg-gray-500";default:return"bg-primary hover:bg-primary/90"}},el=(e,t)=>{let s="An unexpected error occurred while ".concat(t||"processing your request",".");if(e&&"object"==typeof e){var r,a;"status"in e&&0===e.status?s="Failed to connect to the server while ".concat(t||"processing",". Please check your internet connection."):(null==(r=e.data)?void 0:r.message)?s=e.data.message:e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?s=e.message:(null==(a=e.originalError)?void 0:a.message)&&(s=e.originalError.message),"status"in e&&e.status&&0!==e.status&&(s="".concat(s," (Status: ").concat(e.status,")"))}else"string"==typeof e&&(s=e);return s},eo=et.Ik({title:et.Yj().min(1,"Title is required."),startDate:et.p6().optional(),dueDate:et.p6().optional(),isMilestone:et.zM().optional()}).refine(e=>(!e.isMilestone||!!e.startDate)&&(!e.startDate||!e.dueDate||!!e.isMilestone||!(e.startDate>e.dueDate)),{message:"Start date must be valid. For milestones, date is required. For ranges, start must be <= due.",path:["startDate"]}),ed=e=>{let{task:t,onSave:s,onClose:a}=e,n=(0,Q.mN)({resolver:(0,ee.u)(eo),defaultValues:{title:t.title,startDate:t.startDate?new Date(t.startDate):void 0,dueDate:t.dueDate?new Date(t.dueDate):void 0,isMilestone:"VALIDATION_PROJECT"===t.task_type&&!!t.isMilestone}}),{toast:i}=(0,y.dj)(),[l,o]=(0,g.useState)(!1),[d,c]=(0,g.useState)(!1),[m,p]=(0,g.useState)(!1),x=n.watch("isMilestone"),f=n.watch("startDate");(0,g.useEffect)(()=>{if("VALIDATION_PROJECT"===t.task_type&&x&&f){var e;n.getValues("dueDate")&&(null==(e=n.getValues("dueDate"))?void 0:e.getTime())===f.getTime()||n.setValue("dueDate",f,{shouldValidate:!0})}},[x,f,t.task_type,n]);let h=async e=>{o(!0);let r={title:e.title,startDate:e.startDate,dueDate:e.dueDate};"VALIDATION_PROJECT"===t.task_type&&(r.isMilestone=e.isMilestone,e.isMilestone&&e.startDate&&(r.dueDate=e.startDate));try{await s(t.id,r),a()}catch(e){}finally{o(!1)}};return(0,r.jsxs)("form",{onSubmit:n.handleSubmit(h),className:"space-y-4",children:[(0,r.jsxs)("h4",{className:"font-medium text-sm leading-none",children:["Edit: ",t.title]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(K.J,{htmlFor:"quickEditTitle",children:"Title"}),(0,r.jsx)(H.p,{id:"quickEditTitle",...n.register("title"),className:"mt-1"}),n.formState.errors.title&&(0,r.jsx)("p",{className:"text-xs text-destructive mt-1",children:n.formState.errors.title.message})]}),"VALIDATION_PROJECT"===t.task_type&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(Q.xI,{name:"isMilestone",control:n.control,render:e=>{let{field:t}=e;return(0,r.jsx)(Z.S,{id:"quickEditIsMilestone",checked:t.value,onCheckedChange:t.onChange})}}),(0,r.jsx)(K.J,{htmlFor:"quickEditIsMilestone",className:"text-sm font-normal",children:"Is Milestone"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(K.J,{htmlFor:"quickEditStartDate",children:"Start Date"}),(0,r.jsxs)(W.AM,{open:d,onOpenChange:c,children:[(0,r.jsx)(W.Wv,{asChild:!0,children:(0,r.jsxs)(V.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal mt-1",!n.watch("startDate")&&"text-muted-foreground"),children:[(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4"}),n.watch("startDate")?(0,u.GP)(n.watch("startDate"),"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(W.hl,{className:"w-auto p-0",children:(0,r.jsx)(U.V,{mode:"single",selected:n.watch("startDate"),onSelect:e=>{n.setValue("startDate",e,{shouldValidate:!0}),c(!1)},initialFocus:!0})})]}),n.formState.errors.startDate&&(0,r.jsx)("p",{className:"text-xs text-destructive mt-1",children:n.formState.errors.startDate.message})]}),!("VALIDATION_PROJECT"===t.task_type&&x)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(K.J,{htmlFor:"quickEditDueDate",children:"Due Date"}),(0,r.jsxs)(W.AM,{open:m,onOpenChange:p,children:[(0,r.jsx)(W.Wv,{asChild:!0,children:(0,r.jsxs)(V.$,{variant:"outline",className:(0,v.cn)("w-full justify-start text-left font-normal mt-1",!n.watch("dueDate")&&"text-muted-foreground"),children:[(0,r.jsx)(C.A,{className:"mr-2 h-4 w-4"}),n.watch("dueDate")?(0,u.GP)(n.watch("dueDate"),"PPP"):(0,r.jsx)("span",{children:"Pick a date"})]})}),(0,r.jsx)(W.hl,{className:"w-auto p-0",children:(0,r.jsx)(U.V,{mode:"single",selected:n.watch("dueDate"),onSelect:e=>{n.setValue("dueDate",e,{shouldValidate:!0}),p(!1)},disabled:e=>!!n.watch("startDate")&&e<n.watch("startDate"),initialFocus:!0})})]}),n.formState.errors.dueDate&&(0,r.jsx)("p",{className:"text-xs text-destructive mt-1",children:n.formState.errors.dueDate.message})]}),n.formState.errors.root&&(0,r.jsx)("p",{className:"text-xs text-destructive mt-1",children:n.formState.errors.root.message}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 pt-2",children:[(0,r.jsxs)(V.$,{type:"button",variant:"ghost",onClick:a,disabled:l,children:[(0,r.jsx)(E.A,{className:"mr-2 h-4 w-4"})," Cancel"]}),(0,r.jsxs)(V.$,{type:"submit",disabled:l,children:[l?(0,r.jsx)(D.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"Save"]})]})]})},ec=e=>{let{filterTaskType:t,displayHeaderControls:s="defaultTitle"}=e,{pbClient:C}=(0,j.A)(),{toast:E}=(0,y.dj)(),_=(0,ea.useRouter)(),[O,z]=(0,g.useState)([]),[X,U]=(0,g.useState)(!0),[Z,H]=(0,g.useState)(null),[K,Q]=(0,g.useState)((0,a.w)(new Date)),[ee,et]=(0,g.useState)(30),[es,en]=(0,g.useState)(null),[eo,ec]=(0,g.useState)(null),[em,ep]=(0,g.useState)(null),ex=(0,g.useRef)(null),ef=(0,g.useRef)(null),eh=(0,g.useRef)(null),[eg,ev]=(0,g.useState)(!1),[ej,eb]=(0,g.useState)(null),[ey,eD]=(0,g.useState)(null),[eN,ew]=(0,g.useState)(!1),ek=(0,g.useCallback)(async(e,t)=>{if(!e)return void U(!0);U(!0),H(null);try{let s=(await (0,b.x1)(e,{signal:t})).filter(e=>e.startDate&&e.dueDate&&(0,n.f)(new Date(e.startDate))&&(0,n.f)(new Date(e.dueDate)));z(s),s.length>0||Q((0,a.w)(new Date))}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("GanttChart: Timeline tasks fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=el(s,"fetching timeline data");H(e),E({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Timeline tasks fetch (network error):",e,s)}else{let e=el(s,"fetching timeline data");H(e),E({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Error fetching tasks for timeline (after retries):",e,s)}}finally{U(!1)}},[E]);(0,g.useEffect)(()=>{let e=new AbortController;return C?ek(C,e.signal):U(!0),()=>{e.abort()}},[C,ek]);let{tasksToDisplay:eT,chartStartDate:eA,chartEndDate:eM,totalDaysInView:eP,monthHeaders:eI}=(0,g.useMemo)(()=>{let e=O.map(e=>{let t,s=(0,i.o)(new Date(e.startDate)),r=(0,i.o)(new Date(e.dueDate)),a="VALIDATION_PROJECT"===e.task_type,o="VALIDATION_STEP"===e.task_type;if(o&&e.dependencies&&e.dependencies.length>0){let s=O.find(t=>t.id===e.dependencies[0]&&"VALIDATION_PROJECT"===t.task_type);s&&(t=s.id)}return{...e,startDate:s,dueDate:r,progress:"number"==typeof e.progress&&e.progress>=0&&e.progress<=100?e.progress:0,isMilestone:a&&(!0===e.isMilestone||!1!==e.isMilestone&&(0,n.f)(s)&&(0,n.f)(r)&&(0,l.r)(s,r)),dependencies:Array.isArray(e.dependencies)?e.dependencies:[],isValidationProject:a,isValidationStep:o,parentProjectId:t}}),s=e;if("VALIDATION_PROJECT"===t){let t=e.filter(e=>e.isValidationProject).map(e=>e.id);s=e.filter(e=>e.isValidationProject||e.isValidationStep&&e.parentProjectId&&t.includes(e.parentProjectId))}else"ALL_EXCEPT_VALIDATION"===t?s=e.filter(e=>!e.isValidationProject&&!e.isValidationStep):t&&"VALIDATION_AND_ITS_STEPS"!==t&&(s=e.filter(e=>e.task_type===t));let r=[],a=new Map(s.map(e=>[e.id,e])),p=s.filter(e=>!!e.isValidationProject||!e.isValidationStep||!(e.parentProjectId&&a.has(e.parentProjectId)));for(let e of(p.sort((e,t)=>e.startDate.getTime()-t.startDate.getTime()),p))if(r.push(e),e.isValidationProject){let t=s.filter(t=>t.isValidationStep&&t.parentProjectId===e.id&&a.has(t.id));t.sort((e,t)=>e.startDate.getTime()-t.startDate.getTime()),r.push(...t)}let x=(0,o.p)((0,d.P)(K,2)),f=r.filter(e=>e.startDate<=x&&e.dueDate>=K),h=(0,c.c)(x,K)+1,g=e=>(0,u.GP)(e,"MMM yyyy"),v=[];if(h>0){let e=new Date(K),t={};for(;e<=x;){let s=g(e);t[s]=(t[s]||0)+1,e=(0,m.f)(e,1)}Object.entries(t).forEach(e=>{let[t,s]=e;v.push({name:t,span:s})})}return{tasksToDisplay:f,chartStartDate:K,chartEndDate:x,totalDaysInView:h>0?h:0,monthHeaders:v}},[O,K,t]),eS=(0,g.useMemo)(()=>{let e=new Map;return eT.forEach((t,s)=>{let r=t.startDate,a=t.dueDate;if(eo&&eo.taskId===t.id){var n;let e=Math.round(((null!=(n=eo.currentMouseX)?n:eo.initialMouseX)-eo.initialMouseX)/ee);"drag"===eo.type?(r=(0,m.f)(eo.originalStartDate,e),a=(0,m.f)(eo.originalDueDate,e)):"resize-start"===eo.type?(r=(0,m.f)(eo.originalStartDate,e),r=(0,p.j)([r,(0,m.f)(eo.originalDueDate,-0)]),a=eo.originalDueDate):"resize-end"===eo.type&&(r=eo.originalStartDate,a=(0,m.f)(eo.originalDueDate,e),a=(0,x.T)([a,(0,m.f)(eo.originalStartDate,0)]))}let i=(0,x.T)([r,eA]),l=(0,p.j)([a,eM]),o=t.isValidationProject&&t.isMilestone;if(i>l&&!o)return;let d=(0,c.c)(i,eA),u=o?1:(0,c.c)(l,i)+1;if(u<=0&&!o)return;let f=d*ee,h=o?16:u*ee;o&&(f+=ee/2-8),e.set(t.id,{task:t,index:s,barStartX:f,barEndX:f+h,barWidth:h,barCenterY:48*s+24,isMilestoneRender:o,effectiveStartDate:r,effectiveDueDate:a})}),e},[eT,eA,eM,ee,eo]),eC=(0,g.useMemo)(()=>{let e=[];return eT.forEach(t=>{if(!t.dependencies||0===t.dependencies.length)return;let s=eS.get(t.id);s&&t.dependencies.forEach((r,a)=>{let n=eS.get(r);if(!n)return;let i=n.isMilestoneRender?n.barStartX+8:n.barEndX,l=s.isMilestoneRender?s.barStartX+8:s.barStartX,o=n.barCenterY;n.isMilestoneRender||(o+=8);let d=s.barCenterY;s.isMilestoneRender||(d-=8),n.isMilestoneRender||s.isMilestoneRender||n.index!==s.index||(o=n.barCenterY+8,d=s.barCenterY-12);let c=l-12,u="M ".concat(i," ").concat(o," L ").concat(c," ").concat(o," L ").concat(c," ").concat(d," L ").concat(l," ").concat(d);e.push({id:"dep-".concat(r,"-to-").concat(t.id,"-").concat(a),d:u})})}),e},[eT,eS]),eE=(0,g.useCallback)(async(e,t)=>{if(!C)return;let s=O.find(t=>t.id===e);if(!s)return;let r={...t};t.startDate&&(r.startDate=new Date(t.startDate).toISOString()),t.dueDate&&(r.dueDate=new Date(t.dueDate).toISOString()),"VALIDATION_PROJECT"===s.task_type?t.hasOwnProperty("isMilestone")&&(r.isMilestone=!!t.isMilestone,r.isMilestone&&r.startDate&&!r.dueDate&&(r.dueDate=r.startDate)):(r.isMilestone=!1,t.hasOwnProperty("dependencies")?(null===t.dependencies||void 0===t.dependencies)&&(r.dependencies=[]):delete r.dependencies);try{await (0,b.lC)(C,e,r),E({title:"Task Updated",description:'Task "'.concat(t.title||s.title,'" was successfully updated.')}),C&&ek(C)}catch(e){E({title:"Update Failed",description:el(e,'updating task "'.concat(t.title||s.title,'"')),variant:"destructive"}),C&&ek(C)}},[C,O,E,ek]),e_=(0,g.useCallback)((e,t)=>{if(0!==e.button)return;let s=eS.get(t.id);s&&(e.preventDefault(),e.stopPropagation(),ec({type:"drag",taskId:t.id,initialMouseX:e.clientX,originalStartDate:s.effectiveStartDate,originalDueDate:s.effectiveDueDate}),eh.current&&(eh.current.style.cursor="grabbing"),document.body.style.userSelect="none")},[eS]),eV=(0,g.useCallback)((e,t,s)=>{if(0!==e.button)return;let r=eS.get(t.id);r&&(e.preventDefault(),e.stopPropagation(),ec({type:"start"===s?"resize-start":"resize-end",taskId:t.id,initialMouseX:e.clientX,originalStartDate:r.effectiveStartDate,originalDueDate:r.effectiveDueDate}),eh.current&&(eh.current.style.cursor="ew-resize"),document.body.style.userSelect="none")},[eS]),eL=(0,g.useCallback)((e,t)=>{var s;if(0!==e.button||"VALIDATION_PROJECT"!==t.task_type)return;let r=eS.get(t.id);if(!r||r.isMilestoneRender)return;e.preventDefault(),e.stopPropagation();let a=null==(s=eh.current)?void 0:s.getBoundingClientRect(),n=ex.current;if(!a||!n)return;let i=e.clientX-a.left+n.scrollLeft,l=e.clientY-a.top+n.scrollTop-60;ep({sourceTaskId:t.id,sourceTaskBarEndX:r.barEndX,sourceTaskBarCenterY:r.barCenterY,currentMouseX:i,currentMouseY:l}),eh.current&&(eh.current.style.cursor="crosshair")},[eS]),eO=(0,g.useCallback)(async()=>{if(ej&&C)try{await (0,b.vq)(C,ej.id),E({title:"Task Deleted",description:'Task "'.concat(ej.title,'" has been deleted.')}),ek(C)}catch(e){E({title:"Delete Failed",description:el(e,"deleting task"),variant:"destructive"})}finally{ev(!1),eb(null)}},[ej,C,E,ek]);(0,g.useEffect)(()=>{let e=e=>{if(eo)ec(t=>t?{...t,currentMouseX:e.clientX}:null);else if(em&&eh.current){let t=eh.current.getBoundingClientRect(),s=ex.current;if(!s)return;let r=e.clientX-t.left+s.scrollLeft,a=e.clientY-t.top+s.scrollTop-60;ep(e=>e?{...e,currentMouseX:r,currentMouseY:a}:null)}},t=e=>{if(eo){let e=eS.get(eo.taskId);e&&eE(eo.taskId,{startDate:e.effectiveStartDate,dueDate:e.effectiveDueDate}),ec(null),eh.current&&(eh.current.style.cursor="default"),document.body.style.userSelect=""}else if(em){var t;let s=null==(t=eh.current)?void 0:t.getBoundingClientRect(),r=ex.current;if(s&&r){let t=e.clientX-s.left+r.scrollLeft,a=e.clientY-s.top+r.scrollTop-60,n=null;for(let[e,s]of eS.entries()){if(e===em.sourceTaskId||"VALIDATION_PROJECT"!==s.task.task_type)continue;let r=48*s.index,i=r+48;if(a>=r&&a<=i&&t>=s.barStartX-ee/2&&t<=s.barStartX+ee/2){n=e;break}}if(n){let e=O.find(e=>e.id===em.sourceTaskId),t=O.find(e=>e.id===n);if(e&&t&&"VALIDATION_PROJECT"===e.task_type&&"VALIDATION_PROJECT"===t.task_type){let s=t.dependencies||[],r=e.dependencies||[];s.includes(e.id)||r.includes(t.id)?E({title:"Invalid Dependency",description:"Cannot create duplicate or circular dependency.",variant:"destructive"}):eE(t.id,{dependencies:[...s,e.id]})}}}ep(null),eh.current&&(eh.current.style.cursor="default")}};return(eo||em)&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[eo,em,ee,eS,eE,O,E]);let eR=(e,t)=>{ew(e),e?eD(t):eD(null)};if((0,g.useEffect)(()=>{var e;let t=null,s=()=>{if("right"!==t){if(t="left",ef.current&&ex.current){let e=ex.current.querySelector(".timeline-inner-content-scrollable-body");e&&(e.scrollTop=ef.current.scrollTop)}requestAnimationFrame(()=>t=null)}},r=()=>{if("left"!==t){if(t="right",ef.current&&ex.current){let e=ex.current.querySelector(".timeline-inner-content-scrollable-body");e&&(ef.current.scrollTop=e.scrollTop)}requestAnimationFrame(()=>t=null)}},a=ef.current,n=null==(e=ex.current)?void 0:e.querySelector(".timeline-inner-content-scrollable-body");return null==a||a.addEventListener("scroll",s),null==n||n.addEventListener("scroll",r),()=>{null==a||a.removeEventListener("scroll",s),null==n||n.removeEventListener("scroll",r)}},[eT]),X)return(0,r.jsxs)("div",{className:"flex justify-center items-center py-10 min-h-[300px]",children:[(0,r.jsx)(D.A,{className:"h-8 w-8 animate-spin text-primary"})," ",(0,r.jsx)("p",{className:"ml-2",children:"Loading timeline data..."})]});if(Z)return(0,r.jsxs)("div",{className:"text-center py-10 min-h-[300px]",children:[(0,r.jsx)(N.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Timeline Data"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:Z}),(0,r.jsx)(V.$,{onClick:()=>C&&ek(C),className:"mt-6",children:"Try Again"})]});let ez=(0,i.o)(new Date),eX=(0,h.v)(ez,{start:eA,end:eM}),eJ=eX&&eP>0?(0,c.c)(ez,eA)*ee:0,eY=eP*ee,eF=48*eT.length,eq=()=>(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center text-sm",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"VALIDATION_PROJECT"===t?"No Validation Projects or their steps found for current view.":"ALL_EXCEPT_VALIDATION"===t?"No standard tasks found for current view.":"No tasks found for current view."}),(0,r.jsx)("p",{className:"text-xs mt-1 text-muted-foreground",children:0===O.length?"Ensure tasks have valid start/due dates.":"Try adjusting date range or zoom."})]});return(0,r.jsxs)(L.Bc,{children:[(0,r.jsxs)("div",{ref:eh,className:"gantt-chart-root flex flex-col h-[calc(100vh-200px)] overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-border bg-card flex-shrink-0",children:["addValidationButton"===s?(0,r.jsx)(er(),{href:"/tasks/new?defaultType=VALIDATION_PROJECT",passHref:!0,children:(0,r.jsxs)(V.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Add Validation Project"]})}):(0,r.jsx)("h2",{className:"text-lg font-semibold text-card-foreground",children:"Project Timeline"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(V.$,{variant:"outline",size:"icon",onClick:()=>et(e=>Math.max(15,e-5)),disabled:ee<=15,title:"Zoom Out",children:(0,r.jsx)(k.A,{className:"h-4 w-4"})}),(0,r.jsx)(V.$,{variant:"outline",size:"icon",onClick:()=>et(e=>Math.min(60,e+5)),disabled:ee>=60,title:"Zoom In",children:(0,r.jsx)(T.A,{className:"h-4 w-4"})}),(0,r.jsxs)(V.$,{variant:"outline",size:"sm",onClick:()=>Q(e=>(0,f.a)(e,1)),children:[(0,r.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"Prev"]}),(0,r.jsxs)("span",{className:"font-medium text-sm text-muted-foreground tabular-nums",children:[(0,u.GP)(K,"MMM yyyy")," - ",(0,u.GP)((0,d.P)(K,2),"MMM yyyy")]}),(0,r.jsxs)(V.$,{variant:"outline",size:"sm",onClick:()=>Q(e=>(0,d.P)(e,1)),children:["Next",(0,r.jsx)(M.A,{className:"h-4 w-4 ml-1"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,r.jsxs)("div",{style:{width:"".concat(450,"px")},className:"flex-shrink-0 bg-card border-r border-border flex flex-col",children:[(0,r.jsx)("div",{className:"h-[60px] flex items-center p-2 font-semibold text-xs border-b border-border flex-shrink-0 sticky top-0 bg-card z-20",children:(0,r.jsxs)("div",{className:"grid grid-cols-[40px_1fr_70px_70px_60px_60px] w-full items-center gap-2",children:[(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"WBS"}),(0,r.jsx)("span",{className:"text-muted-foreground uppercase",children:"Task Name"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Start"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"End"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Prog."}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Actions"})]})}),(0,r.jsxs)("div",{ref:ef,className:"overflow-y-auto flex-1",children:[0===eT.length&&!X&&eq(),eT.map((e,t)=>{let s=e.isValidationStep&&e.parentProjectId&&eT.some(t=>t.id===e.parentProjectId),a=e.isValidationProject||e.isValidationStep,n=(0,r.jsxs)("span",{className:(0,v.cn)("font-medium truncate",s?"pl-4":"",a?"cursor-pointer hover:underline":""),title:e.title,children:[s&&(0,r.jsx)(P.A,{className:"inline-block h-3 w-3 mr-1 text-muted-foreground"}),e.title]});return(0,r.jsxs)("div",{className:(0,v.cn)("grid grid-cols-[40px_1fr_70px_70px_60px_60px] items-center gap-2 p-2 border-b border-border text-xs transition-opacity duration-150",!a&&"cursor-default",e.id===es?"bg-primary/10 dark:bg-primary/20":"",eo&&eo.taskId!==e.id&&"draw-dependency"!==eo.type||em&&em.sourceTaskId!==e.id||es&&e.id!==es?"opacity-60":"opacity-100"),style:{height:"".concat(48,"px")},onMouseEnter:()=>en(e.id),onMouseLeave:()=>en(null),children:[(0,r.jsx)("span",{className:"text-center text-muted-foreground",children:t+1}),a?(0,r.jsxs)(W.AM,{open:eN&&(null==ey?void 0:ey.id)===e.id,onOpenChange:t=>eR(t,e),children:[(0,r.jsx)(W.Wv,{asChild:!0,children:n}),(0,r.jsx)(W.hl,{className:"w-96 p-4",side:"bottom",align:"start",children:ey&&(0,r.jsx)(ed,{task:ey,onSave:eE,onClose:()=>ew(!1)})})]}):n,(0,r.jsx)("span",{className:"text-center text-[10px]",children:(0,u.GP)(e.startDate,"ddMMMyy")}),(0,r.jsx)("span",{className:"text-center text-[10px]",children:(0,u.GP)(e.dueDate,"ddMMMyy")}),(0,r.jsxs)("span",{className:"text-center text-[10px] font-semibold",children:[e.progress,"%"]}),(0,r.jsxs)("div",{className:"flex justify-center items-center gap-1 w-full h-full",children:[(0,r.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:e.isValidationProject&&(0,r.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-6 w-6",title:"Add New Step Task for ".concat(e.title),onClick:t=>{t.stopPropagation();let s=new URLSearchParams;s.set("defaultType","VALIDATION_STEP"),s.set("dependsOnValidationProject",e.id),s.set("defaultTitle","Step for: ".concat(e.title)),_.push("/tasks/new?".concat(s.toString()))},children:(0,r.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground hover:text-primary"})})}),(0,r.jsx)("div",{className:"w-6 h-6 flex items-center justify-center",children:(e.isValidationProject||e.isValidationStep)&&(0,r.jsx)(V.$,{variant:"ghost",size:"icon",className:"h-6 w-6",title:"Delete Task: ".concat(e.title),onClick:t=>{t.stopPropagation(),eb(e),ev(!0)},children:(0,r.jsx)(I.A,{className:"h-4 w-4 text-destructive/70 hover:text-destructive"})})})]})]},"".concat(e.id,"-leftpanel"))})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto",ref:ex,children:(0,r.jsxs)("div",{className:"relative timeline-inner-content",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-20 bg-card",children:[(0,r.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:eI.map(e=>"".concat(e.span*ee,"px")).join(" ")||"1fr"},children:[eI.map((e,t)=>(0,r.jsx)("div",{className:"flex items-center justify-center border-r border-border font-semibold text-xs",children:e.name},t)),0===eI.length&&(0,r.jsx)("div",{className:"h-full col-span-1"})]}),(0,r.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:"repeat(".concat(eP>0?eP:1,", ").concat(ee,"px)")},children:[Array.from({length:eP>0?eP:0}).map((e,t)=>{let s=(0,m.f)(eA,t);return(0,r.jsx)("div",{className:(0,v.cn)("flex items-center justify-center border-r border-border text-muted-foreground text-[10px]",(0,l.r)(s,ez)?"bg-primary/10 dark:bg-primary/20":""),title:(0,u.GP)(s,"EEE, MMM d"),children:(0,u.GP)(s,"d")},"".concat(t))}),eP<=0&&(0,r.jsx)("div",{className:"h-full col-span-1"})]})]}),(0,r.jsxs)("div",{className:"relative timeline-inner-content-scrollable-body",style:{height:"".concat(eF,"px"),width:"".concat(eY,"px")},children:[eT.length>0&&(0,r.jsxs)(r.Fragment,{children:[eT.map((e,t)=>(0,r.jsx)("div",{className:"absolute left-0 right-0 border-b border-border/30",style:{top:"".concat((t+1)*48-1,"px"),height:"1px",zIndex:1}},"row-line-".concat(t))),eX&&eP>0&&(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-[2px] bg-destructive/70 z-[5]",style:{left:"".concat(eJ,"px")},title:"Today: ".concat((0,u.GP)(ez,"PPP")),children:(0,r.jsx)("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 bg-destructive text-white text-[8px] px-0.5 rounded-sm",children:"TODAY"})}),eT.map((e,t)=>{var s;let a=eS.get(e.id);if(!a)return null;let{barStartX:n,barWidth:i,isMilestoneRender:l}=a,o=(null==eo?void 0:eo.taskId)===e.id,d=(null==em?void 0:em.sourceTaskId)===e.id;return(0,r.jsxs)(L.m_,{delayDuration:o||d?999999:100,children:[(0,r.jsx)(L.k$,{asChild:!0,children:(0,r.jsxs)("div",{onMouseDown:t=>e_(t,e),onMouseEnter:()=>en(e.id),onMouseLeave:()=>en(null),className:(0,v.cn)("absolute transition-opacity duration-150 ease-in-out group z-10 flex items-center justify-center cursor-grab",ei(e.status,l,e.task_type),!l&&"rounded-sm",o||d?"ring-2 ring-ring ring-offset-background ring-offset-1 shadow-lg":e.id===es?"ring-1 ring-primary/70":"",eo&&eo.taskId!==e.id||em&&em.sourceTaskId!==e.id||es&&e.id!==es?"opacity-50":"opacity-100"),style:{left:"".concat(n,"px"),width:"".concat(i<0?0:i,"px"),top:"".concat(48*t+(l?16:8),"px"),height:l?"".concat(16,"px"):"".concat(32,"px")},children:[!l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"resize-handle absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>eV(t,e,"start"),title:"Resize start date",children:(0,r.jsx)(S.A,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),(0,r.jsx)("div",{className:"resize-handle absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>eV(t,e,"end"),title:"Resize end date",children:(0,r.jsx)(S.A,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),e.isValidationProject&&(0,r.jsx)("div",{className:"dependency-connector absolute right-[-6px] top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary border-2 border-background cursor-crosshair z-30 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:t=>eL(t,e),title:"Draw dependency"})]}),!l&&(null==(s=e.status)?void 0:s.toLowerCase())!=="done"&&void 0!==e.progress&&e.progress>0&&i>0&&(0,r.jsx)("div",{className:"absolute top-0 left-0 h-full bg-black/40 rounded-sm",style:{width:"".concat(e.progress,"%")}}),l&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("svg",{viewBox:"0 0 100 100",className:"w-full h-full fill-current text-white/80",preserveAspectRatio:"none",children:(0,r.jsx)("polygon",{points:"50,0 100,50 50,100 0,50"})})}),!l&&i>.75*ee&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center px-1.5 overflow-hidden",children:(0,r.jsx)("span",{className:"text-[10px] text-white/90 font-medium whitespace-nowrap overflow-hidden text-ellipsis",children:e.title})})]})}),(0,r.jsx)(L.ZI,{className:"p-2 shadow-lg bg-popover text-popover-foreground rounded-md border max-w-xs w-auto z-50",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{className:"font-semibold text-sm",children:[e.title,e.isValidationProject&&e.isMilestone?" (Milestone)":""]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Type: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.task_type.replace(/_/g," ")})]}),("MDL"===e.task_type||"SOP"===e.task_type)&&e.instrument_subtype&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Subtype: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.instrument_subtype})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Status: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.status})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Priority: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.priority})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Progress: ",(0,r.jsxs)("span",{className:"font-medium text-foreground",children:[e.progress||0,"%"]})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Dates: ",(0,u.GP)(e.startDate,"MMM d, yy")," - ",(0,u.GP)(e.dueDate,"MMM d, yy")]}),e.assignedTo_text&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.assignedTo_text})]}),e.dependencies&&e.dependencies.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Depends on:"}),(0,r.jsx)("ul",{className:"list-disc list-inside pl-2 space-y-0.5",children:e.dependencies.map(e=>{let t=O.find(t=>t.id===e);return(0,r.jsx)("li",{className:"text-xs font-medium text-foreground truncate",title:null==t?void 0:t.title,children:(null==t?void 0:t.title)||"Unknown Task"},e)})})]}),(!e.dependencies||0===e.dependencies.length)&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Dependencies: None"})]})})]},"".concat(e.id,"-timeline"))}),em&&(0,r.jsx)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-40",style:{width:eY,height:eF},children:(0,r.jsx)("line",{x1:em.sourceTaskBarEndX,y1:em.sourceTaskBarCenterY,x2:em.currentMouseX,y2:em.currentMouseY,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeDasharray:"4 2"})}),eC.length>0&&(0,r.jsxs)("svg",{className:"absolute top-0 left-0 pointer-events-none",width:eY,height:eF,xmlns:"http://www.w3.org/2000/svg",style:{zIndex:20},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"arrowhead",markerWidth:4.8,markerHeight:3.2,refX:4.4,refY:1.6,orient:"auto-start-reverse",children:(0,r.jsx)("polygon",{points:"0 0, ".concat(4," ").concat(1.6,", 0 ").concat(3.2),fill:"hsl(var(--foreground) / 0.7)"})})}),eC.map(e=>(0,r.jsx)("path",{d:e.d,stroke:"hsl(var(--foreground) / 0.7)",strokeWidth:"1.2",fill:"none",markerEnd:"url(#arrowhead)"},e.id))]})]}),0===eT.length&&!X&&(0,r.jsx)("div",{style:{height:144},className:"flex items-center justify-center",children:eq()})]})]})})]})]}),ej&&(0,r.jsx)(R,{open:eg,onOpenChange:ev,children:(0,r.jsxs)(J,{children:[(0,r.jsxs)(Y,{children:[(0,r.jsx)(q,{children:"Confirm Deletion"}),(0,r.jsxs)(G,{children:['Are you sure you want to delete the task "',ej.title,'"?',"VALIDATION_PROJECT"===ej.task_type&&" Associated step tasks will NOT be automatically deleted and will need to be managed separately.","This action cannot be undone."]})]}),(0,r.jsxs)(F,{children:[(0,r.jsx)(B,{onClick:()=>eb(null),children:"Cancel"}),(0,r.jsx)($,{onClick:eO,className:(0,v.cn)(eu({variant:"destructive"})),children:"Delete Task"})]})]})})]})},eu=(0,en.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}})}}]);