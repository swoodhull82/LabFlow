(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[109],{15100:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>E});var l=a(95155),t=a(12115),r=a(66695),i=a(30285),n=a(62523),c=a(85057),d=a(4884),o=a(59434);let h=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(d.bL,{className:(0,o.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...t,ref:s,children:(0,l.jsx)(d.zi,{className:(0,o.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});h.displayName=d.bL.displayName;var m=a(22346),u=a(59576),f=a(91394),x=a(54165),p=a(59409),j=a(51362),g=a(87481),N=a(50172),v=a(94479),b=a(77223),y=a(59119),w=a(57804),C=a(30645);let S=e=>({id:e.id,email:e.email,name:e.name||e.email.split("@")[0]||"User",role:e.role,sharesPersonalCalendarWith:e.sharesPersonalCalendarWith||[]}),k=async(e,s)=>{try{return(await (0,C.b)(()=>e.collection("users").getFullList({sort:"name",fields:"id,name,email,role"},{signal:null==s?void 0:s.signal}),{...s,context:"fetching all users"})).map(S)}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch users:",e),e}};var L=a(47262),P=a(66424);let A={emailNotifications:"labflow-emailNotificationsEnabled",pushNotifications:"labflow-pushNotificationsEnabled"};function E(){let{user:e,pbClient:s,updateUserAvatar:a,updateUserSelectedIcon:d,clearAvatarAndSelection:o}=(0,u.A)(),{theme:C,setTheme:S}=(0,j.D)(),{toast:E}=(0,g.dj)(),[F,R]=(0,t.useState)(!1),[U,I]=(0,t.useState)(!0),[J,O]=(0,t.useState)(!1),W=(0,t.useRef)(null),[z,B]=(0,t.useState)(!1),[$,_]=(0,t.useState)(!1),[V,Z]=(0,t.useState)([]),[M,T]=(0,t.useState)(!0),[D,q]=(0,t.useState)(new Set),[H,K]=(0,t.useState)(!1);(0,t.useEffect)(()=>{R(!0);let a=localStorage.getItem(A.emailNotifications);null!==a&&I(JSON.parse(a));let l=localStorage.getItem(A.pushNotifications);null!==l&&O(JSON.parse(l));let t=new AbortController;return s&&e?(T(!0),k(s,{signal:t.signal}).then(s=>{Z(s.filter(s=>s.id!==(null==e?void 0:e.id)))}).catch(e=>{(null==e?void 0:e.isAbort)===!0||"string"==typeof(null==e?void 0:e.message)&&e.message.toLowerCase().includes("autocancelled")?console.warn("Users fetch for sharing was cancelled. This is expected on component unmount and is not an error."):(console.error("Failed to load users for sharing:",e),E({title:"Error Loading Users",description:"Could not fetch the list of users for calendar sharing.",variant:"destructive"}))}).finally(()=>{T(!1)})):T(!1),()=>{t.abort()}},[s,E,e]),(0,t.useEffect)(()=>{(null==e?void 0:e.sharesPersonalCalendarWith)&&q(new Set(e.sharesPersonalCalendarWith))},[null==e?void 0:e.sharesPersonalCalendarWith]);let G=async s=>{if(s.target.files&&s.target.files[0]){let l=s.target.files[0];if(!e||!a)return void E({title:"Error",description:"User not available for avatar update.",variant:"destructive"});B(!0),_(!1);try{await a(l)}catch(e){console.error("Avatar upload failed on settings page:",e)}finally{B(!1),W.current&&(W.current.value="")}}},Y=async s=>{if(e&&d){B(!0),_(!1);try{await d(s)}catch(e){console.error("Icon selection failed:",e)}finally{B(!1)}}},Q=async()=>{if(e&&o){B(!0),_(!1);try{await o()}catch(e){console.error("Revert to default failed:",e)}finally{B(!1)}}},X=e=>{q(s=>{let a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},ee=async()=>{if(!s||!e)return void E({title:"Error",description:"Not authenticated. Cannot save sharing settings.",variant:"destructive"});K(!0);try{await s.collection("users").update(e.id,{sharesPersonalCalendarWith:Array.from(D)}),E({title:"Sharing Settings Saved",description:"Your calendar sharing preferences have been updated."})}catch(e){console.error("Failed to save sharing settings:",e),E({title:"Error Saving Settings",description:e.message||"An unexpected error occurred.",variant:"destructive"})}finally{K(!1)}};return F?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Settings"}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-3",children:[(0,l.jsx)("div",{className:"md:col-span-1 space-y-6",children:(0,l.jsxs)(r.Zp,{className:"shadow-md",children:[(0,l.jsxs)(r.aR,{children:[(0,l.jsx)(r.ZB,{className:"text-xl md:text-2xl font-headline",children:"Profile"}),(0,l.jsx)(r.BT,{children:"Update your personal information."})]}),(0,l.jsxs)(r.Wu,{className:"space-y-4",children:[(0,l.jsx)("div",{className:"flex flex-col items-center space-y-2",children:e&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.eu,{className:"h-24 w-24 flex items-center justify-center",children:e.lucideIconComponent?t.createElement(e.lucideIconComponent,{className:"h-full w-full text-muted-foreground"}):e.avatarUrl?(0,l.jsx)(f.BK,{src:e.avatarUrl,alt:e.name||e.email}):null}),(0,l.jsx)("input",{type:"file",ref:W,onChange:G,style:{display:"none"},accept:"image/png, image/jpeg, image/gif"}),(0,l.jsxs)(x.lG,{open:$,onOpenChange:_,children:[(0,l.jsx)(x.zM,{asChild:!0,children:(0,l.jsxs)(i.$,{variant:"outline",size:"sm",disabled:z,children:[z?(0,l.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,z?"Updating...":"Change Photo"]})}),(0,l.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,l.jsxs)(x.c7,{children:[(0,l.jsx)(x.L3,{children:"Change Profile Photo"}),(0,l.jsx)(x.rr,{children:"Choose a chemistry icon, upload your own photo, or revert to the default."})]}),(0,l.jsxs)("div",{className:"space-y-4 py-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-2 text-sm font-medium text-foreground",children:"Select an Icon"}),(0,l.jsx)("div",{className:"grid grid-cols-4 gap-2",children:u.O.map(e=>(0,l.jsx)(i.$,{variant:"outline",size:"icon",className:"h-16 w-16 flex items-center justify-center",onClick:()=>Y(e.name),title:"Select ".concat(e.name),children:(0,l.jsx)(e.component,{className:"h-8 w-8"})},e.name))})]}),(0,l.jsx)(m.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-2 text-sm font-medium text-foreground",children:"Upload Custom Photo"}),(0,l.jsxs)(i.$,{variant:"outline",className:"w-full",onClick:()=>{var e;_(!1),null==(e=W.current)||e.click()},children:[(0,l.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Upload Photo"]})]}),(0,l.jsx)(m.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-2 text-sm font-medium text-foreground",children:"Default"}),(0,l.jsxs)(i.$,{variant:"outline",className:"w-full",onClick:Q,children:[(0,l.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Use Default Lab Icon"]})]})]}),(0,l.jsx)(x.Es,{children:(0,l.jsx)(x.HM,{asChild:!0,children:(0,l.jsx)(i.$,{type:"button",variant:"ghost",children:"Cancel"})})})]})]})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"name",children:"Name"}),(0,l.jsx)(n.p,{id:"name",defaultValue:(null==e?void 0:e.name)||"",disabled:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"email",children:"Email"}),(0,l.jsx)(n.p,{id:"email",type:"email",defaultValue:(null==e?void 0:e.email)||"",readOnly:!0,disabled:!0})]}),(0,l.jsx)(i.$,{className:"w-full",disabled:!0,children:"Save Profile"})]})]})}),(0,l.jsxs)("div",{className:"md:col-span-2 space-y-6",children:[(0,l.jsxs)(r.Zp,{className:"shadow-md",children:[(0,l.jsxs)(r.aR,{children:[(0,l.jsx)(r.ZB,{className:"text-xl md:text-2xl font-headline",children:"Preferences"}),(0,l.jsx)(r.BT,{children:"Customize your LabFlow experience."})]}),(0,l.jsxs)(r.Wu,{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(c.J,{htmlFor:"theme-select",className:"font-medium",children:"Interface Theme"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Choose your preferred interface theme."}),(0,l.jsxs)(p.l6,{value:C,onValueChange:S,children:[(0,l.jsx)(p.bq,{id:"theme-select",className:"w-[180px]",children:(0,l.jsx)(p.yv,{placeholder:"Select theme"})}),(0,l.jsxs)(p.gC,{children:[(0,l.jsx)(p.eb,{value:"light",children:"Light"}),(0,l.jsx)(p.eb,{value:"dark",children:"Dark"}),(0,l.jsx)(p.eb,{value:"system",children:"System"})]})]})]}),(0,l.jsx)(m.w,{}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"notifications-email",className:"font-medium",children:"Email Notifications"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Receive updates via email."})]}),(0,l.jsx)(h,{id:"notifications-email",checked:U,onCheckedChange:I})]}),(0,l.jsx)(m.w,{}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(c.J,{htmlFor:"notifications-push",className:"font-medium",children:"Push Notifications"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"Get real-time alerts in the app."})]}),(0,l.jsx)(h,{id:"notifications-push",checked:J,onCheckedChange:O})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsxs)(i.$,{onClick:()=>{localStorage.setItem(A.emailNotifications,JSON.stringify(U)),localStorage.setItem(A.pushNotifications,JSON.stringify(J)),E({title:"Preferences Saved",description:"Your notification and theme preferences have been updated."})},children:[(0,l.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Save Preferences"]})})]})]}),(0,l.jsxs)(r.Zp,{className:"shadow-md",children:[(0,l.jsxs)(r.aR,{children:[(0,l.jsx)(r.ZB,{className:"text-xl md:text-2xl font-headline",children:"Calendar Sharing"}),(0,l.jsx)(r.BT,{children:"Select users you want to share your personal calendar with."})]}),(0,l.jsx)(r.Wu,{children:M?(0,l.jsxs)("div",{className:"flex items-center justify-center h-48",children:[(0,l.jsx)(N.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,l.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Loading users..."})]}):(0,l.jsx)(P.F,{className:"h-48 rounded-md border p-4",children:(0,l.jsx)("div",{className:"space-y-2",children:V.length>0?V.map(e=>(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(L.S,{id:"share-".concat(e.id),checked:D.has(e.id),onCheckedChange:()=>X(e.id)}),(0,l.jsxs)(c.J,{htmlFor:"share-".concat(e.id),className:"font-normal cursor-pointer",children:[e.name," (",e.email,")"]})]},e.id)):(0,l.jsx)("p",{className:"text-sm text-muted-foreground text-center",children:"No other users available to share with."})})})}),(0,l.jsx)(r.wL,{className:"flex justify-end",children:(0,l.jsxs)(i.$,{onClick:ee,disabled:H||M,children:[H?(0,l.jsx)(N.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Save Sharing Settings"]})})]})]})]})]}):null}},22346:(e,s,a)=>{"use strict";a.d(s,{w:()=>n});var l=a(95155),t=a(12115),r=a(87489),i=a(59434);let n=t.forwardRef((e,s)=>{let{className:a,orientation:t="horizontal",decorative:n=!0,...c}=e;return(0,l.jsx)(r.b,{ref:s,decorative:n,orientation:t,className:(0,i.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",a),...c})});n.displayName=r.b.displayName},47262:(e,s,a)=>{"use strict";a.d(s,{S:()=>c});var l=a(95155),t=a(12115),r=a(76981),i=a(10518),n=a(59434);let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(r.bL,{ref:s,className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...t,children:(0,l.jsx)(r.C1,{className:(0,n.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(i.A,{className:"h-4 w-4"})})})});c.displayName=r.bL.displayName},66424:(e,s,a)=>{"use strict";a.d(s,{F:()=>n});var l=a(95155),t=a(12115),r=a(47655),i=a(59434);let n=t.forwardRef((e,s)=>{let{className:a,children:t,...n}=e;return(0,l.jsxs)(r.bL,{ref:s,className:(0,i.cn)("relative overflow-hidden",a),...n,children:[(0,l.jsx)(r.LM,{className:"h-full w-full rounded-[inherit]",children:t}),(0,l.jsx)(c,{}),(0,l.jsx)(r.OK,{})]})});n.displayName=r.bL.displayName;let c=t.forwardRef((e,s)=>{let{className:a,orientation:t="vertical",...n}=e;return(0,l.jsx)(r.VM,{ref:s,orientation:t,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...n,children:(0,l.jsx)(r.lr,{className:"relative flex-1 rounded-full bg-border"})})});c.displayName=r.VM.displayName},77404:(e,s,a)=>{Promise.resolve().then(a.bind(a,15100))},91394:(e,s,a)=>{"use strict";a.d(s,{BK:()=>c,eu:()=>n,q5:()=>d});var l=a(95155),t=a(12115),r=a(85977),i=a(59434);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(r.bL,{ref:s,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...t})});n.displayName=r.bL.displayName;let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(r._V,{ref:s,className:(0,i.cn)("aspect-square h-full w-full",a),...t})});c.displayName=r._V.displayName;let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(r.H4,{ref:s,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...t})});d.displayName=r.H4.displayName}},e=>{var s=s=>e(e.s=s);e.O(0,[2383,4897,9052,1859,5452,7655,6045,9467,5229,8441,1684,7358],()=>s(77404)),_N_E=e.O()}]);