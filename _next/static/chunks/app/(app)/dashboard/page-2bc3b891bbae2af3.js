(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1536],{30285:(e,t,a)=>{"use strict";a.d(t,{$:()=>c,r:()=>i});var s=a(95155),r=a(12115),o=a(99708),l=a(74466),n=a(59434);let i=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:c=!1,...d}=e,u=c?o.DX:"button";return(0,s.jsx)(u,{className:(0,n.cn)(i({variant:r,size:l,className:a})),ref:t,...d})});c.displayName="Button"},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>l});let s={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var r=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(r||{});let o=new Map;async function l(e,t){let a,r={...s,...t},l=r.context,n=(e,t)=>{let a="[withRetry:".concat(l,"] ").concat(e,". Circuit: ").concat(i.state,".");console.warn(a);let s=Error(a);throw s.isAbort=!0,s.context=l,t&&(s.originalError=t),s};o.has(l)||o.set(l,{state:"CLOSED",failures:0});let i=o.get(l);if("OPEN"===i.state)if(Date.now()<(i.openUntil||0)){let e=Error("Circuit for '".concat(l,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=l,e.openUntil=i.openUntil,e}else i.state="HALF_OPEN",i.failures=0,i.openUntil=void 0,console.log("[withRetry:".concat(l,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===i.state?1:r.maxAttempts;for(let t=1;t<=c;t++){var d,u,m;(null==(d=r.signal)?void 0:d.aborted)&&n("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===i.state||i.failures>0||"OPEN"===i.state)&&(console.log("[withRetry:".concat(l,"] Circuit is now Closed due to successful attempt (was ").concat(i.state,").")),i.state="CLOSED",i.failures=0,i.openUntil=void 0),t}catch(e){if(a=e,(null==(u=r.signal)?void 0:u.aborted)&&n("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(l,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(i.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=l),e;if(r.shouldRetry(e))if(r.onRetry&&r.onRetry(t,c,e),t<c){let e="HALF_OPEN"===i.state?r.delayMs:r.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(m=r.signal)?void 0:m.aborted)&&n("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(l,"] All ").concat(c," attempts failed (Circuit: ").concat(i.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===i.state?(console.warn("[withRetry:".concat(l,"] Circuit failed in HalfOpen state. Re-opening.")),i.state="OPEN",i.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=l):"CLOSED"===i.state&&(i.failures++,console.log("[withRetry:".concat(l,"] Circuit failure count: ").concat(i.failures," (max: ").concat(1,")")),i.failures>=1&&(console.warn("[withRetry:".concat(l,"] Circuit reached max failures. Opening circuit.")),i.state="OPEN",i.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=l)),a;else throw e}}if(a)throw a;throw Error("[withRetry:".concat(l,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},46102:(e,t,a)=>{"use strict";a.d(t,{Bc:()=>n,ZI:()=>d,k$:()=>c,m_:()=>i});var s=a(95155),r=a(12115),o=a(89613),l=a(59434);let n=o.Kq,i=o.bL,c=o.l9,d=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(o.UC,{ref:t,sideOffset:r,className:(0,l.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})});d.displayName=o.UC.displayName},59409:(e,t,a)=>{"use strict";a.d(t,{bq:()=>m,eb:()=>x,gC:()=>p,l6:()=>d,yv:()=>u});var s=a(95155),r=a(12115),o=a(31992),l=a(79556),n=a(77381),i=a(10518),c=a(59434);let d=o.bL;o.YJ;let u=o.WT,m=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(o.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[r,(0,s.jsx)(o.In,{asChild:!0,children:(0,s.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=o.l9.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=o.PP.displayName;let f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,s.jsx)(l.A,{className:"h-4 w-4"})})});f.displayName=o.wn.displayName;let p=r.forwardRef((e,t)=>{let{className:a,children:r,position:l="popper",...n}=e;return(0,s.jsx)(o.ZL,{children:(0,s.jsxs)(o.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...n,children:[(0,s.jsx)(h,{}),(0,s.jsx)(o.LM,{className:(0,c.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(f,{})]})})});p.displayName=o.UC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=o.JU.displayName;let x=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(o.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(o.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),(0,s.jsx)(o.p4,{children:r})]})});x.displayName=o.q7.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(o.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=o.wv.displayName},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>l,aR:()=>n,wL:()=>u});var s=a(95155),r=a(12115),o=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...r})});l.displayName="Card";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...r})});n.displayName="CardHeader";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,o.cn)("font-semibold leading-none tracking-tight",a),...r})});i.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...r})});u.displayName="CardFooter"},68856:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var s=a(95155),r=a(59434);function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,r.cn)("rounded-md bg-muted",t),...a})}},73835:(e,t,a)=>{"use strict";a.d(t,{w:()=>i});var s=a(70831),r=a(96019),o=a(78039),l=a(86622),n=a(63482);function i(e,t){let a=[];return e.forEach(e=>{if(a.push(e),"None"===e.recurrence||!e.dueDate)return;let i=new Date(e.dueDate),c=e.startDate?new Date(e.dueDate).getTime()-new Date(e.startDate).getTime():0,d=1;for(;;){let u=new Date(i);switch(e.recurrence){case"Daily":i=(0,s.f)(u,1);break;case"Weekly":i=(0,r.J)(u,1);break;case"Monthly":i=(0,o.P)(u,1);break;case"Yearly":i=(0,l.e)(u,1);break;default:return}if((0,n.Y)(i,t)){let t=e.startDate?new Date(i.getTime()-c):void 0,s={...e,id:"".concat(e.id,"_proj_").concat(d),dueDate:i,startDate:t,status:"To Do",progress:0,attachments:[],description:"Recurring instance of: ".concat(e.title,". Original due date: ").concat(new Date(e.dueDate).toLocaleDateString())};a.push(s),d++}else break}}),a}},74848:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>es});var s=a(95155),r=a(12115),o=a(66695),l=a(89829),n=a(31949),i=a(763),c=a(58127),d=a(25299),u=a(50286),m=a(80659),h=a(3401),f=a(94754),p=a(96025),x=a(16238),g=a(94517),y=a(24026),v=a(58227),w=a(93504),b=a(21374),j=a(83540),N=a(59434);let k={light:"",dark:".dark"},D=r.createContext(null);function C(){let e=r.useContext(D);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let T=r.forwardRef((e,t)=>{let{id:a,className:o,children:l,config:n,...i}=e,c=r.useId(),d="chart-".concat(a||c.replace(/:/g,""));return(0,s.jsx)(D.Provider,{value:{config:n},children:(0,s.jsxs)("div",{"data-chart":d,ref:t,className:(0,N.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",o),...i,children:[(0,s.jsx)(_,{id:d,config:n}),(0,s.jsx)(j.u,{children:l})]})})});T.displayName="Chart";let _=e=>{let{id:t,config:a}=e,r=Object.entries(a).filter(e=>{let[,t]=e;return t.theme||t.color});return r.length?(0,s.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(k).map(e=>{let[a,s]=e;return"\n".concat(s," [data-chart=").concat(t,"] {\n").concat(r.map(e=>{var t;let[s,r]=e,o=(null==(t=r.theme)?void 0:t[a])||r.color;return o?"  --color-".concat(s,": ").concat(o,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null};g.m;let O=r.forwardRef((e,t)=>{let{active:a,payload:o,className:l,indicator:n="dot",hideLabel:i=!1,hideIndicator:c=!1,label:d,labelFormatter:u,labelClassName:m,formatter:h,color:f,nameKey:p,labelKey:x}=e,{config:g}=C(),y=r.useMemo(()=>{var e;if(i||!(null==o?void 0:o.length))return null;let[t]=o,a="".concat(x||t.dataKey||t.name||"value"),r=E(g,t,a),l=x||"string"!=typeof d?null==r?void 0:r.label:(null==(e=g[d])?void 0:e.label)||d;return u?(0,s.jsx)("div",{className:(0,N.cn)("font-medium",m),children:u(l,o)}):l?(0,s.jsx)("div",{className:(0,N.cn)("font-medium",m),children:l}):null},[d,u,o,i,m,g,x]);if(!a||!(null==o?void 0:o.length))return null;let v=1===o.length&&"dot"!==n;return(0,s.jsxs)("div",{ref:t,className:(0,N.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",l),children:[v?null:y,(0,s.jsx)("div",{className:"grid gap-1.5",children:o.map((e,t)=>{let a="".concat(p||e.name||e.dataKey||"value"),r=E(g,e,a),o=f||e.payload.fill||e.color;return(0,s.jsx)("div",{className:(0,N.cn)("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground","dot"===n&&"items-center"),children:h&&(null==e?void 0:e.value)!==void 0&&e.name?h(e.value,e.name,e,t,e.payload):(0,s.jsxs)(s.Fragment,{children:[(null==r?void 0:r.icon)?(0,s.jsx)(r.icon,{}):!c&&(0,s.jsx)("div",{className:(0,N.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===n,"w-1":"line"===n,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===n,"my-0.5":v&&"dashed"===n}),style:{"--color-bg":o,"--color-border":o}}),(0,s.jsxs)("div",{className:(0,N.cn)("flex flex-1 justify-between leading-none",v?"items-end":"items-center"),children:[(0,s.jsxs)("div",{className:"grid gap-1.5",children:[v?y:null,(0,s.jsx)("span",{className:"text-muted-foreground",children:(null==r?void 0:r.label)||e.name})]}),e.value&&(0,s.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})});function E(e,t,a){if("object"!=typeof t||null===t)return;let s="payload"in t&&"object"==typeof t.payload&&null!==t.payload?t.payload:void 0,r=a;return a in t&&"string"==typeof t[a]?r=t[a]:s&&a in s&&"string"==typeof s[a]&&(r=s[a]),r in e?e[r]:e[a]}O.displayName="ChartTooltip",y.s,r.forwardRef((e,t)=>{let{className:a,hideIcon:r=!1,payload:o,verticalAlign:l="bottom",nameKey:n}=e,{config:i}=C();return(null==o?void 0:o.length)?(0,s.jsx)("div",{ref:t,className:(0,N.cn)("flex items-center justify-center gap-4","top"===l?"pb-3":"pt-3",a),children:o.map(e=>{let t="".concat(n||e.dataKey||"value"),a=E(i,e,t);return(0,s.jsxs)("div",{className:(0,N.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[(null==a?void 0:a.icon)&&!r?(0,s.jsx)(a.icon,{}):(0,s.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==a?void 0:a.label]},e.value)})}):null}).displayName="ChartLegend";var R=a(30285),A=a(59409),P=a(46102),L=a(59576),F=a(77694),I=a(97841),S=a(87481),M=a(80644),B=a(70831),U=a(3567),W=a(19616),Z=a(20908),K=a(56499),Q=a(73168),q=a(86622),H=a(68856),J=a(35695);let z=["MDL","SOP","IA","DOC"],V=[{title:"Active Tasks",value:"0",icon:l.A,description:"Tasks currently in progress or to do.",color:"text-blue-500",bgColor:"bg-blue-50",tasks:[]},{title:"Overdue Tasks",value:"0",icon:n.A,description:"Tasks past their due date.",color:"text-red-500",bgColor:"bg-red-50",tasks:[]},{title:"Upcoming Tasks",value:"0",icon:i.A,description:"Tasks due in the next 7 days.",color:"text-yellow-500",bgColor:"bg-yellow-50",tasks:[]},{title:"Completed Today",value:"0",icon:c.A,description:"Tasks marked as done today.",color:"text-green-500",bgColor:"bg-green-50",tasks:[]}],Y={count:{label:"Tasks"},"To Do":{label:"To Do",color:"hsl(var(--chart-1))"},"In Progress":{label:"In Progress",color:"hsl(var(--chart-2))"},Blocked:{label:"Blocked",color:"hsl(var(--chart-3))"},Done:{label:"Done",color:"hsl(var(--chart-4))"},Overdue:{label:"Overdue",color:"hsl(var(--chart-5))"}},G={activeTasks:{label:"Active Tasks",color:"hsl(var(--chart-2))"}},$=z.reduce((e,t,a)=>{let s=t.replace(/_/g," ");return"IA"===t&&(s="Internal Audit"),"DOC"===t&&(s="DOC"),e[t]={label:"".concat(s," Rate"),color:"hsl(var(--chart-".concat(a%5+1,"))")},e["".concat(t,"_total")]={label:"".concat(s," Total")},e["".concat(t,"_completed")]={label:"".concat(s," Completed")},e},{goalRate:{label:"Goal Rate",color:"hsl(var(--muted-foreground))"}}),X={"To Do":"hsl(var(--chart-1))","In Progress":"hsl(var(--chart-2))",Blocked:"hsl(var(--chart-3))",Done:"hsl(var(--chart-4))",Overdue:"hsl(var(--chart-5))"},ee=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dashboard data",a="An unexpected error occurred while fetching ".concat(t,".");if(e&&"object"==typeof e){if("status"in e&&0===e.status?a="Failed to communicate with the server while fetching ".concat(t,". Please check your connection and try again."):e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?a=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?a=e.message:e.originalError&&"string"==typeof e.originalError.message?a=e.originalError.message:e.message&&"string"==typeof e.message&&(a=e.message),"status"in e&&0!==e.status){let s=e.status,r=t.includes("tasks")?"tasks":t.includes("employees")?"employees":"data";404===s?a="The '".concat(r,"' collection was not found (404). ").concat(a):403===s&&(a="You do not have permission to view ".concat(r," (403). ").concat(a))}}else"string"==typeof e&&(a=e);return a},et=()=>(0,s.jsxs)(o.Zp,{className:"shadow-md",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(H.E,{className:"h-4 w-2/3"}),(0,s.jsx)(H.E,{className:"h-5 w-5 rounded-full"})]}),(0,s.jsxs)(o.Wu,{children:[(0,s.jsx)(H.E,{className:"h-7 w-1/3 mb-2"}),(0,s.jsx)(H.E,{className:"h-3 w-full"})]})]}),ea=()=>(0,s.jsxs)(o.Zp,{className:"shadow-md",children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsx)(H.E,{className:"h-5 w-1/2 mb-1"}),(0,s.jsx)(H.E,{className:"h-4 w-3/4"})]}),(0,s.jsx)(o.Wu,{className:"h-[300px]",children:(0,s.jsx)(H.E,{className:"h-full w-full"})})]});function es(){let{pbClient:e}=(0,L.A)(),{toast:t}=(0,S.dj)(),a=(0,J.useRouter)(),[l,i]=(0,r.useState)(V),[c,j]=(0,r.useState)([]),[N,k]=(0,r.useState)([]),[D,C]=(0,r.useState)(new Date().getFullYear()),[_,E]=(0,r.useState)([]),[H,es]=(0,r.useState)([]),[er,eo]=(0,r.useState)(!0),[el,en]=(0,r.useState)(null),ei=(0,r.useCallback)((e,t)=>{let a=(0,M.o)(new Date),s=(0,B.f)(a,7),r=0,o=0,l=0,n=0,c=[],d=[],u=[],m=[],h={"To Do":0,"In Progress":0,Blocked:0,Done:0,Overdue:0},f={};e.forEach(e=>{let t=e.dueDate?(0,M.o)(new Date(e.dueDate)):null,i="Done"===e.status,p=t&&(0,U.R)(t)&&!(0,W.c)(t)&&!i,x="Overdue"===e.status||p;if("Overdue"===e.status||p?h.Overdue++:e.status&&h.hasOwnProperty(e.status)?h[e.status]++:h["To Do"]++,!i&&!x&&"VALIDATION_PROJECT"!==e.task_type){var g;(null==(g=e.expand)?void 0:g.assignedTo)&&e.expand.assignedTo.length>0&&e.expand.assignedTo.forEach(e=>{e.name&&(f[e.name]=(f[e.name]||0)+1)})}if(i){let t=new Date(e.updated?e.updated:e.created);(0,W.c)(t)&&(n++,m.push(e))}else x&&(o++,d.push(e)),x||"In Progress"!==e.status&&"To Do"!==e.status&&"Blocked"!==e.status||(r++,c.push(e)),!x&&t&&t>=a&&t<s&&(l++,u.push(e))}),i([{...V[0],value:r.toString(),tasks:c},{...V[1],value:o.toString(),tasks:d},{...V[2],value:l.toString(),tasks:u},{...V[3],value:n.toString(),tasks:m}]),j(Object.keys(h).map(e=>({status:e,count:h[e]||0,fill:X[e]||"hsl(var(--muted))"})).filter(e=>e.count>0)),k(Object.entries(f).map(e=>{let[t,a]=e;return{employee:t,activeTasks:a}}).sort((e,t)=>t.activeTasks-e.activeTasks));let p={},x={Q1:{},Q2:{},Q3:{},Q4:{}};z.forEach(e=>{p[e]=0,["Q1","Q2","Q3","Q4"].forEach(t=>{x[t]||(x[t]={}),x[t][e]=0})}),e.forEach(e=>{let a;if("VALIDATION_PROJECT"===e.task_type||"VALIDATION_STEP"===e.task_type||("iDOC"===e.task_type||"oDOC"===e.task_type?a="DOC":z.includes(e.task_type)&&(a=e.task_type),!a))return;let s=e.dueDate?(0,M.o)(new Date(e.dueDate)):null;if(s&&(0,Z.C)(s)===t&&(p[a]=(p[a]||0)+1,"Done"===e.status)){let e=(0,K.F)(s),t="Q".concat(e);x[t][a]=(x[t][a]||0)+1}});let g=[],y=(0,Q.GP)(new Date(t,0,1),"yy"),v=[25,50,75,100],w={};z.forEach(e=>w[e]=0);for(let e=1;e<=4;e++){let t="Q".concat(e),a={},s={};z.forEach(e=>{var r;let o=(null==(r=x[t])?void 0:r[e])||0;w[e]=(w[e]||0)+o;let l=p[e]||0;a[e]=l>0?parseFloat(((w[e]||0)/l*100).toFixed(1)):0,s[e]={total:l,completed:w[e]||0}}),g.push({quarter:"Q".concat(e," '").concat(y),rates:a,totals:s,goalRate:v[e-1]})}E(g)},[]),ec=(0,r.useCallback)(async(e,a)=>{if(!e)return void eo(!0);eo(!0),en(null);try{let t=(0,q.e)(new Date,2),[s,r]=await Promise.all([(0,F.x1)(e,{signal:a,projectionHorizon:t}),(0,I.Oc)(e,{signal:a})]);es(s),ei(s,D)}catch(r){let e=(null==r?void 0:r.isAbort)===!0||"string"==typeof(null==r?void 0:r.message)&&r.message.toLowerCase().includes("autocancelled"),a=(null==r?void 0:r.status)===0&&!e;if(e)console.warn("Dashboard data fetch request was ".concat((null==r?void 0:r.isAbort)?"aborted":"autocancelled","."),r);else if(a){let e=ee(r,"dashboard data");en(e),t({title:"Error Loading Data",description:e,variant:"destructive"}),console.warn("Dashboard data fetch (network error):",e,r)}else{var s;let e=(null==(s=r.message)?void 0:s.toLowerCase().includes("employee"))?"employees":"tasks",a=ee(r,e);en(a),t({title:"Error Loading Data",description:a,variant:"destructive"}),console.warn("Error fetching dashboard data (after retries):",a,r)}}finally{eo(!1)}},[t,ei,D]);(0,r.useEffect)(()=>{let t=new AbortController;return e?ec(e,t.signal):eo(!0),()=>{t.abort()}},[e,ec]),(0,r.useEffect)(()=>{H.length>0&&ei(H,D)},[D,H,ei]);let ed=new Date().getFullYear();return(0,s.jsx)(P.Bc,{children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Dashboard"}),el&&!er?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-10 text-destructive bg-destructive/10 rounded-lg",children:[(0,s.jsx)(n.A,{className:"h-12 w-12"}),(0,s.jsx)("p",{className:"mt-4 text-xl font-semibold",children:"Failed to Load Dashboard Data"}),(0,s.jsx)("p",{className:"text-md mt-1 text-center max-w-md",children:el}),(0,s.jsx)(R.$,{onClick:()=>{e&&ec(e)},className:"mt-6",variant:"destructive",children:"Try Again"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:er?Array.from({length:4}).map((e,t)=>(0,s.jsx)(et,{},t)):!el&&l.map(e=>(0,s.jsxs)(P.m_,{children:[(0,s.jsx)(P.k$,{asChild:!0,children:(0,s.jsxs)(o.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-300",children:[(0,s.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,s.jsx)(o.ZB,{className:"text-sm font-medium",children:e.title}),(0,s.jsx)(e.icon,{className:"h-5 w-5 ".concat(e.color)})]}),(0,s.jsxs)(o.Wu,{children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:e.value}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]})}),(0,s.jsx)(P.ZI,{className:"max-w-xs w-auto bg-card border shadow-lg rounded-md p-2",side:"bottom",align:"center",children:e.tasks&&e.tasks.length>0?(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsxs)("p",{className:"font-semibold text-sm mb-1 text-card-foreground",children:[e.title,":"]}),(0,s.jsx)("ul",{className:"list-disc list-inside space-y-0.5 max-h-60 overflow-y-auto",children:e.tasks.map(e=>(0,s.jsxs)("li",{className:"text-xs text-card-foreground truncate",title:e.title,children:[e.title,e.dueDate&&(0,s.jsxs)("span",{className:"text-muted-foreground text-[10px] ml-1",children:[" (Due: ",(0,Q.GP)(new Date(e.dueDate),"MM/dd"),")"]})]},e.id))})]}):(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"No tasks in this category."})})]},e.title))}),(0,s.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[er?(0,s.jsx)(ea,{}):!el&&(0,s.jsxs)(o.Zp,{className:"shadow-md",children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"font-headline flex items-center",children:[(0,s.jsx)(d.A,{className:"mr-2 h-5 w-5 text-primary"}),"Task Status Distribution"]}),(0,s.jsx)(o.BT,{children:"Overview of tasks by their current status."})]}),(0,s.jsx)(o.Wu,{children:c.length>0?(0,s.jsx)(T,{config:Y,className:"h-[300px] w-full",children:(0,s.jsxs)(h.E,{data:c,layout:"vertical",margin:{left:10,right:30},children:[(0,s.jsx)(f.d,{horizontal:!1}),(0,s.jsx)(p.W,{type:"number",dataKey:"count",allowDecimals:!1}),(0,s.jsx)(x.h,{dataKey:"status",type:"category",tickLine:!1,axisLine:!1,width:80}),(0,s.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},content:(0,s.jsx)(O,{hideLabel:!0})}),(0,s.jsx)(y.s,{}),(0,s.jsx)(v.y,{dataKey:"count",radius:4,style:{cursor:"pointer"},onClick:e=>{e&&e.status&&a.push("/tasks?status=".concat(encodeURIComponent(e.status)))}})]})}):(0,s.jsx)("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No task data available for distribution chart."})})]}),er?(0,s.jsx)(ea,{}):!el&&(0,s.jsxs)(o.Zp,{className:"shadow-md",children:[(0,s.jsxs)(o.aR,{children:[(0,s.jsxs)(o.ZB,{className:"font-headline flex items-center",children:[(0,s.jsx)(u.A,{className:"mr-2 h-5 w-5 text-primary"}),"Active Tasks by Employee"]}),(0,s.jsx)(o.BT,{children:"Breakdown of active non-validation tasks assigned per employee."})]}),(0,s.jsx)(o.Wu,{children:N.length>0?(0,s.jsx)(T,{config:G,className:"h-[300px] w-full",children:(0,s.jsxs)(h.E,{data:N,margin:{top:5,right:20,left:0,bottom:5},children:[(0,s.jsx)(f.d,{strokeDasharray:"3 3",vertical:!1}),(0,s.jsx)(p.W,{dataKey:"employee",type:"category"}),(0,s.jsx)(x.h,{dataKey:"activeTasks",type:"number",allowDecimals:!1}),(0,s.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},content:(0,s.jsx)(O,{})}),(0,s.jsx)(v.y,{dataKey:"activeTasks",fill:"var(--color-activeTasks)",radius:[4,4,0,0]})]})}):(0,s.jsx)("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No active tasks assigned to employees or employee data not loaded."})})]}),er?(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(ea,{})}):!el&&(0,s.jsxs)(o.Zp,{className:"shadow-md md:col-span-2",children:[(0,s.jsx)(o.aR,{children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(o.ZB,{className:"font-headline flex items-center",children:[(0,s.jsx)(m.A,{className:"mr-2 h-5 w-5 text-primary"}),"Quarterly Task Completion Rate (by Type)"]}),(0,s.jsx)(o.BT,{children:"Cumulative completion vs. yearly totals for non-validation tasks."})]}),(0,s.jsxs)(A.l6,{value:D.toString(),onValueChange:e=>C(parseInt(e)),children:[(0,s.jsx)(A.bq,{className:"w-full sm:w-[120px] mt-2 sm:mt-0",children:(0,s.jsx)(A.yv,{placeholder:"Select Year"})}),(0,s.jsx)(A.gC,{children:[ed,ed-1,ed-2].map(e=>(0,s.jsx)(A.eb,{value:e.toString(),children:e},e))})]})]})}),(0,s.jsx)(o.Wu,{children:_.length>0?(0,s.jsx)(T,{config:$,className:"h-[300px] w-full",children:(0,s.jsxs)(w.b,{data:_,margin:{top:5,right:30,left:0,bottom:5},children:[(0,s.jsx)(f.d,{strokeDasharray:"3 3",vertical:!1}),(0,s.jsx)(p.W,{dataKey:"quarter"}),(0,s.jsx)(x.h,{domain:[0,100],tickFormatter:e=>"".concat(e,"%")}),(0,s.jsx)(g.m,{content:e=>{let{active:t,payload:a,label:r}=e;if(t&&a&&a.length){let e=_.find(e=>e.quarter===r);return e?(0,s.jsxs)("div",{className:"p-2 rounded-md border bg-background shadow-lg text-xs",children:[(0,s.jsx)("p",{className:"font-medium text-sm mb-1",children:r}),z.map(t=>{let a=e.rates[t],r=e.totals[t],o=$[t];return void 0!==a||r&&0!==r.total?(0,s.jsxs)("p",{style:{color:(null==o?void 0:o.color)||"inherit"},children:[(null==o?void 0:o.label)||t,": ",void 0!==a?"".concat(a,"%"):"N/A",r&&r.total>0&&" (".concat(r.completed,"/").concat(r.total," yearly)"),r&&0===r.total&&" (0/0 yearly)"]},t):null}),(0,s.jsxs)("p",{style:{color:$.goalRate.color||"inherit"},className:"mt-1",children:["Overall Goal: ",e.goalRate,"%"]})]}):null}return null},cursor:{fill:"hsl(var(--muted))"}}),(0,s.jsx)(y.s,{}),z.map(e=>{var t;return(0,s.jsx)(b.N,{type:"monotone",dataKey:"rates.".concat(e),stroke:"var(--color-".concat(e,")"),strokeWidth:2,dot:{r:4,fill:"var(--color-".concat(e,")")},activeDot:{r:6,fill:"var(--color-".concat(e,")")},name:(null==(t=$[e])?void 0:t.label)||"".concat(e.replace(/_/g," ")," Rate"),connectNulls:!1},e)}),(0,s.jsx)(b.N,{type:"monotone",dataKey:"goalRate",stroke:$.goalRate.color,strokeDasharray:"5 5",strokeWidth:2,dot:{r:4,fill:$.goalRate.color},activeDot:{r:6,fill:$.goalRate.color},name:"Goal Rate"})]})}):(0,s.jsx)("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:"No task data available for the selected year."})})]})]})]})]})})}},77694:(e,t,a)=>{"use strict";a.d(t,{UT:()=>d,lC:()=>u,vq:()=>m,x1:()=>c});var s=a(7140),r=a(30645),o=a(73835);a(97841);let l="tasks",n=(e,t)=>{if(e instanceof s.fp){var a;if(404===e.status)throw Error("Cannot create item: The '".concat(t,"' collection does not exist. Please create it in your PocketBase admin panel."));if(400===e.status&&(null==(a=e.data)?void 0:a.data)){if(e.data.data.id&&e.data.data.id.message)throw Error("There seems to be a configuration issue with your '".concat(t,"' collection. The server is asking for an 'id', which should be automatically generated. Please check in your PocketBase admin panel that the 'id' field is the default system field and not a required text field you created."));let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a.message)}).join("; ");throw Error("Validation failed. Server says: ".concat(a))}}throw console.error("Failed to create item in ".concat(t,":"),e),e},i=e=>({id:e.id,title:e.title||"",task_type:e.task_type,description:e.description,status:e.status,priority:e.priority,startDate:e.startDate?new Date(e.startDate):void 0,dueDate:e.dueDate?new Date(e.dueDate):void 0,assignedTo:e.assignedTo||[],recurrence:e.recurrence||"None",attachments:e.attachments,userId:e.userId,created:new Date(e.created),updated:new Date(e.updated),collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand,progress:e.progress,isMilestone:"boolean"==typeof e.isMilestone&&e.isMilestone,dependencies:Array.isArray(e.dependencies)?e.dependencies:"string"==typeof e.dependencies&&e.dependencies.startsWith("[")?JSON.parse(e.dependencies):[],instrument_subtype:e.instrument_subtype||void 0,method:e.method||void 0}),c=async(e,t)=>{try{let{onRetry:a,signal:s,projectionHorizon:n,...c}=t||{},d={sort:"-created",fields:"id,title,task_type,status,priority,startDate,dueDate,assignedTo,userId,created,updated,progress,isMilestone,dependencies,instrument_subtype,method,recurrence,expand",expand:"assignedTo",...c},u=(await (0,r.b)(()=>e.collection(l).getFullList(d,{signal:s}),{signal:s,context:"fetching tasks list",onRetry:a})).map(i);if(n)return(0,o.w)(u,n);return u}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch tasks:",e),e}},d=async(e,t,a)=>{try{t.has("isMilestone")&&t.set("isMilestone","true"===t.get("isMilestone")?"true":"false");let s=await e.collection(l).create(t,{signal:null==a?void 0:a.signal,expand:"assignedTo"});return i(s)}catch(e){throw n(e,l),e}},u=async(e,t,a,s)=>{try{let{signal:o}=s||{};a instanceof FormData&&a.has("isMilestone")?a.set("isMilestone","true"===a.get("isMilestone")||!0===a.get("isMilestone")?"true":"false"):!(a instanceof FormData)&&a.hasOwnProperty("isMilestone")&&(a.isMilestone=!!a.isMilestone);let n=await (0,r.b)(()=>e.collection(l).update(t,a,{signal:o,expand:"assignedTo"}),{context:"updating task ".concat(t),signal:o});return i(n)}catch(e){throw console.error("Failed to update task ".concat(t,":"),e),e}},m=async(e,t,a)=>{try{let{signal:s}=a||{};await (0,r.b)(()=>e.collection(l).delete(t,{signal:s}),{context:"deleting task ".concat(t),signal:s})}catch(e){throw console.error("Failed to delete task ".concat(t,":"),e),e}}},86249:(e,t,a)=>{Promise.resolve().then(a.bind(a,74848))},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>i,Qu:()=>u,Y$:()=>d,bV:()=>c});var s=a(7140),r=a(30645);let o="employees",l=(e,t)=>{if(e instanceof s.fp){var a;if(404===e.status)throw Error("Cannot create item: The '".concat(t,"' collection does not exist. Please create it in your PocketBase admin panel."));if(400===e.status&&(null==(a=e.data)?void 0:a.data)){if(e.data.data.id&&e.data.data.id.message)throw Error("There seems to be a configuration issue with your '".concat(t,"' collection. The server is asking for an 'id', which should be automatically generated. Please check in your PocketBase admin panel that the 'id' field is the default system field and not a required text field you created."));let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a.message)}).join("; ");throw Error("Validation failed. Server says: ".concat(a))}}throw console.error("Failed to create item in ".concat(t,":"),e),e},n=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,color:e.color,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),i=async(e,t)=>{try{let{onRetry:a,signal:s,...l}=t||{},i={sort:"name",fields:"id,name,email,role,department_text,reportsTo_text,userId,color,created,updated",...l};return(await (0,r.b)(()=>e.collection(o).getFullList(i,{signal:s}),{signal:s,context:"fetching employees list",onRetry:a})).map(n)}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch employees:",e),e}},c=async(e,t,a)=>{try{let s=await e.collection(o).create(t,{signal:null==a?void 0:a.signal});return n(s)}catch(e){throw l(e,o),e}},d=async(e,t,a,s)=>{try{let{signal:l}=s||{},i=await (0,r.b)(()=>e.collection(o).update(t,a,{signal:l}),{context:"updating employee ".concat(t),signal:l});return n(i)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},u=async(e,t,a)=>{try{let{signal:s}=a||{};await (0,r.b)(()=>e.collection(o).delete(t,{signal:s}),{context:"deleting employee ".concat(t),signal:s})}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2383,4897,9052,1859,7164,3168,9613,3185,9467,8441,1684,7358],()=>t(86249)),_N_E=e.O()}]);