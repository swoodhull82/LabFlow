(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{965:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},3567:(e,t,a)=>{"use strict";a.d(t,{R:()=>s});var r=a(35476);function s(e){return+(0,r.a)(e)<Date.now()}},13813:(e,t,a)=>{Promise.resolve().then(a.bind(a,97297))},19164:(e,t,a)=>{"use strict";a.d(t,{w:()=>s});var r=a(35476);function s(e){let t=(0,r.a)(e);return t.setDate(1),t.setHours(0,0,0,0),t}},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>o});let r={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var s=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(s||{});let n=new Map;async function o(e,t){let a,s={...r,...t},o=s.context,i=(e,t)=>{let a="[withRetry:".concat(o,"] ").concat(e,". Circuit: ").concat(l.state,".");console.warn(a);let r=Error(a);throw r.isAbort=!0,r.context=o,t&&(r.originalError=t),r};n.has(o)||n.set(o,{state:"CLOSED",failures:0});let l=n.get(o);if("OPEN"===l.state)if(Date.now()<(l.openUntil||0)){let e=Error("Circuit for '".concat(o,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=o,e.openUntil=l.openUntil,e}else l.state="HALF_OPEN",l.failures=0,l.openUntil=void 0,console.log("[withRetry:".concat(o,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===l.state?1:s.maxAttempts;for(let t=1;t<=c;t++){var d,u,m;(null==(d=s.signal)?void 0:d.aborted)&&i("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===l.state||l.failures>0||"OPEN"===l.state)&&(console.log("[withRetry:".concat(o,"] Circuit is now Closed due to successful attempt (was ").concat(l.state,").")),l.state="CLOSED",l.failures=0,l.openUntil=void 0),t}catch(e){if(a=e,(null==(u=s.signal)?void 0:u.aborted)&&i("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(o,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(l.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=o),e;if(s.shouldRetry(e))if(s.onRetry&&s.onRetry(t,c,e),t<c){let e="HALF_OPEN"===l.state?s.delayMs:s.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(m=s.signal)?void 0:m.aborted)&&i("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(o,"] All ").concat(c," attempts failed (Circuit: ").concat(l.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===l.state?(console.warn("[withRetry:".concat(o,"] Circuit failed in HalfOpen state. Re-opening.")),l.state="OPEN",l.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o):"CLOSED"===l.state&&(l.failures++,console.log("[withRetry:".concat(o,"] Circuit failure count: ").concat(l.failures," (max: ").concat(1,")")),l.failures>=1&&(console.warn("[withRetry:".concat(o,"] Circuit reached max failures. Opening circuit.")),l.state="OPEN",l.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o)),a;else throw e}}if(a)throw a;throw Error("[withRetry:".concat(o,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},50172:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},56313:(e,t,a)=>{"use strict";a.d(t,{T:()=>s});var r=a(35476);function s(e){let t;return e.forEach(function(e){let a=(0,r.a)(e);(void 0===t||t<a||isNaN(Number(a)))&&(t=a)}),t||new Date(NaN)}},70831:(e,t,a)=>{"use strict";a.d(t,{f:()=>n});var r=a(35476),s=a(92084);function n(e,t){let a=(0,r.a)(e);return isNaN(t)?(0,s.w)(e,NaN):(t&&a.setDate(a.getDate()+t),a)}},73158:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},74641:(e,t,a)=>{"use strict";a.d(t,{p:()=>s});var r=a(35476);function s(e){let t=(0,r.a)(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}},76959:(e,t,a)=>{"use strict";a.d(t,{r:()=>s});var r=a(80644);function s(e,t){return+(0,r.o)(e)==+(0,r.o)(t)}},78039:(e,t,a)=>{"use strict";a.d(t,{P:()=>n});var r=a(35476),s=a(92084);function n(e,t){let a=(0,r.a)(e);if(isNaN(t))return(0,s.w)(e,NaN);if(!t)return a;let n=a.getDate(),o=(0,s.w)(e,a.getTime());return(o.setMonth(a.getMonth()+t+1,0),n>=o.getDate())?o:(a.setFullYear(o.getFullYear(),o.getMonth(),n),a)}},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>c});var r=a(95155);a(12115);var s=a(965),n=a(73158),o=a(86374),i=a(59434),l=a(30285);function c(e){let{className:t,classNames:a,showOutsideDays:c=!0,...d}=e;return(0,r.jsx)(o.hv,{showOutsideDays:c,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(s.A,{className:(0,i.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(n.A,{className:(0,i.cn)("h-4 w-4",t),...a})}},...d})}c.displayName="Calendar"},92759:(e,t,a)=>{"use strict";a.d(t,{j:()=>s});var r=a(35476);function s(e){let t;return e.forEach(e=>{let a=(0,r.a)(e);(!t||t>a||isNaN(+a))&&(t=a)}),t||new Date(NaN)}},97297:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var r=a(95155),s=a(85511),n=a(66695),o=a(12115),i=a(73168),l=a(80644),c=a(3567),d=a(76959),u=a(39140),m=a(35476),f=a(30285),p=a(59576),g=a(30645);let h=e=>({id:e.id,title:e.title,eventDate:e.dueDate?new Date(e.dueDate):new Date,description:e.description,status:e.status,userId:e.userId,created:e.created?new Date(e.created):new Date,updated:e.updated?new Date(e.updated):new Date,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),w=async(e,t)=>{try{let{signal:a,...r}=t||{},s={filter:'dueDate != null && dueDate != ""',sort:"-dueDate",fields:"id,title,dueDate,description,status,userId,created,updated",...r};return(await (0,g.b)(()=>e.collection("tasks").getFullList(s,{signal:a}),{...t,context:"fetching tasks for calendar"})).map(h).filter(e=>e.eventDate)}catch(e){throw e}};var y=a(87481),x=a(50172),b=a(31949);let v=e=>{let t="An unexpected error occurred while fetching tasks for the calendar.";if(e&&"object"==typeof e){if("status"in e&&0===e.status)t="Failed to load calendar tasks: Could not connect to the server. Please check your internet connection and try again.";else if(e.data&&"object"==typeof e.data){if(e.data.message&&"string"==typeof e.data.message&&(t=e.data.message),e.data.data&&"object"==typeof e.data.data&&Object.keys(e.data.data).length>0){let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a&&a.message?a.message:"Invalid value")}).join("; ");t=a?"".concat(t,". Details: ").concat(a):t}}else e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message);if("status"in e&&0!==e.status){let a=e.status;404===a?t="The 'tasks' collection (used for calendar events) was not found (404). ".concat(t):403===a?t="You do not have permission to view tasks for the calendar (403). ".concat(t):400===a&&(t=t.toLowerCase().includes("something went wrong")||t.startsWith("PocketBase_ClientResponseError")||e.data&&0===Object.keys(e.data.data||{}).length?"Request error (400): ".concat(t,". Please check the 'tasks' collection schema, especially ensure 'dueDate' exists and is a sortable Date type."):"Request error (400) when fetching tasks for calendar: ".concat(t,"."))}}else"string"==typeof e&&(t=e);return t};function N(){let{pbClient:e}=(0,p.A)(),{toast:t}=(0,y.dj)(),[a,g]=(0,o.useState)([]),[h,N]=(0,o.useState)(!0),[D,k]=(0,o.useState)(null),[C,E]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{E(new Date)},[]);let j=(0,o.useCallback)(async(e,a)=>{if(!e)return void N(!0);N(!0),k(null);try{let t=await w(e,{signal:a});g(t)}catch(r){let e=(null==r?void 0:r.isAbort)===!0||"string"==typeof(null==r?void 0:r.message)&&r.message.toLowerCase().includes("autocancelled"),a=(null==r?void 0:r.status)===0&&!e;if(e)console.warn("Calendar events (tasks) fetch request was ".concat((null==r?void 0:r.isAbort)?"aborted":"autocancelled","."),r);else if(a){let e=v(r);k(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Calendar events (tasks) fetch (network error):",e,r)}else{let e=v(r);k(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Error fetching tasks for calendar (after retries):",e,r)}}finally{N(!1)}},[t]);(0,o.useEffect)(()=>{let t=new AbortController;return e?j(e,t.signal):N(!0),()=>{t.abort()}},[e,j]);let A=(0,o.useMemo)(()=>C?a.filter(e=>e.eventDate&&(0,i.GP)(new Date(e.eventDate),"yyyy-MM-dd")===(0,i.GP)(C,"yyyy-MM-dd")):[],[C,a]),{overdueEventDates:O,completedEventDates:_,almostDueEventDates:P,activeEventDates:L}=(0,o.useMemo)(()=>{let e=(0,l.o)(new Date),t=[],r=[],s=[],n=[];return a.forEach(a=>{if(!a.eventDate||!a.status)return;let o=(0,l.o)(new Date(a.eventDate));if("Done"===a.status)r.push(o);else if((0,c.R)(o)&&!(0,d.r)(o,e))t.push(o);else{let t=(0,u.m)(o,e);if(t>=0&&t<3)s.push(o);else(+(0,m.a)(o)>Date.now()||(0,d.r)(o,e))&&n.push(o)}}),{overdueEventDates:[...new Set(t.map(e=>e.getTime()))].map(e=>new Date(e)),completedEventDates:[...new Set(r.map(e=>e.getTime()))].map(e=>new Date(e)),almostDueEventDates:[...new Set(s.map(e=>e.getTime()))].map(e=>new Date(e)),activeEventDates:[...new Set(n.map(e=>e.getTime()))].map(e=>new Date(e))}},[a]);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Task Calendar"}),h&&(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(x.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading tasks for calendar..."})]}),D&&!h&&(0,r.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,r.jsx)(b.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Calendar Data"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:D}),(0,r.jsx)(f.$,{onClick:()=>{e&&j(e)},className:"mt-6",children:"Try Again"})]}),!h&&!D&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)(n.Zp,{className:"lg:col-span-2 shadow-md",children:(0,r.jsx)(n.Wu,{className:"p-0",children:(0,r.jsx)(s.V,{mode:"single",selected:C,onSelect:E,className:"rounded-md",modifiers:{completed:_,overdue:O,almostDue:P,active:L},modifiersClassNames:{completed:"!bg-green-100 !text-green-800 dark:!bg-green-800/30 dark:!text-green-200 border !border-green-300 dark:!border-green-700 rounded-md",overdue:"!bg-red-100 !text-red-800 dark:!bg-red-800/30 dark:!text-red-200 border !border-red-300 dark:!border-red-700 rounded-md",almostDue:"!bg-yellow-100 !text-yellow-800 dark:!bg-yellow-700/30 dark:!text-yellow-200 border !border-yellow-300 dark:!border-yellow-600 rounded-md",active:"!bg-blue-100 !text-blue-800 dark:!bg-blue-800/30 dark:!text-blue-200 border !border-blue-300 dark:!border-blue-700 rounded-md"}})})}),(0,r.jsxs)(n.Zp,{className:"shadow-md",children:[(0,r.jsx)(n.aR,{children:(0,r.jsxs)(n.ZB,{className:"font-headline",children:["Tasks for ",C?(0,i.GP)(C,"PPP"):"selected date"]})}),(0,r.jsx)(n.Wu,{children:A.length>0?(0,r.jsx)("ul",{className:"space-y-3",children:A.map(e=>(0,r.jsxs)("li",{className:"p-3 rounded-md border hover:bg-muted transition-colors",children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No tasks due on this day."})})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[383,977,374,666,441,303,358],()=>t(13813)),_N_E=e.O()}]);