(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{3567:(e,t,a)=>{"use strict";a.d(t,{R:()=>s});var r=a(35476);function s(e){return+(0,r.a)(e)<Date.now()}},13813:(e,t,a)=>{Promise.resolve().then(a.bind(a,20923))},20923:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(95155),s=a(85511),n=a(66695),o=a(12115),i=a(73168),c=a(80644),l=a(86622),d=a(44861),u=a(3567),m=a(76959),f=a(39140),p=a(35476),h=a(70831),x=a(19164),y=a(34548),g=a(65119),w=a(74641),v=a(30285),D=a(59576),b=a(30645),N=a(73835);let j=e=>({id:e.id,title:e.title,eventDate:e.dueDate?new Date(e.dueDate):new Date,description:e.description,status:e.status,userId:e.userId,created:e.created?new Date(e.created):new Date,updated:e.updated?new Date(e.updated):new Date,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),C=e=>({id:e.id,title:e.title||"",task_type:e.task_type,description:e.description,status:e.status,priority:e.priority,startDate:e.startDate?new Date(e.startDate):void 0,dueDate:e.dueDate?new Date(e.dueDate):void 0,assignedTo_text:e.assignedTo_text,recurrence:e.recurrence||"None",attachments:e.attachments,userId:e.userId,created:new Date(e.created),updated:new Date(e.updated),collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand,progress:e.progress,isMilestone:"boolean"==typeof e.isMilestone&&e.isMilestone,dependencies:Array.isArray(e.dependencies)?e.dependencies:"string"==typeof e.dependencies&&e.dependencies.startsWith("[")?JSON.parse(e.dependencies):[],instrument_subtype:e.instrument_subtype||void 0,method:e.method||void 0}),k=async(e,t)=>{try{let{signal:a,projectionHorizon:r,...s}=t||{},n={filter:'dueDate != null && dueDate != ""',sort:"-dueDate",fields:"id,title,task_type,dueDate,description,status,userId,created,updated,recurrence,startDate,priority,progress,isMilestone,dependencies,instrument_subtype,method",...s},o=(await (0,b.b)(()=>e.collection("tasks").getFullList(n,{signal:a}),{...t,context:"fetching tasks for calendar"})).map(C);return(r?(0,N.w)(o,r):o).map(j).filter(e=>e.eventDate)}catch(e){throw e}};var _=a(87481);let A=(0,a(40157).A)("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);var P=a(50172),M=a(31949),O=a(965),E=a(73158),R=a(59434);let T=e=>{let t="An unexpected error occurred while fetching tasks for the calendar.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load calendar tasks: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data?e.data.message&&"string"==typeof e.data.message&&(t=e.data.message):e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")&&(t=e.message),"status"in e&&0!==e.status){let a=e.status;404===a?t="The 'tasks' collection was not found (404).":403===a&&(t="You do not have permission to view tasks for the calendar (403).")}}else"string"==typeof e&&(t=e);return t};function L(e){let{date:t,tasksForDay:a}=e,s=(0,i.GP)(t,"d"),n=Math.min(a.length,4);return(0,r.jsxs)("div",{className:"relative h-full w-full flex flex-col items-center justify-center",children:[(0,r.jsx)("span",{children:s}),n>0&&(0,r.jsx)("div",{className:"absolute bottom-1 flex items-center justify-center",children:Array.from({length:n}).map((e,t)=>(0,r.jsx)(A,{className:"h-3 w-3 -mx-1 text-primary/70"},t))})]})}function S(){let{pbClient:e}=(0,D.A)(),{toast:t}=(0,_.dj)(),[a,b]=(0,o.useState)([]),[N,j]=(0,o.useState)(!0),[C,A]=(0,o.useState)(null),[S,F]=(0,o.useState)(new Date),[I,H]=(0,o.useState)({from:(0,c.o)(new Date),to:(0,c.o)(new Date)}),G=(0,o.useCallback)(async(e,a)=>{if(!e)return void j(!0);j(!0),A(null);try{let t=(0,l.e)(new Date,2),r=await k(e,{signal:a,projectionHorizon:t});b(r)}catch(e){if((null==e?void 0:e.isAbort)===!0||"string"==typeof(null==e?void 0:e.message)&&e.message.toLowerCase().includes("autocancelled"))console.warn("Calendar events (tasks) fetch request was ".concat((null==e?void 0:e.isAbort)?"aborted":"autocancelled","."),e);else{let a=T(e);A(a),t({title:"Error Loading Calendar Data",description:a,variant:"destructive"}),console.warn("Error fetching tasks for calendar (after retries):",a,e)}}finally{j(!1)}},[t]);(0,o.useEffect)(()=>{let t=new AbortController;return e?G(e,t.signal):j(!0),()=>{t.abort()}},[e,G]);let{tasksByDay:U,statusModifiers:z}=(0,o.useMemo)(()=>{let e=new Map,t={completed:new Set,overdue:new Set,almostDue:new Set,active:new Set},r=(0,c.o)(new Date);for(let s of a){if(!s.eventDate||!(0,d.f)(new Date(s.eventDate)))continue;let a=(0,c.o)(new Date(s.eventDate)),n=(0,i.GP)(a,"yyyy-MM-dd");if(e.has(n)||e.set(n,[]),e.get(n).push(s),"Done"===s.status)t.completed.add(a.getTime());else if((0,u.R)(a)&&!(0,m.r)(a,r))t.overdue.add(a.getTime());else{let e=(0,f.m)(a,r);if(e>=0&&e<3)t.almostDue.add(a.getTime());else(+(0,p.a)(a)>Date.now()||(0,m.r)(a,r))&&t.active.add(a.getTime())}}return{tasksByDay:e,statusModifiers:{completed:Array.from(t.completed).map(e=>new Date(e)),overdue:Array.from(t.overdue).map(e=>new Date(e)),almostDue:Array.from(t.almostDue).map(e=>new Date(e)),active:Array.from(t.active).map(e=>new Date(e))}}},[a]),W=(0,o.useMemo)(()=>{if(!(null==I?void 0:I.from))return[];let e=(0,c.o)(I.from),t=I.to?(0,c.o)(I.to):e,a=[];for(let r=e;r<=t;r=(0,h.f)(r,1)){let e=(0,i.GP)(r,"yyyy-MM-dd");U.has(e)&&a.push(...U.get(e))}return a.sort((e,t)=>new Date(e.eventDate).getTime()-new Date(t.eventDate).getTime())},[I,U]),$=(0,o.useMemo)(()=>(null==I?void 0:I.from)?!I.to||(0,m.r)(I.from,I.to)?(0,i.GP)(I.from,"PPP"):"".concat((0,i.GP)(I.from,"PPP")," - ").concat((0,i.GP)(I.to,"PPP")):"No date selected",[I]);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Task Calendar"}),N?(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(P.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading tasks for calendar..."})]}):C?(0,r.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,r.jsx)(M.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Calendar Data"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:C}),(0,r.jsx)(v.$,{onClick:()=>{e&&G(e)},className:"mt-6",children:"Try Again"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.Zp,{className:"shadow-md",children:[(0,r.jsxs)(n.aR,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(v.$,{variant:"outline",size:"icon",onClick:()=>{F(e=>(0,h.f)((0,x.w)(e),-1))},children:(0,r.jsx)(O.A,{className:"h-4 w-4"})}),(0,r.jsx)(v.$,{variant:"outline",size:"icon",onClick:()=>{F(e=>(0,h.f)((0,x.w)(e),32))},children:(0,r.jsx)(E.A,{className:"h-4 w-4"})}),(0,r.jsx)("h2",{className:"text-lg font-semibold ml-2",children:(0,i.GP)(S,"MMMM yyyy")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsx)(v.$,{variant:"outline",size:"sm",onClick:()=>H({from:new Date,to:new Date}),children:"Today"}),(0,r.jsx)(v.$,{variant:"outline",size:"sm",onClick:()=>H({from:(0,y.k)(new Date),to:(0,g.$)(new Date)}),children:"This Week"}),(0,r.jsx)(v.$,{variant:"outline",size:"sm",onClick:()=>H({from:(0,x.w)(new Date),to:(0,w.p)(new Date)}),children:"This Month"})]})]}),(0,r.jsx)(n.Wu,{children:(0,r.jsx)(s.V,{mode:"range",month:S,onMonthChange:F,selected:I,onSelect:H,disabled:u.R,numberOfMonths:2,className:"p-0",classNames:{day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary/90 text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground rounded-full",day_range_middle:"aria-selected:bg-primary/20 aria-selected:text-primary-foreground rounded-none"},modifiers:z,modifiersClassNames:{completed:"!bg-green-100 dark:!bg-green-900/50",overdue:"!bg-red-100 dark:!bg-red-900/50",almostDue:"!bg-yellow-100 dark:!bg-yellow-800/50",active:"!bg-blue-100 dark:!bg-blue-900/50"},components:{DayContent:e=>(0,r.jsx)(L,{date:e.date,tasksForDay:U.get((0,i.GP)(e.date,"yyyy-MM-dd"))||[]})}})})]}),(0,r.jsxs)(n.Zp,{children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsxs)(n.ZB,{className:"font-headline",children:["Tasks for: ",$]}),(0,r.jsxs)(n.BT,{children:[W.length," task(s) found in the selected period."]})]}),(0,r.jsx)(n.Wu,{children:W.length>0?(0,r.jsx)("ul",{className:"space-y-3",children:W.map(e=>(0,r.jsx)("li",{className:"p-3 rounded-md border bg-card hover:bg-muted transition-colors",children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]}),(0,r.jsxs)("div",{className:"text-right flex-shrink-0 ml-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium",children:(0,i.GP)(new Date(e.eventDate),"MMM dd")}),(0,r.jsx)("p",{className:(0,R.cn)("text-xs","Done"===e.status?"text-green-600":"text-muted-foreground"),children:e.status})]})]})},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground py-8 text-center",children:"No tasks scheduled for the selected period."})})]})]})]})}},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>o});let r={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var s=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(s||{});let n=new Map;async function o(e,t){let a,s={...r,...t},o=s.context,i=(e,t)=>{let a="[withRetry:".concat(o,"] ").concat(e,". Circuit: ").concat(c.state,".");console.warn(a);let r=Error(a);throw r.isAbort=!0,r.context=o,t&&(r.originalError=t),r};n.has(o)||n.set(o,{state:"CLOSED",failures:0});let c=n.get(o);if("OPEN"===c.state)if(Date.now()<(c.openUntil||0)){let e=Error("Circuit for '".concat(o,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=o,e.openUntil=c.openUntil,e}else c.state="HALF_OPEN",c.failures=0,c.openUntil=void 0,console.log("[withRetry:".concat(o,"] Circuit is now HalfOpen. Allowing one attempt."));let l="HALF_OPEN"===c.state?1:s.maxAttempts;for(let t=1;t<=l;t++){var d,u,m;(null==(d=s.signal)?void 0:d.aborted)&&i("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===c.state||c.failures>0||"OPEN"===c.state)&&(console.log("[withRetry:".concat(o,"] Circuit is now Closed due to successful attempt (was ").concat(c.state,").")),c.state="CLOSED",c.failures=0,c.openUntil=void 0),t}catch(e){if(a=e,(null==(u=s.signal)?void 0:u.aborted)&&i("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(o,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(c.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=o),e;if(s.shouldRetry(e))if(s.onRetry&&s.onRetry(t,l,e),t<l){let e="HALF_OPEN"===c.state?s.delayMs:s.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(m=s.signal)?void 0:m.aborted)&&i("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(o,"] All ").concat(l," attempts failed (Circuit: ").concat(c.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===c.state?(console.warn("[withRetry:".concat(o,"] Circuit failed in HalfOpen state. Re-opening.")),c.state="OPEN",c.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o):"CLOSED"===c.state&&(c.failures++,console.log("[withRetry:".concat(o,"] Circuit failure count: ").concat(c.failures," (max: ").concat(1,")")),c.failures>=1&&(console.warn("[withRetry:".concat(o,"] Circuit reached max failures. Opening circuit.")),c.state="OPEN",c.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o)),a;else throw e}}if(a)throw a;throw Error("[withRetry:".concat(o,"] Unexpected exit: Max attempts ").concat(l," reached without success or explicit error handling."))}},50172:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>c,Zp:()=>o,aR:()=>i});var r=a(95155),s=a(12115),n=a(59434);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});i.displayName="CardHeader";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-xl md:text-2xl font-semibold leading-none tracking-tight",a),...s})});c.displayName="CardTitle";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});l.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},73835:(e,t,a)=>{"use strict";a.d(t,{w:()=>c});var r=a(70831),s=a(96019),n=a(78039),o=a(86622),i=a(63482);function c(e,t){let a=[];return e.forEach(e=>{if(a.push(e),"None"===e.recurrence||!e.dueDate)return;let c=new Date(e.dueDate),l=e.startDate?new Date(e.dueDate).getTime()-new Date(e.startDate).getTime():0,d=1;for(;;){let u=new Date(c);switch(e.recurrence){case"Daily":c=(0,r.f)(u,1);break;case"Weekly":c=(0,s.J)(u,1);break;case"Monthly":c=(0,n.P)(u,1);break;case"Yearly":c=(0,o.e)(u,1);break;default:return}if((0,i.Y)(c,t)){let t=e.startDate?new Date(c.getTime()-l):void 0,r={...e,id:"".concat(e.id,"_proj_").concat(d),dueDate:c,startDate:t,status:"To Do",progress:0,attachments:[],description:"Recurring instance of: ".concat(e.title,". Original due date: ").concat(new Date(e.dueDate).toLocaleDateString())};a.push(r),d++}else break}}),a}},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>l});var r=a(95155);a(12115);var s=a(965),n=a(73158),o=a(49063),i=a(59434),c=a(30285);function l(e){let{className:t,classNames:a,showOutsideDays:l=!0,...d}=e;return(0,r.jsx)(o.hv,{showOutsideDays:l,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,c.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,c.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(s.A,{className:(0,i.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(n.A,{className:(0,i.cn)("h-4 w-4",t),...a})}},...d})}l.displayName="Calendar"}},e=>{var t=t=>e(e.s=t);e.O(0,[383,977,376,876,441,303,358],()=>t(13813)),_N_E=e.O()}]);