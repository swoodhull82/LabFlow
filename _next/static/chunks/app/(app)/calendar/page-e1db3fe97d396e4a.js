(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{3567:(e,t,a)=>{"use strict";a.d(t,{R:()=>s});var r=a(35476);function s(e){return+(0,r.a)(e)<Date.now()}},13813:(e,t,a)=>{Promise.resolve().then(a.bind(a,97297))},30285:(e,t,a)=>{"use strict";a.d(t,{$:()=>i,r:()=>d});var r=a(95155),s=a(12115),o=a(99708),n=a(74466),l=a(59434);let d=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),i=s.forwardRef((e,t)=>{let{className:a,variant:s,size:n,asChild:i=!1,...c}=e,u=i?o.DX:"button";return(0,r.jsx)(u,{className:(0,l.cn)(d({variant:s,size:n,className:a})),ref:t,...c})});i.displayName="Button"},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>s});let r={maxAttempts:3,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};async function s(e,t){let a,s={...r,...t};for(let t=1;t<=s.maxAttempts;t++)try{return await e()}catch(e){if(a=e,s.shouldRetry(e))s.onRetry&&s.onRetry(t,e),t<s.maxAttempts?(console.warn("Attempt ".concat(t," failed for ").concat(s.context,". Retrying in ").concat(s.delayMs*Math.pow(2,t-1),"ms... Error: ").concat(e.message||JSON.stringify(e))),await new Promise(e=>setTimeout(e,s.delayMs*Math.pow(2,t-1)))):console.warn("All ".concat(s.maxAttempts," attempts failed for ").concat(s.context,". Last error: ").concat(e.message||JSON.stringify(e)));else throw e}throw a}},50172:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},59434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var r=a(52596),s=a(39688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},59576:(e,t,a)=>{"use strict";a.d(t,{A:()=>m,AuthProvider:()=>u});var r=a(95155),s=a(35695),o=a(12115),n=a(7140),l=a(87481);let d=new n.Ay("https://swoodhu.pockethost.io/"),i=(0,o.createContext)(void 0),c=["Supervisor","Team Lead","Chem I","Chem II"],u=e=>{let{children:t}=e,[a,n]=(0,o.useState)(null),[u,m]=(0,o.useState)(!0),f=(0,s.useRouter)(),{toast:p}=(0,l.dj)();(0,o.useEffect)(()=>{m(!0),(async()=>{if(d.authStore.isValid&&d.authStore.model){var e;let t=d.authStore.model,a=t.role;if("Analyst"===a&&(a="Chem I"),!a||!c.includes(a)){let e=localStorage.getItem("labflowUserRole"),t="Chem I";e&&("Analyst"===e?t="Chem I":c.includes(e)&&(t=e)),a=t}n({id:t.id,email:t.email||"",name:t.name||(null==(e=t.email)?void 0:e.split("@")[0])||"User",role:a,avatarUrl:t.avatar?d.files.getUrl(t,t.avatar,{thumb:"100x100"}):"https://placehold.co/100x100.png?text=".concat((t.name||t.email||"U")[0].toUpperCase())}),localStorage.setItem("labflowUserRole",a)}})().finally(()=>m(!1))},[]);let g=async(e,t)=>{m(!0);try{if(await d.collection("users").authWithPassword(e,t),d.authStore.model){var a;let e=d.authStore.model,t=e.role;"Analyst"===t&&(t="Chem I"),t&&c.includes(t)||(console.warn("User ".concat(e.email," has an invalid or missing role ('").concat(e.role,"') in PocketBase. Defaulting to 'Chem I'.")),t="Chem I");let r={id:e.id,email:e.email||"",name:e.name||(null==(a=e.email)?void 0:a.split("@")[0])||"User",role:t,avatarUrl:e.avatar?d.files.getUrl(e,e.avatar,{thumb:"100x100"}):"https://placehold.co/100x100.png?text=".concat((e.name||e.email||"U")[0].toUpperCase())};n(r),localStorage.setItem("labflowUserRole",r.role),p({title:"Login Successful",description:"Welcome back, ".concat(r.name,"!")}),f.push("/dashboard")}else throw Error("Authentication successful but no user model found.")}catch(t){console.error("Login failed:",t);let e="Login failed. Please check your credentials.";if(t.data&&t.data.data){let a=Object.values(t.data.data).map(e=>e.message).join(", ");a&&(e=a)}else t.message&&(e=t.message);p({title:"Login Failed",description:e,variant:"destructive"}),n(null)}finally{m(!1)}};return(0,r.jsx)(i.Provider,{value:{user:a,login:g,logout:()=>{d.authStore.clear(),n(null),localStorage.removeItem("labflowUserRole"),f.push("/"),p({title:"Logged Out",description:"You have been successfully logged out."})},loading:u,pbClient:d},children:t})},m=()=>{let e=(0,o.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>i,Wu:()=>c,ZB:()=>d,Zp:()=>n,aR:()=>l});var r=a(95155),s=a(12115),o=a(59434);let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});n.displayName="Card";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...s})});l.displayName="CardHeader";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});d.displayName="CardTitle";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...s})});i.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>i});var r=a(95155);a(12115);var s=a(965),o=a(73158),n=a(86374),l=a(59434),d=a(30285);function i(e){let{className:t,classNames:a,showOutsideDays:i=!0,...c}=e;return(0,r.jsx)(n.hv,{showOutsideDays:i,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,l.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,r.jsx)(s.A,{className:(0,l.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,r.jsx)(o.A,{className:(0,l.cn)("h-4 w-4",t),...a})}},...c})}i.displayName="Calendar"},87481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var r=a(12115);let s=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?n(a):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],i={toasts:[]};function c(e){i=l(i,e),d.forEach(e=>{e(i)})}function u(e){let{...t}=e,a=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>c({type:"DISMISS_TOAST",toastId:a});return c({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||r()}}}),{id:a,dismiss:r,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=r.useState(i);return r.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},97297:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var r=a(95155),s=a(85511),o=a(66695),n=a(12115),l=a(73168),d=a(80644),i=a(3567),c=a(76959),u=a(39140),m=a(35476),f=a(30285),p=a(59576),g=a(30645);let h=e=>({id:e.id,title:e.title,eventDate:e.dueDate?new Date(e.dueDate):new Date,description:e.description,status:e.status,userId:e.userId,created:e.created?new Date(e.created):new Date,updated:e.updated?new Date(e.updated):new Date,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),v=async(e,t)=>{try{return(await (0,g.b)(()=>e.collection("tasks").getFullList({filter:'dueDate != null && dueDate != ""',sort:"-dueDate",...t}),{...t,context:"fetching tasks for calendar"})).map(h).filter(e=>e.eventDate)}catch(e){throw e}};var y=a(87481),x=a(50172),b=a(31949);let w=e=>{let t="An unexpected error occurred while fetching tasks for the calendar.";if(e&&"object"==typeof e){if("status"in e&&0===e.status)t="Failed to load calendar tasks: Could not connect to the server. Please check your internet connection and try again.";else if(e.data&&"object"==typeof e.data){if(e.data.message&&"string"==typeof e.data.message&&(t=e.data.message),e.data.data&&"object"==typeof e.data.data&&Object.keys(e.data.data).length>0){let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a&&a.message?a.message:"Invalid value")}).join("; ");t=a?"".concat(t,". Details: ").concat(a):t}}else e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message);if("status"in e&&0!==e.status){let a=e.status;404===a?t="The 'tasks' collection (used for calendar events) was not found (404). ".concat(t):403===a?t="You do not have permission to view tasks for the calendar (403). ".concat(t):400===a&&(t=t.toLowerCase().includes("something went wrong")||t.startsWith("PocketBase_ClientResponseError")||e.data&&0===Object.keys(e.data.data||{}).length?"Request error (400): ".concat(t,". Please check the 'tasks' collection schema, especially ensure 'dueDate' exists and is a sortable Date type."):"Request error (400) when fetching tasks for calendar: ".concat(t,"."))}}else"string"==typeof e&&(t=e);return t};function D(){let{pbClient:e}=(0,p.A)(),{toast:t}=(0,y.dj)(),[a,g]=(0,n.useState)([]),[h,D]=(0,n.useState)(!0),[N,j]=(0,n.useState)(null),[k,S]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{S(new Date)},[]);let A=(0,n.useCallback)(async(e,a)=>{if(!e)return void D(!0);D(!0),j(null);try{let t=await v(e,{signal:a});g(t)}catch(r){let e=(null==r?void 0:r.isAbort)===!0||"string"==typeof(null==r?void 0:r.message)&&r.message.toLowerCase().includes("autocancelled"),a=(null==r?void 0:r.status)===0&&!e;if(e)console.warn("Calendar events (tasks) fetch request was ".concat((null==r?void 0:r.isAbort)?"aborted":"autocancelled","."),r);else if(a){let e=w(r);j(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Calendar events (tasks) fetch (network error):",e,r)}else{let e=w(r);j(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Error fetching tasks for calendar (after retries):",e,r)}}finally{D(!1)}},[t]);(0,n.useEffect)(()=>{let t=new AbortController;return e?A(e,t.signal):D(!0),()=>{t.abort()}},[e,A]);let C=(0,n.useMemo)(()=>k?a.filter(e=>e.eventDate&&(0,l.GP)(new Date(e.eventDate),"yyyy-MM-dd")===(0,l.GP)(k,"yyyy-MM-dd")):[],[k,a]),{overdueEventDates:_,completedEventDates:E,almostDueEventDates:T,activeEventDates:I}=(0,n.useMemo)(()=>{let e=(0,d.o)(new Date),t=[],r=[],s=[],o=[];return a.forEach(a=>{if(!a.eventDate||!a.status)return;let n=(0,d.o)(new Date(a.eventDate));if("Done"===a.status)r.push(n);else if((0,i.R)(n)&&!(0,c.r)(n,e))t.push(n);else{let t=(0,u.m)(n,e);if(t>=0&&t<3)s.push(n);else(+(0,m.a)(n)>Date.now()||(0,c.r)(n,e))&&o.push(n)}}),{overdueEventDates:[...new Set(t.map(e=>e.getTime()))].map(e=>new Date(e)),completedEventDates:[...new Set(r.map(e=>e.getTime()))].map(e=>new Date(e)),almostDueEventDates:[...new Set(s.map(e=>e.getTime()))].map(e=>new Date(e)),activeEventDates:[...new Set(o.map(e=>e.getTime()))].map(e=>new Date(e))}},[a]);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Task Calendar"}),h&&(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(x.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading tasks for calendar..."})]}),N&&!h&&(0,r.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,r.jsx)(b.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Calendar Data"}),(0,r.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:N}),(0,r.jsx)(f.$,{onClick:()=>{e&&A(e)},className:"mt-6",children:"Try Again"})]}),!h&&!N&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsx)(o.Zp,{className:"lg:col-span-2 shadow-md",children:(0,r.jsx)(o.Wu,{className:"p-0",children:(0,r.jsx)(s.V,{mode:"single",selected:k,onSelect:S,className:"rounded-md",modifiers:{completed:E,overdue:_,almostDue:T,active:I},modifiersClassNames:{completed:"!bg-green-100 !text-green-800 dark:!bg-green-800/30 dark:!text-green-200 border !border-green-300 dark:!border-green-700 rounded-md",overdue:"!bg-red-100 !text-red-800 dark:!bg-red-800/30 dark:!text-red-200 border !border-red-300 dark:!border-red-700 rounded-md",almostDue:"!bg-yellow-100 !text-yellow-800 dark:!bg-yellow-700/30 dark:!text-yellow-200 border !border-yellow-300 dark:!border-yellow-600 rounded-md",active:"!bg-blue-100 !text-blue-800 dark:!bg-blue-800/30 dark:!text-blue-200 border !border-blue-300 dark:!border-blue-700 rounded-md"}})})}),(0,r.jsxs)(o.Zp,{className:"shadow-md",children:[(0,r.jsx)(o.aR,{children:(0,r.jsxs)(o.ZB,{className:"font-headline",children:["Tasks for ",k?(0,l.GP)(k,"PPP"):"selected date"]})}),(0,r.jsx)(o.Wu,{children:C.length>0?(0,r.jsx)("ul",{className:"space-y-3",children:C.map(e=>(0,r.jsxs)("li",{className:"p-3 rounded-md border hover:bg-muted transition-colors",children:[(0,r.jsx)("h3",{className:"font-semibold",children:e.title}),e.description&&(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No tasks due on this day."})})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,977,767,441,303,358],()=>t(13813)),_N_E=e.O()}]);