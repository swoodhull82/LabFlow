(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[346],{3567:(e,t,a)=>{"use strict";a.d(t,{R:()=>r});var s=a(35476);function r(e){return+(0,s.a)(e)<Date.now()}},13813:(e,t,a)=>{Promise.resolve().then(a.bind(a,97297))},50172:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>c});var s=a(95155);a(12115);var r=a(965),n=a(73158),d=a(86374),o=a(59434),l=a(30285);function c(e){let{className:t,classNames:a,showOutsideDays:c=!0,...i}=e;return(0,s.jsx)(d.hv,{showOutsideDays:c,className:(0,o.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,o.cn)((0,l.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,o.cn)((0,l.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,o.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(n.A,{className:(0,o.cn)("h-4 w-4",t),...a})}},...i})}c.displayName="Calendar"},97297:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>D});var s=a(95155),r=a(85511),n=a(66695),d=a(12115),o=a(73168),l=a(80644),c=a(3567),i=a(76959),u=a(39140),m=a(35476),p=a(30285),g=a(59576),f=a(30645);let h=e=>({id:e.id,title:e.title,eventDate:e.dueDate?new Date(e.dueDate):new Date,description:e.description,status:e.status,userId:e.userId,created:e.created?new Date(e.created):new Date,updated:e.updated?new Date(e.updated):new Date,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),x=async(e,t)=>{try{return(await (0,f.b)(()=>e.collection("tasks").getFullList({filter:'dueDate != null && dueDate != ""',sort:"-dueDate",...t}),{...t,context:"fetching tasks for calendar"})).map(h).filter(e=>e.eventDate)}catch(e){throw e}};var y=a(87481),b=a(50172),w=a(31949);let v=e=>{let t="An unexpected error occurred while fetching tasks for the calendar.";if(e&&"object"==typeof e){if("status"in e&&0===e.status)t="Failed to load calendar tasks: Could not connect to the server. Please check your internet connection and try again.";else if(e.data&&"object"==typeof e.data){if(e.data.message&&"string"==typeof e.data.message&&(t=e.data.message),e.data.data&&"object"==typeof e.data.data&&Object.keys(e.data.data).length>0){let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a&&a.message?a.message:"Invalid value")}).join("; ");t=a?"".concat(t,". Details: ").concat(a):t}}else e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message);if("status"in e&&0!==e.status){let a=e.status;404===a?t="The 'tasks' collection (used for calendar events) was not found (404). ".concat(t):403===a?t="You do not have permission to view tasks for the calendar (403). ".concat(t):400===a&&(t=t.toLowerCase().includes("something went wrong")||t.startsWith("PocketBase_ClientResponseError")||e.data&&0===Object.keys(e.data.data||{}).length?"Request error (400): ".concat(t,". Please check the 'tasks' collection schema, especially ensure 'dueDate' exists and is a sortable Date type."):"Request error (400) when fetching tasks for calendar: ".concat(t,"."))}}else"string"==typeof e&&(t=e);return t};function D(){let{pbClient:e}=(0,g.A)(),{toast:t}=(0,y.dj)(),[a,f]=(0,d.useState)([]),[h,D]=(0,d.useState)(!0),[k,j]=(0,d.useState)(null),[N,_]=(0,d.useState)(void 0);(0,d.useEffect)(()=>{_(new Date)},[]);let C=(0,d.useCallback)(async(e,a)=>{if(!e)return void D(!0);D(!0),j(null);try{let t=await x(e,{signal:a});f(t)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),a=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Calendar events (tasks) fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(a){let e=v(s);j(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Calendar events (tasks) fetch (network error):",e,s)}else{let e=v(s);j(e),t({title:"Error Loading Calendar Data",description:e,variant:"destructive"}),console.warn("Error fetching tasks for calendar (after retries):",e,s)}}finally{D(!1)}},[t]);(0,d.useEffect)(()=>{let t=new AbortController;return e?C(e,t.signal):D(!0),()=>{t.abort()}},[e,C]);let E=(0,d.useMemo)(()=>N?a.filter(e=>e.eventDate&&(0,o.GP)(new Date(e.eventDate),"yyyy-MM-dd")===(0,o.GP)(N,"yyyy-MM-dd")):[],[N,a]),{overdueEventDates:A,completedEventDates:P,almostDueEventDates:L,activeEventDates:S}=(0,d.useMemo)(()=>{let e=(0,l.o)(new Date),t=[],s=[],r=[],n=[];return a.forEach(a=>{if(!a.eventDate||!a.status)return;let d=(0,l.o)(new Date(a.eventDate));if("Done"===a.status)s.push(d);else if((0,c.R)(d)&&!(0,i.r)(d,e))t.push(d);else{let t=(0,u.m)(d,e);if(t>=0&&t<3)r.push(d);else(+(0,m.a)(d)>Date.now()||(0,i.r)(d,e))&&n.push(d)}}),{overdueEventDates:[...new Set(t.map(e=>e.getTime()))].map(e=>new Date(e)),completedEventDates:[...new Set(s.map(e=>e.getTime()))].map(e=>new Date(e)),almostDueEventDates:[...new Set(r.map(e=>e.getTime()))].map(e=>new Date(e)),activeEventDates:[...new Set(n.map(e=>e.getTime()))].map(e=>new Date(e))}},[a]);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Task Calendar"}),h&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(b.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading tasks for calendar..."})]}),k&&!h&&(0,s.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,s.jsx)(w.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Calendar Data"}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:k}),(0,s.jsx)(p.$,{onClick:()=>{e&&C(e)},className:"mt-6",children:"Try Again"})]}),!h&&!k&&(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)(n.Zp,{className:"lg:col-span-2 shadow-md",children:(0,s.jsx)(n.Wu,{className:"p-0",children:(0,s.jsx)(r.V,{mode:"single",selected:N,onSelect:_,className:"rounded-md",modifiers:{completed:P,overdue:A,almostDue:L,active:S},modifiersClassNames:{completed:"!bg-green-100 !text-green-800 dark:!bg-green-800/30 dark:!text-green-200 border !border-green-300 dark:!border-green-700 rounded-md",overdue:"!bg-red-100 !text-red-800 dark:!bg-red-800/30 dark:!text-red-200 border !border-red-300 dark:!border-red-700 rounded-md",almostDue:"!bg-yellow-100 !text-yellow-800 dark:!bg-yellow-700/30 dark:!text-yellow-200 border !border-yellow-300 dark:!border-yellow-600 rounded-md",active:"!bg-blue-100 !text-blue-800 dark:!bg-blue-800/30 dark:!text-blue-200 border !border-blue-300 dark:!border-blue-700 rounded-md"}})})}),(0,s.jsxs)(n.Zp,{className:"shadow-md",children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)(n.ZB,{className:"font-headline",children:["Tasks for ",N?(0,o.GP)(N,"PPP"):"selected date"]})}),(0,s.jsx)(n.Wu,{children:E.length>0?(0,s.jsx)("ul",{className:"space-y-3",children:E.map(e=>(0,s.jsxs)("li",{className:"p-3 rounded-md border hover:bg-muted transition-colors",children:[(0,s.jsx)("h3",{className:"font-semibold",children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description})]},e.id))}):(0,s.jsx)("p",{className:"text-muted-foreground",children:"No tasks due on this day."})})]})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,977,767,918,441,303,358],()=>t(13813)),_N_E=e.O()}]);