(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1346],{3567:(e,t,a)=>{"use strict";a.d(t,{R:()=>r});var s=a(35476);function r(e){return+(0,s.a)(e)<Date.now()}},7860:(e,t,a)=>{"use strict";a.d(t,{k:()=>r});var s=a(35476);function r(e,t){var a;let r=(0,s.a)(e.start),n=(0,s.a)(e.end),l=+r>+n,i=l?+r:+n,o=l?n:r;o.setHours(0,0,0,0);let d=null!=(a=null==t?void 0:t.step)?a:1;if(!d)return[];d<0&&(d=-d,l=!l);let c=[];for(;+o<=i;)c.push((0,s.a)(o)),o.setDate(o.getDate()+d),o.setHours(0,0,0,0);return l?c.reverse():c}},9208:(e,t,a)=>{"use strict";a.d(t,{o:()=>l});var s=a(24937),r=a(41876),n=a(50657);function l(e,t,a){let l=(0,n.b)(e,t)/r.Cg;return(0,s.u)(null==a?void 0:a.roundingMethod)(l)}},9572:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},13813:(e,t,a)=>{Promise.resolve().then(a.bind(a,87491))},14636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>i,Wv:()=>o,hl:()=>d});var s=a(95155),r=a(12115),n=a(20547),l=a(59434);let i=n.bL,o=n.l9,d=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...o}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{ref:t,align:r,sideOffset:i,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});d.displayName=n.UC.displayName},15667:(e,t,a)=>{"use strict";a.d(t,{h:()=>l});var s=a(92084),r=a(48444),n=a(35476);function l(e,t){let a=(0,n.a)(e);return isNaN(+a)?(0,s.w)(e,NaN):(null!=t.year&&a.setFullYear(t.year),null!=t.month&&(a=(0,r.Z)(a,t.month)),null!=t.date&&a.setDate(t.date),null!=t.hours&&a.setHours(t.hours),null!=t.minutes&&a.setMinutes(t.minutes),null!=t.seconds&&a.setSeconds(t.seconds),null!=t.milliseconds&&a.setMilliseconds(t.milliseconds),a)}},17132:(e,t,a)=>{"use strict";a.d(t,{O:()=>r});var s=a(35476);function r(e){return(0,s.a)(e).getMinutes()}},17313:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>d,j7:()=>o,tU:()=>i});var s=a(95155),r=a(12115),n=a(60704),l=a(59434);let i=n.bL,o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.B8,{ref:t,className:(0,l.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...r})});o.displayName=n.B8.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.l9,{ref:t,className:(0,l.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...r})});d.displayName=n.l9.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.UC,{ref:t,className:(0,l.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...r})}).displayName=n.UC.displayName},19616:(e,t,a)=>{"use strict";a.d(t,{c:()=>n});var s=a(44598),r=a(76959);function n(e){return(0,r.r)(e,(0,s.A)(e))}},26126:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var s=a(95155);a(12115);var r=a(74466),n=a(59434);let l=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...r})}},36506:(e,t,a)=>{"use strict";a.d(t,{q:()=>r});var s=a(35476);function r(e){return(0,s.a)(e).getHours()}},73835:(e,t,a)=>{"use strict";a.d(t,{w:()=>o});var s=a(70831),r=a(96019),n=a(78039),l=a(86622),i=a(63482);function o(e,t){let a=[];return e.forEach(e=>{if(a.push(e),"None"===e.recurrence||!e.dueDate)return;let o=new Date(e.dueDate),d=e.startDate?new Date(e.dueDate).getTime()-new Date(e.startDate).getTime():0,c=1;for(;;){let u=new Date(o);switch(e.recurrence){case"Daily":o=(0,s.f)(u,1);break;case"Weekly":o=(0,r.J)(u,1);break;case"Monthly":o=(0,n.P)(u,1);break;case"Yearly":o=(0,l.e)(u,1);break;default:return}if((0,i.Y)(o,t)){let t=e.startDate?new Date(o.getTime()-d):void 0,s={...e,id:"".concat(e.id,"_proj_").concat(c),dueDate:o,startDate:t,status:"To Do",progress:0,attachments:[],description:"Recurring instance of: ".concat(e.title,". Original due date: ").concat(new Date(e.dueDate).toLocaleDateString())};a.push(s),c++}else break}}),a}},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>d});var s=a(95155);a(12115);var r=a(965),n=a(73158),l=a(43645),i=a(59434),o=a(30285);function d(e){let{className:t,classNames:a,showOutsideDays:d=!0,...c}=e;return(0,s.jsx)(l.hv,{showOutsideDays:d,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,o.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,o.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(n.A,{className:(0,i.cn)("h-4 w-4",t),...a})}},...c})}d.displayName="Calendar"},87491:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ek});var s=a(95155),r=a(85511),n=a(66695),l=a(12115),i=a(73168),o=a(76959),d=a(80644),c=a(86622),u=a(44861),m=a(70831),f=a(3567),p=a(39140),h=a(35476),x=a(19164),v=a(34548),g=a(65119),y=a(74641),j=a(30285),w=a(59576),b=a(30645),D=a(73835);let N=e=>({id:e.id,title:e.title,startDate:e.startDate,endDate:e.dueDate,description:e.description,status:e.status,userId:e.userId,task_type:e.task_type,created:e.created?new Date(e.created):new Date,updated:e.updated?new Date(e.updated):new Date,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand,assignedTo:e.assignedTo,priority:e.priority,progress:e.progress,recurrence:e.recurrence||"None"}),C=e=>({id:e.id,title:e.title||"",task_type:e.task_type,description:e.description,status:e.status,priority:e.priority,startDate:e.startDate?new Date(e.startDate):void 0,dueDate:e.dueDate?new Date(e.dueDate):void 0,assignedTo:e.assignedTo||[],recurrence:e.recurrence||"None",attachments:e.attachments,userId:e.userId,created:new Date(e.created),updated:new Date(e.updated),collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand,progress:e.progress,isMilestone:"boolean"==typeof e.isMilestone&&e.isMilestone,dependencies:Array.isArray(e.dependencies)?e.dependencies:"string"==typeof e.dependencies&&e.dependencies.startsWith("[")?JSON.parse(e.dependencies):[],instrument_subtype:e.instrument_subtype||void 0,method:e.method||void 0}),k=async(e,t)=>{try{let{signal:a,projectionHorizon:s,...r}=t||{},n={filter:'startDate != null && startDate != "" && dueDate != null && dueDate != ""',sort:"-dueDate",fields:"id,title,task_type,dueDate,description,status,userId,created,updated,recurrence,startDate,priority,progress,isMilestone,dependencies,instrument_subtype,method,assignedTo",expand:"assignedTo",...r},l=(await (0,b.b)(()=>e.collection("tasks").getFullList(n,{signal:a}),{...t,context:"fetching tasks for calendar"})).map(C);return(s?(0,D.w)(l,s):l).map(N).filter(e=>e.startDate&&e.endDate)}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch calendar events:",e),e}};var A=a(14209),T=a(87481);let M=(0,a(40157).A)("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);var P=a(50172),_=a(31949),S=a(965),E=a(73158),I=a(9572),R=a(59434),G=a(17313),L=a(54165),z=a(62177),H=a(90221),O=a(55594),V=a(17759),q=a(62523),B=a(88539),F=a(59409),Y=a(14636),$=a(47262),J=a(51920),W=a(77223),U=a(59119),Z=a(36506),X=a(15667),K=a(92084),Q=a(41876),ee=a(91950);let et=O.Ik({title:O.Yj().min(2,{message:"Title must be at least 2 characters."}),description:O.Yj().optional(),eventDate:O.p6({required_error:"An event date is required."}),isAllDay:O.zM().optional(),startTime:O.Yj().optional(),endTime:O.Yj().optional(),eventType:O.Yj().default("Available"),recurrence:O.Yj().default("None")}).superRefine((e,t)=>{!e.isAllDay&&(e.startTime||t.addIssue({code:"custom",message:"Start time is required for timed events.",path:["startTime"]}),e.endTime||t.addIssue({code:"custom",message:"End time is required for timed events.",path:["endTime"]}),e.startTime&&e.endTime&&e.endTime<=e.startTime&&t.addIssue({code:"custom",message:"End time must be after start time.",path:["endTime"]}))}),ea=e=>{let[t,a]=e.split(":").map(Number),s=new Date;return s.setHours(t,a),(0,i.GP)(s,"h:mm a")},es=(()=>{let e=[];for(let t=7;t<=16;t++)e.push("".concat(String(t).padStart(2,"0"),":00")),t<16&&e.push("".concat(String(t).padStart(2,"0"),":30"));return e})();function er(e){let{onTaskCreated:t,onDialogClose:a,onDelete:n,defaultDate:o,eventToEdit:d}=e,{pbClient:c,user:u}=(0,w.A)(),{toast:m}=(0,T.dj)(),[f,p]=(0,l.useState)(!1),x=!!d,v=o?(0,Z.q)(o):9,g=(0,X.h)(o||new Date,{hours:v,minutes:0,seconds:0,milliseconds:0}),y=(0,i.GP)(g,"HH:mm"),b=(0,i.GP)(function(e,t){var a=+Q.s0;let s=+(0,h.a)(e);return(0,K.w)(e,s+a)}(g,0),"HH:mm"),D=(0,z.mN)({resolver:(0,H.u)(et),defaultValues:{title:(null==d?void 0:d.title)||"",description:(null==d?void 0:d.description)||"",eventType:(null==d?void 0:d.eventType)||"Available",eventDate:d?new Date(d.startDate):o,isAllDay:(null==d?void 0:d.isAllDay)||!1,startTime:d&&!d.isAllDay?(0,i.GP)(new Date(d.startDate),"HH:mm"):y,endTime:d&&!d.isAllDay?(0,i.GP)(new Date(d.endDate),"HH:mm"):b,recurrence:(null==d?void 0:d.recurrence)||"None"}}),N=D.watch("isAllDay");async function C(e){let s,r;if(!c||!u)return void m({title:"Error",description:"You must be logged in.",variant:"destructive"});if(p(!0),e.isAllDay)s=(0,X.h)(e.eventDate,{hours:7,minutes:0,seconds:0}),r=(0,X.h)(e.eventDate,{hours:16,minutes:0,seconds:0});else{let[t,a]=e.startTime.split(":").map(Number),[n,l]=e.endTime.split(":").map(Number);s=(0,X.h)(e.eventDate,{hours:t,minutes:a,seconds:0}),r=(0,X.h)(e.eventDate,{hours:n,minutes:l,seconds:0})}try{if(x){let t={title:e.title,description:e.description,startDate:s,endDate:r,isAllDay:e.isAllDay,eventType:e.eventType,recurrence:e.recurrence};await (0,A.E5)(c,d.id,t),m({title:"Success",description:"Personal event updated."})}else{let t={title:e.title,description:e.description,startDate:s,endDate:r,userId:u.id,isAllDay:e.isAllDay,eventType:e.eventType,recurrence:e.recurrence};await (0,A.n)(c,t),m({title:"Success",description:"Personal event added to your calendar."})}t(),a()}catch(e){m({title:"Error ".concat(x?"Updating":"Creating"," Event"),description:e.message||"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{p(!1)}}return(0,s.jsx)(V.lV,{...D,children:(0,s.jsxs)("form",{onSubmit:D.handleSubmit(C),className:"space-y-4",children:[(0,s.jsx)(V.zB,{control:D.control,name:"title",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"Event Title"}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)(q.p,{placeholder:"e.g., Team sync meeting",...t})}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"Description (Optional)"}),(0,s.jsx)(V.MJ,{children:(0,s.jsx)(B.T,{placeholder:"Add more details...",...t})}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"eventType",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"Show As"}),(0,s.jsxs)(F.l6,{onValueChange:t.onChange,value:t.value,children:[(0,s.jsx)(V.MJ,{children:(0,s.jsx)(F.bq,{children:(0,s.jsx)(F.yv,{placeholder:"Select event type"})})}),(0,s.jsx)(F.gC,{children:ee.Y$.map(e=>(0,s.jsx)(F.eb,{value:e,children:e},e))})]}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"eventDate",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{className:"flex flex-col",children:[(0,s.jsx)(V.lR,{children:"Date"}),(0,s.jsxs)(Y.AM,{children:[(0,s.jsx)(Y.Wv,{asChild:!0,children:(0,s.jsx)(V.MJ,{children:(0,s.jsxs)(j.$,{variant:"outline",className:(0,R.cn)("w-full pl-3 text-left font-normal",!t.value&&"text-muted-foreground"),children:[t.value?(0,i.GP)(t.value,"PPP"):(0,s.jsx)("span",{children:"Pick a date"}),(0,s.jsx)(J.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,s.jsx)(Y.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(r.V,{mode:"single",selected:t.value,onSelect:t.onChange,initialFocus:!0})})]}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"recurrence",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"Recurrence"}),(0,s.jsxs)(F.l6,{onValueChange:t.onChange,value:t.value,children:[(0,s.jsx)(V.MJ,{children:(0,s.jsx)(F.bq,{children:(0,s.jsx)(F.yv,{placeholder:"Select recurrence"})})}),(0,s.jsx)(F.gC,{children:ee.y4.map(e=>(0,s.jsx)(F.eb,{value:e,children:e},e))})]}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"isAllDay",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{className:"flex flex-row items-center space-x-3 space-y-0 rounded-md border p-3 shadow-sm",children:[(0,s.jsx)(V.MJ,{children:(0,s.jsx)($.S,{checked:t.value,onCheckedChange:t.onChange})}),(0,s.jsx)("div",{className:"space-y-1 leading-none",children:(0,s.jsx)(V.lR,{className:"cursor-pointer",children:"All-day event"})})]})}}),!N&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(V.zB,{control:D.control,name:"startTime",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"Start Time"}),(0,s.jsxs)(F.l6,{onValueChange:t.onChange,value:t.value,children:[(0,s.jsx)(V.MJ,{children:(0,s.jsx)(F.bq,{children:(0,s.jsx)(F.yv,{placeholder:"Select start time"})})}),(0,s.jsx)(F.gC,{children:es.map(e=>(0,s.jsx)(F.eb,{value:e,children:ea(e)},"start-".concat(e)))})]}),(0,s.jsx)(V.C5,{})]})}}),(0,s.jsx)(V.zB,{control:D.control,name:"endTime",render:e=>{let{field:t}=e;return(0,s.jsxs)(V.eI,{children:[(0,s.jsx)(V.lR,{children:"End Time"}),(0,s.jsxs)(F.l6,{onValueChange:t.onChange,value:t.value,children:[(0,s.jsx)(V.MJ,{children:(0,s.jsx)(F.bq,{children:(0,s.jsx)(F.yv,{placeholder:"Select end time"})})}),(0,s.jsx)(F.gC,{children:es.map(e=>(0,s.jsx)(F.eb,{value:e,children:ea(e)},"end-".concat(e)))})]}),(0,s.jsx)(V.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[(0,s.jsx)("div",{children:x&&n&&(0,s.jsxs)(j.$,{type:"button",variant:"destructive",onClick:()=>n(d.id),disabled:f,children:[(0,s.jsx)(W.A,{className:"mr-2 h-4 w-4"})," Delete"]})}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(j.$,{type:"button",variant:"ghost",onClick:a,children:"Cancel"}),(0,s.jsxs)(j.$,{type:"submit",disabled:f,children:[f?(0,s.jsx)(P.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(U.A,{className:"mr-2 h-4 w-4"}),x?"Save Changes":"Save Event"]})]})]})]})})}var en=a(46081),el=a(63655),ei="Progress",[eo,ed]=(0,en.A)(ei),[ec,eu]=eo(ei),em=l.forwardRef((e,t)=>{var a,r,n,l;let{__scopeProgress:i,value:o=null,max:d,getValueLabel:c=eh,...u}=e;(d||0===d)&&!eg(d)&&console.error((a="".concat(d),r="Progress","Invalid prop `max` of value `".concat(a,"` supplied to `").concat(r,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let m=eg(d)?d:100;null===o||ey(o,m)||console.error((n="".concat(o),l="Progress","Invalid prop `value` of value `".concat(n,"` supplied to `").concat(l,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let f=ey(o,m)?o:null,p=ev(f)?c(f,m):void 0;return(0,s.jsx)(ec,{scope:i,value:f,max:m,children:(0,s.jsx)(el.sG.div,{"aria-valuemax":m,"aria-valuemin":0,"aria-valuenow":ev(f)?f:void 0,"aria-valuetext":p,role:"progressbar","data-state":ex(f,m),"data-value":null!=f?f:void 0,"data-max":m,...u,ref:t})})});em.displayName=ei;var ef="ProgressIndicator",ep=l.forwardRef((e,t)=>{var a;let{__scopeProgress:r,...n}=e,l=eu(ef,r);return(0,s.jsx)(el.sG.div,{"data-state":ex(l.value,l.max),"data-value":null!=(a=l.value)?a:void 0,"data-max":l.max,...n,ref:t})});function eh(e,t){return"".concat(Math.round(e/t*100),"%")}function ex(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function ev(e){return"number"==typeof e}function eg(e){return ev(e)&&!isNaN(e)&&e>0}function ey(e,t){return ev(e)&&!isNaN(e)&&e<=t&&e>=0}ep.displayName=ef;let ej=l.forwardRef((e,t)=>{let{className:a,value:r,...n}=e;return(0,s.jsx)(em,{ref:t,className:(0,R.cn)("relative h-2 w-full overflow-hidden rounded-full bg-secondary",a),...n,children:(0,s.jsx)(ep,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});ej.displayName=em.displayName;var ew=a(26126),eb=a(16303);let eD=e=>{let t="An unexpected error occurred while fetching items for the calendar.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load calendar items: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data?e.data.message&&"string"==typeof e.data.message&&(t=e.data.message):e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")&&(t=e.message),"status"in e&&0!==e.status){let a=e.status;404===a?t="A required data collection was not found (404).":403===a&&(t="You do not have permission to view items for the calendar (403).")}}else"string"==typeof e&&(t=e);return t};function eN(e){let{date:t,tasksForDay:a}=e,r=(0,i.GP)(t,"d"),n=Math.min(a.filter(e=>(0,o.r)(new Date(e.startDate),t)).length,4);return(0,s.jsxs)("div",{className:"relative h-full w-full flex flex-col items-center justify-center",children:[(0,s.jsx)("span",{children:r}),n>0&&(0,s.jsx)("div",{className:"absolute -bottom-1 flex items-center justify-center",children:Array.from({length:n}).map((e,t)=>(0,s.jsx)(M,{className:"h-6 w-6 -mx-2 text-primary opacity-100"},t))})]})}let eC=e=>{if(!e)return"default";switch(e.toLowerCase()){case"urgent":case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"default"}};function ek(){let{pbClient:e,user:t}=(0,w.A)(),{toast:a}=(0,T.dj)(),[b,D]=(0,l.useState)([]),[N,C]=(0,l.useState)(!0),[M,z]=(0,l.useState)(null),[H,O]=(0,l.useState)("personal"),[V,q]=(0,l.useState)(new Date),[B,Y]=(0,l.useState)({from:(0,d.o)(new Date),to:(0,d.o)(new Date)}),[$,J]=(0,l.useState)(!1),W=(0,l.useRef)(null),[U,Z]=(0,l.useState)(),[X,K]=(0,l.useState)("all"),[Q,et]=(0,l.useState)("all"),[ea,es]=(0,l.useState)(null),en=(0,l.useCallback)(()=>{J(!1),W.current=null},[]);(0,l.useEffect)(()=>(window.addEventListener("mouseup",en),()=>{window.removeEventListener("mouseup",en)}),[en]);let el=(0,l.useCallback)(async(e,t,s,r)=>{if(!e)return void C(!0);C(!0),z(null);try{let a=[];if("personal"===t){let t=(0,c.e)(new Date,2);a=await (0,A.yf)(e,s,{signal:r,projectionHorizon:t})}else{let t=(0,c.e)(new Date,2);a=await k(e,{signal:r,projectionHorizon:t})}D(a)}catch(e){if((null==e?void 0:e.isAbort)===!0||"string"==typeof(null==e?void 0:e.message)&&e.message.toLowerCase().includes("autocancelled"))console.warn("Calendar data fetch request was ".concat((null==e?void 0:e.isAbort)?"aborted":"autocancelled","."),e);else{let t=eD(e);z(t),a({title:"Error Loading Calendar Data",description:t,variant:"destructive"}),console.warn("Error fetching data for calendar (after retries):",t,e)}}finally{C(!1)}},[a]);(0,l.useEffect)(()=>{let a=new AbortController;return e&&t?el(e,H,t.id,a.signal):C(!0),()=>{a.abort()}},[e,t,H,el]);let ei=(0,l.useMemo)(()=>{let e=b;return"all"!==X&&(e=e.filter(e=>e.priority===X)),"task"===H&&"all"!==Q&&(e=e.filter(e=>e.status===Q)),e},[b,H,X,Q]),{tasksByDay:eo,statusModifiers:ed}=(0,l.useMemo)(()=>{let e=new Map,t={completed:new Set,overdue:new Set,almostDue:new Set,active:new Set,validation:new Set},a=(0,d.o)(new Date);for(let s of ei){if(!s.startDate)continue;let r=new Date(s.startDate);if((0,u.f)(r))if(("VALIDATION_PROJECT"===s.task_type||"VALIDATION_STEP"===s.task_type)&&s.endDate&&(0,u.f)(new Date(s.endDate))){let a=new Date(s.endDate),n=(0,d.o)(r),l=(0,d.o)(a);for(let a=n;a<=l;a=(0,m.f)(a,1)){let r=(0,i.GP)(a,"yyyy-MM-dd");e.has(r)||e.set(r,[]),e.get(r).find(e=>e.id===s.id)||e.get(r).push(s),t.validation.add(a.getTime())}}else{let n=(0,d.o)(r),l=(0,i.GP)(n,"yyyy-MM-dd");if(e.has(l)||e.set(l,[]),e.get(l).find(e=>e.id===s.id)||e.get(l).push(s),"task"===H&&s.status){if(!s.endDate||!(0,u.f)(new Date(s.endDate)))continue;let e=new Date(s.endDate);if(!(0,u.f)(e))continue;let r=(0,d.o)(e);if("Done"===s.status)t.completed.add(r.getTime());else if((0,f.R)(r)&&!(0,o.r)(r,a))t.overdue.add(r.getTime());else{let e=(0,p.m)(r,a);if(e>=0&&e<3)t.almostDue.add(r.getTime());else(+(0,h.a)(r)>Date.now()||(0,o.r)(r,a))&&t.active.add(r.getTime())}}}}return{tasksByDay:e,statusModifiers:{completed:Array.from(t.completed).map(e=>new Date(e)),overdue:Array.from(t.overdue).map(e=>new Date(e)),almostDue:Array.from(t.almostDue).map(e=>new Date(e)),active:Array.from(t.active).map(e=>new Date(e)),validation:Array.from(t.validation).map(e=>new Date(e))}}},[ei,H]),ec=(0,l.useMemo)(()=>{if(!(null==B?void 0:B.from))return[];let e=(0,d.o)(B.from),t=B.to?(0,d.o)(B.to):e,a=new Map;for(let s=e;s<=t;s=(0,m.f)(s,1)){let e=(0,i.GP)(s,"yyyy-MM-dd");eo.has(e)&&eo.get(e).forEach(e=>{a.set(e.id,e)})}return Array.from(a.values()).sort((e,t)=>new Date(e.startDate).getTime()-new Date(t.startDate).getTime())},[B,eo]),eu=()=>{e&&t&&el(e,H,t.id)},em=()=>{eu()},ef=()=>{Z(void 0)},ep=()=>{es(null)},eh=async t=>{if(e)try{await (0,A.g6)(e,t),a({title:"Event Deleted",description:"The event has been removed from your calendar."}),eu(),ep()}catch(e){a({title:"Error Deleting Event",description:eD(e),variant:"destructive"})}},ex=(0,l.useMemo)(()=>(null==B?void 0:B.from)?!B.to||(0,o.r)(B.from,B.to)?(0,i.GP)(B.from,"PPP"):"".concat((0,i.GP)(B.from,"PPP")," - ").concat((0,i.GP)(B.to,"PPP")):"No date selected",[B]);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Calendar"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(G.tU,{value:H,onValueChange:O,children:(0,s.jsxs)(G.j7,{children:[(0,s.jsx)(G.Xi,{value:"personal",children:"Personal Calendar"}),(0,s.jsx)(G.Xi,{value:"task",children:"Task Calendar"})]})}),"personal"===H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.lG,{open:!!U,onOpenChange:e=>!e&&ef(),children:(0,s.jsxs)(L.Cf,{children:[(0,s.jsx)(L.c7,{children:(0,s.jsx)(L.L3,{children:"Add a New Personal Event"})}),(0,s.jsx)(er,{onTaskCreated:em,onDialogClose:ef,defaultDate:U})]})}),(0,s.jsx)(L.lG,{open:!!ea,onOpenChange:e=>!e&&ep(),children:(0,s.jsxs)(L.Cf,{children:[(0,s.jsx)(L.c7,{children:(0,s.jsx)(L.L3,{children:"Edit Personal Event"})}),(0,s.jsx)(er,{eventToEdit:ea,onTaskCreated:em,onDialogClose:ep,onDelete:eh})]})})]})]})]}),N?(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(P.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading calendar..."})]}):M?(0,s.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,s.jsx)(_.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Calendar Data"}),(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:M}),(0,s.jsx)(j.$,{onClick:eu,className:"mt-6",children:"Try Again"})]}):(0,s.jsxs)(s.Fragment,{children:["task"===H&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.Zp,{className:"shadow-md",children:[(0,s.jsxs)(n.aR,{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.$,{variant:"outline",size:"icon",onClick:()=>{q(e=>(0,m.f)((0,x.w)(e),-1))},children:(0,s.jsx)(S.A,{className:"h-4 w-4"})}),(0,s.jsx)(j.$,{variant:"outline",size:"icon",onClick:()=>{q(e=>(0,m.f)((0,x.w)(e),32))},children:(0,s.jsx)(E.A,{className:"h-4 w-4"})}),(0,s.jsx)("h2",{className:"text-lg font-semibold ml-2",children:(0,i.GP)(V,"MMMM yyyy")})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsx)(j.$,{variant:"outline",size:"sm",onClick:()=>Y({from:new Date,to:new Date}),children:"Today"}),(0,s.jsx)(j.$,{variant:"outline",size:"sm",onClick:()=>Y({from:(0,v.k)(new Date),to:(0,g.$)(new Date)}),children:"This Week"}),(0,s.jsx)(j.$,{variant:"outline",size:"sm",onClick:()=>Y({from:(0,x.w)(new Date),to:(0,y.p)(new Date)}),children:"This Month"})]})]}),(0,s.jsx)(n.Wu,{children:(0,s.jsx)(r.V,{mode:"range",month:V,onMonthChange:q,selected:B,onDayMouseDown:(e,t)=>{J(!0),W.current=e,Y({from:e,to:e})},onDayMouseEnter:(e,t)=>{if($&&W.current){let t=W.current;t<=e?Y({from:t,to:e}):Y({from:e,to:t})}},onDayClick:(e,t)=>{Y({from:e,to:e})},onSelect:void 0,numberOfMonths:2,className:"p-0",classNames:{day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary/90 text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground rounded-full",day_range_middle:"aria-selected:bg-primary/20 aria-selected:text-primary-foreground rounded-none"},modifiers:ed,modifiersClassNames:{completed:"!bg-green-100 dark:!bg-green-900/50",overdue:"!bg-red-100 dark:!bg-red-900/50",almostDue:"!bg-yellow-100 dark:!bg-yellow-800/50",active:"!bg-blue-100 dark:!bg-blue-900/50",validation:"bg-validation"},components:{DayContent:e=>(0,s.jsx)(eN,{date:e.date,tasksForDay:eo.get((0,i.GP)(e.date,"yyyy-MM-dd"))||[]})}})})]}),(0,s.jsxs)(n.Zp,{children:[(0,s.jsx)(n.aR,{children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(n.ZB,{className:"font-headline",children:["Tasks for: ",ex]}),(0,s.jsxs)(n.BT,{children:[ec.length," task(s) found in the selected period for the Task calendar."]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)(F.l6,{value:X,onValueChange:e=>K(e),children:[(0,s.jsx)(F.bq,{className:"w-[140px]",children:(0,s.jsx)(F.yv,{placeholder:"Filter by priority"})}),(0,s.jsxs)(F.gC,{children:[(0,s.jsx)(F.eb,{value:"all",children:"All Priorities"}),ee.PN.map(e=>(0,s.jsx)(F.eb,{value:e,children:e},e))]})]}),"task"===H&&(0,s.jsxs)(F.l6,{value:Q,onValueChange:e=>et(e),children:[(0,s.jsx)(F.bq,{className:"w-[140px]",children:(0,s.jsx)(F.yv,{placeholder:"Filter by status"})}),(0,s.jsxs)(F.gC,{children:[(0,s.jsx)(F.eb,{value:"all",children:"All Statuses"}),ee.Hi.map(e=>(0,s.jsx)(F.eb,{value:e,children:e},e))]})]})]})]})}),(0,s.jsx)(n.Wu,{children:ec.length>0?(0,s.jsx)("ul",{className:"space-y-4",children:ec.map(e=>(0,s.jsx)("li",{className:"p-4 rounded-md border bg-card hover:bg-muted/50 transition-colors",children:(0,s.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)(ew.E,{variant:eC(e.priority),children:e.priority||"N/A"}),(0,s.jsx)("h3",{className:"font-semibold",children:e.title})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),"number"==typeof e.progress&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Progress"}),(0,s.jsxs)("span",{className:"text-xs font-medium",children:[e.progress,"%"]})]}),(0,s.jsx)(ej,{value:e.progress,className:"h-2"})]})]}),(0,s.jsxs)("div",{className:"text-right flex-shrink-0 ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:(0,i.GP)(new Date(e.startDate),"MMM dd")}),(0,s.jsx)("p",{className:(0,R.cn)("text-xs mt-1","Done"===e.status?"text-green-600":"text-muted-foreground"),children:e.status})]})]})},e.id))}):(0,s.jsx)("p",{className:"text-muted-foreground py-8 text-center",children:"No tasks scheduled for the selected period matching your filters."})})]})]}),"personal"===H&&(0,s.jsx)(eb.A,{events:ei,onHourSlotClick:e=>{Z(e)},onEventClick:e=>{es(e)}})]})]})}},91721:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},92266:(e,t,a)=>{"use strict";a.d(t,{W:()=>i});var s=a(70831),r=a(78039),n=a(92084),l=a(35476);function i(e,t){let{years:a=0,months:i=0,weeks:o=0,days:d=0,hours:c=0,minutes:u=0,seconds:m=0}=t,f=(0,l.a)(e),p=i||a?(0,r.P)(f,i+12*a):f,h=d||o?(0,s.f)(p,d+7*o):p;return(0,n.w)(e,h.getTime()+1e3*(m+60*(u+60*c)))}}},e=>{var t=t=>e(e.s=t);e.O(0,[2383,4897,9052,3198,1859,7164,5452,3168,5280,9819,6950,9467,5229,5115,8441,1684,7358],()=>t(13813)),_N_E=e.O()}]);