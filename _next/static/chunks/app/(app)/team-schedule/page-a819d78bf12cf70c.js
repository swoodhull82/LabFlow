(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2221],{9786:(e,t,s)=>{Promise.resolve().then(s.bind(s,26491))},26491:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>V});var l=s(95155),a=s(12115),n=s(59576),r=s(14209),i=s(97841),o=s(87481),c=s(34301),d=s(965),m=s(73158),u=s(50172),h=s(31949),p=s(16303),x=s(66695),j=s(30285),y=s(62177),v=s(90221),g=s(55594),f=s(17759),w=s(62523),b=s(88539),C=s(59409),T=s(47262),N=s(77223),D=s(59119),A=s(73168),I=s(15667),S=s(34548),k=s(70831),E=s(91950);let M=g.Ik({employeeId:g.Yj().min(1,{message:"An employee must be selected."}),title:g.Yj().min(2,{message:"Title must be at least 2 characters."}),description:g.Yj().optional(),priority:g.Yj().min(1,"Priority is required."),selectedDays:g.YO(g.ai()).min(1,{message:"Please select at least one day."}),isAllDay:g.zM().optional(),startTime:g.Yj().optional(),endTime:g.Yj().optional(),eventType:g.Yj().default("Available"),recurrence:g.Yj().default("None")}).superRefine((e,t)=>{!e.isAllDay&&(e.startTime||t.addIssue({code:"custom",message:"Start time is required for timed events.",path:["startTime"]}),e.endTime||t.addIssue({code:"custom",message:"End time is required for timed events.",path:["endTime"]}),e.startTime&&e.endTime&&e.endTime<=e.startTime&&t.addIssue({code:"custom",message:"End time must be after start time.",path:["endTime"]}))}),P=e=>{let[t,s]=e.split(":").map(Number),l=new Date;return l.setHours(t,s),(0,A.GP)(l,"h:mm a")},z=(()=>{let e=[];for(let t=7;t<=16;t++)e.push("".concat(String(t).padStart(2,"0"),":00")),t<16&&e.push("".concat(String(t).padStart(2,"0"),":30"));return e})(),B=[{id:1,label:"Mon"},{id:2,label:"Tue"},{id:3,label:"Wed"},{id:4,label:"Thu"},{id:5,label:"Fri"}];function R(e){let{onEventUpserted:t,onDialogClose:s,onDelete:i,eventToEdit:c,employees:d,weekToShow:m}=e,{pbClient:h,user:p}=(0,n.A)(),{toast:x}=(0,o.dj)(),[g,R]=(0,a.useState)(!1),Y=!!c,_="09:00",O="17:00",V=(0,y.mN)({resolver:(0,v.u)(M),defaultValues:Y&&c?{employeeId:c.employeeId||"",title:c.title||"",description:c.description||"",priority:c.priority||"Medium",eventType:c.eventType||"Available",selectedDays:[new Date(c.startDate).getDay()],isAllDay:c.isAllDay||!1,startTime:c.isAllDay?_:(0,A.GP)(new Date(c.startDate),"HH:mm"),endTime:c.isAllDay?O:(0,A.GP)(new Date(c.endDate),"HH:mm"),recurrence:c.recurrence||"None"}:{employeeId:"",title:"",description:"",priority:"Medium",eventType:"Available",selectedDays:[],isAllDay:!1,startTime:_,endTime:O,recurrence:"None"}}),$=V.watch("isAllDay");async function q(e){if(!h||!p)return void x({title:"Error",description:"You must be logged in.",variant:"destructive"});R(!0);let l=new AbortController;try{if(Y&&c){let t,s,l=new Date(c.startDate);if(e.isAllDay)t=(0,I.h)(l,{hours:7,minutes:0,seconds:0}),s=(0,I.h)(l,{hours:16,minutes:0,seconds:0});else{let[a,n]=e.startTime.split(":").map(Number),[r,i]=e.endTime.split(":").map(Number);t=(0,I.h)(l,{hours:a,minutes:n,seconds:0}),s=(0,I.h)(l,{hours:r,minutes:i,seconds:0})}let a={title:e.title,description:e.description,startDate:t,endDate:s,priority:e.priority,isAllDay:e.isAllDay,eventType:e.eventType,recurrence:e.recurrence,employeeId:e.employeeId,userId:p.id};await (0,r.E5)(h,c.id,a),x({title:"Success",description:"Event updated."})}else{let t=(0,S.k)(m,{weekStartsOn:1}),s=e.selectedDays.map(s=>{let a,n,i=(0,k.f)(t,s-1);if(e.isAllDay)a=(0,I.h)(i,{hours:7,minutes:0,seconds:0}),n=(0,I.h)(i,{hours:16,minutes:0,seconds:0});else{let[t,s]=e.startTime.split(":").map(Number),[l,r]=e.endTime.split(":").map(Number);a=(0,I.h)(i,{hours:t,minutes:s,seconds:0}),n=(0,I.h)(i,{hours:l,minutes:r,seconds:0})}let o={employeeId:e.employeeId,userId:p.id,title:e.title,description:e.description,priority:e.priority,startDate:a,endDate:n,isAllDay:e.isAllDay,eventType:e.eventType,recurrence:e.recurrence};return(0,r.n)(h,o,{signal:l.signal})});await Promise.all(s),x({title:"Success",description:"Events created for ".concat(e.selectedDays.length," day(s).")})}t(),s()}catch(e){if((null==e?void 0:e.isAbort)===!0||"string"==typeof(null==e?void 0:e.message)&&e.message.toLowerCase().includes("autocancelled"))console.warn("Event creation was cancelled. This is expected if the component unmounts.");else{var a;x({title:"Error ".concat(Y?"Updating":"Creating"," Event"),description:(null==(a=e.data)?void 0:a.message)||e.message||"An unexpected error occurred. Please check PocketBase permissions.",variant:"destructive"})}}finally{R(!1)}}return(0,l.jsx)(f.lV,{...V,children:(0,l.jsxs)("form",{onSubmit:V.handleSubmit(q),className:"space-y-4",children:[(0,l.jsx)(f.zB,{control:V.control,name:"employeeId",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Employee"}),(0,l.jsxs)(C.l6,{onValueChange:t.onChange,value:t.value,disabled:Y,children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(C.bq,{children:(0,l.jsx)(C.yv,{placeholder:"Select an employee"})})}),(0,l.jsx)(C.gC,{children:d.map(e=>(0,l.jsx)(C.eb,{value:e.id,children:e.name},e.id))})]}),(0,l.jsx)(f.C5,{})]})}}),(0,l.jsx)(f.zB,{control:V.control,name:"title",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Event Title"}),(0,l.jsx)(f.MJ,{children:(0,l.jsx)(w.p,{placeholder:"e.g., On-site Training",...t})}),(0,l.jsx)(f.C5,{})]})}}),(0,l.jsx)(f.zB,{control:V.control,name:"description",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Description (Optional)"}),(0,l.jsx)(f.MJ,{children:(0,l.jsx)(b.T,{placeholder:"Add more details...",...t})}),(0,l.jsx)(f.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(f.zB,{control:V.control,name:"eventType",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Show As"}),(0,l.jsxs)(C.l6,{onValueChange:t.onChange,value:t.value,children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(C.bq,{children:(0,l.jsx)(C.yv,{placeholder:"Select event type"})})}),(0,l.jsx)(C.gC,{children:E.Y$.map(e=>(0,l.jsx)(C.eb,{value:e,children:e},e))})]}),(0,l.jsx)(f.C5,{})]})}}),(0,l.jsx)(f.zB,{control:V.control,name:"priority",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Priority"}),(0,l.jsxs)(C.l6,{onValueChange:t.onChange,value:t.value,children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(C.bq,{children:(0,l.jsx)(C.yv,{placeholder:"Select priority"})})}),(0,l.jsx)(C.gC,{children:E.PN.map(e=>(0,l.jsx)(C.eb,{value:e,children:e},e))})]}),(0,l.jsx)(f.C5,{})]})}})]}),(0,l.jsx)(f.zB,{control:V.control,name:"selectedDays",render:()=>(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Days"}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Select which days this event should occur on for the week of ",(0,A.GP)(m,"MMM do"),"."]}),(0,l.jsx)("div",{className:"flex items-center space-x-4 pt-2",children:B.map(e=>(0,l.jsx)(f.zB,{control:V.control,name:"selectedDays",render:t=>{var s;let{field:a}=t;return(0,l.jsxs)(f.eI,{className:"flex flex-row items-start space-x-2 space-y-0",children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(T.S,{checked:null==(s=a.value)?void 0:s.includes(e.id),onCheckedChange:t=>{let s=a.value||[];return t?a.onChange([...s,e.id]):a.onChange(s.filter(t=>t!==e.id))},disabled:Y})}),(0,l.jsx)(f.lR,{className:"font-normal cursor-pointer",children:e.label})]},e.id)}},e.id))}),(0,l.jsx)(f.C5,{})]})}),(0,l.jsx)(f.zB,{control:V.control,name:"isAllDay",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{className:"flex flex-row items-center space-x-3 space-y-0 rounded-md border p-3 shadow-sm",children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(T.S,{checked:t.value,onCheckedChange:t.onChange})}),(0,l.jsx)("div",{className:"space-y-1 leading-none",children:(0,l.jsx)(f.lR,{className:"cursor-pointer",children:"All-day event"})})]})}}),!$&&(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(f.zB,{control:V.control,name:"startTime",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"Start Time"}),(0,l.jsxs)(C.l6,{onValueChange:t.onChange,value:t.value,children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(C.bq,{children:(0,l.jsx)(C.yv,{placeholder:"Select start time"})})}),(0,l.jsx)(C.gC,{children:z.map(e=>(0,l.jsx)(C.eb,{value:e,children:P(e)},"start-".concat(e)))})]}),(0,l.jsx)(f.C5,{})]})}}),(0,l.jsx)(f.zB,{control:V.control,name:"endTime",render:e=>{let{field:t}=e;return(0,l.jsxs)(f.eI,{children:[(0,l.jsx)(f.lR,{children:"End Time"}),(0,l.jsxs)(C.l6,{onValueChange:t.onChange,value:t.value,children:[(0,l.jsx)(f.MJ,{children:(0,l.jsx)(C.bq,{children:(0,l.jsx)(C.yv,{placeholder:"Select end time"})})}),(0,l.jsx)(C.gC,{children:z.map(e=>(0,l.jsx)(C.eb,{value:e,children:P(e)},"end-".concat(e)))})]}),(0,l.jsx)(f.C5,{})]})}})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center pt-4",children:[(0,l.jsx)("div",{children:Y&&i&&c&&(0,l.jsxs)(j.$,{type:"button",variant:"destructive",onClick:()=>i(c.id),disabled:g,children:[(0,l.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Delete"]})}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)(j.$,{type:"button",variant:"ghost",onClick:s,children:"Cancel"}),(0,l.jsxs)(j.$,{type:"submit",disabled:g,children:[g?(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(D.A,{className:"mr-2 h-4 w-4"}),Y?"Save Changes":"Save Event(s)"]})]})]})]})})}var Y=s(54165),_=s(92266);let O=e=>{let t="An unexpected error occurred.";if(e&&"object"==typeof e){var s;"status"in e&&0===e.status?t="Could not connect to the server. Please check your internet connection.":(null==(s=e.data)?void 0:s.message)?t=e.data.message:e.message&&(t=e.message)}return t};function V(){let{pbClient:e,user:t}=(0,n.A)(),{toast:s}=(0,o.dj)(),[y,v]=(0,a.useState)([]),[g,f]=(0,a.useState)([]),[w,b]=(0,a.useState)(!0),[C,T]=(0,a.useState)(null),[N,D]=(0,a.useState)(!1),[I,k]=(0,a.useState)(null),[E,M]=(0,a.useState)(new Date),P=(0,a.useMemo)(()=>(0,S.k)(E,{weekStartsOn:1}),[E]),z=(null==t?void 0:t.role)==="Supervisor",B=(0,a.useCallback)(async(e,l)=>{b(!0),T(null);try{let[s,a]=await Promise.all([(0,r.yf)(e,z||null==t?void 0:t.id,{signal:l,expand:"userId,employeeId"}),(0,i.Oc)(e,{signal:l})]);v(s),f(a)}catch(e){if(!((null==e?void 0:e.isAbort)===!0||"string"==typeof(null==e?void 0:e.message)&&e.message.toLowerCase().includes("autocancelled"))){console.error("Failed to fetch team schedule data:",e);let t=O(e);T(t),s({title:"Error Loading Data",description:t,variant:"destructive"})}}finally{b(!1)}},[s,null==t?void 0:t.id,z]);(0,a.useEffect)(()=>{let s=new AbortController;return e&&t&&B(e,s.signal),()=>s.abort()},[e,t,B]);let V=(0,a.useMemo)(()=>{let e=new Map;return g.forEach(t=>{t.color&&t.id&&e.set(t.id,t.color)}),e},[g]),$=(0,a.useMemo)(()=>y.map(e=>e.employeeId&&V.has(e.employeeId)?{...e,color:V.get(e.employeeId)}:e.userId&&V.has(e.userId)?{...e,color:V.get(e.userId)}:e),[y,V]),q=()=>{e&&t&&B(e)},J=()=>{D(!1),k(null)},F=async t=>{if(e)try{await (0,r.g6)(e,t),s({title:"Event Deleted",description:"The event has been removed."}),q(),J()}catch(e){s({title:"Error Deleting Event",description:O(e),variant:"destructive"})}};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,l.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Team Schedule"}),z&&(0,l.jsxs)(Y.lG,{open:N,onOpenChange:D,children:[(0,l.jsx)(Y.zM,{asChild:!0,children:(0,l.jsxs)(j.$,{onClick:()=>{k(null),D(!0)},children:[(0,l.jsx)(c.A,{className:"mr-2 h-4 w-4"})," New Team Event"]})}),(0,l.jsxs)(Y.Cf,{children:[(0,l.jsx)(Y.c7,{children:(0,l.jsx)(Y.L3,{children:I?"Edit Event":"New Team Event"})}),(0,l.jsx)(R,{employees:g,onEventUpserted:q,onDialogClose:J,onDelete:F,eventToEdit:I,weekToShow:P})]})]})]}),(0,l.jsxs)(x.Zp,{className:"shadow-md",children:[(0,l.jsxs)(x.aR,{className:"flex flex-row items-center justify-between gap-4 border-b p-3 flex-shrink-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("span",{className:"text-lg font-semibold",children:(0,A.GP)(P,"MMMM yyyy")}),(0,l.jsx)(j.$,{variant:"outline",size:"sm",onClick:()=>M(new Date),children:"Today"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>M(e=>(0,_.W)(e,{weeks:-1})),children:(0,l.jsx)(d.A,{className:"h-5 w-5"})}),(0,l.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>M(e=>(0,_.W)(e,{weeks:1})),children:(0,l.jsx)(m.A,{className:"h-5 w-5"})})]})]}),(0,l.jsx)(x.Wu,{className:"p-0",children:w?(0,l.jsx)("div",{className:"flex justify-center items-center h-96",children:(0,l.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):C?(0,l.jsxs)("div",{className:"text-center py-10 text-destructive h-96",children:[(0,l.jsx)(h.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,l.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Data"}),(0,l.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:C}),(0,l.jsx)(j.$,{onClick:()=>{e&&t&&B(e)},className:"mt-6",children:"Try Again"})]}):(0,l.jsx)(p.A,{events:$,weekStartDate:P,isTeamView:!0,onEventClick:z?e=>{z&&(k(e),D(!0))}:void 0,onHourSlotClick:z?e=>{z&&(k(null),D(!0))}:void 0})})]})]})}},97841:(e,t,s)=>{"use strict";s.d(t,{Oc:()=>o,Qu:()=>m,Y$:()=>d,bV:()=>c});var l=s(7140),a=s(30645);let n="employees",r=(e,t)=>{if(e instanceof l.fp){var s;if(404===e.status)throw Error("Cannot create item: The '".concat(t,"' collection does not exist. Please create it in your PocketBase admin panel."));if(400===e.status&&(null==(s=e.data)?void 0:s.data)){if(e.data.data.id&&e.data.data.id.message)throw Error("There seems to be a configuration issue with your '".concat(t,"' collection. The server is asking for an 'id', which should be automatically generated. Please check in your PocketBase admin panel that the 'id' field is the default system field and not a required text field you created."));let s=Object.entries(e.data.data).map(e=>{let[t,s]=e;return"".concat(t,": ").concat(s.message)}).join("; ");throw Error("Validation failed. Server says: ".concat(s))}}throw console.error("Failed to create item in ".concat(t,":"),e),e},i=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,color:e.color,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),o=async(e,t)=>{try{let{onRetry:s,signal:l,...r}=t||{},o={sort:"name",fields:"id,name,email,role,department_text,reportsTo_text,userId,color,created,updated",...r};return(await (0,a.b)(()=>e.collection(n).getFullList(o,{signal:l}),{signal:l,context:"fetching employees list",onRetry:s})).map(i)}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch employees:",e),e}},c=async(e,t,s)=>{try{let l=await e.collection(n).create(t,{signal:null==s?void 0:s.signal});return i(l)}catch(e){throw r(e,n),e}},d=async(e,t,s,l)=>{try{let{signal:r}=l||{},o=await (0,a.b)(()=>e.collection(n).update(t,s,{signal:r}),{context:"updating employee ".concat(t),signal:r});return i(o)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},m=async(e,t,s)=>{try{let{signal:l}=s||{};await (0,a.b)(()=>e.collection(n).delete(t,{signal:l}),{context:"deleting employee ".concat(t),signal:l})}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2383,4897,9052,3198,1859,7164,5452,3168,5823,9467,5229,5115,8441,1684,7358],()=>t(9786)),_N_E=e.O()}]);