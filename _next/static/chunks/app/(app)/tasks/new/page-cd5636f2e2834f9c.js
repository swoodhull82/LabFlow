(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4867],{21326:(e,t,s)=>{Promise.resolve().then(s.bind(s,96679))},28905:(e,t,s)=>{"use strict";s.d(t,{C:()=>i});var r=s(12115),a=s(6101),n=s(52712),i=e=>{let{present:t,children:s}=e,i=function(e){var t,s;let[a,i]=r.useState(),o=r.useRef({}),d=r.useRef(e),c=r.useRef("none"),[u,m]=(t=e?"mounted":"unmounted",s={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer((e,t)=>{let r=s[e][t];return null!=r?r:e},t));return r.useEffect(()=>{let e=l(o.current);c.current="mounted"===u?e:"none"},[u]),(0,n.N)(()=>{let t=o.current,s=d.current;if(s!==e){let r=c.current,a=l(t);e?m("MOUNT"):"none"===a||(null==t?void 0:t.display)==="none"?m("UNMOUNT"):s&&r!==a?m("ANIMATION_OUT"):m("UNMOUNT"),d.current=e}},[e,m]),(0,n.N)(()=>{if(a){var e;let t,s=null!=(e=a.ownerDocument.defaultView)?e:window,r=e=>{let r=l(o.current).includes(e.animationName);if(e.target===a&&r&&(m("ANIMATION_END"),!d.current)){let e=a.style.animationFillMode;a.style.animationFillMode="forwards",t=s.setTimeout(()=>{"forwards"===a.style.animationFillMode&&(a.style.animationFillMode=e)})}},n=e=>{e.target===a&&(c.current=l(o.current))};return a.addEventListener("animationstart",n),a.addEventListener("animationcancel",r),a.addEventListener("animationend",r),()=>{s.clearTimeout(t),a.removeEventListener("animationstart",n),a.removeEventListener("animationcancel",r),a.removeEventListener("animationend",r)}}m("ANIMATION_END")},[a,m]),{isPresent:["mounted","unmountSuspended"].includes(u),ref:r.useCallback(e=>{e&&(o.current=getComputedStyle(e)),i(e)},[])}}(t),o="function"==typeof s?s({present:i.isPresent}):r.Children.only(s),d=(0,a.s)(i.ref,function(e){var t,s;let r=null==(t=Object.getOwnPropertyDescriptor(e.props,"ref"))?void 0:t.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?e.ref:(a=(r=null==(s=Object.getOwnPropertyDescriptor(e,"ref"))?void 0:s.get)&&"isReactWarning"in r&&r.isReactWarning)?e.props.ref:e.props.ref||e.ref}(o));return"function"==typeof s||i.isPresent?r.cloneElement(o,{ref:d}):null};function l(e){return(null==e?void 0:e.animationName)||"none"}i.displayName="Presence"},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>d,r:()=>o});var r=s(95155),a=s(12115),n=s(99708),i=s(74466),l=s(59434);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:i,asChild:d=!1,...c}=e,u=d?n.DX:"button";return(0,r.jsx)(u,{className:(0,l.cn)(o({variant:a,size:i,className:s})),ref:t,...c})});d.displayName="Button"},30645:(e,t,s)=>{"use strict";s.d(t,{b:()=>i});let r={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var a=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(a||{});let n=new Map;async function i(e,t){let s,a={...r,...t},i=a.context,l=(e,t)=>{let s="[withRetry:".concat(i,"] ").concat(e,". Circuit: ").concat(o.state,".");console.warn(s);let r=Error(s);throw r.isAbort=!0,r.context=i,t&&(r.originalError=t),r};n.has(i)||n.set(i,{state:"CLOSED",failures:0});let o=n.get(i);if("OPEN"===o.state)if(Date.now()<(o.openUntil||0)){let e=Error("Circuit for '".concat(i,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=i,e.openUntil=o.openUntil,e}else o.state="HALF_OPEN",o.failures=0,o.openUntil=void 0,console.log("[withRetry:".concat(i,"] Circuit is now HalfOpen. Allowing one attempt."));let d="HALF_OPEN"===o.state?1:a.maxAttempts;for(let t=1;t<=d;t++){var c,u,m;(null==(c=a.signal)?void 0:c.aborted)&&l("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===o.state||o.failures>0||"OPEN"===o.state)&&(console.log("[withRetry:".concat(i,"] Circuit is now Closed due to successful attempt (was ").concat(o.state,").")),o.state="CLOSED",o.failures=0,o.openUntil=void 0),t}catch(e){if(s=e,(null==(u=a.signal)?void 0:u.aborted)&&l("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(i,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(o.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=i),e;if(a.shouldRetry(e))if(a.onRetry&&a.onRetry(t,d,e),t<d){let e="HALF_OPEN"===o.state?a.delayMs:a.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(m=a.signal)?void 0:m.aborted)&&l("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(i,"] All ").concat(d," attempts failed (Circuit: ").concat(o.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===o.state?(console.warn("[withRetry:".concat(i,"] Circuit failed in HalfOpen state. Re-opening.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=i):"CLOSED"===o.state&&(o.failures++,console.log("[withRetry:".concat(i,"] Circuit failure count: ").concat(o.failures," (max: ").concat(1,")")),o.failures>=1&&(console.warn("[withRetry:".concat(i,"] Circuit reached max failures. Opening circuit.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=i)),s;else throw e}}if(s)throw s;throw Error("[withRetry:".concat(i,"] Unexpected exit: Max attempts ").concat(d," reached without success or explicit error handling."))}},40968:(e,t,s)=>{"use strict";s.d(t,{b:()=>l});var r=s(12115),a=s(63655),n=s(95155),i=r.forwardRef((e,t)=>(0,n.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null==(s=e.onMouseDown)||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},50172:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},59409:(e,t,s)=>{"use strict";s.d(t,{bq:()=>m,eb:()=>x,gC:()=>h,l6:()=>c,yv:()=>u});var r=s(95155),a=s(12115),n=s(31992),i=s(79556),l=s(77381),o=s(10518),d=s(59434);let c=n.bL;n.YJ;let u=n.WT,m=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,r.jsxs)(n.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[a,(0,r.jsx)(n.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=n.l9.displayName;let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})});p.displayName=n.PP.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})});f.displayName=n.wn.displayName;let h=a.forwardRef((e,t)=>{let{className:s,children:a,position:i="popper",...l}=e;return(0,r.jsx)(n.ZL,{children:(0,r.jsxs)(n.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...l,children:[(0,r.jsx)(p,{}),(0,r.jsx)(n.LM,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(f,{})]})})});h.displayName=n.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=n.JU.displayName;let x=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(n.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.VF,{children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})}),(0,r.jsx)(n.p4,{children:a})]})});x.displayName=n.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...a})}).displayName=n.wv.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var r=s(95155),a=s(12115),n=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...i})});i.displayName="Input"},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>o,Zp:()=>i,aR:()=>l,wL:()=>u});var r=s(95155),a=s(12115),n=s(59434);let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",s),...a})});i.displayName="Card";let l=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...a})});l.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),...a})});o.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...a})});d.displayName="CardDescription";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...a})});c.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...a})});u.displayName="CardFooter"},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>d});var r=s(95155),a=s(12115),n=s(40968),i=s(74466),l=s(59434);let o=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.b,{ref:t,className:(0,l.cn)(o(),s),...a})});d.displayName=n.b.displayName},96679:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>V});var r=s(95155),a=s(30285),n=s(66695),i=s(62523),l=s(85057),o=s(88539),d=s(59409),c=s(14636),u=s(85511),m=s(47262),p=s(66424),f=s(50172),h=s(44972),x=s(51920),N=s(13896),g=s(31949),v=s(86318);let A=(0,s(40157).A)("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);var y=s(59119),T=s(73168),j=s(12115),O=s(35695),I=s(6874),b=s.n(I),w=s(59576),P=s(77694),E=s(97841),D=s(87481),S=s(91950);let L=e=>{let t="Could not load employees for assignment.";if(e&&"object"==typeof e)if("status"in e&&0===e.status)return"Failed to load employees for assignment: Could not connect to the server. Please check your internet connection and try again.";else e.message&&(t=e.message);return t},C=e=>{let t="Could not load tasks for dependency selection.";if(e&&"object"==typeof e)if("status"in e&&0===e.status)return"Failed to load tasks for dependency selection: Could not connect to the server. Please check your internet connection and try again.";else e.message&&(t=e.message);return t},_=e=>{let t=e.get("defaultType");return t&&S.ci.includes(t)?t:S.ci.find(e=>"VALIDATION_PROJECT"!==e&&"VALIDATION_STEP"!==e)||S.ci[0]};function V(){var e;let{pbClient:t,user:s}=(0,w.A)(),I=(0,O.useRouter)(),{toast:V}=(0,D.dj)(),R=(0,O.useSearchParams)(),k=(0,j.useMemo)(()=>_(R),[R]),J=R.get("dependsOnValidationProject"),[M,F]=(0,j.useState)(k),[U,q]=(0,j.useState)(""),[H,W]=(0,j.useState)(),[z,B]=(0,j.useState)(),[G,Z]=(0,j.useState)(""),[$,Y]=(0,j.useState)(S.Hi[0]||"To Do"),[X,K]=(0,j.useState)(S.PN.find(e=>"medium"===e.toLowerCase())||S.PN[0]||"Medium"),[Q,ee]=(0,j.useState)(),[et,es]=(0,j.useState)(),[er,ea]=(0,j.useState)(!1),[en,ei]=(0,j.useState)(()=>{let e=_(R);if("VALIDATION_PROJECT"===e||"VALIDATION_STEP"===e)return localStorage.setItem("newTaskFormRecurrence","None"),"None";{let e=localStorage.getItem("newTaskFormRecurrence");if(e&&S.y4.includes(e))return e}return"Daily"}),[el,eo]=(0,j.useState)([]),[ed,ec]=(0,j.useState)(null),[eu,em]=(0,j.useState)(!1),[ep,ef]=(0,j.useState)(!1),[eh,ex]=(0,j.useState)([]),[eN,eg]=(0,j.useState)(!0),[ev,eA]=(0,j.useState)(null),[ey,eT]=(0,j.useState)([]),[ej,eO]=(0,j.useState)(!0),[eI,eb]=(0,j.useState)(null),[ew,eP]=(0,j.useState)(J?[J]:[]),[eE,eD]=(0,j.useState)(!1),[eS,eL]=(0,j.useState)(!1),[eC,e_]=(0,j.useState)([]),eV=(0,j.useMemo)(()=>"VALIDATION_PROJECT"===k||"VALIDATION_STEP"===k&&!!J,[k,J]),eR=(0,j.useMemo)(()=>"VALIDATION_PROJECT"===k?S.ci.filter(e=>"VALIDATION_PROJECT"===e):"VALIDATION_STEP"===k&&J?S.ci.filter(e=>"VALIDATION_STEP"===e):S.ci.filter(e=>"VALIDATION_PROJECT"!==e&&"VALIDATION_STEP"!==e),[k,J]);(0,j.useEffect)(()=>{localStorage.setItem("newTaskFormRecurrence",en)},[en]),(0,j.useEffect)(()=>{if("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)"None"!==en&&ei("None");else if("None"===en){let e=localStorage.getItem("newTaskFormRecurrence");e&&"None"!==e&&S.y4.includes(e)?ei(e):ei("Daily")}},[M,en,ei]),(0,j.useEffect)(()=>{"MDL"!==M&&"SOP"!==M?(W(void 0),B(void 0),e_([])):"MDL"===M?(H&&S.xJ[H]?e_(S.xJ[H]):e_([]),H&&S.xJ[H]&&!S.xJ[H].includes(z||"")&&B(void 0)):(B(void 0),e_([])),("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep&&Q?es(Q):("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep&&!Q&&es(void 0),"VALIDATION_PROJECT"!==M&&"VALIDATION_STEP"!==M&&(ef(!1),q("")),"VALIDATION_STEP"===M?!J&&ew.length>0&&eP([]):"VALIDATION_PROJECT"===M||J||eP([])},[M,H,ep,Q,z,J,ew.length]);let ek=(0,j.useCallback)(async(e,t)=>{if(!e)return void eg(!1);eg(!0),eA(null);try{let s=await (0,E.Oc)(e,{signal:t});ex(s)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Fetch employees for task assignment request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=L(s);eA(e),V({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Fetch employees for task assignment (network error):",e,s)}else{let e=L(s);eA(e),V({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees for task assignment (after retries):",e,s)}}finally{eg(!1)}},[V]),eJ=(0,j.useCallback)(async(e,t)=>{if(!e)return void eO(!1);eO(!0),eb(null);try{let s=await (0,P.x1)(e,{signal:t});eT(s)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Fetch tasks for dependency selection request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=C(s);eb(e),V({title:"Error Loading Tasks for Dependencies",description:e,variant:"destructive"}),console.warn("Fetch tasks for dependency selection (network error):",e,s)}else{let e=C(s);eb(e),V({title:"Error Loading Tasks for Dependencies",description:e,variant:"destructive"}),console.warn("Error fetching tasks for dependency selection (after retries):",e,s)}}finally{eO(!1)}},[V]);(0,j.useEffect)(()=>{let e=new AbortController;return t?(ek(t,e.signal),"VALIDATION_STEP"!==M?eJ(t,e.signal):(eO(!1),eT([]))):(eg(!0),eO(!0)),()=>{e.abort()}},[t,ek,eJ,M]);let eM=e=>{eP(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},eF=e=>{eo(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},eU=async e=>{var r;if(e.preventDefault(),!t||!s)return void V({title:"Error",description:"You must be logged in to create a task.",variant:"destructive"});let a="VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M?U.trim():M;if(!a){let e="Task Type (which serves as Name) is required.";"VALIDATION_PROJECT"===M&&(e="Project Name is required."),"VALIDATION_STEP"===M&&(e="Step Name is required."),V({title:"Validation Error",description:e,variant:"destructive"});return}if("MDL"===M&&!H)return void V({title:"Validation Error",description:"Instrument Subtype is required for ".concat(M," tasks."),variant:"destructive"});if("MDL"===M&&H&&(null==(r=S.xJ[H])?void 0:r.length)>0&&!z)return void V({title:"Validation Error",description:"Method is required for the selected ".concat(H,"."),variant:"destructive"});if("SOP"===M&&!H)return void V({title:"Validation Error",description:"Subtype is required for ".concat(M," tasks."),variant:"destructive"});if(!$)return void V({title:"Validation Error",description:"Task status is required.",variant:"destructive"});if(!X)return void V({title:"Validation Error",description:"Task priority is required.",variant:"destructive"});let n="VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M?"None":en;if("VALIDATION_PROJECT"!==M&&"VALIDATION_STEP"!==M&&(!n||!S.y4.includes(n)))return void V({title:"Validation Error",description:"Task recurrence is required for this task type.",variant:"destructive"});if(("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep&&!Q)return void V({title:"Validation Error",description:"Milestone date is required for a Validation milestone.",variant:"destructive"});if(!(("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep)&&Q&&et&&Q>et)return void V({title:"Validation Error",description:"Start date must be before or same as due date.",variant:"destructive"});em(!0);let i=new FormData;if(i.append("title",a),i.append("task_type",M),"MDL"===M&&H?(i.append("instrument_subtype",H),z&&i.append("method",z)):"SOP"===M&&H&&i.append("instrument_subtype",H),G.trim()&&i.append("description",G),i.append("status",$),i.append("priority",X),i.append("recurrence",n),i.append("isMilestone","VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M?ep.toString():"false"),ew.length>0&&i.append("dependencies",JSON.stringify(ew)),Q&&i.append("startDate",Q.toISOString()),et&&i.append("dueDate",et.toISOString()),el.length>0&&el.forEach(e=>i.append("assignedTo",e)),i.append("userId",s.id),ed)for(let e=0;e<ed.length;e++)i.append("attachments",ed[e]);try{await (0,P.UT)(t,i),V({title:"Success",description:"New ".concat(a," task created successfully!")}),"VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M||J?I.push("/validations"):I.push("/tasks")}catch(e){V({title:"Error Creating Task",description:e.message||"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{em(!1)}},eq=eN||ej&&"VALIDATION_STEP"!==M,eH="Pick a date";if(eH=("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?Q?"Milestone: ".concat((0,T.GP)(Q,"PPP")):"Pick Milestone Date":Q&&et?"".concat((0,T.GP)(Q,"PPP")," - ").concat((0,T.GP)(et,"PPP")):Q?"".concat((0,T.GP)(Q,"PPP")," - Select End Date"):"Pick Date Range",!t&&!eq)return(0,r.jsx)("div",{className:"space-y-6 max-w-2xl mx-auto",children:(0,r.jsxs)(n.Zp,{className:"shadow-md",children:[(0,r.jsx)(n.aR,{children:(0,r.jsx)(n.ZB,{className:"font-headline",children:"Initializing Task Creation"})}),(0,r.jsx)(n.Wu,{children:(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(f.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Initializing task creation form..."})]})})]})});let eW="VALIDATION_STEP"===M&&!!J,ez="VALIDATION_PROJECT"===M||"VALIDATION_PROJECT"===k,eB=0===el.length?"Select employees (Optional)":1===el.length?(null==(e=eh.find(e=>e.id===el[0]))?void 0:e.name)||"1 employee selected":"".concat(el.length," employees selected");return(0,r.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:ez?"New Validation Project":eW?"New Step for Validation Project":"Add New Task"}),(0,r.jsx)(a.$,{variant:"outline",asChild:!0,children:(0,r.jsx)(b(),{href:ez||eW?"/validations":"/tasks",children:"Cancel"})})]}),(0,r.jsxs)(n.Zp,{className:"shadow-md",children:[(0,r.jsxs)(n.aR,{children:[(0,r.jsx)(n.ZB,{className:"font-headline",children:"Task Details"}),(0,r.jsx)(n.BT,{children:"Fill in the information for the new task."})]}),(0,r.jsx)(n.Wu,{children:(0,r.jsxs)("form",{onSubmit:eU,className:"space-y-6",children:[!eV&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"task_type_select",children:"Task Type"}),(0,r.jsxs)(d.l6,{value:M,onValueChange:e=>{F(e),"VALIDATION_PROJECT"!==e&&"VALIDATION_STEP"!==e&&q("")},children:[(0,r.jsx)(d.bq,{id:"task_type_select",children:(0,r.jsx)(d.yv,{placeholder:"Select task type"})}),(0,r.jsx)(d.gC,{children:eR.map(e=>(0,r.jsx)(d.eb,{value:e,children:e.replace(/_/g," ")},e))})]})]}),("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"customTaskName",children:"VALIDATION_PROJECT"===M?"Project Name":"Step Name"}),(0,r.jsx)(i.p,{id:"customTaskName",placeholder:"VALIDATION_PROJECT"===M?"Enter the project name":"Enter the step name",value:U,onChange:e=>q(e.target.value)})]}),"MDL"===M&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"instrumentSubtypeMDL",children:"Instrument Subtype"}),(0,r.jsxs)(d.l6,{value:H,onValueChange:e=>{W(e),e&&S.xJ[e]&&!S.xJ[e].includes(z||"")?B(void 0):e||B(void 0),e_(e&&S.xJ[e]||[])},children:[(0,r.jsx)(d.bq,{id:"instrumentSubtypeMDL",children:(0,r.jsx)(d.yv,{placeholder:"Select instrument for MDL"})}),(0,r.jsx)(d.gC,{children:S.oe.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]}),H&&eC.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"methodMDL",children:"Method"}),(0,r.jsxs)(d.l6,{value:z,onValueChange:e=>B(e),children:[(0,r.jsx)(d.bq,{id:"methodMDL",children:(0,r.jsx)(d.yv,{placeholder:"Select method"})}),(0,r.jsx)(d.gC,{children:eC.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]})]}),"SOP"===M&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"instrumentSubtypeSOP",children:"SOP Subtype"}),(0,r.jsxs)(d.l6,{value:H,onValueChange:e=>W(e),children:[(0,r.jsx)(d.bq,{id:"instrumentSubtypeSOP",children:(0,r.jsx)(d.yv,{placeholder:"Select SOP subtype"})}),(0,r.jsx)(d.gC,{children:S.tk.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"description",children:"Description"}),(0,r.jsx)(o.T,{id:"description",placeholder:"Add any relevant details or instructions...",value:G,onChange:e=>Z(e.target.value)})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"status",children:"Status"}),(0,r.jsxs)(d.l6,{value:$,onValueChange:e=>Y(e),children:[(0,r.jsx)(d.bq,{id:"status",children:(0,r.jsx)(d.yv,{placeholder:"Select status"})}),(0,r.jsx)(d.gC,{children:S.Hi.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"priority",children:"Priority"}),(0,r.jsxs)(d.l6,{value:X,onValueChange:e=>K(e),children:[(0,r.jsx)(d.bq,{id:"priority",children:(0,r.jsx)(d.yv,{placeholder:"Select priority"})}),(0,r.jsx)(d.gC,{children:S.PN.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]})]}),("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.S,{id:"isMilestone",checked:ep,onCheckedChange:e=>ef(!!e)}),(0,r.jsxs)(l.J,{htmlFor:"isMilestone",className:"flex items-center cursor-pointer",children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4 text-muted-foreground"})," Mark as Milestone"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"dateRangePicker",children:("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?"Milestone Date":"Date Range (Start - Due)"}),(0,r.jsxs)(c.AM,{open:er,onOpenChange:ea,children:[(0,r.jsx)(c.Wv,{asChild:!0,children:(0,r.jsxs)(a.$,{id:"dateRangePicker",variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"}),eH]})}),(0,r.jsx)(c.hl,{className:"w-auto p-0",children:(0,r.jsx)(u.V,{mode:("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?"single":"range",selected:("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?Q:{from:Q,to:et},onSelect:e=>{("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?(ee(e),es(e)):(ee(null==e?void 0:e.from),es(null==e?void 0:e.to)),e&&(("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep||null==e||!e.from||(null==e?void 0:e.to))&&ea(!1)},numberOfMonths:("VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M)&&ep?1:2,initialFocus:!0})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:["VALIDATION_PROJECT"!==M&&"VALIDATION_STEP"!==M&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"recurrence",children:"Recurrence"}),(0,r.jsxs)(d.l6,{value:en,onValueChange:e=>ei(e),children:[(0,r.jsx)(d.bq,{id:"recurrence",children:(0,r.jsx)(d.yv,{placeholder:"Select recurrence"})}),(0,r.jsx)(d.gC,{children:S.y4.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{className:"VALIDATION_PROJECT"===M||"VALIDATION_STEP"===M||"MDL"===M&&eC.length>0||"VALIDATION_PROJECT"!==M&&"VALIDATION_STEP"!==M?"md:col-span-2":"",children:[(0,r.jsx)(l.J,{htmlFor:"assignedTo",children:"Assigned To"}),(0,r.jsxs)(c.AM,{open:eS,onOpenChange:eL,children:[(0,r.jsx)(c.Wv,{asChild:!0,children:(0,r.jsxs)(a.$,{variant:"outline",className:"w-full justify-start text-left font-normal",disabled:eN||!!ev,children:[(0,r.jsx)(N.A,{className:"mr-2 h-4 w-4"}),eN?"Loading employees...":ev?"Error loading":eB]})}),(0,r.jsx)(c.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,r.jsx)(p.F,{className:"h-48",children:(0,r.jsx)("div",{className:"p-4 space-y-2",children:eh.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.S,{id:"assignee-".concat(e.id),checked:el.includes(e.id),onCheckedChange:()=>eF(e.id)}),(0,r.jsxs)(l.J,{htmlFor:"assignee-".concat(e.id),className:"font-normal cursor-pointer",children:[e.name," (",e.role,")"]})]},e.id))})})})]}),ev&&!eN&&(0,r.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,r.jsx)(g.A,{className:"h-4 w-4 mr-1"})," ",ev]})]})]}),"VALIDATION_STEP"!==M&&(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"dependencies",children:"Dependencies (Optional)"}),(0,r.jsxs)(c.AM,{open:eE,onOpenChange:eD,children:[(0,r.jsx)(c.Wv,{asChild:!0,children:(0,r.jsxs)(a.$,{variant:"outline",className:"w-full justify-start text-left font-normal",disabled:ej||!!eI,children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"}),ej?"Loading tasks...":eI?"Error loading tasks":ew.length>0?"".concat(ew.length," selected"):"Select tasks"]})}),(0,r.jsxs)(c.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:[ej?(0,r.jsx)("div",{className:"p-4 text-center text-sm",children:"Loading tasks..."}):eI?(0,r.jsx)("div",{className:"p-4 text-center text-sm text-destructive",children:eI}):0===ey.length?(0,r.jsx)("div",{className:"p-4 text-center text-sm",children:"No tasks available to select as dependencies."}):(0,r.jsx)(p.F,{className:"h-48",children:(0,r.jsx)("div",{className:"p-4 space-y-2",children:ey.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(m.S,{id:"dep-".concat(e.id),checked:ew.includes(e.id),onCheckedChange:()=>eM(e.id),disabled:J===e.id}),(0,r.jsxs)("label",{htmlFor:"dep-".concat(e.id),className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 truncate",title:e.title,children:[e.title," (",e.task_type.replace(/_/g," "),")"]})]},e.id))})}),(0,r.jsx)("div",{className:"p-2 border-t",children:(0,r.jsx)(a.$,{size:"sm",className:"w-full",onClick:()=>eD(!1),children:"Done"})})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.J,{htmlFor:"attachments",children:"Attachments"}),(0,r.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md",children:(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)(A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,r.jsxs)("div",{className:"flex text-sm text-muted-foreground",children:[(0,r.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-ring",children:[(0,r.jsx)("span",{children:"Upload files"}),(0,r.jsx)(i.p,{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",multiple:!0,onChange:e=>{e.target.files&&ec(e.target.files)}})]}),(0,r.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, PDF, etc. up to 10MB each"}),ed&&ed.length>0&&(0,r.jsxs)("div",{className:"pt-2 text-sm text-muted-foreground",children:["Selected: ",Array.from(ed).map(e=>e.name).join(", ")]})]})})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)(a.$,{type:"submit",disabled:eu||eq||eI&&"VALIDATION_STEP"!==M||ev,children:[eu?(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Save Task"]})})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2383,4897,9052,6874,1859,7164,3168,5280,9819,7655,9467,5061,8441,1684,7358],()=>t(21326)),_N_E=e.O()}]);