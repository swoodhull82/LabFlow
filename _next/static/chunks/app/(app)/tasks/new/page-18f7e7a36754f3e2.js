(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[867],{13645:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var s=a(95155),r=a(30285),i=a(66695),l=a(62523),n=a(85057),d=a(12115),o=a(59434);let c=d.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...r})});c.displayName="Textarea";var u=a(59409),m=a(20547);let h=m.bL,p=m.l9,x=d.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...l}=e;return(0,s.jsx)(m.ZL,{children:(0,s.jsx)(m.UC,{ref:t,align:r,sideOffset:i,className:(0,o.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});x.displayName=m.UC.displayName;var f=a(85511),g=a(50172),y=a(51920),j=a(31949),v=a(37607),w=a(59119),b=a(83013),N=a(35695),k=a(6874),_=a.n(k),C=a(59576),D=a(77694),F=a(97841),S=a(87481),P=a(91950);function T(){let{pbClient:e,user:t}=(0,C.A)(),a=(0,N.useRouter)(),{toast:o}=(0,S.dj)(),[m,k]=(0,d.useState)(""),[T,E]=(0,d.useState)(""),[O,A]=(0,d.useState)(P.Hi[0]||"To Do"),[I,V]=(0,d.useState)(P.PN.find(e=>"medium"===e.toLowerCase())||P.PN[0]||"Medium"),[L,J]=(0,d.useState)(),[q,B]=(0,d.useState)(),[R,z]=(0,d.useState)(P.y4.find(e=>"none"===e.toLowerCase())||P.y4[0]||"None"),[U,H]=(0,d.useState)(),[Z,$]=(0,d.useState)(null),[G,M]=(0,d.useState)(!1),[W,Y]=(0,d.useState)([]),[Q,K]=(0,d.useState)(!0),[X,ee]=(0,d.useState)(null),et=(0,d.useCallback)(async e=>{if(!e)return void K(!1);K(!0),ee(null);try{let t=await (0,F.Oc)(e);Y(t)}catch(s){let e=(null==s?void 0:s.isAbort)===!0,t=(null==s?void 0:s.status)===0,a="string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled");if(e||t||a)console.warn("Fetch employees request for task assignment was autocancelled or due to a network issue.",s);else{console.error("Error fetching employees for task assignment:",s);let e=s.message||"Could not load employees for assignment.";ee(e),o({title:"Error Loading Employees",description:e,variant:"destructive"})}}finally{K(!1)}},[o]);(0,d.useEffect)(()=>{e?et(e):K(!0)},[e,et]);let ea=async s=>{if(s.preventDefault(),!e||!t)return void o({title:"Error",description:"You must be logged in to create a task.",variant:"destructive"});if(!m.trim())return void o({title:"Validation Error",description:"Task title is required.",variant:"destructive"});if(!O)return void o({title:"Validation Error",description:"Task status is required.",variant:"destructive"});if(!I)return void o({title:"Validation Error",description:"Task priority is required.",variant:"destructive"});if(!R)return void o({title:"Validation Error",description:"Task recurrence is required.",variant:"destructive"});M(!0);let r=new FormData;if(r.append("title",m),r.append("description",T),r.append("status",O),r.append("priority",I),L&&r.append("startDate",L.toISOString()),q&&r.append("dueDate",q.toISOString()),r.append("recurrence",R),U&&r.append("assignedTo_text",U),r.append("userId",t.id),Z)for(let e=0;e<Z.length;e++)r.append("attachments",Z[e]);try{await (0,D.UT)(e,r),o({title:"Success",description:"New task created successfully!"}),a.push("/tasks")}catch(t){console.error("Failed to create task (full error object):",t);let e="Failed to create task. Please try again.";if(t.data&&"object"==typeof t.data){let a="";t.data.message&&"string"==typeof t.data.message&&(a=t.data.message);let s="";if(t.data.data&&"object"==typeof t.data.data&&Object.keys(t.data.data).length>0&&(s=Object.entries(t.data.data).map(e=>{let[t,a]=e,s=a&&a.message?a.message:"Invalid value";return"".concat(t,": ").concat(s)}).join("; ")),a&&s)e="".concat(a,". Details: ").concat(s);else if(a)e=a;else if(s)e="Validation errors: ".concat(s);else if(Object.keys(t.data).length>0&&"Failed to create task. Please try again."===e)try{e="PocketBase error: ".concat(JSON.stringify(t.data))}catch(t){e="PocketBase error: Could not stringify error data."}}else t.message&&"string"==typeof t.message&&(e=t.message);o({title:"Error Creating Task",description:e,variant:"destructive"})}finally{M(!1)}};return e||Q?(0,s.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Add New Task"}),(0,s.jsx)(r.$,{variant:"outline",asChild:!0,children:(0,s.jsx)(_(),{href:"/tasks",children:"Cancel"})})]}),(0,s.jsxs)(i.Zp,{className:"shadow-md",children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsx)(i.ZB,{className:"font-headline",children:"Task Details"}),(0,s.jsx)(i.BT,{children:"Fill in the information for the new task."})]}),(0,s.jsx)(i.Wu,{children:(0,s.jsxs)("form",{onSubmit:ea,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"title",children:"Title"}),(0,s.jsx)(l.p,{id:"title",placeholder:"e.g., Calibrate pH meter",value:m,onChange:e=>k(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"description",children:"Description"}),(0,s.jsx)(c,{id:"description",placeholder:"Add any relevant details or instructions...",value:T,onChange:e=>E(e.target.value)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"status",children:"Status"}),(0,s.jsxs)(u.l6,{value:O,onValueChange:e=>A(e),children:[(0,s.jsx)(u.bq,{id:"status",children:(0,s.jsx)(u.yv,{placeholder:"Select status"})}),(0,s.jsx)(u.gC,{children:P.Hi.map(e=>(0,s.jsx)(u.eb,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"priority",children:"Priority"}),(0,s.jsxs)(u.l6,{value:I,onValueChange:e=>V(e),children:[(0,s.jsx)(u.bq,{id:"priority",children:(0,s.jsx)(u.yv,{placeholder:"Select priority"})}),(0,s.jsx)(u.gC,{children:P.PN.map(e=>(0,s.jsx)(u.eb,{value:e,children:e},e))})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"startDate",children:"Start Date"}),(0,s.jsxs)(h,{children:[(0,s.jsx)(p,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),L?(0,b.GP)(L,"PPP"):(0,s.jsx)("span",{children:"Pick a date"})]})}),(0,s.jsx)(x,{className:"w-auto p-0",children:(0,s.jsx)(f.V,{mode:"single",selected:L,onSelect:J,initialFocus:!0})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"dueDate",children:"Due Date"}),(0,s.jsxs)(h,{children:[(0,s.jsx)(p,{asChild:!0,children:(0,s.jsxs)(r.$,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),q?(0,b.GP)(q,"PPP"):(0,s.jsx)("span",{children:"Pick a date"})]})}),(0,s.jsx)(x,{className:"w-auto p-0",children:(0,s.jsx)(f.V,{mode:"single",selected:q,onSelect:B,initialFocus:!0})})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"recurrence",children:"Recurrence"}),(0,s.jsxs)(u.l6,{value:R,onValueChange:e=>z(e),children:[(0,s.jsx)(u.bq,{id:"recurrence",children:(0,s.jsx)(u.yv,{placeholder:"Select recurrence"})}),(0,s.jsx)(u.gC,{children:P.y4.map(e=>(0,s.jsx)(u.eb,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"assignedTo",children:"Assigned To"}),(0,s.jsxs)(u.l6,{onValueChange:e=>H("__NONE__"===e?void 0:e),value:U||"__NONE__",disabled:Q||!!X,children:[(0,s.jsx)(u.bq,{id:"assignedTo_text",children:(0,s.jsx)(u.yv,{placeholder:Q?"Loading employees...":X?"Error loading":"Select employee (Optional)"})}),(0,s.jsxs)(u.gC,{children:[(0,s.jsx)(u.eb,{value:"__NONE__",children:"None"}),W.map(e=>(0,s.jsxs)(u.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),X&&!Q&&(0,s.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-1"})," ",X]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(n.J,{htmlFor:"attachments",children:"Attachments"}),(0,s.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md",children:(0,s.jsxs)("div",{className:"space-y-1 text-center",children:[(0,s.jsx)(v.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsxs)("div",{className:"flex text-sm text-muted-foreground",children:[(0,s.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer rounded-md font-medium text-primary hover:text-primary/80 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-ring",children:[(0,s.jsx)("span",{children:"Upload files"}),(0,s.jsx)(l.p,{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",multiple:!0,onChange:e=>{e.target.files&&$(e.target.files)}})]}),(0,s.jsx)("p",{className:"pl-1",children:"or drag and drop"})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"PNG, JPG, PDF, etc. up to 10MB each"}),Z&&Z.length>0&&(0,s.jsxs)("div",{className:"pt-2 text-sm text-muted-foreground",children:["Selected: ",Array.from(Z).map(e=>e.name).join(", ")]})]})})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(r.$,{type:"submit",disabled:G||Q,children:[G?(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Save Task"]})})]})})]})]}):(0,s.jsx)("div",{className:"space-y-6 max-w-2xl mx-auto",children:(0,s.jsxs)(i.Zp,{className:"shadow-md",children:[(0,s.jsx)(i.aR,{children:(0,s.jsx)(i.ZB,{className:"font-headline",children:"Initializing Task Creation"})}),(0,s.jsx)(i.Wu,{children:(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(g.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Initializing task creation form..."})]})})]})})}},21326:(e,t,a)=>{Promise.resolve().then(a.bind(a,13645))},77694:(e,t,a)=>{"use strict";a.d(t,{UT:()=>l,lC:()=>n,vq:()=>d,x1:()=>i});let s="tasks",r=e=>({...e,startDate:e.startDate?new Date(e.startDate):void 0,dueDate:e.dueDate?new Date(e.dueDate):void 0,created:new Date(e.created),updated:new Date(e.updated)}),i=async e=>{try{return(await e.collection(s).getFullList({sort:"-created"})).map(r)}catch(e){throw console.error("Failed to fetch tasks:",e),e}},l=async(e,t)=>{try{let a=await e.collection(s).create(t);return r(a)}catch(e){throw console.error("Failed to create task:",e),e}},n=async(e,t,a)=>{try{let i=await e.collection(s).update(t,a);return r(i)}catch(e){throw console.error("Failed to update task ".concat(t,":"),e),e}},d=async(e,t)=>{try{await e.collection(s).delete(t)}catch(e){throw console.error("Failed to delete task ".concat(t,":"),e),e}}},85511:(e,t,a)=>{"use strict";a.d(t,{V:()=>o});var s=a(95155);a(12115);var r=a(965),i=a(73158),l=a(57076),n=a(59434),d=a(30285);function o(e){let{className:t,classNames:a,showOutsideDays:o=!0,...c}=e;return(0,s.jsx)(l.hv,{showOutsideDays:o,className:(0,n.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,n.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,n.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e;return(0,s.jsx)(r.A,{className:(0,n.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e;return(0,s.jsx)(i.A,{className:(0,n.cn)("h-4 w-4",t),...a})}},...c})}o.displayName="Calendar"},91950:(e,t,a)=>{"use strict";a.d(t,{C3:()=>l,Hi:()=>s,PN:()=>r,y4:()=>i});let s=["To Do","In Progress","Blocked","Done","Overdue"],r=["Low","Medium","High","Urgent"],i=["None","Daily","Weekly","Monthly","Yearly"],l="LabFlow"},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>i,Qu:()=>d,Y$:()=>n,bV:()=>l});let s="employees",r=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),i=async e=>{try{return(await e.collection(s).getFullList({sort:"name"})).map(r)}catch(e){throw console.error("Failed to fetch employees:",e),e}},l=async(e,t)=>{try{let a=await e.collection(s).create(t);return r(a)}catch(e){throw console.error("Failed to create employee:",e),e}},n=async(e,t,a)=>{try{let i=await e.collection(s).update(t,a);return r(i)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},d=async(e,t)=>{try{await e.collection(s).delete(t)}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,644,52,524,73,483,354,475,556,441,303,358],()=>t(21326)),_N_E=e.O()}]);