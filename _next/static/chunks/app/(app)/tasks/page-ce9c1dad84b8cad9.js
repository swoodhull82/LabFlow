(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[738],{3970:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>Q});var a=s(95155),r=s(12115),n=s(30285),l=s(66695),i=s(85127),c=s(74466),o=s(59434);let d=(0,c.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,o.cn)(d({variant:s}),t),...r})}var p=s(44838),h=s(54165),m=s(17759),x=s(62523),y=s(88539),f=s(59409),g=s(14636),j=s(85511),v=s(5349),b=s(66424),k=s(40157);let N=(0,k.A)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var A=s(34301),_=s(50172),C=s(31949),w=s(3561),T=s(70154),D=s(58127),I=s(18763),O=s(77223),V=s(44972),E=s(51920),P=s(86318);let M=(0,k.A)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]]);var R=s(81737),L=s(59119),S=s(73168),J=s(6874),q=s.n(J),z=s(59576),B=s(77694),F=s(97841),Y=s(87481),H=s(62177),$=s(90221),G=s(55594),W=s(91950);let X=e=>{if(!e)return"default";switch(e.toLowerCase()){case"urgent":case"high":return"destructive";case"medium":return"secondary";case"low":return"outline";default:return"default"}},Z=e=>{if(!e)return"default";switch(e.toLowerCase()){case"done":return"default";case"in progress":return"secondary";case"overdue":case"blocked":return"destructive";default:return"outline"}},K=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tasks",s="An unexpected error occurred while managing ".concat(t,".");if(e&&"object"==typeof e){let a=e.context||t;if(!0===e.isCircuitOpenError){let t=e.openUntil;if(t&&Date.now()<t){let e=Math.ceil((t-Date.now())/1e3),s=e>60?"".concat(Math.ceil(e/60)," minute(s)"):"".concat(e," second(s)");return"Too many recent connection issues with '".concat(a,"'. Access is temporarily paused. Please try again in about ").concat(s,".")}return"Access to '".concat(a,"' is temporarily paused due to repeated connection issues. Please try again in a few moments.")}if(!0===e.circuitJustOpened)return"Failed to connect to '".concat(a,"' after multiple attempts. To allow the service to recover, further attempts will be paused for a short period. Please try again in a few moments.");if("status"in e&&0===e.status?s="Failed to load ".concat(a,": Could not connect to the server. Please check your internet connection and try again."):e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?s=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?s=e.message:e.originalError&&"string"==typeof e.originalError.message?s=e.originalError.message:e.message&&"string"==typeof e.message&&(s=e.message),"status"in e&&0!==e.status){let t=e.status,r="items";a.includes("task")?r="tasks":a.includes("employee")&&(r="employees");let n=s.startsWith("An unexpected error occurred")||s.startsWith("PocketBase_ClientResponseError")||s===e.message;404===t&&n?s="The requested ".concat(r," could not be found (404)."):403===t&&n?s="You do not have permission to access or modify these ".concat(r," (403)."):n&&s.startsWith("PocketBase_ClientResponseError")?s="A server error occurred (".concat(t,") while managing ").concat(r,". If this persists, please contact support."):n&&(s="".concat(s," (Status: ").concat(t,")"))}}else"string"==typeof e&&(s=e);return s},U=G.Ik({title:G.Yj().min(1,{message:"Task Name is required."}),task_type:G.k5(W.ci,{errorMap:()=>({message:"Please select a valid task type."})}),instrument_subtype:G.Yj().optional(),description:G.Yj().optional(),status:G.Yj().min(1,"Status is required."),priority:G.Yj().min(1,"Priority is required."),startDate:G.p6().optional(),dueDate:G.p6().optional(),recurrence:G.Yj().optional(),assignedTo_text:G.Yj().optional(),dependencies:G.YO(G.Yj()).optional(),isMilestone:G.zM().optional(),steps:G.YO(G.Yj()).optional()}).superRefine((e,t)=>{"MDL"!==e.task_type||e.instrument_subtype||t.addIssue({code:G.eq.custom,message:"Instrument Subtype is required for MDL tasks.",path:["instrument_subtype"]}),"SOP"!==e.task_type||e.instrument_subtype||t.addIssue({code:G.eq.custom,message:"SOP Subtype is required for SOP tasks.",path:["instrument_subtype"]}),"VALIDATION_PROJECT"===e.task_type?e.isMilestone&&!e.startDate&&t.addIssue({code:G.eq.custom,message:"Milestone date (Start Date) is required for a Validation Project milestone.",path:["startDate"]}):(e.isMilestone&&t.addIssue({code:G.eq.custom,message:"Milestones are only applicable to 'VALIDATION_PROJECT' tasks.",path:["isMilestone"]}),e.dependencies&&e.dependencies.length>0&&t.addIssue({code:G.eq.custom,message:"Dependencies are only applicable to 'VALIDATION_PROJECT' tasks.",path:["dependencies"]}),e.steps&&e.steps.length>0&&t.addIssue({code:G.eq.custom,message:"Steps are only applicable to 'VALIDATION_PROJECT' tasks.",path:["steps"]}),e.recurrence&&W.y4.includes(e.recurrence)||t.addIssue({code:G.eq.custom,message:"Recurrence is required and must be a valid option for non-VALIDATION_PROJECT tasks.",path:["recurrence"]})),!e.isMilestone&&e.startDate&&e.dueDate&&e.startDate>e.dueDate&&t.addIssue({code:G.eq.custom,message:"Start date must be before or same as due date.",path:["startDate"]})});function Q(){let{pbClient:e,user:t}=(0,z.A)(),{toast:s}=(0,Y.dj)(),[c,o]=(0,r.useState)([]),[d,k]=(0,r.useState)(!0),[J,G]=(0,r.useState)(null),[Q,ee]=(0,r.useState)(null),[et,es]=(0,r.useState)([]),[ea,er]=(0,r.useState)(!0),[en,el]=(0,r.useState)(null),[ei,ec]=(0,r.useState)([]),[eo,ed]=(0,r.useState)(!0),[eu,ep]=(0,r.useState)(null),[eh,em]=(0,r.useState)(null),[ex,ey]=(0,r.useState)(!1),[ef,eg]=(0,r.useState)(!1),[ej,ev]=(0,r.useState)(!1),[eb,ek]=(0,r.useState)(null),[eN,eA]=(0,r.useState)(!1),[e_,eC]=(0,r.useState)(""),ew=(0,H.mN)({resolver:(0,$.u)(U),defaultValues:{title:"",task_type:W.ci.find(e=>"VALIDATION_PROJECT"!==e)||W.ci[0],instrument_subtype:void 0,dependencies:[],isMilestone:!1,recurrence:"None",steps:[]}}),eT=ew.watch("task_type"),eD=ew.watch("isMilestone");ew.watch("startDate");let eI=ew.watch("steps"),eO=ew.watch("startDate"),eV=ew.watch("dueDate");(0,r.useEffect)(()=>{let e=ew.watch((e,t)=>{let{name:s}=t;if("task_type"===s&&("MDL"!==e.task_type&&"SOP"!==e.task_type&&ew.setValue("instrument_subtype",void 0,{shouldValidate:!0}),"VALIDATION_PROJECT"!==e.task_type?(ew.setValue("isMilestone",!1,{shouldValidate:!0}),ew.setValue("dependencies",[],{shouldValidate:!0}),ew.setValue("steps",[],{shouldValidate:!0}),ew.getValues("recurrence")||ew.setValue("recurrence","None",{shouldValidate:!0})):ew.setValue("recurrence","None",{shouldValidate:!0})),("isMilestone"===s||"startDate"===s)&&"VALIDATION_PROJECT"===ew.getValues("task_type")&&ew.getValues("isMilestone")&&ew.getValues("startDate")){var a;let e=ew.getValues("startDate");ew.getValues("dueDate")&&(null==(a=ew.getValues("dueDate"))?void 0:a.getTime())===e.getTime()||ew.setValue("dueDate",e,{shouldValidate:!0})}});return()=>e.unsubscribe()},[ew]);let eE=(0,r.useCallback)(async(e,t)=>{if(!e)return void k(!1);k(!0),G(null),ee(null);try{let s=await (0,B.x1)(e,{signal:t,onRetry:(e,t,s)=>{let a=s&&0===s.status,r=s&&[502,503,504].includes(s.status);a||r?ee("Connection issues, retrying... Attempt ".concat(e," of ").concat(t)):ee("Attempting to recover... Attempt ".concat(e," of ").concat(t))},filter:'task_type != "VALIDATION_PROJECT"'});o(s),ee(null)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(ee(null),e)console.warn("Tasks fetch request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=K(a,"tasks");G(e),s({title:"Error Loading Tasks",description:e,variant:"destructive"}),console.warn("Tasks fetch (network error):",e,a)}else{let e=K(a,"tasks");G(e),s({title:"Error Loading Tasks",description:e,variant:"destructive"}),console.warn("Error fetching tasks (after retries):",e,a)}}finally{k(!1)}},[s]),eP=(0,r.useCallback)(async(e,t)=>{if(!e)return void er(!1);er(!0),el(null);try{let s=await (0,F.Oc)(e,{signal:t,onRetry:(e,t,s)=>{ee("Retrying employee data... Attempt ".concat(e," of ").concat(t))}});es(s)}catch(t){let e=(null==t?void 0:t.isAbort)===!0||"string"==typeof(null==t?void 0:t.message)&&t.message.toLowerCase().includes("autocancelled");if(e)console.warn("Fetch employees for task edit request was ".concat((null==t?void 0:t.isAbort)?"aborted":"autocancelled","."),t);else if((null==t?void 0:t.status)!==0||e){let e=K(t,"employees for task assignment");el(e),s({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees for task edit (after retries):",e,t)}else{let e=K(t,"employees for task assignment");el(e),s({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Fetch employees for task edit (network error):",e,t)}}finally{er(!1)}},[s]),eM=(0,r.useCallback)(async(e,t,a)=>{if(!e)return void ed(!1);ed(!0),ep(null),em(null);try{let s=await (0,B.x1)(e,{signal:a,onRetry:(e,t,s)=>{em("Retrying tasks for selection... Attempt ".concat(e," of ").concat(t))},filter:'task_type = "VALIDATION_PROJECT"'});ec(t?s.filter(e=>e.id!==t):s),em(null)}catch(a){em(null);let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Fetch tasks for edit dependency selection request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=K(a,"tasks for dependency selection (edit)");ep(e),s({title:"Error Loading Tasks for Dependencies",description:e,variant:"destructive"}),console.warn("Fetch tasks for edit dependency selection (network error):",e,a)}else{let e=K(a,"tasks for dependency selection (edit)");ep(e),s({title:"Error Loading Tasks for Dependencies",description:e,variant:"destructive"}),console.warn("Error fetching tasks for edit dependency selection (after retries):",e,a)}}finally{ed(!1)}},[s]);(0,r.useEffect)(()=>{let t=new AbortController;return e?(eE(e,t.signal),eP(e,t.signal)):(k(!0),er(!0)),()=>{t.abort()}},[e,eE,eP]),(0,r.useEffect)(()=>{if(ej&&eb&&e&&"VALIDATION_PROJECT"===eT){let t=new AbortController;return eM(e,eb.id,t.signal),()=>t.abort()}"VALIDATION_PROJECT"!==eT&&(ec([]),ed(!1))},[ej,eb,e,eM,eT]),(0,r.useEffect)(()=>{eb&&ew.reset({title:eb.title,task_type:eb.task_type,instrument_subtype:eb.instrument_subtype||void 0,description:eb.description||"",status:eb.status,priority:eb.priority,startDate:eb.startDate?new Date(eb.startDate):void 0,dueDate:eb.dueDate?new Date(eb.dueDate):void 0,recurrence:"VALIDATION_PROJECT"===eb.task_type?"None":eb.recurrence||"None",assignedTo_text:eb.assignedTo_text||"",dependencies:Array.isArray(eb.dependencies)?eb.dependencies:[],isMilestone:eb.isMilestone||!1,steps:Array.isArray(eb.steps)?eb.steps:[]})},[eb,ew]);let eR=async(t,a)=>{if(!e)return void s({title:"Error",description:"Client not available.",variant:"destructive"});let r="Done"===a?"To Do":"Done";o(c.map(e=>e.id===t?{...e,status:r}:e));try{let a=await (0,B.lC)(e,t,{status:r});o(e=>e.map(e=>e.id===t?a:e)),s({title:"Success",description:"Task marked as ".concat(r,".")})}catch(e){console.warn("Error updating task status:",e),o(c),s({title:"Error",description:"Failed to update task status: ".concat(K(e)),variant:"destructive"})}},eL=async t=>{if(!e)return void s({title:"Error",description:"Client not available.",variant:"destructive"});let a=[...c];o(e=>e.filter(e=>e.id!==t));try{await (0,B.vq)(e,t),s({title:"Success",description:"Task deleted successfully."})}catch(e){console.warn("Error deleting task:",e),o(a),s({title:"Error",description:K(e),variant:"destructive"})}},eS=e=>{ek(e),ev(!0)},eJ=()=>{ev(!1),ek(null),ew.reset(),ec([]),ey(!1),eg(!1),eC("")},eq=e=>{let t=ew.getValues("steps")||[];ew.setValue("steps",t.filter((t,s)=>s!==e),{shouldValidate:!0})},ez=async a=>{if(!eb||!e||!t)return void s({title:"Error",description:"Editing context, client or user not available.",variant:"destructive"});eA(!0);let r={title:a.title,task_type:a.task_type,instrument_subtype:"MDL"===a.task_type||"SOP"===a.task_type?a.instrument_subtype:void 0,description:a.description,status:a.status,priority:a.priority,startDate:a.startDate,dueDate:"VALIDATION_PROJECT"===a.task_type&&a.isMilestone&&a.startDate?a.startDate:a.dueDate,recurrence:"VALIDATION_PROJECT"===a.task_type?"None":a.recurrence,assignedTo_text:"__NONE__"!==a.assignedTo_text&&a.assignedTo_text?a.assignedTo_text:void 0,isMilestone:"VALIDATION_PROJECT"===a.task_type&&a.isMilestone,dependencies:"VALIDATION_PROJECT"===a.task_type&&a.dependencies||[],steps:"VALIDATION_PROJECT"===a.task_type&&a.steps||[],userId:t.id};try{let t=await (0,B.lC)(e,eb.id,r);o(e=>e.map(e=>e.id===eb.id?t:e)),s({title:"Success",description:"Task updated successfully."}),eJ()}catch(t){var n,l;console.warn("Failed to update task:",t);let e=K(t);t.data&&t.data.data&&(null==(n=t.data.data.instrument_subtype)?void 0:n.message)?e="Instrument Subtype: ".concat(t.data.data.instrument_subtype.message):t.data&&t.data.data&&(null==(l=t.data.data.title)?void 0:l.message)&&(e="Title: ".concat(t.data.data.title.message)),s({title:"Error Updating Task",description:e,variant:"destructive"})}finally{eA(!1)}},eB="Pick a date";eB="VALIDATION_PROJECT"===eT&&eD?eO?"Milestone: ".concat((0,S.GP)(eO,"PPP")):"Pick Milestone Date":eO&&eV?"".concat((0,S.GP)(eO,"PPP")," - ").concat((0,S.GP)(eV,"PPP")):eO?"".concat((0,S.GP)(eO,"PPP")," - Select End Date"):"Pick Date Range";let eF=d||ea;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Task Management"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(n.$,{variant:"outline",children:[(0,a.jsx)(N,{className:"mr-2 h-4 w-4"})," Filter"]}),(0,a.jsx)(q(),{href:"/tasks/new",passHref:!0,children:(0,a.jsxs)(n.$,{children:[(0,a.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Add Task"]})})]})]}),(0,a.jsxs)(l.Zp,{className:"shadow-md",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{className:"font-headline",children:"All Tasks"}),(0,a.jsx)(l.BT,{children:"View, manage, and track all laboratory tasks (excluding Validation Projects)."})]}),(0,a.jsxs)(l.Wu,{children:[eF&&(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(_.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:Q||"Loading tasks and employee data..."})]}),J&&!eF&&!Q&&(0,a.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,a.jsx)(C.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Tasks"}),(0,a.jsx)("p",{className:"text-sm",children:J}),(0,a.jsx)(n.$,{onClick:()=>{e&&eE(e,new AbortController().signal)},className:"mt-6",children:"Try Again"})]}),!eF&&!J&&0===c.length&&(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,a.jsx)("p",{children:"No tasks found. Get started by adding a new task!"})}),!eF&&!J&&c.length>0&&(0,a.jsxs)(i.XI,{children:[(0,a.jsx)(i.A0,{children:(0,a.jsxs)(i.Hj,{children:[(0,a.jsx)(i.nd,{children:"Task Name"}),(0,a.jsx)(i.nd,{children:"Type"}),(0,a.jsx)(i.nd,{children:"Status"}),(0,a.jsx)(i.nd,{children:"Priority"}),(0,a.jsx)(i.nd,{children:"Due Date"}),(0,a.jsx)(i.nd,{children:"Assigned To"}),(0,a.jsx)(i.nd,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(i.BF,{children:c.map(e=>(0,a.jsxs)(i.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,a.jsx)(i.nA,{className:"font-medium flex items-center",children:e.title}),(0,a.jsxs)(i.nA,{children:[e.task_type.replace(/_/g," "),("MDL"===e.task_type||"SOP"===e.task_type)&&e.instrument_subtype&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-1",children:["(",e.instrument_subtype,")"]})]}),(0,a.jsx)(i.nA,{children:(0,a.jsx)(u,{variant:Z(e.status),children:e.status})}),(0,a.jsx)(i.nA,{children:(0,a.jsx)(u,{variant:X(e.priority),children:e.priority})}),(0,a.jsx)(i.nA,{children:e.dueDate?(0,S.GP)(new Date(e.dueDate),"MMM dd, yyyy"):"-"}),(0,a.jsx)(i.nA,{children:e.assignedTo_text||"-"}),(0,a.jsx)(i.nA,{className:"text-right",children:(0,a.jsxs)(p.rI,{children:[(0,a.jsx)(p.ty,{asChild:!0,children:(0,a.jsx)(n.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(w.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(p.SQ,{align:"end",children:[(0,a.jsxs)(p._2,{onClick:()=>eR(e.id,e.status),className:"flex items-center w-full",children:["Done"===e.status?(0,a.jsx)(T.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(D.A,{className:"mr-2 h-4 w-4"}),"Done"===e.status?"Mark as To Do":"Mark as Done"]}),(0,a.jsxs)(p._2,{onClick:()=>eS(e),className:"flex items-center w-full",children:[(0,a.jsx)(I.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,a.jsxs)(p._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>eL(e.id),children:[(0,a.jsx)(O.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),eb&&(0,a.jsx)(h.lG,{open:ej,onOpenChange:e=>{e?ev(!0):eJ()},children:(0,a.jsxs)(h.Cf,{className:"sm:max-w-lg",children:[(0,a.jsxs)(h.c7,{children:[(0,a.jsxs)(h.L3,{className:"font-headline",children:["Edit Task: ",eb.title]}),(0,a.jsx)(h.rr,{children:"Make changes to the task details below."})]}),(0,a.jsx)(m.lV,{...ew,children:(0,a.jsxs)("form",{onSubmit:ew.handleSubmit(ez),className:"space-y-4 py-4 max-h-[70vh] overflow-y-auto pr-2",children:[(0,a.jsx)(m.zB,{control:ew.control,name:"task_type",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Task Type"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value,disabled:!0,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select task type"})})}),(0,a.jsx)(f.gC,{children:W.ci.map(e=>(0,a.jsx)(f.eb,{value:e,disabled:"VALIDATION_PROJECT"===e&&"VALIDATION_PROJECT"!==eb.task_type,children:e.replace(/_/g," ")},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:ew.control,name:"title",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"VALIDATION_PROJECT"===eT?"Validation Project Name":"Task Name"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(x.p,{...t,placeholder:"VALIDATION_PROJECT"===eT?"e.g., New HPLC Method Validation":"e.g., Daily Balances Check"})}),(0,a.jsx)(m.C5,{})]})}}),"MDL"===eT&&(0,a.jsx)(m.zB,{control:ew.control,name:"instrument_subtype",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Instrument Subtype"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select instrument for MDL"})})}),(0,a.jsx)(f.gC,{children:W.oe.map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),"SOP"===eT&&(0,a.jsx)(m.zB,{control:ew.control,name:"instrument_subtype",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"SOP Subtype"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select SOP subtype"})})}),(0,a.jsx)(f.gC,{children:W.tk.map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:ew.control,name:"description",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Description (Optional)"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(y.T,{...t,placeholder:"Add any relevant details..."})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsx)(m.zB,{control:ew.control,name:"status",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Status"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select status"})})}),(0,a.jsx)(f.gC,{children:W.Hi.map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:ew.control,name:"priority",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Priority"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select priority"})})}),(0,a.jsx)(f.gC,{children:W.PN.map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}})]}),"VALIDATION_PROJECT"===eT&&(0,a.jsx)(m.zB,{control:ew.control,name:"isMilestone",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{className:"flex flex-row items-center space-x-2 space-y-0 py-2",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(v.S,{checked:t.value,onCheckedChange:t.onChange})}),(0,a.jsxs)(m.lR,{className:"font-normal flex items-center cursor-pointer mb-0!",children:[(0,a.jsx)(V.A,{className:"mr-2 h-4 w-4 text-muted-foreground"})," Mark as Milestone"]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m.lR,{children:"VALIDATION_PROJECT"===eT&&eD?"Milestone Date":"Date Range (Start - Due)"}),(0,a.jsxs)(g.AM,{open:ef,onOpenChange:eg,children:[(0,a.jsx)(g.Wv,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"outline",className:"w-full justify-start text-left font-normal mt-2",children:[(0,a.jsx)(E.A,{className:"mr-2 h-4 w-4"}),eB]})}),(0,a.jsx)(g.hl,{className:"w-auto p-0",children:(0,a.jsx)(j.V,{mode:"VALIDATION_PROJECT"===eT&&eD?"single":"range",selected:"VALIDATION_PROJECT"===eT&&eD?eO:{from:eO,to:eV},onSelect:e=>{let t=ew.getValues("task_type"),s=ew.getValues("isMilestone");"VALIDATION_PROJECT"===t&&s?(ew.setValue("startDate",e,{shouldValidate:!0}),ew.setValue("dueDate",e,{shouldValidate:!0})):(ew.setValue("startDate",null==e?void 0:e.from,{shouldValidate:!0}),ew.setValue("dueDate",null==e?void 0:e.to,{shouldValidate:!0})),e&&("VALIDATION_PROJECT"===t&&s||null==e||!e.from||(null==e?void 0:e.to))&&eg(!1)},numberOfMonths:"VALIDATION_PROJECT"===eT&&eD?1:2,initialFocus:!0})})]}),(0,a.jsx)(m.zB,{control:ew.control,name:"startDate",render:()=>(0,a.jsx)(m.C5,{})}),(0,a.jsx)(m.zB,{control:ew.control,name:"dueDate",render:()=>(0,a.jsx)(m.C5,{})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["VALIDATION_PROJECT"!==eT&&(0,a.jsx)(m.zB,{control:ew.control,name:"recurrence",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Recurrence"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value||"None",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:"Select recurrence"})})}),(0,a.jsx)(f.gC,{children:W.y4.map(e=>(0,a.jsx)(f.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:ew.control,name:"assignedTo_text",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{className:"VALIDATION_PROJECT"===eT?"md:col-span-2":"",children:[(0,a.jsx)(m.lR,{children:"Assigned To (Optional)"}),(0,a.jsxs)(f.l6,{onValueChange:t.onChange,value:t.value||"__NONE__",disabled:ea||!!en,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(f.bq,{children:(0,a.jsx)(f.yv,{placeholder:ea?"Loading...":en?"Error":"Select employee"})})}),(0,a.jsxs)(f.gC,{children:[(0,a.jsx)(f.eb,{value:"__NONE__",children:"None"}),et.map(e=>(0,a.jsxs)(f.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),en&&!ea&&(0,a.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-1"})," ",en]}),(0,a.jsx)(m.C5,{})]})}})]}),"VALIDATION_PROJECT"===eT&&(0,a.jsx)(m.zB,{control:ew.control,name:"dependencies",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Dependencies (Optional)"}),(0,a.jsxs)(g.AM,{open:ex,onOpenChange:ey,children:[(0,a.jsx)(g.Wv,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:"outline",className:"w-full justify-start text-left font-normal",disabled:eo||!!eu,children:[(0,a.jsx)(P.A,{className:"mr-2 h-4 w-4"}),eo?"Loading tasks...":eu?"Error loading tasks":t.value&&t.value.length>0?"".concat(t.value.length," selected"):"Select dependent tasks"]})}),(0,a.jsxs)(g.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:[eh&&(0,a.jsx)("div",{className:"p-4 text-center text-sm text-orange-600",children:eh}),eo&&!eh?(0,a.jsx)("div",{className:"p-4 text-center text-sm",children:"Loading tasks..."}):eu&&!eh?(0,a.jsx)("div",{className:"p-4 text-center text-sm text-destructive",children:eu}):eo||eu||0!==ei.length||eh?!eh&&!eu&&(0,a.jsx)(b.F,{className:"h-48",children:(0,a.jsx)("div",{className:"p-4 space-y-2",children:ei.map(e=>{var s;return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(v.S,{id:"edit-dep-".concat(e.id),checked:null==(s=t.value)?void 0:s.includes(e.id),onCheckedChange:s=>{let a=t.value||[];return s?t.onChange([...a,e.id]):t.onChange(a.filter(t=>t!==e.id))}}),(0,a.jsx)("label",{htmlFor:"edit-dep-".concat(e.id),className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 truncate",title:e.title,children:e.title})]},e.id)})})}):(0,a.jsx)("div",{className:"p-4 text-center text-sm",children:"No other 'VALIDATION_PROJECT' tasks available to select."}),!eh&&!eo&&(0,a.jsx)("div",{className:"p-2 border-t",children:(0,a.jsx)(n.$,{type:"button",size:"sm",className:"w-full",onClick:()=>ey(!1),children:"Done"})})]})]}),(0,a.jsx)(m.C5,{})]})}}),"VALIDATION_PROJECT"===eT&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(Label,{children:"Steps"}),(0,a.jsx)("div",{className:"space-y-2",children:eI&&eI.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-md bg-muted/50",children:[(0,a.jsx)("span",{className:"flex-1 text-sm",children:e}),(0,a.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>eq(t),className:"h-6 w-6",children:(0,a.jsx)(M,{className:"h-4 w-4 text-destructive"})})]},t))}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)(x.p,{type:"text",placeholder:"New step description",value:e_,onChange:e=>eC(e.target.value),className:"flex-1 h-9"}),(0,a.jsxs)(n.$,{type:"button",onClick:()=>{if(""===e_.trim())return void s({title:"Cannot add empty step",variant:"destructive"});let e=ew.getValues("steps")||[];ew.setValue("steps",[...e,e_.trim()],{shouldValidate:!0}),eC("")},size:"sm",children:[(0,a.jsx)(R.A,{className:"mr-2 h-4 w-4"})," Add Step"]})]}),ew.formState.errors.steps&&(0,a.jsx)("p",{className:"text-sm text-destructive mt-1",children:ew.formState.errors.steps.message})]}),(0,a.jsxs)(h.Es,{children:[(0,a.jsx)(h.HM,{asChild:!0,children:(0,a.jsx)(n.$,{type:"button",variant:"outline",onClick:eJ,disabled:eN,children:"Cancel"})}),(0,a.jsxs)(n.$,{type:"submit",disabled:eN||ea||"VALIDATION_PROJECT"===eT&&eo,children:[eN?(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(L.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]})}},5349:(e,t,s)=>{"use strict";s.d(t,{S:()=>C});var a=s(95155),r=s(12115),n=s(6101),l=s(46081),i=s(85185),c=s(5845),o=s(45503),d=s(11275),u=s(28905),p=s(63655),h="Checkbox",[m,x]=(0,l.A)(h),[y,f]=m(h),g=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,name:l,checked:o,defaultChecked:d,required:u,disabled:h,value:m="on",onCheckedChange:x,form:f,...g}=e,[j,v]=r.useState(null),A=(0,n.s)(t,e=>v(e)),_=r.useRef(!1),C=!j||f||!!j.closest("form"),[w=!1,T]=(0,c.i)({prop:o,defaultProp:d,onChange:x}),D=r.useRef(w);return r.useEffect(()=>{let e=null==j?void 0:j.form;if(e){let t=()=>T(D.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[j,T]),(0,a.jsxs)(y,{scope:s,state:w,disabled:h,children:[(0,a.jsx)(p.sG.button,{type:"button",role:"checkbox","aria-checked":k(w)?"mixed":w,"aria-required":u,"data-state":N(w),"data-disabled":h?"":void 0,disabled:h,value:m,...g,ref:A,onKeyDown:(0,i.m)(e.onKeyDown,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,i.m)(e.onClick,e=>{T(e=>!!k(e)||!e),C&&(_.current=e.isPropagationStopped(),_.current||e.stopPropagation())})}),C&&(0,a.jsx)(b,{control:j,bubbles:!_.current,name:l,value:m,checked:w,required:u,disabled:h,form:f,style:{transform:"translateX(-100%)"},defaultChecked:!k(d)&&d})]})});g.displayName=h;var j="CheckboxIndicator",v=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,forceMount:r,...n}=e,l=f(j,s);return(0,a.jsx)(u.C,{present:r||k(l.state)||!0===l.state,children:(0,a.jsx)(p.sG.span,{"data-state":N(l.state),"data-disabled":l.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...e.style}})})});v.displayName=j;var b=e=>{let{control:t,checked:s,bubbles:n=!0,defaultChecked:l,...i}=e,c=r.useRef(null),u=(0,o.Z)(s),p=(0,d.X)(t);r.useEffect(()=>{let e=c.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==s&&t){let a=new Event("click",{bubbles:n});e.indeterminate=k(s),t.call(e,!k(s)&&s),e.dispatchEvent(a)}},[u,s,n]);let h=r.useRef(!k(s)&&s);return(0,a.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:null!=l?l:h.current,...i,tabIndex:-1,ref:c,style:{...e.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function k(e){return"indeterminate"===e}function N(e){return k(e)?"indeterminate":e?"checked":"unchecked"}var A=s(10518),_=s(59434);let C=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(g,{ref:t,className:(0,_.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(v,{className:(0,_.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(A.A,{className:"h-4 w-4"})})})});C.displayName=g.displayName},44972:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Milestone",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}],["path",{d:"M4 6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h13a2 2 0 0 0 1.152-.365l3.424-2.317a1 1 0 0 0 0-1.635l-3.424-2.318A2 2 0 0 0 17 6z",key:"1btarq"}]])},51920:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},58127:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]])},81737:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]])},82159:(e,t,s)=>{Promise.resolve().then(s.bind(s,3970))},85511:(e,t,s)=>{"use strict";s.d(t,{V:()=>o});var a=s(95155);s(12115);var r=s(965),n=s(73158),l=s(86374),i=s(59434),c=s(30285);function o(e){let{className:t,classNames:s,showOutsideDays:o=!0,...d}=e;return(0,a.jsx)(l.hv,{showOutsideDays:o,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,c.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,c.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:t,...s}=e;return(0,a.jsx)(r.A,{className:(0,i.cn)("h-4 w-4",t),...s})},IconRight:e=>{let{className:t,...s}=e;return(0,a.jsx)(n.A,{className:(0,i.cn)("h-4 w-4",t),...s})}},...d})}o.displayName="Calendar"},86318:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},88539:(e,t,s)=>{"use strict";s.d(t,{T:()=>l});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});l.displayName="Textarea"}},e=>{var t=t=>e(e.s=t);e.O(0,[383,897,125,977,192,874,342,889,374,812,666,575,710,441,303,358],()=>t(82159)),_N_E=e.O()}]);