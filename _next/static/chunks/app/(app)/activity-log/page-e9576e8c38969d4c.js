(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{10561:(e,t,s)=>{Promise.resolve().then(s.bind(s,89641))},50172:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},85127:(e,t,s)=>{"use strict";s.d(t,{A0:()=>n,BF:()=>o,Hj:()=>c,XI:()=>i,nA:()=>m,nd:()=>d});var a=s(95155),r=s(12115),l=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...r})})});i.displayName="Table";let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...r})});n.displayName="TableHeader";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...r})});o.displayName="TableBody",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});c.displayName="TableRow";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});d.displayName="TableHead";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});m.displayName="TableCell",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption"},89641:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var a=s(95155),r=s(12115),l=s(30285),i=s(66695),n=s(85127),o=s(50172),c=s(31949),d=s(73168),m=s(59576),u=s(30645);let h=e=>({...e,created:new Date(e.created),updated:new Date(e.updated)}),f=async(e,t)=>{try{return(await (0,u.b)(()=>e.collection("activity_log").getFullList({sort:"-created",...t}),{...t,context:"fetching activity log entries"})).map(h)}catch(e){throw e}};var x=s(87481),g=s(35695);let p=e=>{let t="An unexpected error occurred while fetching the activity log.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load activity log: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let s=e.status;404===s?t="The activity log collection was not found (404). Original: ".concat(t):403===s&&(t="You do not have permission to view the activity log (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function j(){let{user:e,pbClient:t}=(0,m.A)(),{toast:s}=(0,x.dj)(),u=(0,g.useRouter)(),[h,j]=(0,r.useState)([]),[y,v]=(0,r.useState)(!0),[N,b]=(0,r.useState)(null),w=(null==e?void 0:e.role)==="Supervisor"||(null==e?void 0:e.role)==="Team Lead",A=(0,r.useCallback)(async(e,t)=>{v(!0),b(null);try{let s=await f(e,{signal:t});j(s)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Activity log fetch request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=p(a);b(e),s({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Activity log fetch (network error):",e,a)}else{let e=p(a);b(e),s({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Error fetching activity log (after retries):",e,a)}}finally{v(!1)}},[s]);return((0,r.useEffect)(()=>{if(!t||!e)return void v(!0);if(!w){s({title:"Access Denied",description:"This page is for Supervisors and Team Leads only.",variant:"destructive"}),u.push("/dashboard");return}let a=new AbortController;return A(t,a.signal),()=>{a.abort()}},[e,t,u,s,A,w]),!e&&y)?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,a.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!e||w||y?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Activity Log"}),(0,a.jsxs)(i.Zp,{className:"shadow-md",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{className:"font-headline",children:"Log Entries"}),(0,a.jsx)(i.BT,{children:"Recent activities within the application."})]}),(0,a.jsxs)(i.Wu,{children:[y&&(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading activity log..."})]}),N&&!y&&(0,a.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,a.jsx)(c.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Activity Log"}),(0,a.jsx)("p",{className:"text-sm",children:N}),(0,a.jsx)(l.$,{onClick:()=>{t&&w&&A(t)},className:"mt-6",children:"Try Again"})]}),!y&&!N&&0===h.length&&(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,a.jsx)("p",{children:"No activity log entries found."})}),!y&&!N&&h.length>0&&(0,a.jsxs)(n.XI,{children:[(0,a.jsx)(n.A0,{children:(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nd,{children:"Timestamp"}),(0,a.jsx)(n.nd,{children:"User"}),(0,a.jsx)(n.nd,{children:"Action"}),(0,a.jsx)(n.nd,{children:"Details"})]})}),(0,a.jsx)(n.BF,{children:h.map(e=>(0,a.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,a.jsx)(n.nA,{children:(0,d.GP)(new Date(e.created),"MMM dd, yyyy, hh:mm:ss a")}),(0,a.jsx)(n.nA,{children:e.user_name}),(0,a.jsx)(n.nA,{children:e.action}),(0,a.jsx)(n.nA,{children:e.details||"-"})]},e.id))})]})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,a.jsxs)(i.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{className:"text-center",children:"Access Denied"})}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors and Team Leads only."}),(0,a.jsx)(l.$,{onClick:()=>u.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,977,918,441,303,358],()=>t(10561)),_N_E=e.O()}]);