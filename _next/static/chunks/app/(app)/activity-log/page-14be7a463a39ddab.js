(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[562],{10561:(e,t,a)=>{Promise.resolve().then(a.bind(a,89641))},30285:(e,t,a)=>{"use strict";a.d(t,{$:()=>c,r:()=>n});var s=a(95155),r=a(12115),o=a(99708),l=a(74466),i=a(59434);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:c=!1,...d}=e,u=c?o.DX:"button";return(0,s.jsx)(u,{className:(0,i.cn)(n({variant:r,size:l,className:a})),ref:t,...d})});c.displayName="Button"},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>r});let s={maxAttempts:3,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};async function r(e,t){let a,r={...s,...t};for(let t=1;t<=r.maxAttempts;t++)try{return await e()}catch(e){if(a=e,r.shouldRetry(e))r.onRetry&&r.onRetry(t,e),t<r.maxAttempts?(console.warn("Attempt ".concat(t," failed for ").concat(r.context,". Retrying in ").concat(r.delayMs*Math.pow(2,t-1),"ms... Error: ").concat(e.message||JSON.stringify(e))),await new Promise(e=>setTimeout(e,r.delayMs*Math.pow(2,t-1)))):console.warn("All ".concat(r.maxAttempts," attempts failed for ").concat(r.context,". Last error: ").concat(e.message||JSON.stringify(e)));else throw e}throw a}},50172:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},59434:(e,t,a)=>{"use strict";a.d(t,{cn:()=>o});var s=a(52596),r=a(39688);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.QP)((0,s.$)(t))}},59576:(e,t,a)=>{"use strict";a.d(t,{A:()=>m,AuthProvider:()=>u});var s=a(95155),r=a(35695),o=a(12115),l=a(7140),i=a(87481);let n=new l.Ay("https://swoodhu.pockethost.io/"),c=(0,o.createContext)(void 0),d=["Supervisor","Team Lead","Chem I","Chem II"],u=e=>{let{children:t}=e,[a,l]=(0,o.useState)(null),[u,m]=(0,o.useState)(!0),f=(0,r.useRouter)(),{toast:h}=(0,i.dj)();(0,o.useEffect)(()=>{m(!0),(async()=>{if(n.authStore.isValid&&n.authStore.model){var e;let t=n.authStore.model,a=t.role;if("Analyst"===a&&(a="Chem I"),!a||!d.includes(a)){let e=localStorage.getItem("labflowUserRole"),t="Chem I";e&&("Analyst"===e?t="Chem I":d.includes(e)&&(t=e)),a=t}l({id:t.id,email:t.email||"",name:t.name||(null==(e=t.email)?void 0:e.split("@")[0])||"User",role:a,avatarUrl:t.avatar?n.files.getUrl(t,t.avatar,{thumb:"100x100"}):"https://placehold.co/100x100.png?text=".concat((t.name||t.email||"U")[0].toUpperCase())}),localStorage.setItem("labflowUserRole",a)}})().finally(()=>m(!1))},[]);let p=async(e,t)=>{m(!0);try{if(await n.collection("users").authWithPassword(e,t),n.authStore.model){var a;let e=n.authStore.model,t=e.role;"Analyst"===t&&(t="Chem I"),t&&d.includes(t)||(console.warn("User ".concat(e.email," has an invalid or missing role ('").concat(e.role,"') in PocketBase. Defaulting to 'Chem I'.")),t="Chem I");let s={id:e.id,email:e.email||"",name:e.name||(null==(a=e.email)?void 0:a.split("@")[0])||"User",role:t,avatarUrl:e.avatar?n.files.getUrl(e,e.avatar,{thumb:"100x100"}):"https://placehold.co/100x100.png?text=".concat((e.name||e.email||"U")[0].toUpperCase())};l(s),localStorage.setItem("labflowUserRole",s.role),h({title:"Login Successful",description:"Welcome back, ".concat(s.name,"!")}),f.push("/dashboard")}else throw Error("Authentication successful but no user model found.")}catch(t){console.error("Login failed:",t);let e="Login failed. Please check your credentials.";if(t.data&&t.data.data){let a=Object.values(t.data.data).map(e=>e.message).join(", ");a&&(e=a)}else t.message&&(e=t.message);h({title:"Login Failed",description:e,variant:"destructive"}),l(null)}finally{m(!1)}};return(0,s.jsx)(c.Provider,{value:{user:a,login:p,logout:()=>{n.authStore.clear(),l(null),localStorage.removeItem("labflowUserRole"),f.push("/"),h({title:"Logged Out",description:"You have been successfully logged out."})},loading:u,pbClient:n},children:t})},m=()=>{let e=(0,o.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>n,Zp:()=>l,aR:()=>i});var s=a(95155),r=a(12115),o=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});n.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},85127:(e,t,a)=>{"use strict";a.d(t,{A0:()=>i,BF:()=>n,Hj:()=>c,XI:()=>l,nA:()=>u,nd:()=>d});var s=a(95155),r=a(12115),o=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,o.cn)("w-full caption-bottom text-sm",a),...r})})});l.displayName="Table";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("thead",{ref:t,className:(0,o.cn)("[&_tr]:border-b",a),...r})});i.displayName="TableHeader";let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,o.cn)("[&_tr:last-child]:border-0",a),...r})});n.displayName="TableBody",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,o.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...r})}).displayName="TableFooter";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("tr",{ref:t,className:(0,o.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...r})});c.displayName="TableRow";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("th",{ref:t,className:(0,o.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...r})});d.displayName="TableHead";let u=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("td",{ref:t,className:(0,o.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...r})});u.displayName="TableCell",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("caption",{ref:t,className:(0,o.cn)("mt-4 text-sm text-muted-foreground",a),...r})}).displayName="TableCaption"},87481:(e,t,a)=>{"use strict";a.d(t,{dj:()=>m});var s=a(12115);let r=0,o=new Map,l=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:a}=t;return a?l(a):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===a||void 0===a?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},n=[],c={toasts:[]};function d(e){c=i(c,e),n.forEach(e=>{e(c)})}function u(e){let{...t}=e,a=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:a});return d({type:"ADD_TOAST",toast:{...t,id:a,open:!0,onOpenChange:e=>{e||s()}}}),{id:a,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:a}})}}function m(){let[e,t]=s.useState(c);return s.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},89641:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var s=a(95155),r=a(12115),o=a(30285),l=a(66695),i=a(85127),n=a(50172),c=a(31949),d=a(73168),u=a(59576),m=a(30645);let f=e=>({...e,created:new Date(e.created),updated:new Date(e.updated)}),h=async(e,t)=>{try{return(await (0,m.b)(()=>e.collection("activity_log").getFullList({sort:"-created",...t}),{...t,context:"fetching activity log entries"})).map(f)}catch(e){throw e}};var p=a(87481),g=a(35695);let x=e=>{let t="An unexpected error occurred while fetching the activity log.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load activity log: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let a=e.status;404===a?t="The activity log collection was not found (404). Original: ".concat(t):403===a&&(t="You do not have permission to view the activity log (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function v(){let{user:e,pbClient:t}=(0,u.A)(),{toast:a}=(0,p.dj)(),m=(0,g.useRouter)(),[f,v]=(0,r.useState)([]),[y,b]=(0,r.useState)(!0),[w,j]=(0,r.useState)(null),N=(null==e?void 0:e.role)==="Supervisor"||(null==e?void 0:e.role)==="Team Lead",A=(0,r.useCallback)(async(e,t)=>{b(!0),j(null);try{let a=await h(e,{signal:t});v(a)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Activity log fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=x(s);j(e),a({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Activity log fetch (network error):",e,s)}else{let e=x(s);j(e),a({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Error fetching activity log (after retries):",e,s)}}finally{b(!1)}},[a]);return((0,r.useEffect)(()=>{if(!t||!e)return void b(!0);if(!N){a({title:"Access Denied",description:"This page is for Supervisors and Team Leads only.",variant:"destructive"}),m.push("/dashboard");return}let s=new AbortController;return A(t,s.signal),()=>{s.abort()}},[e,t,m,a,A,N]),!e&&y)?(0,s.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,s.jsx)(n.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!e||N||y?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Activity Log"}),(0,s.jsxs)(l.Zp,{className:"shadow-md",children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsx)(l.ZB,{className:"font-headline",children:"Log Entries"}),(0,s.jsx)(l.BT,{children:"Recent activities within the application."})]}),(0,s.jsxs)(l.Wu,{children:[y&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(n.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading activity log..."})]}),w&&!y&&(0,s.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,s.jsx)(c.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Activity Log"}),(0,s.jsx)("p",{className:"text-sm",children:w}),(0,s.jsx)(o.$,{onClick:()=>{t&&N&&A(t)},className:"mt-6",children:"Try Again"})]}),!y&&!w&&0===f.length&&(0,s.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,s.jsx)("p",{children:"No activity log entries found."})}),!y&&!w&&f.length>0&&(0,s.jsxs)(i.XI,{children:[(0,s.jsx)(i.A0,{children:(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nd,{children:"Timestamp"}),(0,s.jsx)(i.nd,{children:"User"}),(0,s.jsx)(i.nd,{children:"Action"}),(0,s.jsx)(i.nd,{children:"Details"})]})}),(0,s.jsx)(i.BF,{children:f.map(e=>(0,s.jsxs)(i.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,s.jsx)(i.nA,{children:(0,d.GP)(new Date(e.created),"MMM dd, yyyy, hh:mm:ss a")}),(0,s.jsx)(i.nA,{children:e.user_name}),(0,s.jsx)(i.nA,{children:e.action}),(0,s.jsx)(i.nA,{children:e.details||"-"})]},e.id))})]})]})]})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,s.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,s.jsx)(l.aR,{children:(0,s.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,s.jsxs)(l.Wu,{children:[(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors and Team Leads only."}),(0,s.jsx)(o.$,{onClick:()=>m.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,977,441,303,358],()=>t(10561)),_N_E=e.O()}]);