(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4562],{10561:(e,t,r)=>{Promise.resolve().then(r.bind(r,89641))},30285:(e,t,r)=>{"use strict";r.d(t,{$:()=>c,r:()=>l});var a=r(95155),s=r(12115),i=r(99708),n=r(74466),o=r(59434);let l=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:c=!1,...d}=e,u=c?i.DX:"button";return(0,a.jsx)(u,{className:(0,o.cn)(l({variant:s,size:n,className:r})),ref:t,...d})});c.displayName="Button"},30645:(e,t,r)=>{"use strict";r.d(t,{b:()=>n});let a={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var s=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(s||{});let i=new Map;async function n(e,t){let r,s={...a,...t},n=s.context,o=(e,t)=>{let r="[withRetry:".concat(n,"] ").concat(e,". Circuit: ").concat(l.state,".");console.warn(r);let a=Error(r);throw a.isAbort=!0,a.context=n,t&&(a.originalError=t),a};i.has(n)||i.set(n,{state:"CLOSED",failures:0});let l=i.get(n);if("OPEN"===l.state)if(Date.now()<(l.openUntil||0)){let e=Error("Circuit for '".concat(n,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=n,e.openUntil=l.openUntil,e}else l.state="HALF_OPEN",l.failures=0,l.openUntil=void 0,console.log("[withRetry:".concat(n,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===l.state?1:s.maxAttempts;for(let t=1;t<=c;t++){var d,u,f;(null==(d=s.signal)?void 0:d.aborted)&&o("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===l.state||l.failures>0||"OPEN"===l.state)&&(console.log("[withRetry:".concat(n,"] Circuit is now Closed due to successful attempt (was ").concat(l.state,").")),l.state="CLOSED",l.failures=0,l.openUntil=void 0),t}catch(e){if(r=e,(null==(u=s.signal)?void 0:u.aborted)&&o("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(n,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(l.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=n),e;if(s.shouldRetry(e))if(s.onRetry&&s.onRetry(t,c,e),t<c){let e="HALF_OPEN"===l.state?s.delayMs:s.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(f=s.signal)?void 0:f.aborted)&&o("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(n,"] All ").concat(c," attempts failed (Circuit: ").concat(l.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===l.state?(console.warn("[withRetry:".concat(n,"] Circuit failed in HalfOpen state. Re-opening.")),l.state="OPEN",l.openUntil=Date.now()+3e4,r.circuitJustOpened=!0,r.context=n):"CLOSED"===l.state&&(l.failures++,console.log("[withRetry:".concat(n,"] Circuit failure count: ").concat(l.failures," (max: ").concat(1,")")),l.failures>=1&&(console.warn("[withRetry:".concat(n,"] Circuit reached max failures. Opening circuit.")),l.state="OPEN",l.openUntil=Date.now()+3e4,r.circuitJustOpened=!0,r.context=n)),r;else throw e}}if(r)throw r;throw Error("[withRetry:".concat(n,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},50172:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(40157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},66695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>n,aR:()=>o,wL:()=>u});var a=r(95155),s=r(12115),i=r(59434);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...s})});n.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h3",{ref:t,className:(0,i.cn)("font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",r),...s})});d.displayName="CardContent";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",r),...s})});u.displayName="CardFooter"},85127:(e,t,r)=>{"use strict";r.d(t,{A0:()=>o,BF:()=>l,Hj:()=>c,XI:()=>n,nA:()=>u,nd:()=>d});var a=r(95155),s=r(12115),i=r(59434);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",r),...s})})});n.displayName="Table";let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("thead",{ref:t,className:(0,i.cn)("[&_tr]:border-b",r),...s})});o.displayName="TableHeader";let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",r),...s})});l.displayName="TableBody",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tfoot",{ref:t,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...s})}).displayName="TableFooter";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("tr",{ref:t,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...s})});c.displayName="TableRow";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("th",{ref:t,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...s})});d.displayName="TableHead";let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("td",{ref:t,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...s})});u.displayName="TableCell",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",r),...s})}).displayName="TableCaption"},89641:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var a=r(95155),s=r(12115),i=r(30285),n=r(66695),o=r(85127),l=r(50172),c=r(31949),d=r(73168),u=r(59576),f=r(30645);let m=e=>({...e,created:new Date(e.created),updated:new Date(e.updated)}),h=async(e,t)=>{try{let{signal:r,...a}=t||{},s={sort:"-created",fields:"id,created,user_name,action,details",...a};return(await (0,f.b)(()=>e.collection("activity_log").getFullList(s,{signal:r}),{...t,context:"fetching activity log entries"})).map(m)}catch(e){if((null==e?void 0:e.isAbort)===!0||(null==e?void 0:e.message)&&(e.message.toLowerCase().includes("aborted")||e.message.toLowerCase().includes("autocancelled")))throw e;throw console.error("Failed to fetch activity log entries:",e),e}};var p=r(87481),g=r(35695);let x=e=>{let t="An unexpected error occurred while fetching the activity log.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load activity log: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let r=e.status;404===r?t="The activity log collection was not found (404). Original: ".concat(t):403===r&&(t="You do not have permission to view the activity log (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function y(){let{user:e,pbClient:t}=(0,u.A)(),{toast:r}=(0,p.dj)(),f=(0,g.useRouter)(),[m,y]=(0,s.useState)([]),[v,w]=(0,s.useState)(!0),[b,N]=(0,s.useState)(null),j=(null==e?void 0:e.role)==="Supervisor",A=(0,s.useCallback)(async(e,t)=>{w(!0),N(null);try{let r=await h(e,{signal:t});y(r)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Activity log fetch request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=x(a);N(e),r({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Activity log fetch (network error):",e,a)}else{let e=x(a);N(e),r({title:"Error Loading Activity Log",description:e,variant:"destructive"}),console.warn("Error fetching activity log (after retries):",e,a)}}finally{w(!1)}},[r]);return((0,s.useEffect)(()=>{if(!t||!e)return void w(!0);if(!j){r({title:"Access Denied",description:"This page is for Supervisors only.",variant:"destructive"}),f.push("/dashboard");return}let a=new AbortController;return A(t,a.signal),()=>{a.abort()}},[e,t,f,r,A,j]),!e&&v)?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!e||j||v?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Activity Log"}),(0,a.jsxs)(n.Zp,{className:"shadow-md",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"font-headline",children:"Log Entries"}),(0,a.jsx)(n.BT,{children:"Recent activities within the application."})]}),(0,a.jsxs)(n.Wu,{children:[v&&(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading activity log..."})]}),b&&!v&&(0,a.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,a.jsx)(c.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Activity Log"}),(0,a.jsx)("p",{className:"text-sm",children:b}),(0,a.jsx)(i.$,{onClick:()=>{t&&j&&A(t)},className:"mt-6",children:"Try Again"})]}),!v&&!b&&0===m.length&&(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,a.jsx)("p",{children:"No activity log entries found."})}),!v&&!b&&m.length>0&&(0,a.jsxs)(o.XI,{children:[(0,a.jsx)(o.A0,{children:(0,a.jsxs)(o.Hj,{children:[(0,a.jsx)(o.nd,{children:"Timestamp"}),(0,a.jsx)(o.nd,{children:"User"}),(0,a.jsx)(o.nd,{children:"Action"}),(0,a.jsx)(o.nd,{children:"Details"})]})}),(0,a.jsx)(o.BF,{children:m.map(e=>(0,a.jsxs)(o.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,a.jsx)(o.nA,{children:(0,d.GP)(new Date(e.created),"MMM dd, yyyy, hh:mm:ss a")}),(0,a.jsx)(o.nA,{children:e.user_name}),(0,a.jsx)(o.nA,{children:e.action}),(0,a.jsx)(o.nA,{children:e.details||"-"})]},e.id))})]})]})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,a.jsxs)(n.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,a.jsx)(n.aR,{children:(0,a.jsx)(n.ZB,{className:"text-center",children:"Access Denied"})}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors only."}),(0,a.jsx)(i.$,{onClick:()=>f.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[2383,7164,3168,9467,8441,1684,7358],()=>t(10561)),_N_E=e.O()}]);