(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7454:(e,t,s)=>{Promise.resolve().then(s.bind(s,30379))},30379:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var a=s(95155),r=s(30285),l=s(66695),n=s(85127),i=s(44838),o=s(54165),c=s(62523),d=s(59409),m=s(17759),u=s(50172),p=s(34301),x=s(31949),h=s(3561),f=s(18763),j=s(77223),g=s(59119),y=s(6874),w=s.n(y),v=s(59576),b=s(12115),N=s(35695),C=s(97841),A=s(87481),E=s(62177),R=s(90221),_=s(55594);let O=_.Ik({name:_.Yj().min(2,{message:"Name must be at least 2 characters."}),email:_.Yj().email({message:"Please enter a valid email address."}),role:_.Yj().min(1,{message:"Role is required."}),department_text:_.Yj().optional(),reportsTo_text:_.Yj().optional()}),S="__NONE__",L=["Supervisor","Team Lead","Chem I","Chem II"],T=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],k=e=>{let t="An unexpected error occurred while managing employees.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load employees: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let s=e.status;404===s?t="The employees collection was not found (404). Original: ".concat(t):403===s&&(t="You do not have permission to manage employees (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function M(){let{pbClient:e,user:t}=(0,v.A)(),s=(0,N.useRouter)(),{toast:y}=(0,A.dj)(),[_,M]=(0,b.useState)([]),[P,F]=(0,b.useState)(!0),[J,D]=(0,b.useState)(null),[H,I]=(0,b.useState)(!1),[U,B]=(0,b.useState)(null),[q,z]=(0,b.useState)(!1),Y=(null==t?void 0:t.role)==="Supervisor",$=(0,E.mN)({resolver:(0,R.u)(O),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}}),V=(0,b.useCallback)(async(e,t)=>{F(!0),D(null);try{let s=await (0,C.Oc)(e,{signal:t});M(s)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Employees fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=k(s);D(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Employees fetch (network error):",e,s)}else{let e=k(s);D(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees (after retries):",e,s)}}finally{F(!1)}},[y]);(0,b.useEffect)(()=>{if(!e||!t)return void F(!0);if(!Y){y({title:"Access Denied",description:"This page is for Supervisors only.",variant:"destructive"}),s.push("/dashboard");return}let a=new AbortController;return V(e,a.signal),()=>{a.abort()}},[t,e,s,y,V,Y]);let Z=(0,b.useMemo)(()=>U?_.filter(e=>("Supervisor"===e.role||"Team Lead"===e.role)&&e.id!==U.id):[],[_,U]);(0,b.useEffect)(()=>{U&&$.reset({name:U.name,email:U.email,role:U.role,department_text:U.department_text||"",reportsTo_text:U.reportsTo_text||""})},[U,$]);let G=async t=>{if(!e)return void y({title:"Error",description:"Client not available.",variant:"destructive"});let s=[..._];M(e=>e.filter(e=>e.id!==t));try{await (0,C.Qu)(e,t),y({title:"Success",description:"Employee removed successfully."})}catch(e){console.error("Failed to delete employee:",e),M(s),y({title:"Error",description:k(e),variant:"destructive"})}},W=e=>{B(e),I(!0)},Q=()=>{I(!1),B(null),$.reset()},X=async t=>{if(!U||!e)return void y({title:"Error",description:"Editing context or client not available.",variant:"destructive"});z(!0);let s=t.reportsTo_text!==S&&t.reportsTo_text?t.reportsTo_text:void 0,a=t.department_text!==S&&t.department_text?t.department_text:void 0,r={name:t.name,email:t.email,role:t.role,department_text:a,reportsTo_text:s};try{let t=await (0,C.Y$)(e,U.id,r);M(e=>e.map(e=>e.id===U.id?t:e)),y({title:"Success",description:"Employee details updated successfully."}),Q()}catch(e){console.error("Failed to update employee:",e),y({title:"Error",description:k(e),variant:"destructive"})}finally{z(!1)}};return!t&&P?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!t||Y||P?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Employee Management"}),Y&&(0,a.jsx)(w(),{href:"/employees/new",passHref:!0,children:(0,a.jsxs)(r.$,{children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Add Employee"]})})]}),(0,a.jsxs)(l.Zp,{className:"shadow-md",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{className:"font-headline",children:"All Employees"}),(0,a.jsx)(l.BT,{children:"Manage employee information and access."})]}),(0,a.jsxs)(l.Wu,{children:[P&&(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading employees..."})]}),J&&!P&&(0,a.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,a.jsx)(x.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Employees"}),(0,a.jsx)("p",{className:"text-sm",children:J}),(0,a.jsx)(r.$,{onClick:()=>{e&&Y&&V(e)},className:"mt-6",children:"Try Again"})]}),!P&&!J&&0===_.length&&(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,a.jsx)("p",{children:"No employees found. Get started by adding a new employee."})}),!P&&!J&&_.length>0&&(0,a.jsxs)(n.XI,{children:[(0,a.jsx)(n.A0,{children:(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nd,{children:"Name"}),(0,a.jsx)(n.nd,{children:"Email"}),(0,a.jsx)(n.nd,{children:"Role"}),(0,a.jsx)(n.nd,{children:"Department"}),(0,a.jsx)(n.nd,{children:"Reports To"}),Y&&(0,a.jsx)(n.nd,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(n.BF,{children:_.map(e=>(0,a.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,a.jsx)(n.nA,{children:(0,a.jsx)("span",{className:"font-medium",children:e.name})}),(0,a.jsx)(n.nA,{children:e.email}),(0,a.jsx)(n.nA,{children:e.role}),(0,a.jsx)(n.nA,{children:e.department_text||"-"}),(0,a.jsx)(n.nA,{children:e.reportsTo_text||"-"}),Y&&(0,a.jsx)(n.nA,{className:"text-right",children:(0,a.jsxs)(i.rI,{children:[(0,a.jsx)(i.ty,{asChild:!0,children:(0,a.jsx)(r.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(h.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(i.SQ,{align:"end",children:[(0,a.jsxs)(i._2,{onClick:()=>W(e),className:"flex items-center w-full",children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,a.jsxs)(i._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>G(e.id),children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),U&&Y&&(0,a.jsx)(o.lG,{open:H,onOpenChange:e=>{e?I(!0):Q()},children:(0,a.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(o.c7,{children:[(0,a.jsxs)(o.L3,{className:"font-headline",children:["Edit Employee: ",U.name]}),(0,a.jsx)(o.rr,{children:"Make changes to the employee's details below."})]}),(0,a.jsx)(m.lV,{...$,children:(0,a.jsxs)("form",{onSubmit:$.handleSubmit(X),className:"space-y-4 py-4",children:[(0,a.jsx)(m.zB,{control:$.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Full Name"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(c.p,{...t})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Email Address"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(c.p,{type:"email",...t})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"role",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Role / Job Title"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a role"})})}),(0,a.jsx)(d.gC,{children:L.map(e=>(0,a.jsx)(d.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"department_text",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Department (Optional)"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a department (Optional)"})})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:S,children:"None"}),T.map(e=>(0,a.jsx)(d.eb,{value:e,children:e},e))]})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"reportsTo_text",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a manager"})})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:S,children:"None"}),Z.map(e=>(0,a.jsxs)(d.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsxs)(o.Es,{children:[(0,a.jsx)(o.HM,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"outline",onClick:Q,disabled:q,children:"Cancel"})}),(0,a.jsxs)(r.$,{type:"submit",disabled:q,children:[q?(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors only."}),(0,a.jsx)(r.$,{onClick:()=>s.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}},30645:(e,t,s)=>{"use strict";s.d(t,{b:()=>n});let a={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var r=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(r||{});let l=new Map;async function n(e,t){let s,r={...a,...t},n=r.context,i=(e,t)=>{let s="[withRetry:".concat(n,"] ").concat(e,". Circuit: ").concat(o.state,".");console.warn(s);let a=Error(s);throw a.isAbort=!0,a.context=n,t&&(a.originalError=t),a};l.has(n)||l.set(n,{state:"CLOSED",failures:0});let o=l.get(n);if("OPEN"===o.state)if(Date.now()<(o.openUntil||0)){let e=Error("Circuit for '".concat(n,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=n,e.openUntil=o.openUntil,e}else o.state="HALF_OPEN",o.failures=0,o.openUntil=void 0,console.log("[withRetry:".concat(n,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===o.state?1:r.maxAttempts;for(let t=1;t<=c;t++){var d,m,u;(null==(d=r.signal)?void 0:d.aborted)&&i("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===o.state||o.failures>0||"OPEN"===o.state)&&(console.log("[withRetry:".concat(n,"] Circuit is now Closed due to successful attempt (was ").concat(o.state,").")),o.state="CLOSED",o.failures=0,o.openUntil=void 0),t}catch(e){if(s=e,(null==(m=r.signal)?void 0:m.aborted)&&i("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(n,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(o.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=n),e;if(r.shouldRetry(e))if(r.onRetry&&r.onRetry(t,c,e),t<c){let e="HALF_OPEN"===o.state?r.delayMs:r.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(u=r.signal)?void 0:u.aborted)&&i("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(n,"] All ").concat(c," attempts failed (Circuit: ").concat(o.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===o.state?(console.warn("[withRetry:".concat(n,"] Circuit failed in HalfOpen state. Re-opening.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n):"CLOSED"===o.state&&(o.failures++,console.log("[withRetry:".concat(n,"] Circuit failure count: ").concat(o.failures," (max: ").concat(1,")")),o.failures>=1&&(console.warn("[withRetry:".concat(n,"] Circuit reached max failures. Opening circuit.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n)),s;else throw e}}if(s)throw s;throw Error("[withRetry:".concat(n,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},31949:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},59409:(e,t,s)=>{"use strict";s.d(t,{bq:()=>u,eb:()=>f,gC:()=>h,l6:()=>d,yv:()=>m});var a=s(95155),r=s(12115),l=s(31992),n=s(79556),i=s(77381),o=s(10518),c=s(59434);let d=l.bL;l.YJ;let m=l.WT,u=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(l.l9,{ref:t,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...i,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.PP,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=l.PP.displayName;let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.wn,{ref:t,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});x.displayName=l.wn.displayName;let h=r.forwardRef((e,t)=>{let{className:s,children:r,position:n="popper",...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:t,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...i,children:[(0,a.jsx)(p,{}),(0,a.jsx)(l.LM,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(x,{})]})})});h.displayName=l.UC.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.JU,{ref:t,className:(0,c.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=l.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(l.q7,{ref:t,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:r})]})});f.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=l.wv.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var a=s(95155),r=s(12115),l=s(59434);let n=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},73158:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var a=s(95155),r=s(12115),l=s(40968),n=s(74466),i=s(59434);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),s),...r})});c.displayName=l.b.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[383,897,125,192,342,874,443,890,666,710,441,303,358],()=>t(7454)),_N_E=e.O()}]);