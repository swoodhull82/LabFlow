(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7454:(e,t,s)=>{Promise.resolve().then(s.bind(s,30379))},30379:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var r=s(95155),a=s(30285),l=s(66695),n=s(85127),i=s(44838),o=s(54165),c=s(62523),d=s(59409),m=s(17759),u=s(50172),p=s(34301),x=s(31949),h=s(3561),f=s(18763),j=s(77223),g=s(59119),y=s(6874),v=s.n(y),w=s(59576),b=s(12115),N=s(35695),C=s(97841),A=s(87481),E=s(62177),R=s(90221),_=s(55594);let O=_.Ik({name:_.Yj().min(2,{message:"Name must be at least 2 characters."}),email:_.Yj().email({message:"Please enter a valid email address."}),role:_.Yj().min(1,{message:"Role is required."}),department_text:_.Yj().optional(),reportsTo_text:_.Yj().optional()}),k="__NONE__",S=["Supervisor","Team Lead","Chem I","Chem II"],T=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],L=e=>{let t="An unexpected error occurred while managing employees.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load employees: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let s=e.status;404===s?t="The employees collection was not found (404). Original: ".concat(t):403===s&&(t="You do not have permission to manage employees (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function M(){let{pbClient:e,user:t}=(0,w.A)(),s=(0,N.useRouter)(),{toast:y}=(0,A.dj)(),[_,M]=(0,b.useState)([]),[P,H]=(0,b.useState)(!0),[D,F]=(0,b.useState)(null),[B,I]=(0,b.useState)(!1),[J,U]=(0,b.useState)(null),[z,q]=(0,b.useState)(!1),V=(null==t?void 0:t.role)==="Supervisor",Y=(0,E.mN)({resolver:(0,R.u)(O),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}}),$=(0,b.useCallback)(async(e,t)=>{H(!0),F(null);try{let s=await (0,C.Oc)(e,{signal:t});M(s)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Employees fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=L(s);F(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Employees fetch (network error):",e,s)}else{let e=L(s);F(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees (after retries):",e,s)}}finally{H(!1)}},[y]);(0,b.useEffect)(()=>{if(!e||!t)return void H(!0);if(!V){y({title:"Access Denied",description:"This page is for Supervisors only.",variant:"destructive"}),s.push("/dashboard");return}let r=new AbortController;return $(e,r.signal),()=>{r.abort()}},[t,e,s,y,$,V]);let Z=(0,b.useMemo)(()=>J?_.filter(e=>("Supervisor"===e.role||"Team Lead"===e.role)&&e.id!==J.id):[],[_,J]);(0,b.useEffect)(()=>{J&&Y.reset({name:J.name,email:J.email,role:J.role,department_text:J.department_text||"",reportsTo_text:J.reportsTo_text||""})},[J,Y]);let G=(0,b.useCallback)(async t=>{if(!e)return void y({title:"Error",description:"Client not available.",variant:"destructive"});let s=[..._];M(e=>e.filter(e=>e.id!==t));try{await (0,C.Qu)(e,t),y({title:"Success",description:"Employee removed successfully."})}catch(e){console.error("Failed to delete employee:",e),M(s),y({title:"Error",description:L(e),variant:"destructive"})}},[e,y,_]),W=(0,b.useCallback)(e=>{U(e),I(!0)},[]),Q=()=>{I(!1),U(null),Y.reset()},X=async t=>{if(!J||!e)return void y({title:"Error",description:"Editing context or client not available.",variant:"destructive"});q(!0);let s=t.reportsTo_text!==k&&t.reportsTo_text?t.reportsTo_text:void 0,r=t.department_text!==k&&t.department_text?t.department_text:void 0,a={name:t.name,email:t.email,role:t.role,department_text:r,reportsTo_text:s};try{let t=await (0,C.Y$)(e,J.id,a);M(e=>e.map(e=>e.id===J.id?t:e)),y({title:"Success",description:"Employee details updated successfully."}),Q()}catch(e){console.error("Failed to update employee:",e),y({title:"Error",description:L(e),variant:"destructive"})}finally{q(!1)}};return!t&&P?(0,r.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!t||V||P?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Employee Management"}),V&&(0,r.jsx)(v(),{href:"/employees/new",passHref:!0,children:(0,r.jsxs)(a.$,{children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Add Employee"]})})]}),(0,r.jsxs)(l.Zp,{className:"shadow-md",children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{className:"font-headline",children:"All Employees"}),(0,r.jsx)(l.BT,{children:"Manage employee information and access."})]}),(0,r.jsxs)(l.Wu,{children:[P&&(0,r.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading employees..."})]}),D&&!P&&(0,r.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,r.jsx)(x.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Employees"}),(0,r.jsx)("p",{className:"text-sm",children:D}),(0,r.jsx)(a.$,{onClick:()=>{e&&V&&$(e)},className:"mt-6",children:"Try Again"})]}),!P&&!D&&0===_.length&&(0,r.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,r.jsx)("p",{children:"No employees found. Get started by adding a new employee."})}),!P&&!D&&_.length>0&&(0,r.jsxs)(n.XI,{children:[(0,r.jsx)(n.A0,{children:(0,r.jsxs)(n.Hj,{children:[(0,r.jsx)(n.nd,{children:"Name"}),(0,r.jsx)(n.nd,{children:"Email"}),(0,r.jsx)(n.nd,{children:"Role"}),(0,r.jsx)(n.nd,{children:"Department"}),(0,r.jsx)(n.nd,{children:"Reports To"}),V&&(0,r.jsx)(n.nd,{className:"text-right",children:"Actions"})]})}),(0,r.jsx)(n.BF,{children:_.map(e=>(0,r.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,r.jsx)(n.nA,{children:(0,r.jsx)("span",{className:"font-medium",children:e.name})}),(0,r.jsx)(n.nA,{children:e.email}),(0,r.jsx)(n.nA,{children:e.role}),(0,r.jsx)(n.nA,{children:e.department_text||"-"}),(0,r.jsx)(n.nA,{children:e.reportsTo_text||"-"}),V&&(0,r.jsx)(n.nA,{className:"text-right",children:(0,r.jsxs)(i.rI,{children:[(0,r.jsx)(i.ty,{asChild:!0,children:(0,r.jsx)(a.$,{variant:"ghost",size:"icon",children:(0,r.jsx)(h.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(i.SQ,{align:"end",children:[(0,r.jsxs)(i._2,{onClick:()=>W(e),className:"flex items-center w-full",children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,r.jsxs)(i._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>G(e.id),children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),J&&V&&(0,r.jsx)(o.lG,{open:B,onOpenChange:e=>{e?I(!0):Q()},children:(0,r.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(o.c7,{children:[(0,r.jsxs)(o.L3,{className:"font-headline",children:["Edit Employee: ",J.name]}),(0,r.jsx)(o.rr,{children:"Make changes to the employee's details below."})]}),(0,r.jsx)(m.lV,{...Y,children:(0,r.jsxs)("form",{onSubmit:Y.handleSubmit(X),className:"space-y-4 py-4",children:[(0,r.jsx)(m.zB,{control:Y.control,name:"name",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{children:[(0,r.jsx)(m.lR,{children:"Full Name"}),(0,r.jsx)(m.MJ,{children:(0,r.jsx)(c.p,{...t})}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(m.zB,{control:Y.control,name:"email",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{children:[(0,r.jsx)(m.lR,{children:"Email Address"}),(0,r.jsx)(m.MJ,{children:(0,r.jsx)(c.p,{type:"email",...t})}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(m.zB,{control:Y.control,name:"role",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{children:[(0,r.jsx)(m.lR,{children:"Role / Job Title"}),(0,r.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(m.MJ,{children:(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"Select a role"})})}),(0,r.jsx)(d.gC,{children:S.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))})]}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(m.zB,{control:Y.control,name:"department_text",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{children:[(0,r.jsx)(m.lR,{children:"Department (Optional)"}),(0,r.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(m.MJ,{children:(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"Select a department (Optional)"})})}),(0,r.jsxs)(d.gC,{children:[(0,r.jsx)(d.eb,{value:k,children:"None"}),T.map(e=>(0,r.jsx)(d.eb,{value:e,children:e},e))]})]}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsx)(m.zB,{control:Y.control,name:"reportsTo_text",render:e=>{let{field:t}=e;return(0,r.jsxs)(m.eI,{children:[(0,r.jsx)(m.lR,{children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,r.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(m.MJ,{children:(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"Select a manager"})})}),(0,r.jsxs)(d.gC,{children:[(0,r.jsx)(d.eb,{value:k,children:"None"}),Z.map(e=>(0,r.jsxs)(d.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),(0,r.jsx)(m.C5,{})]})}}),(0,r.jsxs)(o.Es,{children:[(0,r.jsx)(o.HM,{asChild:!0,children:(0,r.jsx)(a.$,{type:"button",variant:"outline",onClick:Q,disabled:z,children:"Cancel"})}),(0,r.jsxs)(a.$,{type:"submit",disabled:z,children:[z?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]}):(0,r.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,r.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors only."}),(0,r.jsx)(a.$,{onClick:()=>s.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}},30645:(e,t,s)=>{"use strict";s.d(t,{b:()=>n});let r={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var a=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(a||{});let l=new Map;async function n(e,t){let s,a={...r,...t},n=a.context,i=(e,t)=>{let s="[withRetry:".concat(n,"] ").concat(e,". Circuit: ").concat(o.state,".");console.warn(s);let r=Error(s);throw r.isAbort=!0,r.context=n,t&&(r.originalError=t),r};l.has(n)||l.set(n,{state:"CLOSED",failures:0});let o=l.get(n);if("OPEN"===o.state)if(Date.now()<(o.openUntil||0)){let e=Error("Circuit for '".concat(n,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=n,e.openUntil=o.openUntil,e}else o.state="HALF_OPEN",o.failures=0,o.openUntil=void 0,console.log("[withRetry:".concat(n,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===o.state?1:a.maxAttempts;for(let t=1;t<=c;t++){var d,m,u;(null==(d=a.signal)?void 0:d.aborted)&&i("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===o.state||o.failures>0||"OPEN"===o.state)&&(console.log("[withRetry:".concat(n,"] Circuit is now Closed due to successful attempt (was ").concat(o.state,").")),o.state="CLOSED",o.failures=0,o.openUntil=void 0),t}catch(e){if(s=e,(null==(m=a.signal)?void 0:m.aborted)&&i("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(n,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(o.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=n),e;if(a.shouldRetry(e))if(a.onRetry&&a.onRetry(t,c,e),t<c){let e="HALF_OPEN"===o.state?a.delayMs:a.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(u=a.signal)?void 0:u.aborted)&&i("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(n,"] All ").concat(c," attempts failed (Circuit: ").concat(o.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===o.state?(console.warn("[withRetry:".concat(n,"] Circuit failed in HalfOpen state. Re-opening.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n):"CLOSED"===o.state&&(o.failures++,console.log("[withRetry:".concat(n,"] Circuit failure count: ").concat(o.failures," (max: ").concat(1,")")),o.failures>=1&&(console.warn("[withRetry:".concat(n,"] Circuit reached max failures. Opening circuit.")),o.state="OPEN",o.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n)),s;else throw e}}if(s)throw s;throw Error("[withRetry:".concat(n,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},31949:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},59119:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>n});var r=s(95155),a=s(12115),l=s(59434);let n=a.forwardRef((e,t)=>{let{className:s,type:a,...n}=e;return(0,r.jsx)("input",{type:a,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});n.displayName="Input"},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>i});var r=s(95155),a=s(12115),l=s(59434);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});i.displayName="CardHeader";let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-xl md:text-2xl font-semibold leading-none tracking-tight",s),...a})});o.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},73158:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>c});var r=s(95155),a=s(12115),l=s(40968),n=s(74466),i=s(59434);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,i.cn)(o(),s),...a})});c.displayName=l.b.displayName}},e=>{var t=t=>e(e.s=t);e.O(0,[383,90,386,198,874,859,452,945,876,642,441,303,358],()=>t(7454)),_N_E=e.O()}]);