(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{29422:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var r=a(95155),s=a(30285),l=a(66695),o=a(62523),n=a(85057),i=a(59409),c=a(62177),d=a(90221),m=a(55594),u=a(35695),p=a(6874),h=a.n(p),x=a(59576),j=a(97841),v=a(87481),y=a(50172),f=a(31949),g=a(59119),w=a(12115);let b=m.Ik({name:m.Yj().min(2,{message:"Name must be at least 2 characters."}),email:m.Yj().email({message:"Please enter a valid email address."}),role:m.Yj().min(1,{message:"Role is required."}),department_text:m.Yj().optional(),reportsTo_text:m.Yj().optional()}),N="__NONE__",_=["Supervisor","Team Lead","Chem I","Chem II"],A=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],S=e=>{let t="Could not load list of potential managers.";if(e&&"object"==typeof e)if("status"in e&&0===e.status)return"Failed to load potential managers: Could not connect to the server. Please check your internet connection and try again.";else e.message&&(t=e.message);return t};function C(){let{pbClient:e,user:t}=(0,x.A)(),a=(0,u.useRouter)(),{toast:m}=(0,v.dj)(),[p,C]=(0,w.useState)(!1),[T,F]=(0,w.useState)([]),[E,k]=(0,w.useState)(!1),[I,L]=(0,w.useState)(null),O=(null==t?void 0:t.role)==="Supervisor"||(null==t?void 0:t.role)==="Team Lead",R=(0,c.mN)({resolver:(0,d.u)(b),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}});(0,w.useEffect)(()=>{t&&!O&&(m({title:"Access Denied",description:"You are not authorized to add employees.",variant:"destructive"}),a.push("/dashboard"))},[t,a,m,O]);let M=(0,w.useCallback)(async(e,t)=>{if(e&&O){k(!0),L(null);try{let a=(await (0,j.Oc)(e,{signal:t})).filter(e=>"Supervisor"===e.role||"Team Lead"===e.role);F(a)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Fetch potential managers request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=S(a);L(e),m({title:"Error Loading Managers",description:e,variant:"destructive"}),console.warn("Fetch potential managers (network error):",e,a)}else{let e=S(a);L(e),m({title:"Error Loading Managers",description:e,variant:"destructive"}),console.warn("Failed to fetch potential managers (after retries):",a)}}finally{k(!1)}}},[m,O]);(0,w.useEffect)(()=>{let t=new AbortController;return M(e,t.signal),()=>{t.abort()}},[e,M]);let J=async r=>{if(!e||!t||!O)return void m({title:"Error",description:"Unauthorized or client not available.",variant:"destructive"});C(!0);try{let t=r.reportsTo_text!==N&&r.reportsTo_text?r.reportsTo_text:void 0,s=r.department_text!==N&&r.department_text?r.department_text:void 0,l={name:r.name,email:r.email,role:r.role,department_text:s,reportsTo_text:t};await (0,j.bV)(e,l),m({title:"Success",description:"New employee added successfully!"}),a.push("/employees")}catch(t){console.error("Failed to create employee:",t);let e="Failed to add employee. Please try again.";t.data&&t.data.message?e=t.data.message:t.message&&(e=t.message),m({title:"Error",description:e,variant:"destructive"})}finally{C(!1)}};return t||E||p?t&&!O?(0,r.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,r.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:"You are not authorized to view this page."}),(0,r.jsx)(s.$,{onClick:()=>a.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})}):(0,r.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Add New Employee"}),(0,r.jsx)(s.$,{variant:"outline",asChild:!0,children:(0,r.jsx)(h(),{href:"/employees",children:"Cancel"})})]}),(0,r.jsxs)(l.Zp,{className:"shadow-md",children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{className:"font-headline",children:"Employee Information"}),(0,r.jsx)(l.BT,{children:"Fill in the details for the new employee."})]}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("form",{onSubmit:R.handleSubmit(J),className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"name",children:"Full Name"}),(0,r.jsx)(o.p,{id:"name",...R.register("name"),placeholder:"e.g., Dr. Jane Doe"}),R.formState.errors.name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:R.formState.errors.name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"email",children:"Email Address"}),(0,r.jsx)(o.p,{id:"email",type:"email",...R.register("email"),placeholder:"e.g., jane.doe@example.com"}),R.formState.errors.email&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:R.formState.errors.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"role-select",children:"Role / Job Title"}),(0,r.jsx)(c.xI,{name:"role",control:R.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"role-select",children:(0,r.jsx)(i.yv,{placeholder:"Select a role"})}),(0,r.jsx)(i.gC,{children:_.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))})]})}}),R.formState.errors.role&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:R.formState.errors.role.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"department_text",children:"Department (Optional)"}),(0,r.jsx)(c.xI,{name:"department_text",control:R.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"department_text",children:(0,r.jsx)(i.yv,{placeholder:"Select a department (Optional)"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:N,children:"None"}),A.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))]})]})}}),R.formState.errors.department_text&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:R.formState.errors.department_text.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"reportsTo_text",children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,r.jsx)(c.xI,{name:"reportsTo_text",control:R.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",disabled:E||!!I,children:[(0,r.jsx)(i.bq,{id:"reportsTo_text",children:(0,r.jsx)(i.yv,{placeholder:E?"Loading managers...":I?"Error loading managers":"Select a manager"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:N,children:"None"}),T.map(e=>(0,r.jsxs)(i.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]})}}),I&&!E&&(0,r.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-1"})," ",I]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(s.$,{type:"button",variant:"outline",onClick:()=>a.push("/employees"),disabled:p,children:"Cancel"}),(0,r.jsxs)(s.$,{type:"submit",disabled:p||E||!!I,children:[p?(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Save Employee"]})]})]})})]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,r.jsx)(y.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading user data..."})]})}},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>s});let r={maxAttempts:3,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};async function s(e,t){let a,s={...r,...t};for(let t=1;t<=s.maxAttempts;t++)try{return await e()}catch(e){if(a=e,s.shouldRetry(e))s.onRetry&&s.onRetry(t,e),t<s.maxAttempts?(console.warn("Attempt ".concat(t," failed for ").concat(s.context,". Retrying in ").concat(s.delayMs*Math.pow(2,t-1),"ms... Error: ").concat(e.message||JSON.stringify(e))),await new Promise(e=>setTimeout(e,s.delayMs*Math.pow(2,t-1)))):console.warn("All ".concat(s.maxAttempts," attempts failed for ").concat(s.context,". Last error: ").concat(e.message||JSON.stringify(e)));else throw e}throw a}},31949:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},75867:(e,t,a)=>{Promise.resolve().then(a.bind(a,29422))},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>o,Qu:()=>c,Y$:()=>i,bV:()=>n});var r=a(30645);let s="employees",l=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),o=async(e,t)=>{try{return(await (0,r.b)(()=>e.collection(s).getFullList({sort:"name",...t}),{...t,context:"fetching employees list"})).map(l)}catch(e){throw e}},n=async(e,t)=>{try{let a=await e.collection(s).create(t);return l(a)}catch(e){throw console.error("Failed to create employee:",e),e}},i=async(e,t,a)=>{try{let r=await e.collection(s).update(t,a);return l(r)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},c=async(e,t)=>{try{await e.collection(s).delete(t)}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,897,52,198,483,874,556,441,303,358],()=>t(75867)),_N_E=e.O()}]);