(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{29422:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var r=a(95155),s=a(30285),l=a(66695),o=a(62523),n=a(85057),i=a(59409),d=a(62177),c=a(90221),m=a(55594),u=a(35695),p=a(6874),f=a.n(p),x=a(59576),h=a(97841),y=a(87481),g=a(50172),w=a(31949),j=a(59119),v=a(12115);let b=m.Ik({name:m.Yj().min(2,{message:"Name must be at least 2 characters."}),email:m.Yj().email({message:"Please enter a valid email address."}),role:m.Yj().min(1,{message:"Role is required."}),department_text:m.Yj().optional(),reportsTo_text:m.Yj().optional()}),N="__NONE__",C=["Supervisor","Team Lead","Chem I","Chem II"],A=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],_=e=>{let t="Could not load list of potential managers.";if(e&&"object"==typeof e)if("status"in e&&0===e.status)return"Failed to load potential managers: Could not connect to the server. Please check your internet connection and try again.";else e.message&&(t=e.message);return t};function E(){let{pbClient:e,user:t}=(0,x.A)(),a=(0,u.useRouter)(),{toast:m}=(0,y.dj)(),[p,E]=(0,v.useState)(!1),[O,R]=(0,v.useState)([]),[S,T]=(0,v.useState)(!1),[k,L]=(0,v.useState)(null),P=(null==t?void 0:t.role)==="Supervisor",F=(0,d.mN)({resolver:(0,c.u)(b),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}});(0,v.useEffect)(()=>{t&&!P&&(m({title:"Access Denied",description:"You are not authorized to add new employees. This page is for Supervisors only.",variant:"destructive"}),a.push("/dashboard"))},[t,a,m,P]);let D=(0,v.useCallback)(async(e,t)=>{if(e&&P){T(!0),L(null);try{let a=(await (0,h.Oc)(e,{signal:t})).filter(e=>"Supervisor"===e.role||"Team Lead"===e.role);R(a)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Fetch potential managers request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=_(a);L(e),m({title:"Error Loading Managers",description:e,variant:"destructive"}),console.warn("Fetch potential managers (network error):",e,a)}else{let e=_(a);L(e),m({title:"Error Loading Managers",description:e,variant:"destructive"}),console.warn("Failed to fetch potential managers (after retries):",a)}}finally{T(!1)}}},[m,P]);(0,v.useEffect)(()=>{let t=new AbortController;return D(e,t.signal),()=>{t.abort()}},[e,D]);let M=async r=>{if(!e||!t||!P)return void m({title:"Error",description:"Unauthorized or client not available.",variant:"destructive"});E(!0);try{let t=r.reportsTo_text!==N&&r.reportsTo_text?r.reportsTo_text:void 0,s=r.department_text!==N&&r.department_text?r.department_text:void 0,l={name:r.name,email:r.email,role:r.role,department_text:s,reportsTo_text:t};await (0,h.bV)(e,l),m({title:"Success",description:"New employee added successfully!"}),a.push("/employees")}catch(e){m({title:"Error Creating Employee",description:e.message||"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{E(!1)}};return t||S||p?t&&!P?(0,r.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,r.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,r.jsx)(l.aR,{children:(0,r.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,r.jsxs)(l.Wu,{children:[(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:"You are not authorized to view this page. This page is for Supervisors only."}),(0,r.jsx)(s.$,{onClick:()=>a.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})}):(0,r.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Add New Employee"}),(0,r.jsx)(s.$,{variant:"outline",asChild:!0,children:(0,r.jsx)(f(),{href:"/employees",children:"Cancel"})})]}),(0,r.jsxs)(l.Zp,{className:"shadow-md",children:[(0,r.jsxs)(l.aR,{children:[(0,r.jsx)(l.ZB,{className:"font-headline",children:"Employee Information"}),(0,r.jsx)(l.BT,{children:"Fill in the details for the new employee."})]}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("form",{onSubmit:F.handleSubmit(M),className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"name",children:"Full Name"}),(0,r.jsx)(o.p,{id:"name",...F.register("name"),placeholder:"e.g., Dr. Jane Doe"}),F.formState.errors.name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:F.formState.errors.name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"email",children:"Email Address"}),(0,r.jsx)(o.p,{id:"email",type:"email",...F.register("email"),placeholder:"e.g., jane.doe@example.com"}),F.formState.errors.email&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:F.formState.errors.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"role-select",children:"Role / Job Title"}),(0,r.jsx)(d.xI,{name:"role",control:F.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"role-select",children:(0,r.jsx)(i.yv,{placeholder:"Select a role"})}),(0,r.jsx)(i.gC,{children:C.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))})]})}}),F.formState.errors.role&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:F.formState.errors.role.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"department_text",children:"Department (Optional)"}),(0,r.jsx)(d.xI,{name:"department_text",control:F.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"department_text",children:(0,r.jsx)(i.yv,{placeholder:"Select a department (Optional)"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:N,children:"None"}),A.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))]})]})}}),F.formState.errors.department_text&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:F.formState.errors.department_text.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"reportsTo_text",children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,r.jsx)(d.xI,{name:"reportsTo_text",control:F.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",disabled:S||!!k,children:[(0,r.jsx)(i.bq,{id:"reportsTo_text",children:(0,r.jsx)(i.yv,{placeholder:S?"Loading managers...":k?"Error loading managers":"Select a manager"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:N,children:"None"}),O.map(e=>(0,r.jsxs)(i.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]})}}),k&&!S&&(0,r.jsxs)("p",{className:"text-sm text-destructive mt-1 flex items-center",children:[(0,r.jsx)(w.A,{className:"h-4 w-4 mr-1"})," ",k]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(s.$,{type:"button",variant:"outline",onClick:()=>a.push("/employees"),disabled:p,children:"Cancel"}),(0,r.jsxs)(s.$,{type:"submit",disabled:p||S||!!k,children:[p?(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"Save Employee"]})]})]})})]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,r.jsx)(g.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading user data..."})]})}},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>o});let r={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var s=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(s||{});let l=new Map;async function o(e,t){let a,s={...r,...t},o=s.context,n=(e,t)=>{let a="[withRetry:".concat(o,"] ").concat(e,". Circuit: ").concat(i.state,".");console.warn(a);let r=Error(a);throw r.isAbort=!0,r.context=o,t&&(r.originalError=t),r};l.has(o)||l.set(o,{state:"CLOSED",failures:0});let i=l.get(o);if("OPEN"===i.state)if(Date.now()<(i.openUntil||0)){let e=Error("Circuit for '".concat(o,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=o,e.openUntil=i.openUntil,e}else i.state="HALF_OPEN",i.failures=0,i.openUntil=void 0,console.log("[withRetry:".concat(o,"] Circuit is now HalfOpen. Allowing one attempt."));let d="HALF_OPEN"===i.state?1:s.maxAttempts;for(let t=1;t<=d;t++){var c,m,u;(null==(c=s.signal)?void 0:c.aborted)&&n("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===i.state||i.failures>0||"OPEN"===i.state)&&(console.log("[withRetry:".concat(o,"] Circuit is now Closed due to successful attempt (was ").concat(i.state,").")),i.state="CLOSED",i.failures=0,i.openUntil=void 0),t}catch(e){if(a=e,(null==(m=s.signal)?void 0:m.aborted)&&n("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(o,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(i.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=o),e;if(s.shouldRetry(e))if(s.onRetry&&s.onRetry(t,d,e),t<d){let e="HALF_OPEN"===i.state?s.delayMs:s.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(u=s.signal)?void 0:u.aborted)&&n("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(o,"] All ").concat(d," attempts failed (Circuit: ").concat(i.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===i.state?(console.warn("[withRetry:".concat(o,"] Circuit failed in HalfOpen state. Re-opening.")),i.state="OPEN",i.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o):"CLOSED"===i.state&&(i.failures++,console.log("[withRetry:".concat(o,"] Circuit failure count: ").concat(i.failures," (max: ").concat(1,")")),i.failures>=1&&(console.warn("[withRetry:".concat(o,"] Circuit reached max failures. Opening circuit.")),i.state="OPEN",i.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=o)),a;else throw e}}if(a)throw a;throw Error("[withRetry:".concat(o,"] Unexpected exit: Max attempts ").concat(d," reached without success or explicit error handling."))}},31949:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},59119:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(40157).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},59409:(e,t,a)=>{"use strict";a.d(t,{bq:()=>u,eb:()=>h,gC:()=>x,l6:()=>c,yv:()=>m});var r=a(95155),s=a(12115),l=a(31992),o=a(79556),n=a(77381),i=a(10518),d=a(59434);let c=l.bL;l.YJ;let m=l.WT,u=s.forwardRef((e,t)=>{let{className:a,children:s,...n}=e;return(0,r.jsxs)(l.l9,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...n,children:[s,(0,r.jsx)(l.In,{asChild:!0,children:(0,r.jsx)(o.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.PP,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})});p.displayName=l.PP.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wn,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})});f.displayName=l.wn.displayName;let x=s.forwardRef((e,t)=>{let{className:a,children:s,position:o="popper",...n}=e;return(0,r.jsx)(l.ZL,{children:(0,r.jsxs)(l.UC,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===o&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:o,...n,children:[(0,r.jsx)(p,{}),(0,r.jsx)(l.LM,{className:(0,d.cn)("p-1","popper"===o&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(f,{})]})})});x.displayName=l.UC.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.JU,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=l.JU.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,r.jsxs)(l.q7,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.VF,{children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})}),(0,r.jsx)(l.p4,{children:s})]})});h.displayName=l.q7.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.wv,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...s})}).displayName=l.wv.displayName},62523:(e,t,a)=>{"use strict";a.d(t,{p:()=>o});var r=a(95155),s=a(12115),l=a(59434);let o=s.forwardRef((e,t)=>{let{className:a,type:s,...o}=e;return(0,r.jsx)("input",{type:s,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...o})});o.displayName="Input"},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>i,Zp:()=>o,aR:()=>n,wL:()=>m});var r=a(95155),s=a(12115),l=a(59434);let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});o.displayName="Card";let n=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...s})});n.displayName="CardHeader";let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-xl md:text-2xl font-semibold leading-none tracking-tight",a),...s})});i.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...s})});c.displayName="CardContent";let m=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...s})});m.displayName="CardFooter"},75867:(e,t,a)=>{Promise.resolve().then(a.bind(a,29422))},85057:(e,t,a)=>{"use strict";a.d(t,{J:()=>d});var r=a(95155),s=a(12115),l=a(40968),o=a(74466),n=a(59434);let i=(0,o.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(l.b,{ref:t,className:(0,n.cn)(i(),a),...s})});d.displayName=l.b.displayName},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>i,Qu:()=>m,Y$:()=>c,bV:()=>d});var r=a(7140),s=a(30645);let l="employees",o=(e,t)=>{if(e instanceof r.fp){var a;if(404===e.status)throw Error("Cannot create item: The '".concat(t,"' collection does not exist. Please create it in your PocketBase admin panel."));if(400===e.status&&(null==(a=e.data)?void 0:a.data)){if(e.data.data.id&&e.data.data.id.message)throw Error("There seems to be a configuration issue with your '".concat(t,"' collection. The server is asking for an 'id', which should be automatically generated. Please check in your PocketBase admin panel that the 'id' field is the default system field and not a required text field you created."));let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a.message)}).join("; ");throw Error("Validation failed. Server says: ".concat(a))}}throw console.error("Failed to create item in ".concat(t,":"),e),e},n=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),i=async(e,t)=>{try{let{onRetry:a,signal:r,...o}=t||{},i={sort:"name",fields:"id,name,email,role,department_text,reportsTo_text,userId,created,updated",...o};return(await (0,s.b)(()=>e.collection(l).getFullList(i,{signal:r}),{signal:r,context:"fetching employees list",onRetry:a})).map(n)}catch(e){throw e}},d=async(e,t,a)=>{try{let r=await e.collection(l).create(t,{signal:null==a?void 0:a.signal});return n(r)}catch(e){throw o(e,l),e}},c=async(e,t,a,r)=>{try{let{signal:o}=r||{},i=await (0,s.b)(()=>e.collection(l).update(t,a,{signal:o}),{context:"updating employee ".concat(t),signal:o});return n(i)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},m=async(e,t,a)=>{try{let{signal:r}=a||{};await (0,s.b)(()=>e.collection(l).delete(t,{signal:r}),{context:"deleting employee ".concat(t),signal:r})}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[383,897,52,198,859,874,876,441,303,358],()=>t(75867)),_N_E=e.O()}]);