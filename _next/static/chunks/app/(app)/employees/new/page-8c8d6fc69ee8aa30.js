(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{29422:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var r=a(95155),l=a(30285),s=a(66695),o=a(62523),n=a(85057),i=a(59409),d=a(62177),c=a(90221),m=a(55594),x=a(35695),h=a(6874),u=a.n(h),p=a(59576),j=a(97841),v=a(87481),f=a(50172),y=a(59119),g=a(12115);let N=m.Ik({name:m.Yj().min(2,{message:"Name must be at least 2 characters."}),email:m.Yj().email({message:"Please enter a valid email address."}),role:m.Yj().min(1,{message:"Role is required."}),department_text:m.Yj().optional(),reportsTo_text:m.Yj().optional()}),_="__NONE__",w=["Supervisor","Team Lead","Chem I","Chem II"],b=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"];function S(){let{pbClient:e,user:t}=(0,p.A)(),a=(0,x.useRouter)(),{toast:m}=(0,v.dj)(),[h,S]=(0,g.useState)(!1),[C,T]=(0,g.useState)([]),[F,E]=(0,g.useState)(!1),A=(null==t?void 0:t.role)==="Supervisor"||(null==t?void 0:t.role)==="Team Lead",I=(0,d.mN)({resolver:(0,c.u)(N),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}});(0,g.useEffect)(()=>{t&&!A&&(m({title:"Access Denied",description:"You are not authorized to add employees.",variant:"destructive"}),a.push("/dashboard"))},[t,a,m,A]);let O=(0,g.useCallback)(async e=>{if(e&&A){E(!0);try{let t=(await (0,j.Oc)(e)).filter(e=>"Supervisor"===e.role||"Team Lead"===e.role);T(t)}catch(r){let e=(null==r?void 0:r.isAbort)===!0,t=(null==r?void 0:r.status)===0,a="string"==typeof(null==r?void 0:r.message)&&r.message.toLowerCase().includes("autocancelled");e||t||a?console.warn("Fetch potential managers request was autocancelled or due to a network issue.",r):(console.error("Failed to fetch potential managers:",r),m({title:"Error",description:"Could not load list of potential managers.",variant:"destructive"}))}finally{E(!1)}}},[m,A]);(0,g.useEffect)(()=>{O(e)},[e,O]);let k=async r=>{if(!e||!t||!A)return void m({title:"Error",description:"Unauthorized or client not available.",variant:"destructive"});S(!0);try{let t=r.reportsTo_text!==_&&r.reportsTo_text?r.reportsTo_text:void 0,l=r.department_text!==_&&r.department_text?r.department_text:void 0,s={name:r.name,email:r.email,role:r.role,department_text:l,reportsTo_text:t};await (0,j.bV)(e,s),m({title:"Success",description:"New employee added successfully!"}),a.push("/employees")}catch(t){console.error("Failed to create employee:",t);let e="Failed to add employee. Please try again.";t.data&&t.data.message?e=t.data.message:t.message&&(e=t.message),m({title:"Error",description:e,variant:"destructive"})}finally{S(!1)}};return t||F||h?t&&!A?(0,r.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,r.jsxs)(s.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,r.jsx)(s.aR,{children:(0,r.jsx)(s.ZB,{className:"text-center",children:"Access Denied"})}),(0,r.jsxs)(s.Wu,{children:[(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:"You are not authorized to view this page."}),(0,r.jsx)(l.$,{onClick:()=>a.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})}):(0,r.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Add New Employee"}),(0,r.jsx)(l.$,{variant:"outline",asChild:!0,children:(0,r.jsx)(u(),{href:"/employees",children:"Cancel"})})]}),(0,r.jsxs)(s.Zp,{className:"shadow-md",children:[(0,r.jsxs)(s.aR,{children:[(0,r.jsx)(s.ZB,{className:"font-headline",children:"Employee Information"}),(0,r.jsx)(s.BT,{children:"Fill in the details for the new employee."})]}),(0,r.jsx)(s.Wu,{children:(0,r.jsxs)("form",{onSubmit:I.handleSubmit(k),className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"name",children:"Full Name"}),(0,r.jsx)(o.p,{id:"name",...I.register("name"),placeholder:"e.g., Dr. Jane Doe"}),I.formState.errors.name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:I.formState.errors.name.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"email",children:"Email Address"}),(0,r.jsx)(o.p,{id:"email",type:"email",...I.register("email"),placeholder:"e.g., jane.doe@example.com"}),I.formState.errors.email&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:I.formState.errors.email.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"role-select",children:"Role / Job Title"}),(0,r.jsx)(d.xI,{name:"role",control:I.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"role-select",children:(0,r.jsx)(i.yv,{placeholder:"Select a role"})}),(0,r.jsx)(i.gC,{children:w.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))})]})}}),I.formState.errors.role&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:I.formState.errors.role.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"department_text",children:"Department (Optional)"}),(0,r.jsx)(d.xI,{name:"department_text",control:I.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"department_text",children:(0,r.jsx)(i.yv,{placeholder:"Select a department (Optional)"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:_,children:"None"}),b.map(e=>(0,r.jsx)(i.eb,{value:e,children:e},e))]})]})}}),I.formState.errors.department_text&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:I.formState.errors.department_text.message})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(n.J,{htmlFor:"reportsTo_text",children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,r.jsx)(d.xI,{name:"reportsTo_text",control:I.control,render:e=>{let{field:t}=e;return(0,r.jsxs)(i.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,r.jsx)(i.bq,{id:"reportsTo_text",disabled:F,children:(0,r.jsx)(i.yv,{placeholder:F?"Loading managers...":"Select a manager"})}),(0,r.jsxs)(i.gC,{children:[(0,r.jsx)(i.eb,{value:_,children:"None"}),C.map(e=>(0,r.jsxs)(i.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]})}})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,r.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>a.push("/employees"),disabled:h,children:"Cancel"}),(0,r.jsxs)(l.$,{type:"submit",disabled:h||F,children:[h?(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Save Employee"]})]})]})})]})]}):(0,r.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,r.jsx)(f.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2",children:"Loading user data..."})]})}},75867:(e,t,a)=>{Promise.resolve().then(a.bind(a,29422))},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>s,Qu:()=>i,Y$:()=>n,bV:()=>o});let r="employees",l=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),s=async e=>{try{return(await e.collection(r).getFullList({sort:"name"})).map(l)}catch(e){throw console.error("Failed to fetch employees:",e),e}},o=async(e,t)=>{try{let a=await e.collection(r).create(t);return l(a)}catch(e){throw console.error("Failed to create employee:",e),e}},n=async(e,t,a)=>{try{let s=await e.collection(r).update(t,a);return l(s)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},i=async(e,t)=>{try{await e.collection(r).delete(t)}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[143,644,52,524,521,483,556,441,303,358],()=>t(75867)),_N_E=e.O()}]);