(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7454:(e,t,a)=>{Promise.resolve().then(a.bind(a,30379))},30379:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>M});var s=a(95155),r=a(30285),l=a(66695),n=a(85127),i=a(44838),o=a(54165),c=a(62523),d=a(59409),m=a(17759),u=a(50172),h=a(34301),p=a(31949),x=a(3561),f=a(18763),j=a(77223),y=a(59119),g=a(6874),v=a.n(g),w=a(59576),N=a(12115),b=a(35695),C=a(97841),E=a(87481),A=a(62177),_=a(90221),O=a(55594);let R=O.Ik({name:O.Yj().min(2,{message:"Name must be at least 2 characters."}),email:O.Yj().email({message:"Please enter a valid email address."}),role:O.Yj().min(1,{message:"Role is required."}),department_text:O.Yj().optional(),reportsTo_text:O.Yj().optional()}),T="__NONE__",k=["Supervisor","Team Lead","Chem I","Chem II"],S=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],L=e=>{let t="An unexpected error occurred while managing employees.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load employees: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let a=e.status;404===a?t="The employees collection was not found (404). Original: ".concat(t):403===a&&(t="You do not have permission to manage employees (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function M(){let{pbClient:e,user:t}=(0,w.A)(),a=(0,b.useRouter)(),{toast:g}=(0,E.dj)(),[O,M]=(0,N.useState)([]),[P,F]=(0,N.useState)(!0),[D,H]=(0,N.useState)(null),[I,B]=(0,N.useState)(!1),[J,U]=(0,N.useState)(null),[V,q]=(0,N.useState)(!1),z=(null==t?void 0:t.role)==="Supervisor",Y=(0,A.mN)({resolver:(0,_.u)(R),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}}),$=(0,N.useCallback)(async(e,t)=>{F(!0),H(null);try{let a=await (0,C.Oc)(e,{signal:t});M(a)}catch(a){let e=(null==a?void 0:a.isAbort)===!0||"string"==typeof(null==a?void 0:a.message)&&a.message.toLowerCase().includes("autocancelled"),t=(null==a?void 0:a.status)===0&&!e;if(e)console.warn("Employees fetch request was ".concat((null==a?void 0:a.isAbort)?"aborted":"autocancelled","."),a);else if(t){let e=L(a);H(e),g({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Employees fetch (network error):",e,a)}else{let e=L(a);H(e),g({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees (after retries):",e,a)}}finally{F(!1)}},[g]);(0,N.useEffect)(()=>{if(!e||!t)return void F(!0);if(!z){g({title:"Access Denied",description:"This page is for Supervisors only.",variant:"destructive"}),a.push("/dashboard");return}let s=new AbortController;return $(e,s.signal),()=>{s.abort()}},[t,e,a,g,$,z]);let Z=(0,N.useMemo)(()=>J?O.filter(e=>("Supervisor"===e.role||"Team Lead"===e.role)&&e.id!==J.id):[],[O,J]);(0,N.useEffect)(()=>{J&&Y.reset({name:J.name,email:J.email,role:J.role,department_text:J.department_text||"",reportsTo_text:J.reportsTo_text||""})},[J,Y]);let G=(0,N.useCallback)(async t=>{if(!e)return void g({title:"Error",description:"Client not available.",variant:"destructive"});let a=[...O];M(e=>e.filter(e=>e.id!==t));try{await (0,C.Qu)(e,t),g({title:"Success",description:"Employee removed successfully."})}catch(e){console.error("Failed to delete employee:",e),M(a),g({title:"Error",description:L(e),variant:"destructive"})}},[e,g,O]),W=(0,N.useCallback)(e=>{U(e),B(!0)},[]),Q=()=>{B(!1),U(null),Y.reset()},X=async t=>{if(!J||!e)return void g({title:"Error",description:"Editing context or client not available.",variant:"destructive"});q(!0);let a=t.reportsTo_text!==T&&t.reportsTo_text?t.reportsTo_text:void 0,s=t.department_text!==T&&t.department_text?t.department_text:void 0,r={name:t.name,email:t.email,role:t.role,department_text:s,reportsTo_text:a};try{let t=await (0,C.Y$)(e,J.id,r);M(e=>e.map(e=>e.id===J.id?t:e)),g({title:"Success",description:"Employee details updated successfully."}),Q()}catch(e){console.error("Failed to update employee:",e),g({title:"Error",description:L(e),variant:"destructive"})}finally{q(!1)}};return!t&&P?(0,s.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,s.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!t||z||P?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Employee Management"}),z&&(0,s.jsx)(v(),{href:"/employees/new",passHref:!0,children:(0,s.jsxs)(r.$,{children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Add Employee"]})})]}),(0,s.jsxs)(l.Zp,{className:"shadow-md",children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsx)(l.ZB,{className:"font-headline",children:"All Employees"}),(0,s.jsx)(l.BT,{children:"Manage employee information and access."})]}),(0,s.jsxs)(l.Wu,{children:[P&&(0,s.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,s.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading employees..."})]}),D&&!P&&(0,s.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,s.jsx)(p.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Employees"}),(0,s.jsx)("p",{className:"text-sm",children:D}),(0,s.jsx)(r.$,{onClick:()=>{e&&z&&$(e)},className:"mt-6",children:"Try Again"})]}),!P&&!D&&0===O.length&&(0,s.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,s.jsx)("p",{children:"No employees found. Get started by adding a new employee."})}),!P&&!D&&O.length>0&&(0,s.jsxs)(n.XI,{children:[(0,s.jsx)(n.A0,{children:(0,s.jsxs)(n.Hj,{children:[(0,s.jsx)(n.nd,{children:"Name"}),(0,s.jsx)(n.nd,{children:"Email"}),(0,s.jsx)(n.nd,{children:"Role"}),(0,s.jsx)(n.nd,{children:"Department"}),(0,s.jsx)(n.nd,{children:"Reports To"}),z&&(0,s.jsx)(n.nd,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(n.BF,{children:O.map(e=>(0,s.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,s.jsx)(n.nA,{children:(0,s.jsx)("span",{className:"font-medium",children:e.name})}),(0,s.jsx)(n.nA,{children:e.email}),(0,s.jsx)(n.nA,{children:e.role}),(0,s.jsx)(n.nA,{children:e.department_text||"-"}),(0,s.jsx)(n.nA,{children:e.reportsTo_text||"-"}),z&&(0,s.jsx)(n.nA,{className:"text-right",children:(0,s.jsxs)(i.rI,{children:[(0,s.jsx)(i.ty,{asChild:!0,children:(0,s.jsx)(r.$,{variant:"ghost",size:"icon",children:(0,s.jsx)(x.A,{className:"h-4 w-4"})})}),(0,s.jsxs)(i.SQ,{align:"end",children:[(0,s.jsxs)(i._2,{onClick:()=>W(e),className:"flex items-center w-full",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,s.jsxs)(i._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>G(e.id),children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),J&&z&&(0,s.jsx)(o.lG,{open:I,onOpenChange:e=>{e?B(!0):Q()},children:(0,s.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(o.c7,{children:[(0,s.jsxs)(o.L3,{className:"font-headline",children:["Edit Employee: ",J.name]}),(0,s.jsx)(o.rr,{children:"Make changes to the employee's details below."})]}),(0,s.jsx)(m.lV,{...Y,children:(0,s.jsxs)("form",{onSubmit:Y.handleSubmit(X),className:"space-y-4 py-4",children:[(0,s.jsx)(m.zB,{control:Y.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Full Name"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(c.p,{...t})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:Y.control,name:"email",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Email Address"}),(0,s.jsx)(m.MJ,{children:(0,s.jsx)(c.p,{type:"email",...t})}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:Y.control,name:"role",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Role / Job Title"}),(0,s.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(d.bq,{children:(0,s.jsx)(d.yv,{placeholder:"Select a role"})})}),(0,s.jsx)(d.gC,{children:k.map(e=>(0,s.jsx)(d.eb,{value:e,children:e},e))})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:Y.control,name:"department_text",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Department (Optional)"}),(0,s.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(d.bq,{children:(0,s.jsx)(d.yv,{placeholder:"Select a department (Optional)"})})}),(0,s.jsxs)(d.gC,{children:[(0,s.jsx)(d.eb,{value:T,children:"None"}),S.map(e=>(0,s.jsx)(d.eb,{value:e,children:e},e))]})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsx)(m.zB,{control:Y.control,name:"reportsTo_text",render:e=>{let{field:t}=e;return(0,s.jsxs)(m.eI,{children:[(0,s.jsx)(m.lR,{children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,s.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,s.jsx)(m.MJ,{children:(0,s.jsx)(d.bq,{children:(0,s.jsx)(d.yv,{placeholder:"Select a manager"})})}),(0,s.jsxs)(d.gC,{children:[(0,s.jsx)(d.eb,{value:T,children:"None"}),Z.map(e=>(0,s.jsxs)(d.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),(0,s.jsx)(m.C5,{})]})}}),(0,s.jsxs)(o.Es,{children:[(0,s.jsx)(o.HM,{asChild:!0,children:(0,s.jsx)(r.$,{type:"button",variant:"outline",onClick:Q,disabled:V,children:"Cancel"})}),(0,s.jsxs)(r.$,{type:"submit",disabled:V,children:[V?(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,s.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,s.jsx)(l.aR,{children:(0,s.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,s.jsxs)(l.Wu,{children:[(0,s.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors only."}),(0,s.jsx)(r.$,{onClick:()=>a.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}},30645:(e,t,a)=>{"use strict";a.d(t,{b:()=>n});let s={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var r=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(r||{});let l=new Map;async function n(e,t){let a,r={...s,...t},n=r.context,i=(e,t)=>{let a="[withRetry:".concat(n,"] ").concat(e,". Circuit: ").concat(o.state,".");console.warn(a);let s=Error(a);throw s.isAbort=!0,s.context=n,t&&(s.originalError=t),s};l.has(n)||l.set(n,{state:"CLOSED",failures:0});let o=l.get(n);if("OPEN"===o.state)if(Date.now()<(o.openUntil||0)){let e=Error("Circuit for '".concat(n,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=n,e.openUntil=o.openUntil,e}else o.state="HALF_OPEN",o.failures=0,o.openUntil=void 0,console.log("[withRetry:".concat(n,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===o.state?1:r.maxAttempts;for(let t=1;t<=c;t++){var d,m,u;(null==(d=r.signal)?void 0:d.aborted)&&i("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===o.state||o.failures>0||"OPEN"===o.state)&&(console.log("[withRetry:".concat(n,"] Circuit is now Closed due to successful attempt (was ").concat(o.state,").")),o.state="CLOSED",o.failures=0,o.openUntil=void 0),t}catch(e){if(a=e,(null==(m=r.signal)?void 0:m.aborted)&&i("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(n,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(o.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=n),e;if(r.shouldRetry(e))if(r.onRetry&&r.onRetry(t,c,e),t<c){let e="HALF_OPEN"===o.state?r.delayMs:r.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(u=r.signal)?void 0:u.aborted)&&i("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(n,"] All ").concat(c," attempts failed (Circuit: ").concat(o.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===o.state?(console.warn("[withRetry:".concat(n,"] Circuit failed in HalfOpen state. Re-opening.")),o.state="OPEN",o.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=n):"CLOSED"===o.state&&(o.failures++,console.log("[withRetry:".concat(n,"] Circuit failure count: ").concat(o.failures," (max: ").concat(1,")")),o.failures>=1&&(console.warn("[withRetry:".concat(n,"] Circuit reached max failures. Opening circuit.")),o.state="OPEN",o.openUntil=Date.now()+3e4,a.circuitJustOpened=!0,a.context=n)),a;else throw e}}if(a)throw a;throw Error("[withRetry:".concat(n,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},31949:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},59119:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>i});var s=a(95155),r=a(12115),l=a(59434);let n=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});n.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-xl md:text-2xl font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",a),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},73158:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},97841:(e,t,a)=>{"use strict";a.d(t,{Oc:()=>o,Qu:()=>m,Y$:()=>d,bV:()=>c});var s=a(7140),r=a(30645);let l="employees",n=(e,t)=>{if(e instanceof s.fp){var a;if(404===e.status)throw Error("Cannot create item: The '".concat(t,"' collection does not exist. Please create it in your PocketBase admin panel."));if(400===e.status&&(null==(a=e.data)?void 0:a.data)){if(e.data.data.id&&e.data.data.id.message)throw Error("There seems to be a configuration issue with your '".concat(t,"' collection. The server is asking for an 'id', which should be automatically generated. Please check in your PocketBase admin panel that the 'id' field is the default system field and not a required text field you created."));let a=Object.entries(e.data.data).map(e=>{let[t,a]=e;return"".concat(t,": ").concat(a.message)}).join("; ");throw Error("Validation failed. Server says: ".concat(a))}}throw console.error("Failed to create item in ".concat(t,":"),e),e},i=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),o=async(e,t)=>{try{let{onRetry:a,signal:s,...n}=t||{},o={sort:"name",fields:"id,name,email,role,department_text,reportsTo_text,userId,created,updated",...n};return(await (0,r.b)(()=>e.collection(l).getFullList(o,{signal:s}),{signal:s,context:"fetching employees list",onRetry:a})).map(i)}catch(e){throw e}},c=async(e,t,a)=>{try{let s=await e.collection(l).create(t,{signal:null==a?void 0:a.signal});return i(s)}catch(e){throw n(e,l),e}},d=async(e,t,a,s)=>{try{let{signal:n}=s||{},o=await (0,r.b)(()=>e.collection(l).update(t,a,{signal:n}),{context:"updating employee ".concat(t),signal:n});return i(o)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},m=async(e,t,a)=>{try{let{signal:s}=a||{};await (0,r.b)(()=>e.collection(l).delete(t,{signal:s}),{context:"deleting employee ".concat(t),signal:s})}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[383,897,52,198,859,874,452,655,876,624,441,303,358],()=>t(7454)),_N_E=e.O()}]);