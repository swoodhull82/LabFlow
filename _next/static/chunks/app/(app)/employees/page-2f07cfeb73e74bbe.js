(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7454:(e,s,t)=>{Promise.resolve().then(t.bind(t,30379))},30379:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>O});var l=t(95155),r=t(30285),a=t(66695),n=t(85127),i=t(44838),o=t(54165),c=t(62523),d=t(59409),m=t(17759),h=t(50172),x=t(34301),p=t(31949),u=t(3561),j=t(18763),v=t(77223),g=t(59119),y=t(6874),f=t.n(y),N=t(59576),b=t(12115),A=t(35695),w=t(97841),C=t(87481),E=t(62177),_=t(90221),T=t(55594);let S=T.Ik({name:T.Yj().min(2,{message:"Name must be at least 2 characters."}),email:T.Yj().email({message:"Please enter a valid email address."}),role:T.Yj().min(1,{message:"Role is required."}),department_text:T.Yj().optional(),reportsTo_text:T.Yj().optional()}),k="__NONE__",R=["Supervisor","Team Lead","Chem I","Chem II"],M=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],L=e=>{let s="An unexpected error occurred while managing employees.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?s="Failed to load employees: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?s=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?s=e.message:e.originalError&&"string"==typeof e.originalError.message?s=e.originalError.message:e.message&&"string"==typeof e.message&&(s=e.message),"status"in e&&0!==e.status){let t=e.status;404===t?s="The employees collection was not found (404). Original: ".concat(s):403===t&&(s="You do not have permission to manage employees (403). Original: ".concat(s))}}else"string"==typeof e&&(s=e);return s};function O(){let{pbClient:e,user:s}=(0,N.A)(),t=(0,A.useRouter)(),{toast:y}=(0,C.dj)(),[T,O]=(0,b.useState)([]),[B,I]=(0,b.useState)(!0),[q,z]=(0,b.useState)(null),[Y,$]=(0,b.useState)(!1),[D,F]=(0,b.useState)(null),[J,V]=(0,b.useState)(!1),G=(null==s?void 0:s.role)==="Supervisor"||(null==s?void 0:s.role)==="Team Lead",H=(0,E.mN)({resolver:(0,_.u)(S),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}}),P=(0,b.useCallback)(async(e,s)=>{I(!0),z(null);try{let t=await (0,w.Oc)(e,{signal:s});O(t)}catch(t){let e=(null==t?void 0:t.isAbort)===!0||"string"==typeof(null==t?void 0:t.message)&&t.message.toLowerCase().includes("autocancelled"),s=(null==t?void 0:t.status)===0&&!e;if(e)console.warn("Employees fetch request was ".concat((null==t?void 0:t.isAbort)?"aborted":"autocancelled","."),t);else if(s){let e=L(t);z(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Employees fetch (network error):",e,t)}else{let e=L(t);z(e),y({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees (after retries):",e,t)}}finally{I(!1)}},[y]);(0,b.useEffect)(()=>{if(!e||!s)return void I(!0);if(!G){y({title:"Access Denied",description:"This page is for Supervisors and Team Leads only.",variant:"destructive"}),t.push("/dashboard");return}let l=new AbortController;return P(e,l.signal),()=>{l.abort()}},[s,e,t,y,P,G]);let Z=(0,b.useMemo)(()=>D?T.filter(e=>("Supervisor"===e.role||"Team Lead"===e.role)&&e.id!==D.id):[],[T,D]);(0,b.useEffect)(()=>{D&&H.reset({name:D.name,email:D.email,role:D.role,department_text:D.department_text||"",reportsTo_text:D.reportsTo_text||""})},[D,H]);let W=async s=>{if(!e)return void y({title:"Error",description:"Client not available.",variant:"destructive"});let t=[...T];O(e=>e.filter(e=>e.id!==s));try{await (0,w.Qu)(e,s),y({title:"Success",description:"Employee removed successfully."})}catch(e){console.error("Failed to delete employee:",e),O(t),y({title:"Error",description:L(e),variant:"destructive"})}},Q=e=>{F(e),$(!0)},U=()=>{$(!1),F(null),H.reset()},X=async s=>{if(!D||!e)return void y({title:"Error",description:"Editing context or client not available.",variant:"destructive"});V(!0);let t=s.reportsTo_text!==k&&s.reportsTo_text?s.reportsTo_text:void 0,l=s.department_text!==k&&s.department_text?s.department_text:void 0,r={name:s.name,email:s.email,role:s.role,department_text:l,reportsTo_text:t};try{let s=await (0,w.Y$)(e,D.id,r);O(e=>e.map(e=>e.id===D.id?s:e)),y({title:"Success",description:"Employee details updated successfully."}),U()}catch(e){console.error("Failed to update employee:",e),y({title:"Error",description:L(e),variant:"destructive"})}finally{V(!1)}};return!s&&B?(0,l.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,l.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,l.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!s||G||B?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-3xl font-headline font-semibold",children:"Employee Management"}),G&&(0,l.jsx)(f(),{href:"/employees/new",passHref:!0,children:(0,l.jsxs)(r.$,{children:[(0,l.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Add Employee"]})})]}),(0,l.jsxs)(a.Zp,{className:"shadow-md",children:[(0,l.jsxs)(a.aR,{children:[(0,l.jsx)(a.ZB,{className:"font-headline",children:"All Employees"}),(0,l.jsx)(a.BT,{children:"Manage employee information and access."})]}),(0,l.jsxs)(a.Wu,{children:[B&&(0,l.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,l.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,l.jsx)("p",{className:"ml-2",children:"Loading employees..."})]}),q&&!B&&(0,l.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,l.jsx)(p.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,l.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Employees"}),(0,l.jsx)("p",{className:"text-sm",children:q}),(0,l.jsx)(r.$,{onClick:()=>{e&&G&&P(e)},className:"mt-6",children:"Try Again"})]}),!B&&!q&&0===T.length&&(0,l.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,l.jsx)("p",{children:"No employees found. Get started by adding a new employee."})}),!B&&!q&&T.length>0&&(0,l.jsxs)(n.XI,{children:[(0,l.jsx)(n.A0,{children:(0,l.jsxs)(n.Hj,{children:[(0,l.jsx)(n.nd,{children:"Name"}),(0,l.jsx)(n.nd,{children:"Email"}),(0,l.jsx)(n.nd,{children:"Role"}),(0,l.jsx)(n.nd,{children:"Department"}),(0,l.jsx)(n.nd,{children:"Reports To"}),G&&(0,l.jsx)(n.nd,{className:"text-right",children:"Actions"})]})}),(0,l.jsx)(n.BF,{children:T.map(e=>(0,l.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,l.jsx)(n.nA,{children:(0,l.jsx)("span",{className:"font-medium",children:e.name})}),(0,l.jsx)(n.nA,{children:e.email}),(0,l.jsx)(n.nA,{children:e.role}),(0,l.jsx)(n.nA,{children:e.department_text||"-"}),(0,l.jsx)(n.nA,{children:e.reportsTo_text||"-"}),G&&(0,l.jsx)(n.nA,{className:"text-right",children:(0,l.jsxs)(i.rI,{children:[(0,l.jsx)(i.ty,{asChild:!0,children:(0,l.jsx)(r.$,{variant:"ghost",size:"icon",children:(0,l.jsx)(u.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(i.SQ,{align:"end",children:[(0,l.jsxs)(i._2,{onClick:()=>Q(e),className:"flex items-center w-full",children:[(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,l.jsxs)(i._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>W(e.id),children:[(0,l.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),D&&G&&(0,l.jsx)(o.lG,{open:Y,onOpenChange:e=>{e?$(!0):U()},children:(0,l.jsxs)(o.Cf,{className:"sm:max-w-[425px]",children:[(0,l.jsxs)(o.c7,{children:[(0,l.jsxs)(o.L3,{className:"font-headline",children:["Edit Employee: ",D.name]}),(0,l.jsx)(o.rr,{children:"Make changes to the employee's details below."})]}),(0,l.jsx)(m.lV,{...H,children:(0,l.jsxs)("form",{onSubmit:H.handleSubmit(X),className:"space-y-4 py-4",children:[(0,l.jsx)(m.zB,{control:H.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(m.eI,{children:[(0,l.jsx)(m.lR,{children:"Full Name"}),(0,l.jsx)(m.MJ,{children:(0,l.jsx)(c.p,{...s})}),(0,l.jsx)(m.C5,{})]})}}),(0,l.jsx)(m.zB,{control:H.control,name:"email",render:e=>{let{field:s}=e;return(0,l.jsxs)(m.eI,{children:[(0,l.jsx)(m.lR,{children:"Email Address"}),(0,l.jsx)(m.MJ,{children:(0,l.jsx)(c.p,{type:"email",...s})}),(0,l.jsx)(m.C5,{})]})}}),(0,l.jsx)(m.zB,{control:H.control,name:"role",render:e=>{let{field:s}=e;return(0,l.jsxs)(m.eI,{children:[(0,l.jsx)(m.lR,{children:"Role / Job Title"}),(0,l.jsxs)(d.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,l.jsx)(m.MJ,{children:(0,l.jsx)(d.bq,{children:(0,l.jsx)(d.yv,{placeholder:"Select a role"})})}),(0,l.jsx)(d.gC,{children:R.map(e=>(0,l.jsx)(d.eb,{value:e,children:e},e))})]}),(0,l.jsx)(m.C5,{})]})}}),(0,l.jsx)(m.zB,{control:H.control,name:"department_text",render:e=>{let{field:s}=e;return(0,l.jsxs)(m.eI,{children:[(0,l.jsx)(m.lR,{children:"Department (Optional)"}),(0,l.jsxs)(d.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,l.jsx)(m.MJ,{children:(0,l.jsx)(d.bq,{children:(0,l.jsx)(d.yv,{placeholder:"Select a department (Optional)"})})}),(0,l.jsxs)(d.gC,{children:[(0,l.jsx)(d.eb,{value:k,children:"None"}),M.map(e=>(0,l.jsx)(d.eb,{value:e,children:e},e))]})]}),(0,l.jsx)(m.C5,{})]})}}),(0,l.jsx)(m.zB,{control:H.control,name:"reportsTo_text",render:e=>{let{field:s}=e;return(0,l.jsxs)(m.eI,{children:[(0,l.jsx)(m.lR,{children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,l.jsxs)(d.l6,{onValueChange:s.onChange,value:s.value||"",children:[(0,l.jsx)(m.MJ,{children:(0,l.jsx)(d.bq,{children:(0,l.jsx)(d.yv,{placeholder:"Select a manager"})})}),(0,l.jsxs)(d.gC,{children:[(0,l.jsx)(d.eb,{value:k,children:"None"}),Z.map(e=>(0,l.jsxs)(d.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),(0,l.jsx)(m.C5,{})]})}}),(0,l.jsxs)(o.Es,{children:[(0,l.jsx)(o.HM,{asChild:!0,children:(0,l.jsx)(r.$,{type:"button",variant:"outline",onClick:U,disabled:J,children:"Cancel"})}),(0,l.jsxs)(r.$,{type:"submit",disabled:J,children:[J?(0,l.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,l.jsxs)(a.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,l.jsx)(a.aR,{children:(0,l.jsx)(a.ZB,{className:"text-center",children:"Access Denied"})}),(0,l.jsxs)(a.Wu,{children:[(0,l.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors and Team Leads only."}),(0,l.jsx)(r.$,{onClick:()=>t.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}},31949:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},73158:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});let l=(0,t(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[143,897,52,198,477,874,812,556,710,441,303,358],()=>s(7454)),_N_E=e.O()}]);