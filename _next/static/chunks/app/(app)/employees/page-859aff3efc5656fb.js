(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[973],{7454:(e,t,s)=>{Promise.resolve().then(s.bind(s,30379))},30379:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var a=s(95155),r=s(30285),l=s(66695),n=s(85127),o=s(44838),i=s(54165),c=s(62523),d=s(59409),m=s(17759),u=s(50172),p=s(34301),h=s(31949),x=s(3561),j=s(18763),f=s(77223),y=s(59119),g=s(6874),v=s.n(g),w=s(59576),N=s(12115),b=s(35695),C=s(97841),A=s(87481),E=s(62177),_=s(90221),O=s(55594);let R=O.Ik({name:O.Yj().min(2,{message:"Name must be at least 2 characters."}),email:O.Yj().email({message:"Please enter a valid email address."}),role:O.Yj().min(1,{message:"Role is required."}),department_text:O.Yj().optional(),reportsTo_text:O.Yj().optional()}),T="__NONE__",S=["Supervisor","Team Lead","Chem I","Chem II"],k=["Trace Metals","Automated","Air & Grav","Organics","BacT","Radiation","MAU","SpecOp"],L=e=>{let t="An unexpected error occurred while managing employees.";if(e&&"object"==typeof e){if("status"in e&&0===e.status?t="Failed to load employees: Could not connect to the server. Please check your internet connection and try again.":e.data&&"object"==typeof e.data&&e.data.message&&"string"==typeof e.data.message?t=e.data.message:e.message&&"string"==typeof e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?t=e.message:e.originalError&&"string"==typeof e.originalError.message?t=e.originalError.message:e.message&&"string"==typeof e.message&&(t=e.message),"status"in e&&0!==e.status){let s=e.status;404===s?t="The employees collection was not found (404). Original: ".concat(t):403===s&&(t="You do not have permission to manage employees (403). Original: ".concat(t))}}else"string"==typeof e&&(t=e);return t};function M(){let{pbClient:e,user:t}=(0,w.A)(),s=(0,b.useRouter)(),{toast:g}=(0,A.dj)(),[O,M]=(0,N.useState)([]),[F,P]=(0,N.useState)(!0),[D,H]=(0,N.useState)(null),[I,B]=(0,N.useState)(!1),[J,U]=(0,N.useState)(null),[z,V]=(0,N.useState)(!1),Y=(null==t?void 0:t.role)==="Supervisor",$=(0,E.mN)({resolver:(0,_.u)(R),defaultValues:{name:"",email:"",role:"",department_text:"",reportsTo_text:""}}),q=(0,N.useCallback)(async(e,t)=>{P(!0),H(null);try{let s=await (0,C.Oc)(e,{signal:t});M(s)}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("Employees fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=L(s);H(e),g({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Employees fetch (network error):",e,s)}else{let e=L(s);H(e),g({title:"Error Loading Employees",description:e,variant:"destructive"}),console.warn("Error fetching employees (after retries):",e,s)}}finally{P(!1)}},[g]);(0,N.useEffect)(()=>{if(!e||!t)return void P(!0);if(!Y){g({title:"Access Denied",description:"This page is for Supervisors only.",variant:"destructive"}),s.push("/dashboard");return}let a=new AbortController;return q(e,a.signal),()=>{a.abort()}},[t,e,s,g,q,Y]);let Z=(0,N.useMemo)(()=>J?O.filter(e=>("Supervisor"===e.role||"Team Lead"===e.role)&&e.id!==J.id):[],[O,J]);(0,N.useEffect)(()=>{J&&$.reset({name:J.name,email:J.email,role:J.role,department_text:J.department_text||"",reportsTo_text:J.reportsTo_text||""})},[J,$]);let G=(0,N.useCallback)(async t=>{if(!e)return void g({title:"Error",description:"Client not available.",variant:"destructive"});let s=[...O];M(e=>e.filter(e=>e.id!==t));try{await (0,C.Qu)(e,t),g({title:"Success",description:"Employee removed successfully."})}catch(e){console.error("Failed to delete employee:",e),M(s),g({title:"Error",description:L(e),variant:"destructive"})}},[e,g,O]),W=(0,N.useCallback)(e=>{U(e),B(!0)},[]),Q=()=>{B(!1),U(null),$.reset()},X=async t=>{if(!J||!e)return void g({title:"Error",description:"Editing context or client not available.",variant:"destructive"});V(!0);let s=t.reportsTo_text!==T&&t.reportsTo_text?t.reportsTo_text:void 0,a=t.department_text!==T&&t.department_text?t.department_text:void 0,r={name:t.name,email:t.email,role:t.role,department_text:a,reportsTo_text:s};try{let t=await (0,C.Y$)(e,J.id,r);M(e=>e.map(e=>e.id===J.id?t:e)),g({title:"Success",description:"Employee details updated successfully."}),Q()}catch(e){console.error("Failed to update employee:",e),g({title:"Error",description:L(e),variant:"destructive"})}finally{V(!1)}};return!t&&F?(0,a.jsxs)("div",{className:"flex items-center justify-center h-full p-4",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading user information..."})]}):!t||Y||F?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-3xl font-headline font-semibold",children:"Employee Management"}),Y&&(0,a.jsx)(v(),{href:"/employees/new",passHref:!0,children:(0,a.jsxs)(r.$,{children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Add Employee"]})})]}),(0,a.jsxs)(l.Zp,{className:"shadow-md",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{className:"font-headline",children:"All Employees"}),(0,a.jsx)(l.BT,{children:"Manage employee information and access."})]}),(0,a.jsxs)(l.Wu,{children:[F&&(0,a.jsxs)("div",{className:"flex justify-center items-center py-10",children:[(0,a.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,a.jsx)("p",{className:"ml-2",children:"Loading employees..."})]}),D&&!F&&(0,a.jsxs)("div",{className:"text-center py-10 text-destructive",children:[(0,a.jsx)(h.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Employees"}),(0,a.jsx)("p",{className:"text-sm",children:D}),(0,a.jsx)(r.$,{onClick:()=>{e&&Y&&q(e)},className:"mt-6",children:"Try Again"})]}),!F&&!D&&0===O.length&&(0,a.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:(0,a.jsx)("p",{children:"No employees found. Get started by adding a new employee."})}),!F&&!D&&O.length>0&&(0,a.jsxs)(n.XI,{children:[(0,a.jsx)(n.A0,{children:(0,a.jsxs)(n.Hj,{children:[(0,a.jsx)(n.nd,{children:"Name"}),(0,a.jsx)(n.nd,{children:"Email"}),(0,a.jsx)(n.nd,{children:"Role"}),(0,a.jsx)(n.nd,{children:"Department"}),(0,a.jsx)(n.nd,{children:"Reports To"}),Y&&(0,a.jsx)(n.nd,{className:"text-right",children:"Actions"})]})}),(0,a.jsx)(n.BF,{children:O.map(e=>(0,a.jsxs)(n.Hj,{className:"hover:bg-muted/50 transition-colors",children:[(0,a.jsx)(n.nA,{children:(0,a.jsx)("span",{className:"font-medium",children:e.name})}),(0,a.jsx)(n.nA,{children:e.email}),(0,a.jsx)(n.nA,{children:e.role}),(0,a.jsx)(n.nA,{children:e.department_text||"-"}),(0,a.jsx)(n.nA,{children:e.reportsTo_text||"-"}),Y&&(0,a.jsx)(n.nA,{className:"text-right",children:(0,a.jsxs)(o.rI,{children:[(0,a.jsx)(o.ty,{asChild:!0,children:(0,a.jsx)(r.$,{variant:"ghost",size:"icon",children:(0,a.jsx)(x.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(o.SQ,{align:"end",children:[(0,a.jsxs)(o._2,{onClick:()=>W(e),className:"flex items-center w-full",children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,a.jsxs)(o._2,{className:"text-destructive focus:text-destructive focus:bg-destructive/10",onClick:()=>G(e.id),children:[(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})})]},e.id))})]})]})]}),J&&Y&&(0,a.jsx)(i.lG,{open:I,onOpenChange:e=>{e?B(!0):Q()},children:(0,a.jsxs)(i.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(i.c7,{children:[(0,a.jsxs)(i.L3,{className:"font-headline",children:["Edit Employee: ",J.name]}),(0,a.jsx)(i.rr,{children:"Make changes to the employee's details below."})]}),(0,a.jsx)(m.lV,{...$,children:(0,a.jsxs)("form",{onSubmit:$.handleSubmit(X),className:"space-y-4 py-4",children:[(0,a.jsx)(m.zB,{control:$.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Full Name"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(c.p,{...t})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"email",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Email Address"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(c.p,{type:"email",...t})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"role",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Role / Job Title"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a role"})})}),(0,a.jsx)(d.gC,{children:S.map(e=>(0,a.jsx)(d.eb,{value:e,children:e},e))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"department_text",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Department (Optional)"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a department (Optional)"})})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:T,children:"None"}),k.map(e=>(0,a.jsx)(d.eb,{value:e,children:e},e))]})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:$.control,name:"reportsTo_text",render:e=>{let{field:t}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Reports To (Supervisor or Team Lead - Optional)"}),(0,a.jsxs)(d.l6,{onValueChange:t.onChange,value:t.value||"",children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(d.bq,{children:(0,a.jsx)(d.yv,{placeholder:"Select a manager"})})}),(0,a.jsxs)(d.gC,{children:[(0,a.jsx)(d.eb,{value:T,children:"None"}),Z.map(e=>(0,a.jsxs)(d.eb,{value:e.name,children:[e.name," (",e.role,")"]},e.id))]})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsxs)(i.Es,{children:[(0,a.jsx)(i.HM,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"outline",onClick:Q,disabled:z,children:"Cancel"})}),(0,a.jsxs)(r.$,{type:"submit",disabled:z,children:[z?(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Save Changes"]})]})]})})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full p-4",children:(0,a.jsxs)(l.Zp,{className:"w-full max-w-md shadow-lg",children:[(0,a.jsx)(l.aR,{children:(0,a.jsx)(l.ZB,{className:"text-center",children:"Access Denied"})}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("p",{className:"text-center text-muted-foreground",children:"This page is for Supervisors only."}),(0,a.jsx)(r.$,{onClick:()=>s.push("/dashboard"),className:"w-full mt-6",children:"Go to Dashboard"})]})]})})}},30645:(e,t,s)=>{"use strict";s.d(t,{b:()=>n});let a={maxAttempts:4,delayMs:1e3,shouldRetry:e=>!!e&&"object"==typeof e&&!(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted"))&&!0!==e.isCircuitOpenError&&!0!==e.circuitJustOpened&&(0===e.status||502===e.status||503===e.status||504===e.status),context:"operation"};var r=function(e){return e.Closed="CLOSED",e.Open="OPEN",e.HalfOpen="HALF_OPEN",e}(r||{});let l=new Map;async function n(e,t){let s,r={...a,...t},n=r.context,o=(e,t)=>{let s="[withRetry:".concat(n,"] ").concat(e,". Circuit: ").concat(i.state,".");console.warn(s);let a=Error(s);throw a.isAbort=!0,a.context=n,t&&(a.originalError=t),a};l.has(n)||l.set(n,{state:"CLOSED",failures:0});let i=l.get(n);if("OPEN"===i.state)if(Date.now()<(i.openUntil||0)){let e=Error("Circuit for '".concat(n,"' is open due to repeated failures. Please try again in a few moments."));throw e.isCircuitOpenError=!0,e.context=n,e.openUntil=i.openUntil,e}else i.state="HALF_OPEN",i.failures=0,i.openUntil=void 0,console.log("[withRetry:".concat(n,"] Circuit is now HalfOpen. Allowing one attempt."));let c="HALF_OPEN"===i.state?1:r.maxAttempts;for(let t=1;t<=c;t++){var d,m,u;(null==(d=r.signal)?void 0:d.aborted)&&o("Aborted before attempt ".concat(t));try{let t=await e();return("HALF_OPEN"===i.state||i.failures>0||"OPEN"===i.state)&&(console.log("[withRetry:".concat(n,"] Circuit is now Closed due to successful attempt (was ").concat(i.state,").")),i.state="CLOSED",i.failures=0,i.openUntil=void 0),t}catch(e){if(s=e,(null==(m=r.signal)?void 0:m.aborted)&&o("Aborted during/after attempt ".concat(t," (caught error: ").concat((null==e?void 0:e.message)||e,")"),e),e&&"object"==typeof e&&(!0===e.isAbort||"string"==typeof e.message&&e.message.toLowerCase().includes("aborted")))throw console.warn("[withRetry:".concat(n,"] Caught abort-like error on attempt ").concat(t,": ").concat(e.message,". Circuit: ").concat(i.state,".")),e.isAbort||(e.isAbort=!0),e.context||(e.context=n),e;if(r.shouldRetry(e))if(r.onRetry&&r.onRetry(t,c,e),t<c){let e="HALF_OPEN"===i.state?r.delayMs:r.delayMs*Math.pow(2,t-1);await new Promise(t=>setTimeout(t,e)),(null==(u=r.signal)?void 0:u.aborted)&&o("Aborted during retry delay after attempt ".concat(t))}else throw console.warn("[withRetry:".concat(n,"] All ").concat(c," attempts failed (Circuit: ").concat(i.state,"). Last error: ").concat(e.message||JSON.stringify(e))),"HALF_OPEN"===i.state?(console.warn("[withRetry:".concat(n,"] Circuit failed in HalfOpen state. Re-opening.")),i.state="OPEN",i.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n):"CLOSED"===i.state&&(i.failures++,console.log("[withRetry:".concat(n,"] Circuit failure count: ").concat(i.failures," (max: ").concat(1,")")),i.failures>=1&&(console.warn("[withRetry:".concat(n,"] Circuit reached max failures. Opening circuit.")),i.state="OPEN",i.openUntil=Date.now()+3e4,s.circuitJustOpened=!0,s.context=n)),s;else throw e}}if(s)throw s;throw Error("[withRetry:".concat(n,"] Unexpected exit: Max attempts ").concat(c," reached without success or explicit error handling."))}},31949:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},59119:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>i,Zp:()=>n,aR:()=>o});var a=s(95155),r=s(12115),l=s(59434);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});n.displayName="Card";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...r})});o.displayName="CardHeader";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-xl md:text-2xl font-semibold leading-none tracking-tight",s),...r})});i.displayName="CardTitle";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},73158:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(40157).A)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},97841:(e,t,s)=>{"use strict";s.d(t,{Oc:()=>n,Qu:()=>c,Y$:()=>i,bV:()=>o});var a=s(30645);let r="employees",l=e=>({id:e.id,name:e.name,email:e.email,role:e.role,reportsTo_text:e.reportsTo_text,department_text:e.department_text,userId:e.userId,created:e.created?new Date(e.created):void 0,updated:e.updated?new Date(e.updated):void 0,collectionId:e.collectionId,collectionName:e.collectionName,expand:e.expand}),n=async(e,t)=>{try{let{onRetry:s,signal:n,...o}=t||{},i={sort:"name",fields:"id,name,email,role,department_text,reportsTo_text,userId,created,updated",...o};return(await (0,a.b)(()=>e.collection(r).getFullList(i,{signal:n}),{signal:n,context:"fetching employees list",onRetry:s})).map(l)}catch(e){throw e}},o=async(e,t,s)=>{try{let a=await e.collection(r).create(t,{signal:null==s?void 0:s.signal});return l(a)}catch(e){throw console.error("Failed to create employee:",e),e}},i=async(e,t,s,n)=>{try{let{signal:o}=n||{},i=await (0,a.b)(()=>e.collection(r).update(t,s,{signal:o}),{context:"updating employee ".concat(t),signal:o});return l(i)}catch(e){throw console.error("Failed to update employee ".concat(t,":"),e),e}},c=async(e,t,s)=>{try{let{signal:l}=s||{};await (0,a.b)(()=>e.collection(r).delete(t,{signal:l}),{context:"deleting employee ".concat(t),signal:l})}catch(e){throw console.error("Failed to delete employee ".concat(t,":"),e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[383,897,52,198,874,859,452,890,876,624,441,303,358],()=>t(7454)),_N_E=e.O()}]);