"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[726],{14636:(e,t,r)=>{r.d(t,{AM:()=>l,Wv:()=>o,hl:()=>c});var s=r(95155),a=r(12115),n=r(20547),i=r(59434);let l=n.bL,o=n.l9,c=a.forwardRef((e,t)=>{let{className:r,align:a="center",sideOffset:l=4,...o}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{ref:t,align:a,sideOffset:l,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...o})})});c.displayName=n.UC.displayName},34301:(e,t,r)=>{r.d(t,{A:()=>s});let s=(0,r(40157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},40968:(e,t,r)=>{r.d(t,{b:()=>l});var s=r(12115),a=r(63655),n=r(95155),i=s.forwardRef((e,t)=>(0,n.jsx)(a.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null==(r=e.onMouseDown)||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},46102:(e,t,r)=>{r.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>c,m_:()=>o});var s=r(95155),a=r(12115),n=r(89613),i=r(59434);let l=n.Kq,o=n.bL,c=n.l9,d=a.forwardRef((e,t)=>{let{className:r,sideOffset:a=4,...l}=e;return(0,s.jsx)(n.UC,{ref:t,sideOffset:a,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...l})});d.displayName=n.UC.displayName},62523:(e,t,r)=>{r.d(t,{p:()=>i});var s=r(95155),a=r(12115),n=r(59434);let i=a.forwardRef((e,t)=>{let{className:r,type:a,...i}=e;return(0,s.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...i})});i.displayName="Input"},66424:(e,t,r)=>{r.d(t,{F:()=>l});var s=r(95155),a=r(12115),n=r(47655),i=r(59434);let l=a.forwardRef((e,t)=>{let{className:r,children:a,...l}=e;return(0,s.jsxs)(n.bL,{ref:t,className:(0,i.cn)("relative overflow-hidden",r),...l,children:[(0,s.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:a}),(0,s.jsx)(o,{}),(0,s.jsx)(n.OK,{})]})});l.displayName=n.bL.displayName;let o=a.forwardRef((e,t)=>{let{className:r,orientation:a="vertical",...l}=e;return(0,s.jsx)(n.VM,{ref:t,orientation:a,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===a&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...l,children:(0,s.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});o.displayName=n.VM.displayName},76726:(e,t,r)=>{r.d(t,{A:()=>$});var s=r(95155),a=r(19164),n=r(44861),i=r(92759),l=r(80644),o=r(76959),c=r(74641),d=r(78039),u=r(39140),p=r(35476);function m(e,t){let r=(0,p.a)(e),s=(0,p.a)(t),a=x(r,s),n=Math.abs((0,u.m)(r,s));r.setDate(r.getDate()-a*n);let i=Number(x(r,s)===-a),l=a*(n-i);return 0===l?0:l}function x(e,t){let r=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return r<0?-1:r>0?1:r}var f=r(73168),h=r(70831),g=r(56313),y=r(12115),v=r(59434),b=r(59576),j=r(77694),N=r(87481),k=r(50172),w=r(31949),T=r(34301),D=r(40157);let M=(0,D.A)("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),I=(0,D.A)("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var A=r(965),S=r(73158);let C=(0,D.A)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var _=r(77223),P=r(81737),O=r(59119),E=r(30285),L=r(46102),R=r(62523),z=r(14636),V=r(85057),J=r(59409),X=r(91950),q=r(6874),F=r.n(q),Y=r(66424);let G=(e,t,r)=>{if("VALIDATION_PROJECT"===r&&t)return"bg-purple-500 hover:bg-purple-600";if(!e)return"bg-primary hover:bg-primary/90";switch(e.toLowerCase()){case"done":return"bg-green-500 hover:bg-green-600";case"in progress":return"bg-blue-500 hover:bg-blue-600";case"overdue":return"bg-red-500 hover:bg-red-600";case"blocked":return"bg-orange-500 hover:bg-orange-600";case"to do":return"bg-gray-400 hover:bg-gray-500";default:return"bg-primary hover:bg-primary/90"}},B=(e,t)=>{let r="An unexpected error occurred while ".concat(t||"processing your request",".");if(e&&"object"==typeof e){var s,a;"status"in e&&0===e.status?r="Failed to connect to the server while ".concat(t||"processing",". Please check your internet connection."):(null==(s=e.data)?void 0:s.message)?r=e.data.message:e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?r=e.message:(null==(a=e.originalError)?void 0:a.message)&&(r=e.originalError.message),"status"in e&&e.status&&0!==e.status&&(r="".concat(r," (Status: ").concat(e.status,")"))}else"string"==typeof e&&(r=e);return r},$=e=>{let{filterTaskType:t,displayHeaderControls:r="defaultTitle"}=e,{pbClient:u}=(0,b.A)(),{toast:x}=(0,N.dj)(),[D,q]=(0,y.useState)([]),[$,H]=(0,y.useState)(!0),[W,U]=(0,y.useState)(null),[Z,K]=(0,y.useState)((0,a.w)(new Date)),[Q,ee]=(0,y.useState)(30),[et,er]=(0,y.useState)(null),[es,ea]=(0,y.useState)(null),[en,ei]=(0,y.useState)(null),el=(0,y.useRef)(null),eo=(0,y.useRef)(null),ec=(0,y.useRef)(null),[ed,eu]=(0,y.useState)({taskId:null,currentTitle:"",currentTaskType:X.ci.find(e=>"VALIDATION_PROJECT"!==e)||X.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""}),[ep,em]=(0,y.useState)(!1),ex=(0,y.useCallback)(async(e,r)=>{if(!e)return void H(!0);H(!0),U(null);try{let s={signal:r};t?s.filter='task_type = "'.concat(t,'"'):s.filter='task_type != "VALIDATION_PROJECT"';let o=(await (0,j.x1)(e,s)).filter(e=>e.startDate&&e.dueDate&&(0,n.f)(new Date(e.startDate))&&(0,n.f)(new Date(e.dueDate)));if(q(o),o.length>0){let e=(0,i.j)(o.map(e=>(0,l.o)(new Date(e.startDate))));K((0,a.w)(e))}else K((0,a.w)(new Date))}catch(r){let e=(null==r?void 0:r.isAbort)===!0||"string"==typeof(null==r?void 0:r.message)&&r.message.toLowerCase().includes("autocancelled"),t=(null==r?void 0:r.status)===0&&!e;if(e)console.warn("GanttChart: Timeline tasks fetch request was ".concat((null==r?void 0:r.isAbort)?"aborted":"autocancelled","."),r);else if(t){let e=B(r,"fetching timeline data");U(e),x({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Timeline tasks fetch (network error):",e,r)}else{let e=B(r,"fetching timeline data");U(e),x({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Error fetching tasks for timeline (after retries):",e,r)}}finally{H(!1)}},[x,t]);(0,y.useEffect)(()=>{let e=new AbortController;return u?ex(u,e.signal):H(!0),()=>{e.abort()}},[u,ex]);let{tasksToDisplay:ef,chartStartDate:eh,chartEndDate:eg,totalDaysInView:ey,monthHeaders:ev}=(0,y.useMemo)(()=>{let e=D.map(e=>{let t=(0,l.o)(new Date(e.startDate)),r=(0,l.o)(new Date(e.dueDate));return{...e,startDate:t,dueDate:r,progress:"number"==typeof e.progress&&e.progress>=0&&e.progress<=100?e.progress:0,isMilestone:"VALIDATION_PROJECT"===e.task_type&&(!0===e.isMilestone||!1!==e.isMilestone&&(0,n.f)(t)&&(0,n.f)(r)&&(0,o.r)(t,r)),dependencies:Array.isArray(e.dependencies)?e.dependencies:[],steps:Array.isArray(e.steps)?e.steps:[]}}),t=(0,c.p)((0,d.P)(Z,2)),r=e.filter(e=>e.startDate<=t&&e.dueDate>=Z).sort((e,t)=>e.startDate.getTime()-t.startDate.getTime()),s=m(t,Z)+1,a=e=>(0,f.GP)(e,"MMM yyyy"),i=[];if(s>0){let e=new Date(Z),r={};for(;e<=t;){let t=a(e);r[t]=(r[t]||0)+1,e=(0,h.f)(e,1)}Object.entries(r).forEach(e=>{let[t,r]=e;i.push({name:t,span:r})})}return{tasksToDisplay:r,chartStartDate:Z,chartEndDate:t,totalDaysInView:s>0?s:0,monthHeaders:i}},[D,Z]),eb=(0,y.useMemo)(()=>{let e=new Map;return ef.forEach((t,r)=>{let s=t.startDate,a=t.dueDate;if(es&&es.taskId===t.id){var n;let e=Math.round(((null!=(n=es.currentMouseX)?n:es.initialMouseX)-es.initialMouseX)/Q);"drag"===es.type?(s=(0,h.f)(es.originalStartDate,e),a=(0,h.f)(es.originalDueDate,e)):"resize-start"===es.type?(s=(0,h.f)(es.originalStartDate,e),s=(0,i.j)([s,(0,h.f)(es.originalDueDate,-0)]),a=es.originalDueDate):"resize-end"===es.type&&(s=es.originalStartDate,a=(0,h.f)(es.originalDueDate,e),a=(0,g.T)([a,(0,h.f)(es.originalStartDate,0)]))}let l=(0,g.T)([s,eh]),o=(0,i.j)([a,eg]),c="VALIDATION_PROJECT"===t.task_type&&t.isMilestone;if(l>o&&!c)return;let d=m(l,eh),u=c?1:m(o,l)+1;if(u<=0&&!c)return;let p=d*Q,x=c?16:u*Q;c&&(p+=Q/2-8),e.set(t.id,{task:t,index:r,barStartX:p,barEndX:p+x,barWidth:x,barCenterY:48*r+24,isMilestoneRender:c,effectiveStartDate:s,effectiveDueDate:a})}),e},[ef,eh,eg,Q,es]),ej=(0,y.useMemo)(()=>{let e=[];return ef.forEach(t=>{if("VALIDATION_PROJECT"!==t.task_type||!t.dependencies||0===t.dependencies.length)return;let r=eb.get(t.id);r&&t.dependencies.forEach((s,a)=>{let n=eb.get(s);if(!n||"VALIDATION_PROJECT"!==n.task.task_type)return;let i=n.isMilestoneRender?n.barStartX+8:n.barEndX,l=n.barCenterY,o=r.isMilestoneRender?r.barStartX+8:r.barStartX,c=r.barCenterY;if(i>=o&&l===c)return;let d=i+15,u="M ".concat(i," ").concat(l," L ").concat(d," ").concat(l," L ").concat(d," ").concat(c," L ").concat(o," ").concat(c);e.push({id:"dep-".concat(s,"-to-").concat(t.id,"-").concat(a),d:u})})}),e},[ef,eb]),eN=(0,y.useCallback)(async(e,t)=>{if(!u)return;let r=D.find(t=>t.id===e);if(!r)return;let s={...t};t.startDate&&(s.startDate=new Date(t.startDate).toISOString()),t.dueDate&&(s.dueDate=new Date(t.dueDate).toISOString()),"VALIDATION_PROJECT"===r.task_type?(t.hasOwnProperty("isMilestone")&&(s.isMilestone=!!t.isMilestone),t.steps&&(s.steps=Array.isArray(t.steps)?t.steps:[])):(s.isMilestone=!1,s.dependencies=[],s.steps=[]);try{await (0,j.lC)(u,e,s),x({title:"Task Updated",description:'Task "'.concat(r.title,'" was successfully updated.')}),ex(u)}catch(e){x({title:"Update Failed",description:B(e,'updating task "'.concat(r.title,'"')),variant:"destructive"}),ex(u)}},[u,D,x,ex]),ek=(e,t)=>{if(0!==e.button||ep&&ed.taskId===t.id)return;let r=eb.get(t.id);r&&(e.preventDefault(),e.stopPropagation(),ea({type:"drag",taskId:t.id,initialMouseX:e.clientX,originalStartDate:r.effectiveStartDate,originalDueDate:r.effectiveDueDate}),ec.current&&(ec.current.style.cursor="grabbing"),document.body.style.userSelect="none")},ew=(e,t,r)=>{if(0!==e.button)return;let s=eb.get(t.id);s&&(e.preventDefault(),e.stopPropagation(),ea({type:"start"===r?"resize-start":"resize-end",taskId:t.id,initialMouseX:e.clientX,originalStartDate:s.effectiveStartDate,originalDueDate:s.effectiveDueDate}),ec.current&&(ec.current.style.cursor="ew-resize"),document.body.style.userSelect="none")},eT=(e,t)=>{var r;if(0!==e.button||"VALIDATION_PROJECT"!==t.task_type)return;let s=eb.get(t.id);if(!s||s.isMilestoneRender)return;e.preventDefault(),e.stopPropagation();let a=null==(r=ec.current)?void 0:r.getBoundingClientRect(),n=el.current;if(!a||!n)return;let i=e.clientX-a.left+n.scrollLeft,l=e.clientY-a.top+n.scrollTop-60;ei({sourceTaskId:t.id,sourceTaskBarEndX:s.barEndX,sourceTaskBarCenterY:s.barCenterY,currentMouseX:i,currentMouseY:l}),ec.current&&(ec.current.style.cursor="crosshair")},eD=e=>{eu({taskId:e.id,currentTitle:e.title,currentTaskType:e.task_type,currentInstrumentSubtype:e.instrument_subtype,currentStatus:e.status,currentProgress:e.progress||0,currentSteps:"VALIDATION_PROJECT"===e.task_type&&e.steps||[],newStepText:""}),em(!0)},eM=(e,t)=>{if(1!==e.detail||Math.abs(e.movementX)>2||Math.abs(e.movementY)>2)return;let r=e.target;r.classList.contains("resize-handle")||r.classList.contains("dependency-connector")||r.closest(".dependency-connector")||eD(t)},eI=(e,t)=>{"VALIDATION_PROJECT"===t.task_type&&(e.stopPropagation(),eD(t))},eA=()=>{""!==ed.newStepText.trim()&&eu(e=>({...e,currentSteps:[...e.currentSteps,e.newStepText.trim()],newStepText:""}))},eS=e=>{eu(t=>({...t,currentSteps:t.currentSteps.filter((t,r)=>r!==e)}))},eC=()=>{if(!ed.taskId)return;let e={title:ed.currentTitle,status:ed.currentStatus,progress:ed.currentProgress};"MDL"===ed.currentTaskType||"SOP"===ed.currentTaskType?e.instrument_subtype=ed.currentInstrumentSubtype:e.instrument_subtype=void 0,"VALIDATION_PROJECT"===ed.currentTaskType?e.steps=ed.currentSteps:e.steps=[],eN(ed.taskId,e),em(!1),eu({taskId:null,currentTitle:"",currentTaskType:X.ci.find(e=>"VALIDATION_PROJECT"!==e)||X.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""})};if((0,y.useEffect)(()=>{let e=e=>{if(es)ea(t=>t?{...t,currentMouseX:e.clientX}:null);else if(en&&ec.current){let t=ec.current.getBoundingClientRect(),r=el.current;if(!r)return;let s=e.clientX-t.left+r.scrollLeft,a=e.clientY-t.top+r.scrollTop-60;ei(e=>e?{...e,currentMouseX:s,currentMouseY:a}:null)}},t=e=>{if(es){let e=eb.get(es.taskId);e&&eN(es.taskId,{startDate:e.effectiveStartDate,dueDate:e.effectiveDueDate}),ea(null),ec.current&&(ec.current.style.cursor="default"),document.body.style.userSelect=""}else if(en){var t;let r=null==(t=ec.current)?void 0:t.getBoundingClientRect(),s=el.current;if(r&&s){let t=e.clientX-r.left+s.scrollLeft,a=e.clientY-r.top+s.scrollTop-60,n=null;for(let[e,r]of eb.entries()){if(e===en.sourceTaskId||"VALIDATION_PROJECT"!==r.task.task_type)continue;let s=48*r.index,i=s+48;if(a>=s&&a<=i&&t>=r.barStartX-Q/2&&t<=r.barStartX+Q/2){n=e;break}}if(n){let e=D.find(e=>e.id===en.sourceTaskId),t=D.find(e=>e.id===n);if(e&&t&&"VALIDATION_PROJECT"===e.task_type&&"VALIDATION_PROJECT"===t.task_type){let r=t.dependencies||[],s=e.dependencies||[];r.includes(e.id)||s.includes(t.id)?x({title:"Invalid Dependency",description:"Cannot create duplicate or circular dependency.",variant:"destructive"}):eN(t.id,{dependencies:[...r,e.id]})}}}ei(null),ec.current&&(ec.current.style.cursor="default")}};return(es||en)&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[es,en,Q,eb,eN,D,x]),(0,y.useEffect)(()=>{var e;let t=null,r=()=>{if("right"!==t){if(t="left",eo.current&&el.current){let e=el.current.querySelector(".timeline-inner-content-scrollable-body");e&&(e.scrollTop=eo.current.scrollTop)}requestAnimationFrame(()=>t=null)}},s=()=>{if("left"!==t){if(t="right",eo.current&&el.current){let e=el.current.querySelector(".timeline-inner-content-scrollable-body");e&&(eo.current.scrollTop=e.scrollTop)}requestAnimationFrame(()=>t=null)}},a=eo.current,n=null==(e=el.current)?void 0:e.querySelector(".timeline-inner-content-scrollable-body");return null==a||a.addEventListener("scroll",r),null==n||n.addEventListener("scroll",s),()=>{null==a||a.removeEventListener("scroll",r),null==n||n.removeEventListener("scroll",s)}},[ef]),$)return(0,s.jsxs)("div",{className:"flex justify-center items-center py-10 min-h-[300px]",children:[(0,s.jsx)(k.A,{className:"h-8 w-8 animate-spin text-primary"})," ",(0,s.jsx)("p",{className:"ml-2",children:"Loading timeline data..."})]});if(W)return(0,s.jsxs)("div",{className:"text-center py-10 min-h-[300px]",children:[(0,s.jsx)(w.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,s.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Timeline Data"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:W}),(0,s.jsx)(E.$,{onClick:()=>u&&ex(u),className:"mt-6",children:"Try Again"})]});let e_=(0,l.o)(new Date),eP=function(e,t){let r=+(0,p.a)(e),[s,a]=[+(0,p.a)(t.start),+(0,p.a)(t.end)].sort((e,t)=>e-t);return r>=s&&r<=a}(e_,{start:eh,end:eg}),eO=eP&&ey>0?m(e_,eh)*Q:0,eE=ey*Q,eL=48*ef.length,eR=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center text-sm",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:t?"No ".concat(t.replace(/_/g," ")," tasks found for current view."):"No tasks found for current view."}),(0,s.jsx)("p",{className:"text-xs mt-1 text-muted-foreground",children:0===D.length?"Ensure tasks have valid start/due dates.":"Try adjusting date range or zoom."})]});return(0,s.jsx)(L.Bc,{children:(0,s.jsxs)("div",{ref:ec,className:"gantt-chart-root flex flex-col h-[calc(100vh-200px)] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-border bg-card flex-shrink-0",children:["addValidationButton"===r?(0,s.jsx)(F(),{href:"/tasks/new?defaultType=VALIDATION_PROJECT",passHref:!0,children:(0,s.jsxs)(E.$,{variant:"outline",size:"sm",children:[(0,s.jsx)(T.A,{className:"mr-2 h-4 w-4"})," Add Validation Project"]})}):(0,s.jsx)("h2",{className:"text-lg font-semibold text-card-foreground",children:"Project Timeline"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.$,{variant:"outline",size:"icon",onClick:()=>ee(e=>Math.max(15,e-5)),disabled:Q<=15,title:"Zoom Out",children:(0,s.jsx)(M,{className:"h-4 w-4"})}),(0,s.jsx)(E.$,{variant:"outline",size:"icon",onClick:()=>ee(e=>Math.min(60,e+5)),disabled:Q>=60,title:"Zoom In",children:(0,s.jsx)(I,{className:"h-4 w-4"})}),(0,s.jsxs)(E.$,{variant:"outline",size:"sm",onClick:()=>K(e=>(0,d.P)(e,-1)),children:[(0,s.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"Prev"]}),(0,s.jsxs)("span",{className:"font-medium text-sm text-muted-foreground tabular-nums",children:[(0,f.GP)(Z,"MMM yyyy")," - ",(0,f.GP)((0,d.P)(Z,2),"MMM yyyy")]}),(0,s.jsxs)(E.$,{variant:"outline",size:"sm",onClick:()=>K(e=>(0,d.P)(e,1)),children:["Next",(0,s.jsx)(S.A,{className:"h-4 w-4 ml-1"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{style:{width:"".concat(450,"px")},className:"flex-shrink-0 bg-card border-r border-border flex flex-col",children:[(0,s.jsx)("div",{className:"h-[60px] flex items-center p-2 font-semibold text-xs border-b border-border flex-shrink-0 sticky top-0 bg-card z-20",children:(0,s.jsxs)("div",{className:"grid grid-cols-[40px_1fr_70px_70px_60px] w-full items-center gap-2",children:[(0,s.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"WBS"}),(0,s.jsx)("span",{className:"text-muted-foreground uppercase",children:"Task Name"}),(0,s.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Start"}),(0,s.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"End"}),(0,s.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Prog."})]})}),(0,s.jsxs)("div",{ref:eo,className:"overflow-y-auto flex-1",children:[0===ef.length&&!$&&eR(),ef.map((e,t)=>(0,s.jsxs)("div",{className:(0,v.cn)("grid grid-cols-[40px_1fr_70px_70px_60px] items-center gap-2 p-2 border-b border-border text-xs transition-opacity duration-150",e.id===et?"bg-primary/10 dark:bg-primary/20":"",es&&es.taskId!==e.id&&"draw-dependency"!==es.type||en&&en.sourceTaskId!==e.id||et&&e.id!==et?"opacity-60":"opacity-100"),style:{height:"".concat(48,"px")},onMouseEnter:()=>er(e.id),onMouseLeave:()=>er(null),children:[(0,s.jsx)("span",{className:"text-center text-muted-foreground",children:t+1}),(0,s.jsx)("span",{className:(0,v.cn)("font-medium truncate","VALIDATION_PROJECT"===e.task_type?"cursor-pointer hover:text-primary":"cursor-default"),title:e.title,onClick:t=>eI(t,e),children:e.title}),(0,s.jsx)("span",{className:"text-center text-[10px]",children:(0,f.GP)(e.startDate,"ddMMMyy")}),(0,s.jsx)("span",{className:"text-center text-[10px]",children:(0,f.GP)(e.dueDate,"ddMMMyy")}),(0,s.jsxs)("span",{className:"text-center text-[10px] font-semibold",children:[e.progress,"%"]})]},e.id))]})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",ref:el,children:(0,s.jsxs)("div",{className:"relative timeline-inner-content",children:[(0,s.jsxs)("div",{className:"sticky top-0 z-20 bg-card",children:[(0,s.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:ev.map(e=>"".concat(e.span*Q,"px")).join(" ")||"1fr"},children:[ev.map((e,t)=>(0,s.jsx)("div",{className:"flex items-center justify-center border-r border-border font-semibold text-xs",children:e.name},t)),0===ev.length&&(0,s.jsx)("div",{className:"h-full col-span-1"})]}),(0,s.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:"repeat(".concat(ey>0?ey:1,", ").concat(Q,"px)")},children:[Array.from({length:ey>0?ey:0}).map((e,t)=>{let r=(0,h.f)(eh,t);return(0,s.jsx)("div",{className:(0,v.cn)("flex items-center justify-center border-r border-border text-muted-foreground text-[10px]",(0,o.r)(r,e_)?"bg-primary/10 dark:bg-primary/20":""),title:(0,f.GP)(r,"EEE, MMM d"),children:(0,f.GP)(r,"d")},"".concat(t))}),ey<=0&&(0,s.jsx)("div",{className:"h-full col-span-1"})]})]}),(0,s.jsxs)("div",{className:"relative timeline-inner-content-scrollable-body",style:{height:"".concat(eL,"px"),width:"".concat(eE,"px")},children:[ef.length>0&&(0,s.jsxs)(s.Fragment,{children:[ef.map((e,t)=>(0,s.jsx)("div",{className:"absolute left-0 right-0 border-b border-border/30",style:{top:"".concat((t+1)*48-1,"px"),height:"1px",zIndex:1}},"row-line-".concat(t))),eP&&ey>0&&(0,s.jsx)("div",{className:"absolute top-0 bottom-0 w-[2px] bg-destructive/70 z-[5]",style:{left:"".concat(eO,"px")},title:"Today: ".concat((0,f.GP)(e_,"PPP")),children:(0,s.jsx)("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 bg-destructive text-white text-[8px] px-0.5 rounded-sm",children:"TODAY"})}),ef.map((e,t)=>{var r;let a=eb.get(e.id);if(!a)return null;let{barStartX:n,barWidth:i,isMilestoneRender:l}=a,o=(null==es?void 0:es.taskId)===e.id,c=(null==en?void 0:en.sourceTaskId)===e.id;return(0,s.jsxs)(z.AM,{open:ep&&ed.taskId===e.id,onOpenChange:t=>{t?e.id!==ed.taskId&&eD(e):(em(!1),eu({taskId:null,currentTitle:"",currentTaskType:X.ci.find(e=>"VALIDATION_PROJECT"!==e)||X.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""}))},children:[(0,s.jsxs)(L.m_,{delayDuration:o||c||ep&&ed.taskId===e.id?999999:100,children:[(0,s.jsx)(L.k$,{asChild:!0,children:(0,s.jsx)(z.Wv,{asChild:!0,children:(0,s.jsxs)("div",{onMouseDown:t=>ek(t,e),onClick:t=>eM(t,e),onMouseEnter:()=>er(e.id),onMouseLeave:()=>er(null),className:(0,v.cn)("absolute transition-opacity duration-150 ease-in-out group cursor-grab z-10 flex items-center justify-center",G(e.status,l,e.task_type),!l&&"rounded-sm",o||c?"ring-2 ring-ring ring-offset-background ring-offset-1 shadow-lg":e.id===et?"ring-1 ring-primary/70":"",es&&es.taskId!==e.id||en&&en.sourceTaskId!==e.id||et&&e.id!==et?"opacity-50":"opacity-100"),style:{left:"".concat(n,"px"),width:"".concat(i<0?0:i,"px"),top:"".concat(48*t+(l?16:8),"px"),height:l?"".concat(16,"px"):"".concat(32,"px")},children:[!l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"resize-handle absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>ew(t,e,"start"),title:"Resize start date",children:(0,s.jsx)(C,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),(0,s.jsx)("div",{className:"resize-handle absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>ew(t,e,"end"),title:"Resize end date",children:(0,s.jsx)(C,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),"VALIDATION_PROJECT"===e.task_type&&(0,s.jsx)("div",{className:"dependency-connector absolute right-[-6px] top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary border-2 border-background cursor-crosshair z-30 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:t=>eT(t,e),title:"Draw dependency"})]}),!l&&(null==(r=e.status)?void 0:r.toLowerCase())!=="done"&&void 0!==e.progress&&e.progress>0&&i>0&&(0,s.jsx)("div",{className:"absolute top-0 left-0 h-full bg-black/40 rounded-sm",style:{width:"".concat(e.progress,"%")}}),l&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("svg",{viewBox:"0 0 100 100",className:"w-full h-full fill-current text-white/80",preserveAspectRatio:"none",children:(0,s.jsx)("polygon",{points:"50,0 100,50 50,100 0,50"})})}),!l&&i>.75*Q&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center px-1.5 overflow-hidden",children:(0,s.jsx)("span",{className:"text-[10px] text-white/90 font-medium whitespace-nowrap overflow-hidden text-ellipsis",children:e.title})})]})})}),(0,s.jsx)(L.ZI,{className:"p-2 shadow-lg bg-popover text-popover-foreground rounded-md border max-w-xs w-auto z-50",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"font-semibold text-sm",children:[e.title,"VALIDATION_PROJECT"===e.task_type&&e.isMilestone?" (Milestone)":""]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Type: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.task_type.replace(/_/g," ")})]}),("MDL"===e.task_type||"SOP"===e.task_type)&&e.instrument_subtype&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Subtype: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.instrument_subtype})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Status: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.status})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Priority: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.priority})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Progress: ",(0,s.jsxs)("span",{className:"font-medium text-foreground",children:[e.progress||0,"%"]})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Dates: ",(0,f.GP)(e.startDate,"MMM d, yy")," - ",(0,f.GP)(e.dueDate,"MMM d, yy")]}),e.assignedTo_text&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to: ",(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.assignedTo_text})]}),"VALIDATION_PROJECT"===e.task_type&&e.dependencies&&e.dependencies.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Depends on:"}),(0,s.jsx)("ul",{className:"list-disc list-inside pl-2 space-y-0.5",children:e.dependencies.map(e=>{let t=D.find(t=>t.id===e);return(0,s.jsx)("li",{className:"text-xs font-medium text-foreground truncate",title:null==t?void 0:t.title,children:(null==t?void 0:t.title)||"Unknown Task"},e)})})]}),"VALIDATION_PROJECT"===e.task_type&&(!e.dependencies||0===e.dependencies.length)&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Dependencies: None"}),"VALIDATION_PROJECT"===e.task_type&&e.steps&&e.steps.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Steps:"}),(0,s.jsx)(Y.F,{className:"max-h-20",children:(0,s.jsx)("ul",{className:"list-decimal list-inside pl-2 space-y-0.5",children:e.steps.map((e,t)=>(0,s.jsx)("li",{className:"text-xs font-medium text-foreground truncate",title:e,children:e},t))})})]})]})})]}),(0,s.jsx)(z.hl,{className:"w-96 z-50",side:"bottom",align:"start",children:(0,s.jsxs)("div",{className:"grid gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h4",{className:"font-medium leading-none",children:["Quick Edit: ",ed.currentTitle]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Modify task details."})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,s.jsx)(V.J,{htmlFor:"qe-title-".concat(e.id),children:"Name"}),(0,s.jsx)(R.p,{id:"qe-title-".concat(e.id),value:ed.currentTitle,onChange:e=>eu(t=>({...t,currentTitle:e.target.value})),className:"col-span-2 h-8"})]}),"VALIDATION_PROJECT"!==ed.currentTaskType&&("MDL"===ed.currentTaskType||"SOP"===ed.currentTaskType)&&(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,s.jsx)(V.J,{htmlFor:"qe-instrument-".concat(e.id),children:"Subtype"}),(0,s.jsxs)(J.l6,{value:ed.currentInstrumentSubtype||"",onValueChange:e=>eu(t=>({...t,currentInstrumentSubtype:e})),children:[(0,s.jsx)(J.bq,{id:"qe-instrument-".concat(e.id),className:"col-span-2 h-8",children:(0,s.jsx)(J.yv,{placeholder:"Select subtype"})}),(0,s.jsx)(J.gC,{children:("MDL"===ed.currentTaskType?X.oe:X.tk).map(e=>(0,s.jsx)(J.eb,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,s.jsx)(V.J,{htmlFor:"qe-status-".concat(e.id),children:"Status"}),(0,s.jsxs)(J.l6,{value:ed.currentStatus,onValueChange:e=>eu(t=>({...t,currentStatus:e})),children:[(0,s.jsx)(J.bq,{id:"qe-status-".concat(e.id),className:"col-span-2 h-8",children:(0,s.jsx)(J.yv,{placeholder:"Select status"})}),(0,s.jsx)(J.gC,{children:X.Hi.map(e=>(0,s.jsx)(J.eb,{value:e,children:e},e))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,s.jsx)(V.J,{htmlFor:"qe-progress-".concat(e.id),children:"Progress (%)"}),(0,s.jsx)(R.p,{id:"qe-progress-".concat(e.id),type:"number",min:"0",max:"100",value:ed.currentProgress,onChange:e=>eu(t=>({...t,currentProgress:parseInt(e.target.value,10)||0})),className:"col-span-2 h-8"})]}),"VALIDATION_PROJECT"===ed.currentTaskType&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(V.J,{children:"Steps"}),ed.currentSteps.length>0&&(0,s.jsx)(Y.F,{className:"h-24 rounded-md border p-2",children:ed.currentSteps.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 py-1",children:[(0,s.jsxs)("span",{className:"text-sm flex-1 truncate",title:e,children:[t+1,". ",e]}),(0,s.jsx)(E.$,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>eS(t),children:(0,s.jsx)(_.A,{className:"h-3.5 w-3.5 text-destructive"})})]},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(R.p,{placeholder:"New step description",value:ed.newStepText,onChange:e=>eu(t=>({...t,newStepText:e.target.value})),className:"h-8 flex-1"}),(0,s.jsxs)(E.$,{type:"button",size:"sm",onClick:eA,className:"h-8",children:[(0,s.jsx)(P.A,{className:"mr-1 h-4 w-4"})," Add"]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,s.jsx)(E.$,{variant:"ghost",size:"sm",onClick:()=>em(!1),children:"Cancel"}),(0,s.jsxs)(E.$,{size:"sm",onClick:eC,children:[(0,s.jsx)(O.A,{className:"mr-1 h-4 w-4"}),"Save"]})]})]})})]},"".concat(e.id,"-popover"))}),en&&(0,s.jsx)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-40",style:{width:eE,height:eL},children:(0,s.jsx)("line",{x1:en.sourceTaskBarEndX,y1:en.sourceTaskBarCenterY,x2:en.currentMouseX,y2:en.currentMouseY,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeDasharray:"4 2"})}),ej.length>0&&(0,s.jsxs)("svg",{className:"absolute top-0 left-0 pointer-events-none",width:eE,height:eL,xmlns:"http://www.w3.org/2000/svg",style:{zIndex:20},children:[(0,s.jsx)("defs",{children:(0,s.jsx)("marker",{id:"arrowhead",markerWidth:6,markerHeight:4,refX:5.5,refY:2,orient:"auto-start-reverse",children:(0,s.jsx)("polygon",{points:"0 0, ".concat(5," ").concat(2,", 0 ").concat(4),fill:"hsl(var(--foreground) / 0.6)"})})}),ej.map(e=>(0,s.jsx)("path",{d:e.d,stroke:"hsl(var(--foreground) / 0.6)",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"},e.id))]})]}),0===ef.length&&!$&&(0,s.jsx)("div",{style:{height:144},className:"flex items-center justify-center",children:eR()})]})]})})]})]})})}},77223:(e,t,r)=>{r.d(t,{A:()=>s});let s=(0,r(40157).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},81737:(e,t,r)=>{r.d(t,{A:()=>s});let s=(0,r(40157).A)("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]])},85057:(e,t,r)=>{r.d(t,{J:()=>c});var s=r(95155),a=r(12115),n=r(40968),i=r(74466),l=r(59434);let o=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(n.b,{ref:t,className:(0,l.cn)(o(),r),...a})});c.displayName=n.b.displayName}}]);