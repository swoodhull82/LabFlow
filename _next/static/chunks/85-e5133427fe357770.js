"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[85],{34301:(e,t,s)=>{s.d(t,{A:()=>r});let r=(0,s(40157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},37140:(e,t,s)=>{s.d(t,{a:()=>n});var r=s(78039);function n(e,t){return(0,r.P)(e,-t)}},46102:(e,t,s)=>{s.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>o,m_:()=>c});var r=s(95155),n=s(12115),a=s(89613),i=s(59434);let l=a.Kq,c=a.bL,o=a.l9,d=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...l}=e;return(0,r.jsx)(a.UC,{ref:t,sideOffset:n,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})});d.displayName=a.UC.displayName},60085:(e,t,s)=>{s.d(t,{A:()=>H});var r=s(95155),n=s(19164),a=s(44861),i=s(92759),l=s(80644),c=s(76959),o=s(74641),d=s(78039),u=s(39140),p=s(35476);function m(e,t){let s=(0,p.a)(e),r=(0,p.a)(t),n=x(s,r),a=Math.abs((0,u.m)(s,r));s.setDate(s.getDate()-n*a);let i=Number(x(s,r)===-n),l=n*(a-i);return 0===l?0:l}function x(e,t){let s=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return s<0?-1:s>0?1:s}var h=s(73168),f=s(70831),g=s(56313),y=s(37140),v=s(12115),j=s(59434),b=s(59576),k=s(77694),N=s(87481),T=s(50172),w=s(31949),D=s(34301),S=s(40157);let M=(0,S.A)("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),I=(0,S.A)("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var A=s(965),C=s(73158);let _=(0,S.A)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);var P=s(77223),E=s(81737),O=s(59119),L=s(30285),z=s(46102),R=s(62523),V=s(14636),X=s(85057),J=s(59409),q=s(91950),Y=s(6874),F=s.n(Y),G=s(66424);let B=(e,t,s)=>{if("VALIDATION_PROJECT"===s&&t)return"bg-purple-500 hover:bg-purple-600";if(!e)return"bg-primary hover:bg-primary/90";switch(e.toLowerCase()){case"done":return"bg-green-500 hover:bg-green-600";case"in progress":return"bg-blue-500 hover:bg-blue-600";case"overdue":return"bg-red-500 hover:bg-red-600";case"blocked":return"bg-orange-500 hover:bg-orange-600";case"to do":return"bg-gray-400 hover:bg-gray-500";default:return"bg-primary hover:bg-primary/90"}},$=(e,t)=>{let s="An unexpected error occurred while ".concat(t||"processing your request",".");if(e&&"object"==typeof e){var r,n;"status"in e&&0===e.status?s="Failed to connect to the server while ".concat(t||"processing",". Please check your internet connection."):(null==(r=e.data)?void 0:r.message)?s=e.data.message:e.message&&!e.message.startsWith("PocketBase_ClientResponseError")?s=e.message:(null==(n=e.originalError)?void 0:n.message)&&(s=e.originalError.message),"status"in e&&e.status&&0!==e.status&&(s="".concat(s," (Status: ").concat(e.status,")"))}else"string"==typeof e&&(s=e);return s},H=e=>{let{filterTaskType:t,displayHeaderControls:s="defaultTitle"}=e,{pbClient:u}=(0,b.A)(),{toast:x}=(0,N.dj)(),[S,Y]=(0,v.useState)([]),[H,W]=(0,v.useState)(!0),[Z,U]=(0,v.useState)(null),[K,Q]=(0,v.useState)((0,n.w)(new Date)),[ee,et]=(0,v.useState)(30),[es,er]=(0,v.useState)(null),[en,ea]=(0,v.useState)(null),[ei,el]=(0,v.useState)(null),ec=(0,v.useRef)(null),eo=(0,v.useRef)(null),ed=(0,v.useRef)(null),[eu,ep]=(0,v.useState)({taskId:null,currentTitle:"",currentTaskType:q.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""}),[em,ex]=(0,v.useState)(!1),eh=(0,v.useCallback)(async(e,s)=>{if(!e)return void W(!0);W(!0),U(null);try{let r={signal:s};t?r.filter='task_type = "'.concat(t,'"'):r.filter='task_type != "VALIDATION_PROJECT"';let c=(await (0,k.x1)(e,r)).filter(e=>e.startDate&&e.dueDate&&(0,a.f)(new Date(e.startDate))&&(0,a.f)(new Date(e.dueDate)));if(Y(c),c.length>0){let e=(0,i.j)(c.map(e=>(0,l.o)(new Date(e.startDate))));Q((0,n.w)(e))}else Q((0,n.w)(new Date))}catch(s){let e=(null==s?void 0:s.isAbort)===!0||"string"==typeof(null==s?void 0:s.message)&&s.message.toLowerCase().includes("autocancelled"),t=(null==s?void 0:s.status)===0&&!e;if(e)console.warn("GanttChart: Timeline tasks fetch request was ".concat((null==s?void 0:s.isAbort)?"aborted":"autocancelled","."),s);else if(t){let e=$(s,"fetching timeline data");U(e),x({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Timeline tasks fetch (network error):",e,s)}else{let e=$(s,"fetching timeline data");U(e),x({title:"Error Loading Timeline Data",description:e,variant:"destructive"}),console.warn("GanttChart: Error fetching tasks for timeline (after retries):",e,s)}}finally{W(!1)}},[x,t]);(0,v.useEffect)(()=>{let e=new AbortController;return u?eh(u,e.signal):W(!0),()=>{e.abort()}},[u,eh]);let{tasksToDisplay:ef,chartStartDate:eg,chartEndDate:ey,totalDaysInView:ev,monthHeaders:ej}=(0,v.useMemo)(()=>{let e=S.map(e=>{let t=(0,l.o)(new Date(e.startDate)),s=(0,l.o)(new Date(e.dueDate));return{...e,startDate:t,dueDate:s,progress:"number"==typeof e.progress&&e.progress>=0&&e.progress<=100?e.progress:0,isMilestone:"VALIDATION_PROJECT"===e.task_type&&(!0===e.isMilestone||!1!==e.isMilestone&&(0,a.f)(t)&&(0,a.f)(s)&&(0,c.r)(t,s)),dependencies:Array.isArray(e.dependencies)?e.dependencies:[],steps:Array.isArray(e.steps)?e.steps:[]}}),t=(0,o.p)((0,d.P)(K,2)),s=e.filter(e=>e.startDate<=t&&e.dueDate>=K).sort((e,t)=>e.startDate.getTime()-t.startDate.getTime()),r=m(t,K)+1,n=e=>(0,h.GP)(e,"MMM yyyy"),i=[];if(r>0){let e=new Date(K),s={};for(;e<=t;){let t=n(e);s[t]=(s[t]||0)+1,e=(0,f.f)(e,1)}Object.entries(s).forEach(e=>{let[t,s]=e;i.push({name:t,span:s})})}return{tasksToDisplay:s,chartStartDate:K,chartEndDate:t,totalDaysInView:r>0?r:0,monthHeaders:i}},[S,K]),eb=(0,v.useMemo)(()=>{let e=new Map;return ef.forEach((t,s)=>{let r=t.startDate,n=t.dueDate;if(en&&en.taskId===t.id){var a;let e=Math.round(((null!=(a=en.currentMouseX)?a:en.initialMouseX)-en.initialMouseX)/ee);"drag"===en.type?(r=(0,f.f)(en.originalStartDate,e),n=(0,f.f)(en.originalDueDate,e)):"resize-start"===en.type?(r=(0,f.f)(en.originalStartDate,e),r=(0,i.j)([r,(0,f.f)(en.originalDueDate,-0)]),n=en.originalDueDate):"resize-end"===en.type&&(r=en.originalStartDate,n=(0,f.f)(en.originalDueDate,e),n=(0,g.T)([n,(0,f.f)(en.originalStartDate,0)]))}let l=(0,g.T)([r,eg]),c=(0,i.j)([n,ey]),o="VALIDATION_PROJECT"===t.task_type&&t.isMilestone;if(l>c&&!o)return;let d=m(l,eg),u=o?1:m(c,l)+1;if(u<=0&&!o)return;let p=d*ee,x=o?16:u*ee;o&&(p+=ee/2-8),e.set(t.id,{task:t,index:s,barStartX:p,barEndX:p+x,barWidth:x,barCenterY:48*s+24,isMilestoneRender:o,effectiveStartDate:r,effectiveDueDate:n})}),e},[ef,eg,ey,ee,en]),ek=(0,v.useMemo)(()=>{let e=[];return ef.forEach(t=>{if("VALIDATION_PROJECT"!==t.task_type||!t.dependencies||0===t.dependencies.length)return;let s=eb.get(t.id);s&&t.dependencies.forEach((r,n)=>{let a=eb.get(r);if(!a||"VALIDATION_PROJECT"!==a.task.task_type)return;let i=a.isMilestoneRender?a.barStartX+8:a.barEndX,l=a.barCenterY,c=s.isMilestoneRender?s.barStartX+8:s.barStartX,o=s.barCenterY;if(i>=c&&l===o)return;let d=i+15,u="M ".concat(i," ").concat(l," L ").concat(d," ").concat(l," L ").concat(d," ").concat(o," L ").concat(c," ").concat(o);e.push({id:"dep-".concat(r,"-to-").concat(t.id,"-").concat(n),d:u})})}),e},[ef,eb]),eN=(0,v.useCallback)(async(e,t)=>{if(!u)return;let s=S.find(t=>t.id===e);if(!s)return;let r={...t};t.startDate&&(r.startDate=new Date(t.startDate).toISOString()),t.dueDate&&(r.dueDate=new Date(t.dueDate).toISOString()),"VALIDATION_PROJECT"===s.task_type?(t.hasOwnProperty("isMilestone")&&(r.isMilestone=!!t.isMilestone),t.steps&&(r.steps=Array.isArray(t.steps)?t.steps:[])):(r.isMilestone=!1,r.dependencies=[],r.steps=[]);try{await (0,k.lC)(u,e,r),x({title:"Task Updated",description:'Task "'.concat(s.title,'" was successfully updated.')}),eh(u)}catch(e){x({title:"Update Failed",description:$(e,'updating task "'.concat(s.title,'"')),variant:"destructive"}),eh(u)}},[u,S,x,eh]),eT=(e,t)=>{if(0!==e.button||em&&eu.taskId===t.id)return;let s=eb.get(t.id);s&&(e.preventDefault(),e.stopPropagation(),ea({type:"drag",taskId:t.id,initialMouseX:e.clientX,originalStartDate:s.effectiveStartDate,originalDueDate:s.effectiveDueDate}),ed.current&&(ed.current.style.cursor="grabbing"),document.body.style.userSelect="none")},ew=(e,t,s)=>{if(0!==e.button)return;let r=eb.get(t.id);r&&(e.preventDefault(),e.stopPropagation(),ea({type:"start"===s?"resize-start":"resize-end",taskId:t.id,initialMouseX:e.clientX,originalStartDate:r.effectiveStartDate,originalDueDate:r.effectiveDueDate}),ed.current&&(ed.current.style.cursor="ew-resize"),document.body.style.userSelect="none")},eD=(e,t)=>{var s;if(0!==e.button||"VALIDATION_PROJECT"!==t.task_type)return;let r=eb.get(t.id);if(!r||r.isMilestoneRender)return;e.preventDefault(),e.stopPropagation();let n=null==(s=ed.current)?void 0:s.getBoundingClientRect(),a=ec.current;if(!n||!a)return;let i=e.clientX-n.left+a.scrollLeft,l=e.clientY-n.top+a.scrollTop-60;el({sourceTaskId:t.id,sourceTaskBarEndX:r.barEndX,sourceTaskBarCenterY:r.barCenterY,currentMouseX:i,currentMouseY:l}),ed.current&&(ed.current.style.cursor="crosshair")},eS=(e,t)=>{if(1!==e.detail||Math.abs(e.movementX)>2||Math.abs(e.movementY)>2)return;let s=e.target;s.classList.contains("resize-handle")||s.classList.contains("dependency-connector")||s.closest(".dependency-connector")||(ep({taskId:t.id,currentTitle:t.title,currentTaskType:t.task_type,currentInstrumentSubtype:t.instrument_subtype,currentStatus:t.status,currentProgress:t.progress||0,currentSteps:"VALIDATION_PROJECT"===t.task_type&&t.steps||[],newStepText:""}),ex(!0))},eM=()=>{""!==eu.newStepText.trim()&&ep(e=>({...e,currentSteps:[...e.currentSteps,e.newStepText.trim()],newStepText:""}))},eI=e=>{ep(t=>({...t,currentSteps:t.currentSteps.filter((t,s)=>s!==e)}))},eA=()=>{if(!eu.taskId)return;let e={title:eu.currentTitle,status:eu.currentStatus,progress:eu.currentProgress};"MDL"===eu.currentTaskType||"SOP"===eu.currentTaskType?e.instrument_subtype=eu.currentInstrumentSubtype:e.instrument_subtype=void 0,"VALIDATION_PROJECT"===eu.currentTaskType?e.steps=eu.currentSteps:e.steps=[],eN(eu.taskId,e),ex(!1),ep({taskId:null,currentTitle:"",currentTaskType:q.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""})};if((0,v.useEffect)(()=>{let e=e=>{if(en)ea(t=>t?{...t,currentMouseX:e.clientX}:null);else if(ei&&ed.current){let t=ed.current.getBoundingClientRect(),s=ec.current;if(!s)return;let r=e.clientX-t.left+s.scrollLeft,n=e.clientY-t.top+s.scrollTop-60;el(e=>e?{...e,currentMouseX:r,currentMouseY:n}:null)}},t=e=>{if(en){let e=eb.get(en.taskId);e&&eN(en.taskId,{startDate:e.effectiveStartDate,dueDate:e.effectiveDueDate}),ea(null),ed.current&&(ed.current.style.cursor="default"),document.body.style.userSelect=""}else if(ei){var t;let s=null==(t=ed.current)?void 0:t.getBoundingClientRect(),r=ec.current;if(s&&r){let t=e.clientX-s.left+r.scrollLeft,n=e.clientY-s.top+r.scrollTop-60,a=null;for(let[e,s]of eb.entries()){if(e===ei.sourceTaskId||"VALIDATION_PROJECT"!==s.task.task_type)continue;let r=48*s.index,i=r+48;if(n>=r&&n<=i&&t>=s.barStartX-ee/2&&t<=s.barStartX+ee/2){a=e;break}}if(a){let e=S.find(e=>e.id===ei.sourceTaskId),t=S.find(e=>e.id===a);if(e&&t&&"VALIDATION_PROJECT"===e.task_type&&"VALIDATION_PROJECT"===t.task_type){let s=t.dependencies||[],r=e.dependencies||[];s.includes(e.id)||r.includes(t.id)?x({title:"Invalid Dependency",description:"Cannot create duplicate or circular dependency.",variant:"destructive"}):eN(t.id,{dependencies:[...s,e.id]})}}}el(null),ed.current&&(ed.current.style.cursor="default")}};return(en||ei)&&(window.addEventListener("mousemove",e),window.addEventListener("mouseup",t)),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[en,ei,ee,eb,eN,S,x]),(0,v.useEffect)(()=>{var e;let t=null,s=()=>{if("right"!==t){if(t="left",eo.current&&ec.current){let e=ec.current.querySelector(".timeline-inner-content-scrollable-body");e&&(e.scrollTop=eo.current.scrollTop)}requestAnimationFrame(()=>t=null)}},r=()=>{if("left"!==t){if(t="right",eo.current&&ec.current){let e=ec.current.querySelector(".timeline-inner-content-scrollable-body");e&&(eo.current.scrollTop=e.scrollTop)}requestAnimationFrame(()=>t=null)}},n=eo.current,a=null==(e=ec.current)?void 0:e.querySelector(".timeline-inner-content-scrollable-body");return null==n||n.addEventListener("scroll",s),null==a||a.addEventListener("scroll",r),()=>{null==n||n.removeEventListener("scroll",s),null==a||a.removeEventListener("scroll",r)}},[ef]),H)return(0,r.jsxs)("div",{className:"flex justify-center items-center py-10 min-h-[300px]",children:[(0,r.jsx)(T.A,{className:"h-8 w-8 animate-spin text-primary"})," ",(0,r.jsx)("p",{className:"ml-2",children:"Loading timeline data..."})]});if(Z)return(0,r.jsxs)("div",{className:"text-center py-10 min-h-[300px]",children:[(0,r.jsx)(w.A,{className:"mx-auto h-12 w-12 text-destructive"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"Failed to Load Timeline Data"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:Z}),(0,r.jsx)(L.$,{onClick:()=>u&&eh(u),className:"mt-6",children:"Try Again"})]});let eC=(0,l.o)(new Date),e_=function(e,t){let s=+(0,p.a)(e),[r,n]=[+(0,p.a)(t.start),+(0,p.a)(t.end)].sort((e,t)=>e-t);return s>=r&&s<=n}(eC,{start:eg,end:ey}),eP=e_&&ev>0?m(eC,eg)*ee:0,eE=ev*ee,eO=48*ef.length,eL=()=>(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-4 text-center text-sm",children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:t?"No ".concat(t.replace(/_/g," ")," tasks found for current view."):"No tasks found for current view."}),(0,r.jsx)("p",{className:"text-xs mt-1 text-muted-foreground",children:0===S.length?"Ensure tasks have valid start/due dates.":"Try adjusting date range or zoom."})]});return(0,r.jsx)(z.Bc,{children:(0,r.jsxs)("div",{ref:ed,className:"gantt-chart-root flex flex-col h-[calc(100vh-200px)] overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-2 border-b border-border bg-card flex-shrink-0",children:["addValidationButton"===s?(0,r.jsx)(F(),{href:"/tasks/new?defaultType=VALIDATION_PROJECT",passHref:!0,children:(0,r.jsxs)(L.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Add Validation Project"]})}):(0,r.jsx)("h2",{className:"text-lg font-semibold text-card-foreground",children:"Project Timeline"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(L.$,{variant:"outline",size:"icon",onClick:()=>et(e=>Math.max(15,e-5)),disabled:ee<=15,title:"Zoom Out",children:(0,r.jsx)(M,{className:"h-4 w-4"})}),(0,r.jsx)(L.$,{variant:"outline",size:"icon",onClick:()=>et(e=>Math.min(60,e+5)),disabled:ee>=60,title:"Zoom In",children:(0,r.jsx)(I,{className:"h-4 w-4"})}),(0,r.jsxs)(L.$,{variant:"outline",size:"sm",onClick:()=>Q(e=>(0,y.a)(e,1)),children:[(0,r.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"Prev"]}),(0,r.jsxs)("span",{className:"font-medium text-sm text-muted-foreground tabular-nums",children:[(0,h.GP)(K,"MMM yyyy")," - ",(0,h.GP)((0,d.P)(K,2),"MMM yyyy")]}),(0,r.jsxs)(L.$,{variant:"outline",size:"sm",onClick:()=>Q(e=>(0,d.P)(e,1)),children:["Next",(0,r.jsx)(C.A,{className:"h-4 w-4 ml-1"})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,r.jsxs)("div",{style:{width:"".concat(450,"px")},className:"flex-shrink-0 bg-card border-r border-border flex flex-col",children:[(0,r.jsx)("div",{className:"h-[60px] flex items-center p-2 font-semibold text-xs border-b border-border flex-shrink-0 sticky top-0 bg-card z-20",children:(0,r.jsxs)("div",{className:"grid grid-cols-[40px_1fr_70px_70px_60px] w-full items-center gap-2",children:[(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"WBS"}),(0,r.jsx)("span",{className:"text-muted-foreground uppercase",children:"Task Name"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Start"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"End"}),(0,r.jsx)("span",{className:"text-center text-muted-foreground uppercase",children:"Prog."})]})}),(0,r.jsxs)("div",{ref:eo,className:"overflow-y-auto flex-1",children:[0===ef.length&&!H&&eL(),ef.map((e,t)=>(0,r.jsxs)("div",{className:(0,j.cn)("grid grid-cols-[40px_1fr_70px_70px_60px] items-center gap-2 p-2 border-b border-border text-xs transition-opacity duration-150",e.id===es?"bg-primary/10 dark:bg-primary/20":"",en&&en.taskId!==e.id&&"draw-dependency"!==en.type||ei&&ei.sourceTaskId!==e.id||es&&e.id!==es?"opacity-60":"opacity-100"),style:{height:"".concat(48,"px")},onMouseEnter:()=>er(e.id),onMouseLeave:()=>er(null),children:[(0,r.jsx)("span",{className:"text-center text-muted-foreground",children:t+1}),(0,r.jsx)("span",{className:"font-medium truncate cursor-default",title:e.title,children:e.title}),(0,r.jsx)("span",{className:"text-center text-[10px]",children:(0,h.GP)(e.startDate,"ddMMMyy")}),(0,r.jsx)("span",{className:"text-center text-[10px]",children:(0,h.GP)(e.dueDate,"ddMMMyy")}),(0,r.jsxs)("span",{className:"text-center text-[10px] font-semibold",children:[e.progress,"%"]})]},e.id))]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-auto",ref:ec,children:(0,r.jsxs)("div",{className:"relative timeline-inner-content",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-20 bg-card",children:[(0,r.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:ej.map(e=>"".concat(e.span*ee,"px")).join(" ")||"1fr"},children:[ej.map((e,t)=>(0,r.jsx)("div",{className:"flex items-center justify-center border-r border-border font-semibold text-xs",children:e.name},t)),0===ej.length&&(0,r.jsx)("div",{className:"h-full col-span-1"})]}),(0,r.jsxs)("div",{className:"grid h-[30px] border-b border-border",style:{gridTemplateColumns:"repeat(".concat(ev>0?ev:1,", ").concat(ee,"px)")},children:[Array.from({length:ev>0?ev:0}).map((e,t)=>{let s=(0,f.f)(eg,t);return(0,r.jsx)("div",{className:(0,j.cn)("flex items-center justify-center border-r border-border text-muted-foreground text-[10px]",(0,c.r)(s,eC)?"bg-primary/10 dark:bg-primary/20":""),title:(0,h.GP)(s,"EEE, MMM d"),children:(0,h.GP)(s,"d")},"".concat(t))}),ev<=0&&(0,r.jsx)("div",{className:"h-full col-span-1"})]})]}),(0,r.jsxs)("div",{className:"relative timeline-inner-content-scrollable-body",style:{height:"".concat(eO,"px"),width:"".concat(eE,"px")},children:[ef.length>0&&(0,r.jsxs)(r.Fragment,{children:[ef.map((e,t)=>(0,r.jsx)("div",{className:"absolute left-0 right-0 border-b border-border/30",style:{top:"".concat((t+1)*48-1,"px"),height:"1px",zIndex:1}},"row-line-".concat(t))),e_&&ev>0&&(0,r.jsx)("div",{className:"absolute top-0 bottom-0 w-[2px] bg-destructive/70 z-[5]",style:{left:"".concat(eP,"px")},title:"Today: ".concat((0,h.GP)(eC,"PPP")),children:(0,r.jsx)("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 bg-destructive text-white text-[8px] px-0.5 rounded-sm",children:"TODAY"})}),ef.map((e,t)=>{var s;let n=eb.get(e.id);if(!n)return null;let{barStartX:a,barWidth:i,isMilestoneRender:l}=n,c=(null==en?void 0:en.taskId)===e.id,o=(null==ei?void 0:ei.sourceTaskId)===e.id;return(0,r.jsxs)(V.AM,{open:em&&eu.taskId===e.id,onOpenChange:t=>{t?e.id!==eu.taskId&&(ep({taskId:e.id,currentTitle:e.title,currentTaskType:e.task_type,currentInstrumentSubtype:e.instrument_subtype,currentStatus:e.status,currentProgress:e.progress||0,currentSteps:"VALIDATION_PROJECT"===e.task_type&&e.steps||[],newStepText:""}),ex(!0)):(ex(!1),ep({taskId:null,currentTitle:"",currentTaskType:q.ci[0],currentInstrumentSubtype:void 0,currentStatus:"To Do",currentProgress:0,currentSteps:[],newStepText:""}))},children:[(0,r.jsxs)(z.m_,{delayDuration:c||o||em&&eu.taskId===e.id?999999:100,children:[(0,r.jsx)(z.k$,{asChild:!0,children:(0,r.jsx)(V.Wv,{asChild:!0,children:(0,r.jsxs)("div",{onMouseDown:t=>eT(t,e),onClick:t=>eS(t,e),onMouseEnter:()=>er(e.id),onMouseLeave:()=>er(null),className:(0,j.cn)("absolute transition-opacity duration-150 ease-in-out group cursor-grab z-10 flex items-center justify-center",B(e.status,l,e.task_type),!l&&"rounded-sm",c||o?"ring-2 ring-ring ring-offset-background ring-offset-1 shadow-lg":e.id===es?"ring-1 ring-primary/70":"",en&&en.taskId!==e.id||ei&&ei.sourceTaskId!==e.id||es&&e.id!==es?"opacity-50":"opacity-100"),style:{left:"".concat(a,"px"),width:"".concat(i<0?0:i,"px"),top:"".concat(48*t+(l?16:8),"px"),height:l?"".concat(16,"px"):"".concat(32,"px")},children:[!l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"resize-handle absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>ew(t,e,"start"),title:"Resize start date",children:(0,r.jsx)(_,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),(0,r.jsx)("div",{className:"resize-handle absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize z-20",onMouseDown:t=>ew(t,e,"end"),title:"Resize end date",children:(0,r.jsx)(_,{className:"h-full w-2 text-white/30 hover:text-white/70"})}),"VALIDATION_PROJECT"===e.task_type&&(0,r.jsx)("div",{className:"dependency-connector absolute right-[-6px] top-1/2 -translate-y-1/2 w-3 h-3 rounded-full bg-primary border-2 border-background cursor-crosshair z-30 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:t=>eD(t,e),title:"Draw dependency"})]}),!l&&(null==(s=e.status)?void 0:s.toLowerCase())!=="done"&&void 0!==e.progress&&e.progress>0&&i>0&&(0,r.jsx)("div",{className:"absolute top-0 left-0 h-full bg-black/40 rounded-sm",style:{width:"".concat(e.progress,"%")}}),l&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("svg",{viewBox:"0 0 100 100",className:"w-full h-full fill-current text-white/80",preserveAspectRatio:"none",children:(0,r.jsx)("polygon",{points:"50,0 100,50 50,100 0,50"})})}),!l&&i>.75*ee&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center px-1.5 overflow-hidden",children:(0,r.jsx)("span",{className:"text-[10px] text-white/90 font-medium whitespace-nowrap overflow-hidden text-ellipsis",children:e.title})})]})})}),(0,r.jsx)(z.ZI,{className:"p-2 shadow-lg bg-popover text-popover-foreground rounded-md border max-w-xs w-auto z-50",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{className:"font-semibold text-sm",children:[e.title,"VALIDATION_PROJECT"===e.task_type&&e.isMilestone?" (Milestone)":""]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Type: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.task_type.replace(/_/g," ")})]}),("MDL"===e.task_type||"SOP"===e.task_type)&&e.instrument_subtype&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Subtype: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.instrument_subtype})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Status: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.status})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Priority: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.priority})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Progress: ",(0,r.jsxs)("span",{className:"font-medium text-foreground",children:[e.progress||0,"%"]})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Dates: ",(0,h.GP)(e.startDate,"MMM d, yy")," - ",(0,h.GP)(e.dueDate,"MMM d, yy")]}),e.assignedTo_text&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Assigned to: ",(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.assignedTo_text})]}),"VALIDATION_PROJECT"===e.task_type&&e.dependencies&&e.dependencies.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Depends on:"}),(0,r.jsx)("ul",{className:"list-disc list-inside pl-2 space-y-0.5",children:e.dependencies.map(e=>{let t=S.find(t=>t.id===e);return(0,r.jsx)("li",{className:"text-xs font-medium text-foreground truncate",title:null==t?void 0:t.title,children:(null==t?void 0:t.title)||"Unknown Task"},e)})})]}),"VALIDATION_PROJECT"===e.task_type&&(!e.dependencies||0===e.dependencies.length)&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Dependencies: None"}),"VALIDATION_PROJECT"===e.task_type&&e.steps&&e.steps.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Steps:"}),(0,r.jsx)("ul",{className:"list-decimal list-inside pl-2 space-y-0.5 max-h-20 overflow-y-auto",children:e.steps.map((e,t)=>(0,r.jsx)("li",{className:"text-xs font-medium text-foreground truncate",title:e,children:e},t))})]})]})})]}),(0,r.jsx)(V.hl,{className:"w-96 z-50",side:"bottom",align:"start",children:(0,r.jsxs)("div",{className:"grid gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h4",{className:"font-medium leading-none",children:["Quick Edit: ",eu.currentTitle]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Modify task details."})]}),(0,r.jsxs)("div",{className:"grid gap-2",children:[(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(X.J,{htmlFor:"qe-title-".concat(e.id),children:"Name"}),(0,r.jsx)(R.p,{id:"qe-title-".concat(e.id),value:eu.currentTitle,onChange:e=>ep(t=>({...t,currentTitle:e.target.value})),className:"col-span-2 h-8"})]}),"VALIDATION_PROJECT"!==eu.currentTaskType&&("MDL"===eu.currentTaskType||"SOP"===eu.currentTaskType)&&(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(X.J,{htmlFor:"qe-instrument-".concat(e.id),children:"Subtype"}),(0,r.jsxs)(J.l6,{value:eu.currentInstrumentSubtype||"",onValueChange:e=>ep(t=>({...t,currentInstrumentSubtype:e})),children:[(0,r.jsx)(J.bq,{id:"qe-instrument-".concat(e.id),className:"col-span-2 h-8",children:(0,r.jsx)(J.yv,{placeholder:"Select subtype"})}),(0,r.jsx)(J.gC,{children:("MDL"===eu.currentTaskType?q.oe:q.tk).map(e=>(0,r.jsx)(J.eb,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(X.J,{htmlFor:"qe-status-".concat(e.id),children:"Status"}),(0,r.jsxs)(J.l6,{value:eu.currentStatus,onValueChange:e=>ep(t=>({...t,currentStatus:e})),children:[(0,r.jsx)(J.bq,{id:"qe-status-".concat(e.id),className:"col-span-2 h-8",children:(0,r.jsx)(J.yv,{placeholder:"Select status"})}),(0,r.jsx)(J.gC,{children:q.Hi.map(e=>(0,r.jsx)(J.eb,{value:e,children:e},e))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 items-center gap-4",children:[(0,r.jsx)(X.J,{htmlFor:"qe-progress-".concat(e.id),children:"Progress (%)"}),(0,r.jsx)(R.p,{id:"qe-progress-".concat(e.id),type:"number",min:"0",max:"100",value:eu.currentProgress,onChange:e=>ep(t=>({...t,currentProgress:parseInt(e.target.value,10)||0})),className:"col-span-2 h-8"})]}),"VALIDATION_PROJECT"===eu.currentTaskType&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(X.J,{children:"Steps"}),eu.currentSteps.length>0&&(0,r.jsx)(G.F,{className:"h-24 rounded-md border p-2",children:eu.currentSteps.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 py-1",children:[(0,r.jsxs)("span",{className:"text-sm flex-1 truncate",title:e,children:[t+1,". ",e]}),(0,r.jsx)(L.$,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0",onClick:()=>eI(t),children:(0,r.jsx)(P.A,{className:"h-3.5 w-3.5 text-destructive"})})]},t))}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(R.p,{placeholder:"New step description",value:eu.newStepText,onChange:e=>ep(t=>({...t,newStepText:e.target.value})),className:"h-8 flex-1"}),(0,r.jsxs)(L.$,{type:"button",size:"sm",onClick:eM,className:"h-8",children:[(0,r.jsx)(E.A,{className:"mr-1 h-4 w-4"})," Add"]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,r.jsx)(L.$,{variant:"ghost",size:"sm",onClick:()=>ex(!1),children:"Cancel"}),(0,r.jsxs)(L.$,{size:"sm",onClick:eA,children:[(0,r.jsx)(O.A,{className:"mr-1 h-4 w-4"}),"Save"]})]})]})})]},"".concat(e.id,"-popover"))}),ei&&(0,r.jsx)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none z-40",style:{width:eE,height:eO},children:(0,r.jsx)("line",{x1:ei.sourceTaskBarEndX,y1:ei.sourceTaskBarCenterY,x2:ei.currentMouseX,y2:ei.currentMouseY,stroke:"hsl(var(--primary))",strokeWidth:"2",strokeDasharray:"4 2"})}),ek.length>0&&(0,r.jsxs)("svg",{className:"absolute top-0 left-0 pointer-events-none",width:eE,height:eO,xmlns:"http://www.w3.org/2000/svg",style:{zIndex:20},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"arrowhead",markerWidth:6,markerHeight:4,refX:5.5,refY:2,orient:"auto-start-reverse",children:(0,r.jsx)("polygon",{points:"0 0, ".concat(5," ").concat(2,", 0 ").concat(4),fill:"hsl(var(--foreground) / 0.6)"})})}),ek.map(e=>(0,r.jsx)("path",{d:e.d,stroke:"hsl(var(--foreground) / 0.6)",strokeWidth:"1.5",fill:"none",markerEnd:"url(#arrowhead)"},e.id))]})]}),0===ef.length&&!H&&(0,r.jsx)("div",{style:{height:144},className:"flex items-center justify-center",children:eL()})]})]})})]})]})})}},77223:(e,t,s)=>{s.d(t,{A:()=>r});let r=(0,s(40157).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},81737:(e,t,s)=>{s.d(t,{A:()=>r});let r=(0,s(40157).A)("ListPlus",[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]])}}]);